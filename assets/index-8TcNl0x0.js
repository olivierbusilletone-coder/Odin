(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=r(i);fetch(i.href,s)}})();var Ee=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function of(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function oa(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var r=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}),r}var Ag={exports:{}},Ge=Ag.exports={},vr,_r;function Fu(){throw new Error("setTimeout has not been defined")}function ku(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?vr=setTimeout:vr=Fu}catch{vr=Fu}try{typeof clearTimeout=="function"?_r=clearTimeout:_r=ku}catch{_r=ku}})();function Tg(t){if(vr===setTimeout)return setTimeout(t,0);if((vr===Fu||!vr)&&setTimeout)return vr=setTimeout,setTimeout(t,0);try{return vr(t,0)}catch{try{return vr.call(null,t,0)}catch{return vr.call(this,t,0)}}}function kb(t){if(_r===clearTimeout)return clearTimeout(t);if((_r===ku||!_r)&&clearTimeout)return _r=clearTimeout,clearTimeout(t);try{return _r(t)}catch{try{return _r.call(null,t)}catch{return _r.call(this,t)}}}var Hr=[],_i=!1,jn,xo=-1;function jb(){!_i||!jn||(_i=!1,jn.length?Hr=jn.concat(Hr):xo=-1,Hr.length&&Og())}function Og(){if(!_i){var t=Tg(jb);_i=!0;for(var e=Hr.length;e;){for(jn=Hr,Hr=[];++xo<e;)jn&&jn[xo].run();xo=-1,e=Hr.length}jn=null,_i=!1,kb(t)}}Ge.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];Hr.push(new Cg(t,e)),Hr.length===1&&!_i&&Tg(Og)};function Cg(t,e){this.fun=t,this.array=e}Cg.prototype.run=function(){this.fun.apply(null,this.array)};Ge.title="browser";Ge.browser=!0;Ge.env={};Ge.argv=[];Ge.version="";Ge.versions={};function Zr(){}Ge.on=Zr;Ge.addListener=Zr;Ge.once=Zr;Ge.off=Zr;Ge.removeListener=Zr;Ge.removeAllListeners=Zr;Ge.emit=Zr;Ge.prependListener=Zr;Ge.prependOnceListener=Zr;Ge.listeners=function(t){return[]};Ge.binding=function(t){throw new Error("process.binding is not supported")};Ge.cwd=function(){return"/"};Ge.chdir=function(t){throw new Error("process.chdir is not supported")};Ge.umask=function(){return 0};var qb=Ag.exports;const zb=of(qb);var zi={},aa={};aa.byteLength=Kb;aa.toByteArray=Gb;aa.fromByteArray=Zb;var Sr=[],Yt=[],Vb=typeof Uint8Array<"u"?Uint8Array:Array,Dc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var ui=0,Hb=Dc.length;ui<Hb;++ui)Sr[ui]=Dc[ui],Yt[Dc.charCodeAt(ui)]=ui;Yt[45]=62;Yt[95]=63;function Dg(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");r===-1&&(r=e);var n=r===e?0:4-r%4;return[r,n]}function Kb(t){var e=Dg(t),r=e[0],n=e[1];return(r+n)*3/4-n}function Wb(t,e,r){return(e+r)*3/4-r}function Gb(t){var e,r=Dg(t),n=r[0],i=r[1],s=new Vb(Wb(t,n,i)),o=0,a=i>0?n-4:n,c;for(c=0;c<a;c+=4)e=Yt[t.charCodeAt(c)]<<18|Yt[t.charCodeAt(c+1)]<<12|Yt[t.charCodeAt(c+2)]<<6|Yt[t.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=Yt[t.charCodeAt(c)]<<2|Yt[t.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=Yt[t.charCodeAt(c)]<<10|Yt[t.charCodeAt(c+1)]<<4|Yt[t.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function Yb(t){return Sr[t>>18&63]+Sr[t>>12&63]+Sr[t>>6&63]+Sr[t&63]}function Xb(t,e,r){for(var n,i=[],s=e;s<r;s+=3)n=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),i.push(Yb(n));return i.join("")}function Zb(t){for(var e,r=t.length,n=r%3,i=[],s=16383,o=0,a=r-n;o<a;o+=s)i.push(Xb(t,o,o+s>a?a:o+s));return n===1?(e=t[r-1],i.push(Sr[e>>2]+Sr[e<<4&63]+"==")):n===2&&(e=(t[r-2]<<8)+t[r-1],i.push(Sr[e>>10]+Sr[e>>4&63]+Sr[e<<2&63]+"=")),i.join("")}var af={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */af.read=function(t,e,r,n,i){var s,o,a=i*8-n-1,c=(1<<a)-1,u=c>>1,l=-7,f=r?i-1:0,h=r?-1:1,p=t[e+f];for(f+=h,s=p&(1<<-l)-1,p>>=-l,l+=a;l>0;s=s*256+t[e+f],f+=h,l-=8);for(o=s&(1<<-l)-1,s>>=-l,l+=n;l>0;o=o*256+t[e+f],f+=h,l-=8);if(s===0)s=1-u;else{if(s===c)return o?NaN:(p?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-u}return(p?-1:1)*o*Math.pow(2,s-n)};af.write=function(t,e,r,n,i,s){var o,a,c,u=s*8-i-1,l=(1<<u)-1,f=l>>1,h=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:s-1,g=n?1:-1,w=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=l):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+f>=1?e+=h/c:e+=h*Math.pow(2,1-f),e*c>=2&&(o++,c/=2),o+f>=l?(a=0,o=l):o+f>=1?(a=(e*c-1)*Math.pow(2,i),o=o+f):(a=e*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;t[r+p]=a&255,p+=g,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;t[r+p]=o&255,p+=g,o/=256,u-=8);t[r+p-g]|=w*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=aa,r=af,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=a,t.SlowBuffer=I,t.INSPECT_MAX_BYTES=50;const i=2147483647;t.kMaxLength=i,a.TYPED_ARRAY_SUPPORT=s(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const _=new Uint8Array(1),d={foo:function(){return 42}};return Object.setPrototypeOf(d,Uint8Array.prototype),Object.setPrototypeOf(_,d),_.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function o(_){if(_>i)throw new RangeError('The value "'+_+'" is invalid for option "size"');const d=new Uint8Array(_);return Object.setPrototypeOf(d,a.prototype),d}function a(_,d,y){if(typeof _=="number"){if(typeof d=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return f(_)}return c(_,d,y)}a.poolSize=8192;function c(_,d,y){if(typeof _=="string")return h(_,d);if(ArrayBuffer.isView(_))return g(_);if(_==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof _);if(ge(_,ArrayBuffer)||_&&ge(_.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(ge(_,SharedArrayBuffer)||_&&ge(_.buffer,SharedArrayBuffer)))return w(_,d,y);if(typeof _=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const B=_.valueOf&&_.valueOf();if(B!=null&&B!==_)return a.from(B,d,y);const V=v(_);if(V)return V;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof _[Symbol.toPrimitive]=="function")return a.from(_[Symbol.toPrimitive]("string"),d,y);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof _)}a.from=function(_,d,y){return c(_,d,y)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function u(_){if(typeof _!="number")throw new TypeError('"size" argument must be of type number');if(_<0)throw new RangeError('The value "'+_+'" is invalid for option "size"')}function l(_,d,y){return u(_),_<=0?o(_):d!==void 0?typeof y=="string"?o(_).fill(d,y):o(_).fill(d):o(_)}a.alloc=function(_,d,y){return l(_,d,y)};function f(_){return u(_),o(_<0?0:E(_)|0)}a.allocUnsafe=function(_){return f(_)},a.allocUnsafeSlow=function(_){return f(_)};function h(_,d){if((typeof d!="string"||d==="")&&(d="utf8"),!a.isEncoding(d))throw new TypeError("Unknown encoding: "+d);const y=x(_,d)|0;let B=o(y);const V=B.write(_,d);return V!==y&&(B=B.slice(0,V)),B}function p(_){const d=_.length<0?0:E(_.length)|0,y=o(d);for(let B=0;B<d;B+=1)y[B]=_[B]&255;return y}function g(_){if(ge(_,Uint8Array)){const d=new Uint8Array(_);return w(d.buffer,d.byteOffset,d.byteLength)}return p(_)}function w(_,d,y){if(d<0||_.byteLength<d)throw new RangeError('"offset" is outside of buffer bounds');if(_.byteLength<d+(y||0))throw new RangeError('"length" is outside of buffer bounds');let B;return d===void 0&&y===void 0?B=new Uint8Array(_):y===void 0?B=new Uint8Array(_,d):B=new Uint8Array(_,d,y),Object.setPrototypeOf(B,a.prototype),B}function v(_){if(a.isBuffer(_)){const d=E(_.length)|0,y=o(d);return y.length===0||_.copy(y,0,0,d),y}if(_.length!==void 0)return typeof _.length!="number"||we(_.length)?o(0):p(_);if(_.type==="Buffer"&&Array.isArray(_.data))return p(_.data)}function E(_){if(_>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return _|0}function I(_){return+_!=_&&(_=0),a.alloc(+_)}a.isBuffer=function(d){return d!=null&&d._isBuffer===!0&&d!==a.prototype},a.compare=function(d,y){if(ge(d,Uint8Array)&&(d=a.from(d,d.offset,d.byteLength)),ge(y,Uint8Array)&&(y=a.from(y,y.offset,y.byteLength)),!a.isBuffer(d)||!a.isBuffer(y))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(d===y)return 0;let B=d.length,V=y.length;for(let re=0,oe=Math.min(B,V);re<oe;++re)if(d[re]!==y[re]){B=d[re],V=y[re];break}return B<V?-1:V<B?1:0},a.isEncoding=function(d){switch(String(d).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(d,y){if(!Array.isArray(d))throw new TypeError('"list" argument must be an Array of Buffers');if(d.length===0)return a.alloc(0);let B;if(y===void 0)for(y=0,B=0;B<d.length;++B)y+=d[B].length;const V=a.allocUnsafe(y);let re=0;for(B=0;B<d.length;++B){let oe=d[B];if(ge(oe,Uint8Array))re+oe.length>V.length?(a.isBuffer(oe)||(oe=a.from(oe)),oe.copy(V,re)):Uint8Array.prototype.set.call(V,oe,re);else if(a.isBuffer(oe))oe.copy(V,re);else throw new TypeError('"list" argument must be an Array of Buffers');re+=oe.length}return V};function x(_,d){if(a.isBuffer(_))return _.length;if(ArrayBuffer.isView(_)||ge(_,ArrayBuffer))return _.byteLength;if(typeof _!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof _);const y=_.length,B=arguments.length>2&&arguments[2]===!0;if(!B&&y===0)return 0;let V=!1;for(;;)switch(d){case"ascii":case"latin1":case"binary":return y;case"utf8":case"utf-8":return $(_).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return y*2;case"hex":return y>>>1;case"base64":return Q(_).length;default:if(V)return B?-1:$(_).length;d=(""+d).toLowerCase(),V=!0}}a.byteLength=x;function A(_,d,y){let B=!1;if((d===void 0||d<0)&&(d=0),d>this.length||((y===void 0||y>this.length)&&(y=this.length),y<=0)||(y>>>=0,d>>>=0,y<=d))return"";for(_||(_="utf8");;)switch(_){case"hex":return k(this,d,y);case"utf8":case"utf-8":return K(this,d,y);case"ascii":return F(this,d,y);case"latin1":case"binary":return Y(this,d,y);case"base64":return L(this,d,y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return W(this,d,y);default:if(B)throw new TypeError("Unknown encoding: "+_);_=(_+"").toLowerCase(),B=!0}}a.prototype._isBuffer=!0;function T(_,d,y){const B=_[d];_[d]=_[y],_[y]=B}a.prototype.swap16=function(){const d=this.length;if(d%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let y=0;y<d;y+=2)T(this,y,y+1);return this},a.prototype.swap32=function(){const d=this.length;if(d%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let y=0;y<d;y+=4)T(this,y,y+3),T(this,y+1,y+2);return this},a.prototype.swap64=function(){const d=this.length;if(d%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let y=0;y<d;y+=8)T(this,y,y+7),T(this,y+1,y+6),T(this,y+2,y+5),T(this,y+3,y+4);return this},a.prototype.toString=function(){const d=this.length;return d===0?"":arguments.length===0?K(this,0,d):A.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(d){if(!a.isBuffer(d))throw new TypeError("Argument must be a Buffer");return this===d?!0:a.compare(this,d)===0},a.prototype.inspect=function(){let d="";const y=t.INSPECT_MAX_BYTES;return d=this.toString("hex",0,y).replace(/(.{2})/g,"$1 ").trim(),this.length>y&&(d+=" ... "),"<Buffer "+d+">"},n&&(a.prototype[n]=a.prototype.inspect),a.prototype.compare=function(d,y,B,V,re){if(ge(d,Uint8Array)&&(d=a.from(d,d.offset,d.byteLength)),!a.isBuffer(d))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof d);if(y===void 0&&(y=0),B===void 0&&(B=d?d.length:0),V===void 0&&(V=0),re===void 0&&(re=this.length),y<0||B>d.length||V<0||re>this.length)throw new RangeError("out of range index");if(V>=re&&y>=B)return 0;if(V>=re)return-1;if(y>=B)return 1;if(y>>>=0,B>>>=0,V>>>=0,re>>>=0,this===d)return 0;let oe=re-V,ve=B-y;const Oe=Math.min(oe,ve),Se=this.slice(V,re),be=d.slice(y,B);for(let Ue=0;Ue<Oe;++Ue)if(Se[Ue]!==be[Ue]){oe=Se[Ue],ve=be[Ue];break}return oe<ve?-1:ve<oe?1:0};function O(_,d,y,B,V){if(_.length===0)return-1;if(typeof y=="string"?(B=y,y=0):y>2147483647?y=2147483647:y<-2147483648&&(y=-2147483648),y=+y,we(y)&&(y=V?0:_.length-1),y<0&&(y=_.length+y),y>=_.length){if(V)return-1;y=_.length-1}else if(y<0)if(V)y=0;else return-1;if(typeof d=="string"&&(d=a.from(d,B)),a.isBuffer(d))return d.length===0?-1:P(_,d,y,B,V);if(typeof d=="number")return d=d&255,typeof Uint8Array.prototype.indexOf=="function"?V?Uint8Array.prototype.indexOf.call(_,d,y):Uint8Array.prototype.lastIndexOf.call(_,d,y):P(_,[d],y,B,V);throw new TypeError("val must be string, number or Buffer")}function P(_,d,y,B,V){let re=1,oe=_.length,ve=d.length;if(B!==void 0&&(B=String(B).toLowerCase(),B==="ucs2"||B==="ucs-2"||B==="utf16le"||B==="utf-16le")){if(_.length<2||d.length<2)return-1;re=2,oe/=2,ve/=2,y/=2}function Oe(be,Ue){return re===1?be[Ue]:be.readUInt16BE(Ue*re)}let Se;if(V){let be=-1;for(Se=y;Se<oe;Se++)if(Oe(_,Se)===Oe(d,be===-1?0:Se-be)){if(be===-1&&(be=Se),Se-be+1===ve)return be*re}else be!==-1&&(Se-=Se-be),be=-1}else for(y+ve>oe&&(y=oe-ve),Se=y;Se>=0;Se--){let be=!0;for(let Ue=0;Ue<ve;Ue++)if(Oe(_,Se+Ue)!==Oe(d,Ue)){be=!1;break}if(be)return Se}return-1}a.prototype.includes=function(d,y,B){return this.indexOf(d,y,B)!==-1},a.prototype.indexOf=function(d,y,B){return O(this,d,y,B,!0)},a.prototype.lastIndexOf=function(d,y,B){return O(this,d,y,B,!1)};function M(_,d,y,B){y=Number(y)||0;const V=_.length-y;B?(B=Number(B),B>V&&(B=V)):B=V;const re=d.length;B>re/2&&(B=re/2);let oe;for(oe=0;oe<B;++oe){const ve=parseInt(d.substr(oe*2,2),16);if(we(ve))return oe;_[y+oe]=ve}return oe}function U(_,d,y,B){return ce($(d,_.length-y),_,y,B)}function G(_,d,y,B){return ce(X(d),_,y,B)}function se(_,d,y,B){return ce(Q(d),_,y,B)}function Z(_,d,y,B){return ce(ee(d,_.length-y),_,y,B)}a.prototype.write=function(d,y,B,V){if(y===void 0)V="utf8",B=this.length,y=0;else if(B===void 0&&typeof y=="string")V=y,B=this.length,y=0;else if(isFinite(y))y=y>>>0,isFinite(B)?(B=B>>>0,V===void 0&&(V="utf8")):(V=B,B=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const re=this.length-y;if((B===void 0||B>re)&&(B=re),d.length>0&&(B<0||y<0)||y>this.length)throw new RangeError("Attempt to write outside buffer bounds");V||(V="utf8");let oe=!1;for(;;)switch(V){case"hex":return M(this,d,y,B);case"utf8":case"utf-8":return U(this,d,y,B);case"ascii":case"latin1":case"binary":return G(this,d,y,B);case"base64":return se(this,d,y,B);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Z(this,d,y,B);default:if(oe)throw new TypeError("Unknown encoding: "+V);V=(""+V).toLowerCase(),oe=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function L(_,d,y){return d===0&&y===_.length?e.fromByteArray(_):e.fromByteArray(_.slice(d,y))}function K(_,d,y){y=Math.min(_.length,y);const B=[];let V=d;for(;V<y;){const re=_[V];let oe=null,ve=re>239?4:re>223?3:re>191?2:1;if(V+ve<=y){let Oe,Se,be,Ue;switch(ve){case 1:re<128&&(oe=re);break;case 2:Oe=_[V+1],(Oe&192)===128&&(Ue=(re&31)<<6|Oe&63,Ue>127&&(oe=Ue));break;case 3:Oe=_[V+1],Se=_[V+2],(Oe&192)===128&&(Se&192)===128&&(Ue=(re&15)<<12|(Oe&63)<<6|Se&63,Ue>2047&&(Ue<55296||Ue>57343)&&(oe=Ue));break;case 4:Oe=_[V+1],Se=_[V+2],be=_[V+3],(Oe&192)===128&&(Se&192)===128&&(be&192)===128&&(Ue=(re&15)<<18|(Oe&63)<<12|(Se&63)<<6|be&63,Ue>65535&&Ue<1114112&&(oe=Ue))}}oe===null?(oe=65533,ve=1):oe>65535&&(oe-=65536,B.push(oe>>>10&1023|55296),oe=56320|oe&1023),B.push(oe),V+=ve}return C(B)}const D=4096;function C(_){const d=_.length;if(d<=D)return String.fromCharCode.apply(String,_);let y="",B=0;for(;B<d;)y+=String.fromCharCode.apply(String,_.slice(B,B+=D));return y}function F(_,d,y){let B="";y=Math.min(_.length,y);for(let V=d;V<y;++V)B+=String.fromCharCode(_[V]&127);return B}function Y(_,d,y){let B="";y=Math.min(_.length,y);for(let V=d;V<y;++V)B+=String.fromCharCode(_[V]);return B}function k(_,d,y){const B=_.length;(!d||d<0)&&(d=0),(!y||y<0||y>B)&&(y=B);let V="";for(let re=d;re<y;++re)V+=xe[_[re]];return V}function W(_,d,y){const B=_.slice(d,y);let V="";for(let re=0;re<B.length-1;re+=2)V+=String.fromCharCode(B[re]+B[re+1]*256);return V}a.prototype.slice=function(d,y){const B=this.length;d=~~d,y=y===void 0?B:~~y,d<0?(d+=B,d<0&&(d=0)):d>B&&(d=B),y<0?(y+=B,y<0&&(y=0)):y>B&&(y=B),y<d&&(y=d);const V=this.subarray(d,y);return Object.setPrototypeOf(V,a.prototype),V};function te(_,d,y){if(_%1!==0||_<0)throw new RangeError("offset is not uint");if(_+d>y)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(d,y,B){d=d>>>0,y=y>>>0,B||te(d,y,this.length);let V=this[d],re=1,oe=0;for(;++oe<y&&(re*=256);)V+=this[d+oe]*re;return V},a.prototype.readUintBE=a.prototype.readUIntBE=function(d,y,B){d=d>>>0,y=y>>>0,B||te(d,y,this.length);let V=this[d+--y],re=1;for(;y>0&&(re*=256);)V+=this[d+--y]*re;return V},a.prototype.readUint8=a.prototype.readUInt8=function(d,y){return d=d>>>0,y||te(d,1,this.length),this[d]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(d,y){return d=d>>>0,y||te(d,2,this.length),this[d]|this[d+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(d,y){return d=d>>>0,y||te(d,2,this.length),this[d]<<8|this[d+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(d,y){return d=d>>>0,y||te(d,4,this.length),(this[d]|this[d+1]<<8|this[d+2]<<16)+this[d+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(d,y){return d=d>>>0,y||te(d,4,this.length),this[d]*16777216+(this[d+1]<<16|this[d+2]<<8|this[d+3])},a.prototype.readBigUInt64LE=Ae(function(d){d=d>>>0,R(d,"offset");const y=this[d],B=this[d+7];(y===void 0||B===void 0)&&N(d,this.length-8);const V=y+this[++d]*2**8+this[++d]*2**16+this[++d]*2**24,re=this[++d]+this[++d]*2**8+this[++d]*2**16+B*2**24;return BigInt(V)+(BigInt(re)<<BigInt(32))}),a.prototype.readBigUInt64BE=Ae(function(d){d=d>>>0,R(d,"offset");const y=this[d],B=this[d+7];(y===void 0||B===void 0)&&N(d,this.length-8);const V=y*2**24+this[++d]*2**16+this[++d]*2**8+this[++d],re=this[++d]*2**24+this[++d]*2**16+this[++d]*2**8+B;return(BigInt(V)<<BigInt(32))+BigInt(re)}),a.prototype.readIntLE=function(d,y,B){d=d>>>0,y=y>>>0,B||te(d,y,this.length);let V=this[d],re=1,oe=0;for(;++oe<y&&(re*=256);)V+=this[d+oe]*re;return re*=128,V>=re&&(V-=Math.pow(2,8*y)),V},a.prototype.readIntBE=function(d,y,B){d=d>>>0,y=y>>>0,B||te(d,y,this.length);let V=y,re=1,oe=this[d+--V];for(;V>0&&(re*=256);)oe+=this[d+--V]*re;return re*=128,oe>=re&&(oe-=Math.pow(2,8*y)),oe},a.prototype.readInt8=function(d,y){return d=d>>>0,y||te(d,1,this.length),this[d]&128?(255-this[d]+1)*-1:this[d]},a.prototype.readInt16LE=function(d,y){d=d>>>0,y||te(d,2,this.length);const B=this[d]|this[d+1]<<8;return B&32768?B|4294901760:B},a.prototype.readInt16BE=function(d,y){d=d>>>0,y||te(d,2,this.length);const B=this[d+1]|this[d]<<8;return B&32768?B|4294901760:B},a.prototype.readInt32LE=function(d,y){return d=d>>>0,y||te(d,4,this.length),this[d]|this[d+1]<<8|this[d+2]<<16|this[d+3]<<24},a.prototype.readInt32BE=function(d,y){return d=d>>>0,y||te(d,4,this.length),this[d]<<24|this[d+1]<<16|this[d+2]<<8|this[d+3]},a.prototype.readBigInt64LE=Ae(function(d){d=d>>>0,R(d,"offset");const y=this[d],B=this[d+7];(y===void 0||B===void 0)&&N(d,this.length-8);const V=this[d+4]+this[d+5]*2**8+this[d+6]*2**16+(B<<24);return(BigInt(V)<<BigInt(32))+BigInt(y+this[++d]*2**8+this[++d]*2**16+this[++d]*2**24)}),a.prototype.readBigInt64BE=Ae(function(d){d=d>>>0,R(d,"offset");const y=this[d],B=this[d+7];(y===void 0||B===void 0)&&N(d,this.length-8);const V=(y<<24)+this[++d]*2**16+this[++d]*2**8+this[++d];return(BigInt(V)<<BigInt(32))+BigInt(this[++d]*2**24+this[++d]*2**16+this[++d]*2**8+B)}),a.prototype.readFloatLE=function(d,y){return d=d>>>0,y||te(d,4,this.length),r.read(this,d,!0,23,4)},a.prototype.readFloatBE=function(d,y){return d=d>>>0,y||te(d,4,this.length),r.read(this,d,!1,23,4)},a.prototype.readDoubleLE=function(d,y){return d=d>>>0,y||te(d,8,this.length),r.read(this,d,!0,52,8)},a.prototype.readDoubleBE=function(d,y){return d=d>>>0,y||te(d,8,this.length),r.read(this,d,!1,52,8)};function ie(_,d,y,B,V,re){if(!a.isBuffer(_))throw new TypeError('"buffer" argument must be a Buffer instance');if(d>V||d<re)throw new RangeError('"value" argument is out of bounds');if(y+B>_.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(d,y,B,V){if(d=+d,y=y>>>0,B=B>>>0,!V){const ve=Math.pow(2,8*B)-1;ie(this,d,y,B,ve,0)}let re=1,oe=0;for(this[y]=d&255;++oe<B&&(re*=256);)this[y+oe]=d/re&255;return y+B},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(d,y,B,V){if(d=+d,y=y>>>0,B=B>>>0,!V){const ve=Math.pow(2,8*B)-1;ie(this,d,y,B,ve,0)}let re=B-1,oe=1;for(this[y+re]=d&255;--re>=0&&(oe*=256);)this[y+re]=d/oe&255;return y+B},a.prototype.writeUint8=a.prototype.writeUInt8=function(d,y,B){return d=+d,y=y>>>0,B||ie(this,d,y,1,255,0),this[y]=d&255,y+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(d,y,B){return d=+d,y=y>>>0,B||ie(this,d,y,2,65535,0),this[y]=d&255,this[y+1]=d>>>8,y+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(d,y,B){return d=+d,y=y>>>0,B||ie(this,d,y,2,65535,0),this[y]=d>>>8,this[y+1]=d&255,y+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(d,y,B){return d=+d,y=y>>>0,B||ie(this,d,y,4,4294967295,0),this[y+3]=d>>>24,this[y+2]=d>>>16,this[y+1]=d>>>8,this[y]=d&255,y+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(d,y,B){return d=+d,y=y>>>0,B||ie(this,d,y,4,4294967295,0),this[y]=d>>>24,this[y+1]=d>>>16,this[y+2]=d>>>8,this[y+3]=d&255,y+4};function he(_,d,y,B,V){b(d,B,V,_,y,7);let re=Number(d&BigInt(4294967295));_[y++]=re,re=re>>8,_[y++]=re,re=re>>8,_[y++]=re,re=re>>8,_[y++]=re;let oe=Number(d>>BigInt(32)&BigInt(4294967295));return _[y++]=oe,oe=oe>>8,_[y++]=oe,oe=oe>>8,_[y++]=oe,oe=oe>>8,_[y++]=oe,y}function J(_,d,y,B,V){b(d,B,V,_,y,7);let re=Number(d&BigInt(4294967295));_[y+7]=re,re=re>>8,_[y+6]=re,re=re>>8,_[y+5]=re,re=re>>8,_[y+4]=re;let oe=Number(d>>BigInt(32)&BigInt(4294967295));return _[y+3]=oe,oe=oe>>8,_[y+2]=oe,oe=oe>>8,_[y+1]=oe,oe=oe>>8,_[y]=oe,y+8}a.prototype.writeBigUInt64LE=Ae(function(d,y=0){return he(this,d,y,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=Ae(function(d,y=0){return J(this,d,y,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(d,y,B,V){if(d=+d,y=y>>>0,!V){const Oe=Math.pow(2,8*B-1);ie(this,d,y,B,Oe-1,-Oe)}let re=0,oe=1,ve=0;for(this[y]=d&255;++re<B&&(oe*=256);)d<0&&ve===0&&this[y+re-1]!==0&&(ve=1),this[y+re]=(d/oe>>0)-ve&255;return y+B},a.prototype.writeIntBE=function(d,y,B,V){if(d=+d,y=y>>>0,!V){const Oe=Math.pow(2,8*B-1);ie(this,d,y,B,Oe-1,-Oe)}let re=B-1,oe=1,ve=0;for(this[y+re]=d&255;--re>=0&&(oe*=256);)d<0&&ve===0&&this[y+re+1]!==0&&(ve=1),this[y+re]=(d/oe>>0)-ve&255;return y+B},a.prototype.writeInt8=function(d,y,B){return d=+d,y=y>>>0,B||ie(this,d,y,1,127,-128),d<0&&(d=255+d+1),this[y]=d&255,y+1},a.prototype.writeInt16LE=function(d,y,B){return d=+d,y=y>>>0,B||ie(this,d,y,2,32767,-32768),this[y]=d&255,this[y+1]=d>>>8,y+2},a.prototype.writeInt16BE=function(d,y,B){return d=+d,y=y>>>0,B||ie(this,d,y,2,32767,-32768),this[y]=d>>>8,this[y+1]=d&255,y+2},a.prototype.writeInt32LE=function(d,y,B){return d=+d,y=y>>>0,B||ie(this,d,y,4,2147483647,-2147483648),this[y]=d&255,this[y+1]=d>>>8,this[y+2]=d>>>16,this[y+3]=d>>>24,y+4},a.prototype.writeInt32BE=function(d,y,B){return d=+d,y=y>>>0,B||ie(this,d,y,4,2147483647,-2147483648),d<0&&(d=4294967295+d+1),this[y]=d>>>24,this[y+1]=d>>>16,this[y+2]=d>>>8,this[y+3]=d&255,y+4},a.prototype.writeBigInt64LE=Ae(function(d,y=0){return he(this,d,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=Ae(function(d,y=0){return J(this,d,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function fe(_,d,y,B,V,re){if(y+B>_.length)throw new RangeError("Index out of range");if(y<0)throw new RangeError("Index out of range")}function q(_,d,y,B,V){return d=+d,y=y>>>0,V||fe(_,d,y,4),r.write(_,d,y,B,23,4),y+4}a.prototype.writeFloatLE=function(d,y,B){return q(this,d,y,!0,B)},a.prototype.writeFloatBE=function(d,y,B){return q(this,d,y,!1,B)};function j(_,d,y,B,V){return d=+d,y=y>>>0,V||fe(_,d,y,8),r.write(_,d,y,B,52,8),y+8}a.prototype.writeDoubleLE=function(d,y,B){return j(this,d,y,!0,B)},a.prototype.writeDoubleBE=function(d,y,B){return j(this,d,y,!1,B)},a.prototype.copy=function(d,y,B,V){if(!a.isBuffer(d))throw new TypeError("argument should be a Buffer");if(B||(B=0),!V&&V!==0&&(V=this.length),y>=d.length&&(y=d.length),y||(y=0),V>0&&V<B&&(V=B),V===B||d.length===0||this.length===0)return 0;if(y<0)throw new RangeError("targetStart out of bounds");if(B<0||B>=this.length)throw new RangeError("Index out of range");if(V<0)throw new RangeError("sourceEnd out of bounds");V>this.length&&(V=this.length),d.length-y<V-B&&(V=d.length-y+B);const re=V-B;return this===d&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(y,B,V):Uint8Array.prototype.set.call(d,this.subarray(B,V),y),re},a.prototype.fill=function(d,y,B,V){if(typeof d=="string"){if(typeof y=="string"?(V=y,y=0,B=this.length):typeof B=="string"&&(V=B,B=this.length),V!==void 0&&typeof V!="string")throw new TypeError("encoding must be a string");if(typeof V=="string"&&!a.isEncoding(V))throw new TypeError("Unknown encoding: "+V);if(d.length===1){const oe=d.charCodeAt(0);(V==="utf8"&&oe<128||V==="latin1")&&(d=oe)}}else typeof d=="number"?d=d&255:typeof d=="boolean"&&(d=Number(d));if(y<0||this.length<y||this.length<B)throw new RangeError("Out of range index");if(B<=y)return this;y=y>>>0,B=B===void 0?this.length:B>>>0,d||(d=0);let re;if(typeof d=="number")for(re=y;re<B;++re)this[re]=d;else{const oe=a.isBuffer(d)?d:a.from(d,V),ve=oe.length;if(ve===0)throw new TypeError('The value "'+d+'" is invalid for argument "value"');for(re=0;re<B-y;++re)this[re+y]=oe[re%ve]}return this};const ne={};function ae(_,d,y){ne[_]=class extends y{constructor(){super(),Object.defineProperty(this,"message",{value:d.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${_}]`,this.stack,delete this.name}get code(){return _}set code(V){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:V,writable:!0})}toString(){return`${this.name} [${_}]: ${this.message}`}}}ae("ERR_BUFFER_OUT_OF_BOUNDS",function(_){return _?`${_} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),ae("ERR_INVALID_ARG_TYPE",function(_,d){return`The "${_}" argument must be of type number. Received type ${typeof d}`},TypeError),ae("ERR_OUT_OF_RANGE",function(_,d,y){let B=`The value of "${_}" is out of range.`,V=y;return Number.isInteger(y)&&Math.abs(y)>2**32?V=S(String(y)):typeof y=="bigint"&&(V=String(y),(y>BigInt(2)**BigInt(32)||y<-(BigInt(2)**BigInt(32)))&&(V=S(V)),V+="n"),B+=` It must be ${d}. Received ${V}`,B},RangeError);function S(_){let d="",y=_.length;const B=_[0]==="-"?1:0;for(;y>=B+4;y-=3)d=`_${_.slice(y-3,y)}${d}`;return`${_.slice(0,y)}${d}`}function m(_,d,y){R(d,"offset"),(_[d]===void 0||_[d+y]===void 0)&&N(d,_.length-(y+1))}function b(_,d,y,B,V,re){if(_>y||_<d){const oe=typeof d=="bigint"?"n":"";let ve;throw d===0||d===BigInt(0)?ve=`>= 0${oe} and < 2${oe} ** ${(re+1)*8}${oe}`:ve=`>= -(2${oe} ** ${(re+1)*8-1}${oe}) and < 2 ** ${(re+1)*8-1}${oe}`,new ne.ERR_OUT_OF_RANGE("value",ve,_)}m(B,V,re)}function R(_,d){if(typeof _!="number")throw new ne.ERR_INVALID_ARG_TYPE(d,"number",_)}function N(_,d,y){throw Math.floor(_)!==_?(R(_,y),new ne.ERR_OUT_OF_RANGE("offset","an integer",_)):d<0?new ne.ERR_BUFFER_OUT_OF_BOUNDS:new ne.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${d}`,_)}const z=/[^+/0-9A-Za-z-_]/g;function H(_){if(_=_.split("=")[0],_=_.trim().replace(z,""),_.length<2)return"";for(;_.length%4!==0;)_=_+"=";return _}function $(_,d){d=d||1/0;let y;const B=_.length;let V=null;const re=[];for(let oe=0;oe<B;++oe){if(y=_.charCodeAt(oe),y>55295&&y<57344){if(!V){if(y>56319){(d-=3)>-1&&re.push(239,191,189);continue}else if(oe+1===B){(d-=3)>-1&&re.push(239,191,189);continue}V=y;continue}if(y<56320){(d-=3)>-1&&re.push(239,191,189),V=y;continue}y=(V-55296<<10|y-56320)+65536}else V&&(d-=3)>-1&&re.push(239,191,189);if(V=null,y<128){if((d-=1)<0)break;re.push(y)}else if(y<2048){if((d-=2)<0)break;re.push(y>>6|192,y&63|128)}else if(y<65536){if((d-=3)<0)break;re.push(y>>12|224,y>>6&63|128,y&63|128)}else if(y<1114112){if((d-=4)<0)break;re.push(y>>18|240,y>>12&63|128,y>>6&63|128,y&63|128)}else throw new Error("Invalid code point")}return re}function X(_){const d=[];for(let y=0;y<_.length;++y)d.push(_.charCodeAt(y)&255);return d}function ee(_,d){let y,B,V;const re=[];for(let oe=0;oe<_.length&&!((d-=2)<0);++oe)y=_.charCodeAt(oe),B=y>>8,V=y%256,re.push(V),re.push(B);return re}function Q(_){return e.toByteArray(H(_))}function ce(_,d,y,B){let V;for(V=0;V<B&&!(V+y>=d.length||V>=_.length);++V)d[V+y]=_[V];return V}function ge(_,d){return _ instanceof d||_!=null&&_.constructor!=null&&_.constructor.name!=null&&_.constructor.name===d.name}function we(_){return _!==_}const xe=function(){const _="0123456789abcdef",d=new Array(256);for(let y=0;y<16;++y){const B=y*16;for(let V=0;V<16;++V)d[B+V]=_[y]+_[V]}return d}();function Ae(_){return typeof BigInt>"u"?Be:_}function Be(){throw new Error("BigInt not supported")}})(zi);var Ms={},Jb=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},Bg={},qt={};let cf;const Qb=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];qt.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return e*4+17};qt.getSymbolTotalCodewords=function(e){return Qb[e]};qt.getBCHDigit=function(t){let e=0;for(;t!==0;)e++,t>>>=1;return e};qt.setToSJISFunction=function(e){if(typeof e!="function")throw new Error('"toSJISFunc" is not a valid function.');cf=e};qt.isKanjiModeEnabled=function(){return typeof cf<"u"};qt.toSJIS=function(e){return cf(e)};var ca={};(function(t){t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2};function e(r){if(typeof r!="string")throw new Error("Param is not a string");switch(r.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+r)}}t.isValid=function(n){return n&&typeof n.bit<"u"&&n.bit>=0&&n.bit<4},t.from=function(n,i){if(t.isValid(n))return n;try{return e(n)}catch{return i}}})(ca);function Rg(){this.buffer=[],this.length=0}Rg.prototype={get:function(t){const e=Math.floor(t/8);return(this.buffer[e]>>>7-t%8&1)===1},put:function(t,e){for(let r=0;r<e;r++)this.putBit((t>>>e-r-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(t){const e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var eE=Rg;function Fs(t){if(!t||t<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=t,this.data=new Uint8Array(t*t),this.reservedBit=new Uint8Array(t*t)}Fs.prototype.set=function(t,e,r,n){const i=t*this.size+e;this.data[i]=r,n&&(this.reservedBit[i]=!0)};Fs.prototype.get=function(t,e){return this.data[t*this.size+e]};Fs.prototype.xor=function(t,e,r){this.data[t*this.size+e]^=r};Fs.prototype.isReserved=function(t,e){return this.reservedBit[t*this.size+e]};var tE=Fs,Ng={};(function(t){const e=qt.getSymbolSize;t.getRowColCoords=function(n){if(n===1)return[];const i=Math.floor(n/7)+2,s=e(n),o=s===145?26:Math.ceil((s-13)/(2*i-2))*2,a=[s-7];for(let c=1;c<i-1;c++)a[c]=a[c-1]-o;return a.push(6),a.reverse()},t.getPositions=function(n){const i=[],s=t.getRowColCoords(n),o=s.length;for(let a=0;a<o;a++)for(let c=0;c<o;c++)a===0&&c===0||a===0&&c===o-1||a===o-1&&c===0||i.push([s[a],s[c]]);return i}})(Ng);var Pg={};const rE=qt.getSymbolSize,Oh=7;Pg.getPositions=function(e){const r=rE(e);return[[0,0],[r-Oh,0],[0,r-Oh]]};var Ug={};(function(t){t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const e={N1:3,N2:3,N3:40,N4:10};t.isValid=function(i){return i!=null&&i!==""&&!isNaN(i)&&i>=0&&i<=7},t.from=function(i){return t.isValid(i)?parseInt(i,10):void 0},t.getPenaltyN1=function(i){const s=i.size;let o=0,a=0,c=0,u=null,l=null;for(let f=0;f<s;f++){a=c=0,u=l=null;for(let h=0;h<s;h++){let p=i.get(f,h);p===u?a++:(a>=5&&(o+=e.N1+(a-5)),u=p,a=1),p=i.get(h,f),p===l?c++:(c>=5&&(o+=e.N1+(c-5)),l=p,c=1)}a>=5&&(o+=e.N1+(a-5)),c>=5&&(o+=e.N1+(c-5))}return o},t.getPenaltyN2=function(i){const s=i.size;let o=0;for(let a=0;a<s-1;a++)for(let c=0;c<s-1;c++){const u=i.get(a,c)+i.get(a,c+1)+i.get(a+1,c)+i.get(a+1,c+1);(u===4||u===0)&&o++}return o*e.N2},t.getPenaltyN3=function(i){const s=i.size;let o=0,a=0,c=0;for(let u=0;u<s;u++){a=c=0;for(let l=0;l<s;l++)a=a<<1&2047|i.get(u,l),l>=10&&(a===1488||a===93)&&o++,c=c<<1&2047|i.get(l,u),l>=10&&(c===1488||c===93)&&o++}return o*e.N3},t.getPenaltyN4=function(i){let s=0;const o=i.data.length;for(let c=0;c<o;c++)s+=i.data[c];return Math.abs(Math.ceil(s*100/o/5)-10)*e.N4};function r(n,i,s){switch(n){case t.Patterns.PATTERN000:return(i+s)%2===0;case t.Patterns.PATTERN001:return i%2===0;case t.Patterns.PATTERN010:return s%3===0;case t.Patterns.PATTERN011:return(i+s)%3===0;case t.Patterns.PATTERN100:return(Math.floor(i/2)+Math.floor(s/3))%2===0;case t.Patterns.PATTERN101:return i*s%2+i*s%3===0;case t.Patterns.PATTERN110:return(i*s%2+i*s%3)%2===0;case t.Patterns.PATTERN111:return(i*s%3+(i+s)%2)%2===0;default:throw new Error("bad maskPattern:"+n)}}t.applyMask=function(i,s){const o=s.size;for(let a=0;a<o;a++)for(let c=0;c<o;c++)s.isReserved(c,a)||s.xor(c,a,r(i,c,a))},t.getBestMask=function(i,s){const o=Object.keys(t.Patterns).length;let a=0,c=1/0;for(let u=0;u<o;u++){s(u),t.applyMask(u,i);const l=t.getPenaltyN1(i)+t.getPenaltyN2(i)+t.getPenaltyN3(i)+t.getPenaltyN4(i);t.applyMask(u,i),l<c&&(c=l,a=u)}return a}})(Ug);var ua={};const bn=ca,Qs=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],eo=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];ua.getBlocksCount=function(e,r){switch(r){case bn.L:return Qs[(e-1)*4+0];case bn.M:return Qs[(e-1)*4+1];case bn.Q:return Qs[(e-1)*4+2];case bn.H:return Qs[(e-1)*4+3];default:return}};ua.getTotalCodewordsCount=function(e,r){switch(r){case bn.L:return eo[(e-1)*4+0];case bn.M:return eo[(e-1)*4+1];case bn.Q:return eo[(e-1)*4+2];case bn.H:return eo[(e-1)*4+3];default:return}};var Lg={},la={};const ps=new Uint8Array(512),Po=new Uint8Array(256);(function(){let e=1;for(let r=0;r<255;r++)ps[r]=e,Po[e]=r,e<<=1,e&256&&(e^=285);for(let r=255;r<512;r++)ps[r]=ps[r-255]})();la.log=function(e){if(e<1)throw new Error("log("+e+")");return Po[e]};la.exp=function(e){return ps[e]};la.mul=function(e,r){return e===0||r===0?0:ps[Po[e]+Po[r]]};(function(t){const e=la;t.mul=function(n,i){const s=new Uint8Array(n.length+i.length-1);for(let o=0;o<n.length;o++)for(let a=0;a<i.length;a++)s[o+a]^=e.mul(n[o],i[a]);return s},t.mod=function(n,i){let s=new Uint8Array(n);for(;s.length-i.length>=0;){const o=s[0];for(let c=0;c<i.length;c++)s[c]^=e.mul(i[c],o);let a=0;for(;a<s.length&&s[a]===0;)a++;s=s.slice(a)}return s},t.generateECPolynomial=function(n){let i=new Uint8Array([1]);for(let s=0;s<n;s++)i=t.mul(i,new Uint8Array([1,e.exp(s)]));return i}})(Lg);const $g=Lg;function uf(t){this.genPoly=void 0,this.degree=t,this.degree&&this.initialize(this.degree)}uf.prototype.initialize=function(e){this.degree=e,this.genPoly=$g.generateECPolynomial(this.degree)};uf.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");const r=new Uint8Array(e.length+this.degree);r.set(e);const n=$g.mod(r,this.genPoly),i=this.degree-n.length;if(i>0){const s=new Uint8Array(this.degree);return s.set(n,i),s}return n};var nE=uf,Mg={},Dn={},lf={};lf.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40};var Or={};const Fg="[0-9]+",iE="[A-Z $%*+\\-./:]+";let Is="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";Is=Is.replace(/u/g,"\\u");const sE="(?:(?![A-Z0-9 $%*+\\-./:]|"+Is+`)(?:.|[\r
]))+`;Or.KANJI=new RegExp(Is,"g");Or.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");Or.BYTE=new RegExp(sE,"g");Or.NUMERIC=new RegExp(Fg,"g");Or.ALPHANUMERIC=new RegExp(iE,"g");const oE=new RegExp("^"+Is+"$"),aE=new RegExp("^"+Fg+"$"),cE=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");Or.testKanji=function(e){return oE.test(e)};Or.testNumeric=function(e){return aE.test(e)};Or.testAlphanumeric=function(e){return cE.test(e)};(function(t){const e=lf,r=Or;t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(s,o){if(!s.ccBits)throw new Error("Invalid mode: "+s);if(!e.isValid(o))throw new Error("Invalid version: "+o);return o>=1&&o<10?s.ccBits[0]:o<27?s.ccBits[1]:s.ccBits[2]},t.getBestModeForData=function(s){return r.testNumeric(s)?t.NUMERIC:r.testAlphanumeric(s)?t.ALPHANUMERIC:r.testKanji(s)?t.KANJI:t.BYTE},t.toString=function(s){if(s&&s.id)return s.id;throw new Error("Invalid mode")},t.isValid=function(s){return s&&s.bit&&s.ccBits};function n(i){if(typeof i!="string")throw new Error("Param is not a string");switch(i.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+i)}}t.from=function(s,o){if(t.isValid(s))return s;try{return n(s)}catch{return o}}})(Dn);(function(t){const e=qt,r=ua,n=ca,i=Dn,s=lf,o=7973,a=e.getBCHDigit(o);function c(h,p,g){for(let w=1;w<=40;w++)if(p<=t.getCapacity(w,g,h))return w}function u(h,p){return i.getCharCountIndicator(h,p)+4}function l(h,p){let g=0;return h.forEach(function(w){const v=u(w.mode,p);g+=v+w.getBitsLength()}),g}function f(h,p){for(let g=1;g<=40;g++)if(l(h,g)<=t.getCapacity(g,p,i.MIXED))return g}t.from=function(p,g){return s.isValid(p)?parseInt(p,10):g},t.getCapacity=function(p,g,w){if(!s.isValid(p))throw new Error("Invalid QR Code version");typeof w>"u"&&(w=i.BYTE);const v=e.getSymbolTotalCodewords(p),E=r.getTotalCodewordsCount(p,g),I=(v-E)*8;if(w===i.MIXED)return I;const x=I-u(w,p);switch(w){case i.NUMERIC:return Math.floor(x/10*3);case i.ALPHANUMERIC:return Math.floor(x/11*2);case i.KANJI:return Math.floor(x/13);case i.BYTE:default:return Math.floor(x/8)}},t.getBestVersionForData=function(p,g){let w;const v=n.from(g,n.M);if(Array.isArray(p)){if(p.length>1)return f(p,v);if(p.length===0)return 1;w=p[0]}else w=p;return c(w.mode,w.getLength(),v)},t.getEncodedBits=function(p){if(!s.isValid(p)||p<7)throw new Error("Invalid QR Code version");let g=p<<12;for(;e.getBCHDigit(g)-a>=0;)g^=o<<e.getBCHDigit(g)-a;return p<<12|g}})(Mg);var kg={};const ju=qt,jg=1335,uE=21522,Ch=ju.getBCHDigit(jg);kg.getEncodedBits=function(e,r){const n=e.bit<<3|r;let i=n<<10;for(;ju.getBCHDigit(i)-Ch>=0;)i^=jg<<ju.getBCHDigit(i)-Ch;return(n<<10|i)^uE};var qg={};const lE=Dn;function Di(t){this.mode=lE.NUMERIC,this.data=t.toString()}Di.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)};Di.prototype.getLength=function(){return this.data.length};Di.prototype.getBitsLength=function(){return Di.getBitsLength(this.data.length)};Di.prototype.write=function(e){let r,n,i;for(r=0;r+3<=this.data.length;r+=3)n=this.data.substr(r,3),i=parseInt(n,10),e.put(i,10);const s=this.data.length-r;s>0&&(n=this.data.substr(r),i=parseInt(n,10),e.put(i,s*3+1))};var fE=Di;const hE=Dn,Bc=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function Bi(t){this.mode=hE.ALPHANUMERIC,this.data=t}Bi.getBitsLength=function(e){return 11*Math.floor(e/2)+6*(e%2)};Bi.prototype.getLength=function(){return this.data.length};Bi.prototype.getBitsLength=function(){return Bi.getBitsLength(this.data.length)};Bi.prototype.write=function(e){let r;for(r=0;r+2<=this.data.length;r+=2){let n=Bc.indexOf(this.data[r])*45;n+=Bc.indexOf(this.data[r+1]),e.put(n,11)}this.data.length%2&&e.put(Bc.indexOf(this.data[r]),6)};var dE=Bi;const pE=Dn;function Ri(t){this.mode=pE.BYTE,typeof t=="string"?this.data=new TextEncoder().encode(t):this.data=new Uint8Array(t)}Ri.getBitsLength=function(e){return e*8};Ri.prototype.getLength=function(){return this.data.length};Ri.prototype.getBitsLength=function(){return Ri.getBitsLength(this.data.length)};Ri.prototype.write=function(t){for(let e=0,r=this.data.length;e<r;e++)t.put(this.data[e],8)};var gE=Ri;const yE=Dn,wE=qt;function Ni(t){this.mode=yE.KANJI,this.data=t}Ni.getBitsLength=function(e){return e*13};Ni.prototype.getLength=function(){return this.data.length};Ni.prototype.getBitsLength=function(){return Ni.getBitsLength(this.data.length)};Ni.prototype.write=function(t){let e;for(e=0;e<this.data.length;e++){let r=wE.toSJIS(this.data[e]);if(r>=33088&&r<=40956)r-=33088;else if(r>=57408&&r<=60351)r-=49472;else throw new Error("Invalid SJIS character: "+this.data[e]+`
Make sure your charset is UTF-8`);r=(r>>>8&255)*192+(r&255),t.put(r,13)}};var mE=Ni,zg={exports:{}};(function(t){var e={single_source_shortest_paths:function(r,n,i){var s={},o={};o[n]=0;var a=e.PriorityQueue.make();a.push(n,0);for(var c,u,l,f,h,p,g,w,v;!a.empty();){c=a.pop(),u=c.value,f=c.cost,h=r[u]||{};for(l in h)h.hasOwnProperty(l)&&(p=h[l],g=f+p,w=o[l],v=typeof o[l]>"u",(v||w>g)&&(o[l]=g,a.push(l,g),s[l]=u))}if(typeof i<"u"&&typeof o[i]>"u"){var E=["Could not find a path from ",n," to ",i,"."].join("");throw new Error(E)}return s},extract_shortest_path_from_predecessor_list:function(r,n){for(var i=[],s=n;s;)i.push(s),r[s],s=r[s];return i.reverse(),i},find_path:function(r,n,i){var s=e.single_source_shortest_paths(r,n,i);return e.extract_shortest_path_from_predecessor_list(s,i)},PriorityQueue:{make:function(r){var n=e.PriorityQueue,i={},s;r=r||{};for(s in n)n.hasOwnProperty(s)&&(i[s]=n[s]);return i.queue=[],i.sorter=r.sorter||n.default_sorter,i},default_sorter:function(r,n){return r.cost-n.cost},push:function(r,n){var i={value:r,cost:n};this.queue.push(i),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};t.exports=e})(zg);var bE=zg.exports;(function(t){const e=Dn,r=fE,n=dE,i=gE,s=mE,o=Or,a=qt,c=bE;function u(E){return unescape(encodeURIComponent(E)).length}function l(E,I,x){const A=[];let T;for(;(T=E.exec(x))!==null;)A.push({data:T[0],index:T.index,mode:I,length:T[0].length});return A}function f(E){const I=l(o.NUMERIC,e.NUMERIC,E),x=l(o.ALPHANUMERIC,e.ALPHANUMERIC,E);let A,T;return a.isKanjiModeEnabled()?(A=l(o.BYTE,e.BYTE,E),T=l(o.KANJI,e.KANJI,E)):(A=l(o.BYTE_KANJI,e.BYTE,E),T=[]),I.concat(x,A,T).sort(function(P,M){return P.index-M.index}).map(function(P){return{data:P.data,mode:P.mode,length:P.length}})}function h(E,I){switch(I){case e.NUMERIC:return r.getBitsLength(E);case e.ALPHANUMERIC:return n.getBitsLength(E);case e.KANJI:return s.getBitsLength(E);case e.BYTE:return i.getBitsLength(E)}}function p(E){return E.reduce(function(I,x){const A=I.length-1>=0?I[I.length-1]:null;return A&&A.mode===x.mode?(I[I.length-1].data+=x.data,I):(I.push(x),I)},[])}function g(E){const I=[];for(let x=0;x<E.length;x++){const A=E[x];switch(A.mode){case e.NUMERIC:I.push([A,{data:A.data,mode:e.ALPHANUMERIC,length:A.length},{data:A.data,mode:e.BYTE,length:A.length}]);break;case e.ALPHANUMERIC:I.push([A,{data:A.data,mode:e.BYTE,length:A.length}]);break;case e.KANJI:I.push([A,{data:A.data,mode:e.BYTE,length:u(A.data)}]);break;case e.BYTE:I.push([{data:A.data,mode:e.BYTE,length:u(A.data)}])}}return I}function w(E,I){const x={},A={start:{}};let T=["start"];for(let O=0;O<E.length;O++){const P=E[O],M=[];for(let U=0;U<P.length;U++){const G=P[U],se=""+O+U;M.push(se),x[se]={node:G,lastCount:0},A[se]={};for(let Z=0;Z<T.length;Z++){const L=T[Z];x[L]&&x[L].node.mode===G.mode?(A[L][se]=h(x[L].lastCount+G.length,G.mode)-h(x[L].lastCount,G.mode),x[L].lastCount+=G.length):(x[L]&&(x[L].lastCount=G.length),A[L][se]=h(G.length,G.mode)+4+e.getCharCountIndicator(G.mode,I))}}T=M}for(let O=0;O<T.length;O++)A[T[O]].end=0;return{map:A,table:x}}function v(E,I){let x;const A=e.getBestModeForData(E);if(x=e.from(I,A),x!==e.BYTE&&x.bit<A.bit)throw new Error('"'+E+'" cannot be encoded with mode '+e.toString(x)+`.
 Suggested mode is: `+e.toString(A));switch(x===e.KANJI&&!a.isKanjiModeEnabled()&&(x=e.BYTE),x){case e.NUMERIC:return new r(E);case e.ALPHANUMERIC:return new n(E);case e.KANJI:return new s(E);case e.BYTE:return new i(E)}}t.fromArray=function(I){return I.reduce(function(x,A){return typeof A=="string"?x.push(v(A,null)):A.data&&x.push(v(A.data,A.mode)),x},[])},t.fromString=function(I,x){const A=f(I,a.isKanjiModeEnabled()),T=g(A),O=w(T,x),P=c.find_path(O.map,"start","end"),M=[];for(let U=1;U<P.length-1;U++)M.push(O.table[P[U]].node);return t.fromArray(p(M))},t.rawSplit=function(I){return t.fromArray(f(I,a.isKanjiModeEnabled()))}})(qg);const fa=qt,Rc=ca,EE=eE,vE=tE,_E=Ng,xE=Pg,qu=Ug,zu=ua,SE=nE,Uo=Mg,IE=kg,AE=Dn,Nc=qg;function TE(t,e){const r=t.size,n=xE.getPositions(e);for(let i=0;i<n.length;i++){const s=n[i][0],o=n[i][1];for(let a=-1;a<=7;a++)if(!(s+a<=-1||r<=s+a))for(let c=-1;c<=7;c++)o+c<=-1||r<=o+c||(a>=0&&a<=6&&(c===0||c===6)||c>=0&&c<=6&&(a===0||a===6)||a>=2&&a<=4&&c>=2&&c<=4?t.set(s+a,o+c,!0,!0):t.set(s+a,o+c,!1,!0))}}function OE(t){const e=t.size;for(let r=8;r<e-8;r++){const n=r%2===0;t.set(r,6,n,!0),t.set(6,r,n,!0)}}function CE(t,e){const r=_E.getPositions(e);for(let n=0;n<r.length;n++){const i=r[n][0],s=r[n][1];for(let o=-2;o<=2;o++)for(let a=-2;a<=2;a++)o===-2||o===2||a===-2||a===2||o===0&&a===0?t.set(i+o,s+a,!0,!0):t.set(i+o,s+a,!1,!0)}}function DE(t,e){const r=t.size,n=Uo.getEncodedBits(e);let i,s,o;for(let a=0;a<18;a++)i=Math.floor(a/3),s=a%3+r-8-3,o=(n>>a&1)===1,t.set(i,s,o,!0),t.set(s,i,o,!0)}function Pc(t,e,r){const n=t.size,i=IE.getEncodedBits(e,r);let s,o;for(s=0;s<15;s++)o=(i>>s&1)===1,s<6?t.set(s,8,o,!0):s<8?t.set(s+1,8,o,!0):t.set(n-15+s,8,o,!0),s<8?t.set(8,n-s-1,o,!0):s<9?t.set(8,15-s-1+1,o,!0):t.set(8,15-s-1,o,!0);t.set(n-8,8,1,!0)}function BE(t,e){const r=t.size;let n=-1,i=r-1,s=7,o=0;for(let a=r-1;a>0;a-=2)for(a===6&&a--;;){for(let c=0;c<2;c++)if(!t.isReserved(i,a-c)){let u=!1;o<e.length&&(u=(e[o]>>>s&1)===1),t.set(i,a-c,u),s--,s===-1&&(o++,s=7)}if(i+=n,i<0||r<=i){i-=n,n=-n;break}}}function RE(t,e,r){const n=new EE;r.forEach(function(c){n.put(c.mode.bit,4),n.put(c.getLength(),AE.getCharCountIndicator(c.mode,t)),c.write(n)});const i=fa.getSymbolTotalCodewords(t),s=zu.getTotalCodewordsCount(t,e),o=(i-s)*8;for(n.getLengthInBits()+4<=o&&n.put(0,4);n.getLengthInBits()%8!==0;)n.putBit(0);const a=(o-n.getLengthInBits())/8;for(let c=0;c<a;c++)n.put(c%2?17:236,8);return NE(n,t,e)}function NE(t,e,r){const n=fa.getSymbolTotalCodewords(e),i=zu.getTotalCodewordsCount(e,r),s=n-i,o=zu.getBlocksCount(e,r),a=n%o,c=o-a,u=Math.floor(n/o),l=Math.floor(s/o),f=l+1,h=u-l,p=new SE(h);let g=0;const w=new Array(o),v=new Array(o);let E=0;const I=new Uint8Array(t.buffer);for(let P=0;P<o;P++){const M=P<c?l:f;w[P]=I.slice(g,g+M),v[P]=p.encode(w[P]),g+=M,E=Math.max(E,M)}const x=new Uint8Array(n);let A=0,T,O;for(T=0;T<E;T++)for(O=0;O<o;O++)T<w[O].length&&(x[A++]=w[O][T]);for(T=0;T<h;T++)for(O=0;O<o;O++)x[A++]=v[O][T];return x}function PE(t,e,r,n){let i;if(Array.isArray(t))i=Nc.fromArray(t);else if(typeof t=="string"){let u=e;if(!u){const l=Nc.rawSplit(t);u=Uo.getBestVersionForData(l,r)}i=Nc.fromString(t,u||40)}else throw new Error("Invalid data");const s=Uo.getBestVersionForData(i,r);if(!s)throw new Error("The amount of data is too big to be stored in a QR Code");if(!e)e=s;else if(e<s)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+s+`.
`);const o=RE(e,r,i),a=fa.getSymbolSize(e),c=new vE(a);return TE(c,e),OE(c),CE(c,e),Pc(c,r,0),e>=7&&DE(c,e),BE(c,o),isNaN(n)&&(n=qu.getBestMask(c,Pc.bind(null,c,r))),qu.applyMask(n,c),Pc(c,r,n),{modules:c,version:e,errorCorrectionLevel:r,maskPattern:n,segments:i}}Bg.create=function(e,r){if(typeof e>"u"||e==="")throw new Error("No input text");let n=Rc.M,i,s;return typeof r<"u"&&(n=Rc.from(r.errorCorrectionLevel,Rc.M),i=Uo.from(r.version),s=qu.from(r.maskPattern),r.toSJISFunc&&fa.setToSJISFunction(r.toSJISFunc)),PE(e,i,n,s)};var Vg={},ff={};(function(t){function e(r){if(typeof r=="number"&&(r=r.toString()),typeof r!="string")throw new Error("Color should be defined as hex string");let n=r.slice().replace("#","").split("");if(n.length<3||n.length===5||n.length>8)throw new Error("Invalid hex color: "+r);(n.length===3||n.length===4)&&(n=Array.prototype.concat.apply([],n.map(function(s){return[s,s]}))),n.length===6&&n.push("F","F");const i=parseInt(n.join(""),16);return{r:i>>24&255,g:i>>16&255,b:i>>8&255,a:i&255,hex:"#"+n.slice(0,6).join("")}}t.getOptions=function(n){n||(n={}),n.color||(n.color={});const i=typeof n.margin>"u"||n.margin===null||n.margin<0?4:n.margin,s=n.width&&n.width>=21?n.width:void 0,o=n.scale||4;return{width:s,scale:s?4:o,margin:i,color:{dark:e(n.color.dark||"#000000ff"),light:e(n.color.light||"#ffffffff")},type:n.type,rendererOpts:n.rendererOpts||{}}},t.getScale=function(n,i){return i.width&&i.width>=n+i.margin*2?i.width/(n+i.margin*2):i.scale},t.getImageWidth=function(n,i){const s=t.getScale(n,i);return Math.floor((n+i.margin*2)*s)},t.qrToImageData=function(n,i,s){const o=i.modules.size,a=i.modules.data,c=t.getScale(o,s),u=Math.floor((o+s.margin*2)*c),l=s.margin*c,f=[s.color.light,s.color.dark];for(let h=0;h<u;h++)for(let p=0;p<u;p++){let g=(h*u+p)*4,w=s.color.light;if(h>=l&&p>=l&&h<u-l&&p<u-l){const v=Math.floor((h-l)/c),E=Math.floor((p-l)/c);w=f[a[v*o+E]?1:0]}n[g++]=w.r,n[g++]=w.g,n[g++]=w.b,n[g]=w.a}}})(ff);(function(t){const e=ff;function r(i,s,o){i.clearRect(0,0,s.width,s.height),s.style||(s.style={}),s.height=o,s.width=o,s.style.height=o+"px",s.style.width=o+"px"}function n(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}t.render=function(s,o,a){let c=a,u=o;typeof c>"u"&&(!o||!o.getContext)&&(c=o,o=void 0),o||(u=n()),c=e.getOptions(c);const l=e.getImageWidth(s.modules.size,c),f=u.getContext("2d"),h=f.createImageData(l,l);return e.qrToImageData(h.data,s,c),r(f,u,l),f.putImageData(h,0,0),u},t.renderToDataURL=function(s,o,a){let c=a;typeof c>"u"&&(!o||!o.getContext)&&(c=o,o=void 0),c||(c={});const u=t.render(s,o,c),l=c.type||"image/png",f=c.rendererOpts||{};return u.toDataURL(l,f.quality)}})(Vg);var Hg={};const UE=ff;function Dh(t,e){const r=t.a/255,n=e+'="'+t.hex+'"';return r<1?n+" "+e+'-opacity="'+r.toFixed(2).slice(1)+'"':n}function Uc(t,e,r){let n=t+e;return typeof r<"u"&&(n+=" "+r),n}function LE(t,e,r){let n="",i=0,s=!1,o=0;for(let a=0;a<t.length;a++){const c=Math.floor(a%e),u=Math.floor(a/e);!c&&!s&&(s=!0),t[a]?(o++,a>0&&c>0&&t[a-1]||(n+=s?Uc("M",c+r,.5+u+r):Uc("m",i,0),i=0,s=!1),c+1<e&&t[a+1]||(n+=Uc("h",o),o=0)):i++}return n}Hg.render=function(e,r,n){const i=UE.getOptions(r),s=e.modules.size,o=e.modules.data,a=s+i.margin*2,c=i.color.light.a?"<path "+Dh(i.color.light,"fill")+' d="M0 0h'+a+"v"+a+'H0z"/>':"",u="<path "+Dh(i.color.dark,"stroke")+' d="'+LE(o,s,i.margin)+'"/>',l='viewBox="0 0 '+a+" "+a+'"',h='<svg xmlns="http://www.w3.org/2000/svg" '+(i.width?'width="'+i.width+'" height="'+i.width+'" ':"")+l+' shape-rendering="crispEdges">'+c+u+`</svg>
`;return typeof n=="function"&&n(null,h),h};const $E=Jb,Vu=Bg,Kg=Vg,ME=Hg;function hf(t,e,r,n,i){const s=[].slice.call(arguments,1),o=s.length,a=typeof s[o-1]=="function";if(!a&&!$E())throw new Error("Callback required as last argument");if(a){if(o<2)throw new Error("Too few arguments provided");o===2?(i=r,r=e,e=n=void 0):o===3&&(e.getContext&&typeof i>"u"?(i=n,n=void 0):(i=n,n=r,r=e,e=void 0))}else{if(o<1)throw new Error("Too few arguments provided");return o===1?(r=e,e=n=void 0):o===2&&!e.getContext&&(n=r,r=e,e=void 0),new Promise(function(c,u){try{const l=Vu.create(r,n);c(t(l,e,n))}catch(l){u(l)}})}try{const c=Vu.create(r,n);i(null,t(c,e,n))}catch(c){i(c)}}Ms.create=Vu.create;Ms.toCanvas=hf.bind(null,Kg.render);Ms.toDataURL=hf.bind(null,Kg.renderToDataURL);Ms.toString=hf.bind(null,function(t,e,r){return ME.render(t,r)});var Wg={},Gg={},Pi={},Sn={},Lo="qpzry9x8gf2tvdw0s3jn54khce6mua7l",Hu={};for(var to=0;to<Lo.length;to++){var Lc=Lo.charAt(to);if(Hu[Lc]!==void 0)throw new TypeError(Lc+" is ambiguous");Hu[Lc]=to}function xi(t){var e=t>>25;return(t&33554431)<<5^-(e>>0&1)&996825010^-(e>>1&1)&642813549^-(e>>2&1)&513874426^-(e>>3&1)&1027748829^-(e>>4&1)&705979059}function Yg(t){for(var e=1,r=0;r<t.length;++r){var n=t.charCodeAt(r);if(n<33||n>126)return"Invalid prefix ("+t+")";e=xi(e)^n>>5}for(e=xi(e),r=0;r<t.length;++r){var i=t.charCodeAt(r);e=xi(e)^i&31}return e}function FE(t,e,r){if(r=r||90,t.length+7+e.length>r)throw new TypeError("Exceeds length limit");t=t.toLowerCase();var n=Yg(t);if(typeof n=="string")throw new Error(n);for(var i=t+"1",s=0;s<e.length;++s){var o=e[s];if(o>>5)throw new Error("Non 5-bit word");n=xi(n)^o,i+=Lo.charAt(o)}for(s=0;s<6;++s)n=xi(n);for(n^=1,s=0;s<6;++s){var a=n>>(5-s)*5&31;i+=Lo.charAt(a)}return i}function Xg(t,e){if(e=e||90,t.length<8)return t+" too short";if(t.length>e)return"Exceeds length limit";var r=t.toLowerCase(),n=t.toUpperCase();if(t!==r&&t!==n)return"Mixed-case string "+t;t=r;var i=t.lastIndexOf("1");if(i===-1)return"No separator character for "+t;if(i===0)return"Missing prefix for "+t;var s=t.slice(0,i),o=t.slice(i+1);if(o.length<6)return"Data too short";var a=Yg(s);if(typeof a=="string")return a;for(var c=[],u=0;u<o.length;++u){var l=o.charAt(u),f=Hu[l];if(f===void 0)return"Unknown character "+l;a=xi(a)^f,!(u+6>=o.length)&&c.push(f)}return a!==1?"Invalid checksum for "+t:{prefix:s,words:c}}function kE(){var t=Xg.apply(null,arguments);if(typeof t=="object")return t}function jE(t){var e=Xg.apply(null,arguments);if(typeof e=="object")return e;throw new Error(e)}function ha(t,e,r,n){for(var i=0,s=0,o=(1<<r)-1,a=[],c=0;c<t.length;++c)for(i=i<<e|t[c],s+=e;s>=r;)s-=r,a.push(i>>s&o);if(n)s>0&&a.push(i<<r-s&o);else{if(s>=e)return"Excess padding";if(i<<r-s&o)return"Non-zero padding"}return a}function qE(t){var e=ha(t,8,5,!0);if(Array.isArray(e))return e}function zE(t){var e=ha(t,8,5,!0);if(Array.isArray(e))return e;throw new Error(e)}function VE(t){var e=ha(t,5,8,!1);if(Array.isArray(e))return e}function HE(t){var e=ha(t,5,8,!1);if(Array.isArray(e))return e;throw new Error(e)}var KE={decodeUnsafe:kE,decode:jE,encode:FE,toWordsUnsafe:qE,toWords:zE,fromWordsUnsafe:VE,fromWords:HE},Zg={exports:{}};(function(t){(function(e){var r,n=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,i=Math.ceil,s=Math.floor,o="[BigNumber Error] ",a=o+"Number primitive has more than 15 significant digits: ",c=1e14,u=14,l=9007199254740991,f=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],h=1e7,p=1e9;function g(O){var P,M,U,G=J.prototype={constructor:J,toString:null,valueOf:null},se=new J(1),Z=20,L=4,K=-7,D=21,C=-1e7,F=1e7,Y=!1,k=1,W=0,te={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},ie="0123456789abcdefghijklmnopqrstuvwxyz",he=!0;function J(S,m){var b,R,N,z,H,$,X,ee,Q=this;if(!(Q instanceof J))return new J(S,m);if(m==null){if(S&&S._isBigNumber===!0){Q.s=S.s,!S.c||S.e>F?Q.c=Q.e=null:S.e<C?Q.c=[Q.e=0]:(Q.e=S.e,Q.c=S.c.slice());return}if(($=typeof S=="number")&&S*0==0){if(Q.s=1/S<0?(S=-S,-1):1,S===~~S){for(z=0,H=S;H>=10;H/=10,z++);z>F?Q.c=Q.e=null:(Q.e=z,Q.c=[S]);return}ee=String(S)}else{if(!n.test(ee=String(S)))return U(Q,ee,$);Q.s=ee.charCodeAt(0)==45?(ee=ee.slice(1),-1):1}(z=ee.indexOf("."))>-1&&(ee=ee.replace(".","")),(H=ee.search(/e/i))>0?(z<0&&(z=H),z+=+ee.slice(H+1),ee=ee.substring(0,H)):z<0&&(z=ee.length)}else{if(I(m,2,ie.length,"Base"),m==10&&he)return Q=new J(S),ne(Q,Z+Q.e+1,L);if(ee=String(S),$=typeof S=="number"){if(S*0!=0)return U(Q,ee,$,m);if(Q.s=1/S<0?(ee=ee.slice(1),-1):1,J.DEBUG&&ee.replace(/^0\.0*|\./,"").length>15)throw Error(a+S)}else Q.s=ee.charCodeAt(0)===45?(ee=ee.slice(1),-1):1;for(b=ie.slice(0,m),z=H=0,X=ee.length;H<X;H++)if(b.indexOf(R=ee.charAt(H))<0){if(R=="."){if(H>z){z=X;continue}}else if(!N&&(ee==ee.toUpperCase()&&(ee=ee.toLowerCase())||ee==ee.toLowerCase()&&(ee=ee.toUpperCase()))){N=!0,H=-1,z=0;continue}return U(Q,String(S),$,m)}$=!1,ee=M(ee,m,10,Q.s),(z=ee.indexOf("."))>-1?ee=ee.replace(".",""):z=ee.length}for(H=0;ee.charCodeAt(H)===48;H++);for(X=ee.length;ee.charCodeAt(--X)===48;);if(ee=ee.slice(H,++X)){if(X-=H,$&&J.DEBUG&&X>15&&(S>l||S!==s(S)))throw Error(a+Q.s*S);if((z=z-H-1)>F)Q.c=Q.e=null;else if(z<C)Q.c=[Q.e=0];else{if(Q.e=z,Q.c=[],H=(z+1)%u,z<0&&(H+=u),H<X){for(H&&Q.c.push(+ee.slice(0,H)),X-=u;H<X;)Q.c.push(+ee.slice(H,H+=u));H=u-(ee=ee.slice(H)).length}else H-=X;for(;H--;ee+="0");Q.c.push(+ee)}}else Q.c=[Q.e=0]}J.clone=g,J.ROUND_UP=0,J.ROUND_DOWN=1,J.ROUND_CEIL=2,J.ROUND_FLOOR=3,J.ROUND_HALF_UP=4,J.ROUND_HALF_DOWN=5,J.ROUND_HALF_EVEN=6,J.ROUND_HALF_CEIL=7,J.ROUND_HALF_FLOOR=8,J.EUCLID=9,J.config=J.set=function(S){var m,b;if(S!=null)if(typeof S=="object"){if(S.hasOwnProperty(m="DECIMAL_PLACES")&&(b=S[m],I(b,0,p,m),Z=b),S.hasOwnProperty(m="ROUNDING_MODE")&&(b=S[m],I(b,0,8,m),L=b),S.hasOwnProperty(m="EXPONENTIAL_AT")&&(b=S[m],b&&b.pop?(I(b[0],-p,0,m),I(b[1],0,p,m),K=b[0],D=b[1]):(I(b,-p,p,m),K=-(D=b<0?-b:b))),S.hasOwnProperty(m="RANGE"))if(b=S[m],b&&b.pop)I(b[0],-p,-1,m),I(b[1],1,p,m),C=b[0],F=b[1];else if(I(b,-p,p,m),b)C=-(F=b<0?-b:b);else throw Error(o+m+" cannot be zero: "+b);if(S.hasOwnProperty(m="CRYPTO"))if(b=S[m],b===!!b)if(b)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))Y=b;else throw Y=!b,Error(o+"crypto unavailable");else Y=b;else throw Error(o+m+" not true or false: "+b);if(S.hasOwnProperty(m="MODULO_MODE")&&(b=S[m],I(b,0,9,m),k=b),S.hasOwnProperty(m="POW_PRECISION")&&(b=S[m],I(b,0,p,m),W=b),S.hasOwnProperty(m="FORMAT"))if(b=S[m],typeof b=="object")te=b;else throw Error(o+m+" not an object: "+b);if(S.hasOwnProperty(m="ALPHABET"))if(b=S[m],typeof b=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(b))he=b.slice(0,10)=="0123456789",ie=b;else throw Error(o+m+" invalid: "+b)}else throw Error(o+"Object expected: "+S);return{DECIMAL_PLACES:Z,ROUNDING_MODE:L,EXPONENTIAL_AT:[K,D],RANGE:[C,F],CRYPTO:Y,MODULO_MODE:k,POW_PRECISION:W,FORMAT:te,ALPHABET:ie}},J.isBigNumber=function(S){if(!S||S._isBigNumber!==!0)return!1;if(!J.DEBUG)return!0;var m,b,R=S.c,N=S.e,z=S.s;e:if({}.toString.call(R)=="[object Array]"){if((z===1||z===-1)&&N>=-p&&N<=p&&N===s(N)){if(R[0]===0){if(N===0&&R.length===1)return!0;break e}if(m=(N+1)%u,m<1&&(m+=u),String(R[0]).length==m){for(m=0;m<R.length;m++)if(b=R[m],b<0||b>=c||b!==s(b))break e;if(b!==0)return!0}}}else if(R===null&&N===null&&(z===null||z===1||z===-1))return!0;throw Error(o+"Invalid BigNumber: "+S)},J.maximum=J.max=function(){return q(arguments,-1)},J.minimum=J.min=function(){return q(arguments,1)},J.random=function(){var S=9007199254740992,m=Math.random()*S&2097151?function(){return s(Math.random()*S)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(b){var R,N,z,H,$,X=0,ee=[],Q=new J(se);if(b==null?b=Z:I(b,0,p),H=i(b/u),Y)if(crypto.getRandomValues){for(R=crypto.getRandomValues(new Uint32Array(H*=2));X<H;)$=R[X]*131072+(R[X+1]>>>11),$>=9e15?(N=crypto.getRandomValues(new Uint32Array(2)),R[X]=N[0],R[X+1]=N[1]):(ee.push($%1e14),X+=2);X=H/2}else if(crypto.randomBytes){for(R=crypto.randomBytes(H*=7);X<H;)$=(R[X]&31)*281474976710656+R[X+1]*1099511627776+R[X+2]*4294967296+R[X+3]*16777216+(R[X+4]<<16)+(R[X+5]<<8)+R[X+6],$>=9e15?crypto.randomBytes(7).copy(R,X):(ee.push($%1e14),X+=7);X=H/7}else throw Y=!1,Error(o+"crypto unavailable");if(!Y)for(;X<H;)$=m(),$<9e15&&(ee[X++]=$%1e14);for(H=ee[--X],b%=u,H&&b&&($=f[u-b],ee[X]=s(H/$)*$);ee[X]===0;ee.pop(),X--);if(X<0)ee=[z=0];else{for(z=-1;ee[0]===0;ee.splice(0,1),z-=u);for(X=1,$=ee[0];$>=10;$/=10,X++);X<u&&(z-=u-X)}return Q.e=z,Q.c=ee,Q}}(),J.sum=function(){for(var S=1,m=arguments,b=new J(m[0]);S<m.length;)b=b.plus(m[S++]);return b},M=function(){var S="0123456789";function m(b,R,N,z){for(var H,$=[0],X,ee=0,Q=b.length;ee<Q;){for(X=$.length;X--;$[X]*=R);for($[0]+=z.indexOf(b.charAt(ee++)),H=0;H<$.length;H++)$[H]>N-1&&($[H+1]==null&&($[H+1]=0),$[H+1]+=$[H]/N|0,$[H]%=N)}return $.reverse()}return function(b,R,N,z,H){var $,X,ee,Q,ce,ge,we,xe,Ae=b.indexOf("."),Be=Z,_=L;for(Ae>=0&&(Q=W,W=0,b=b.replace(".",""),xe=new J(R),ge=xe.pow(b.length-Ae),W=Q,xe.c=m(T(v(ge.c),ge.e,"0"),10,N,S),xe.e=xe.c.length),we=m(b,R,N,H?($=ie,S):($=S,ie)),ee=Q=we.length;we[--Q]==0;we.pop());if(!we[0])return $.charAt(0);if(Ae<0?--ee:(ge.c=we,ge.e=ee,ge.s=z,ge=P(ge,xe,Be,_,N),we=ge.c,ce=ge.r,ee=ge.e),X=ee+Be+1,Ae=we[X],Q=N/2,ce=ce||X<0||we[X+1]!=null,ce=_<4?(Ae!=null||ce)&&(_==0||_==(ge.s<0?3:2)):Ae>Q||Ae==Q&&(_==4||ce||_==6&&we[X-1]&1||_==(ge.s<0?8:7)),X<1||!we[0])b=ce?T($.charAt(1),-Be,$.charAt(0)):$.charAt(0);else{if(we.length=X,ce)for(--N;++we[--X]>N;)we[X]=0,X||(++ee,we=[1].concat(we));for(Q=we.length;!we[--Q];);for(Ae=0,b="";Ae<=Q;b+=$.charAt(we[Ae++]));b=T(b,ee,$.charAt(0))}return b}}(),P=function(){function S(R,N,z){var H,$,X,ee,Q=0,ce=R.length,ge=N%h,we=N/h|0;for(R=R.slice();ce--;)X=R[ce]%h,ee=R[ce]/h|0,H=we*X+ee*ge,$=ge*X+H%h*h+Q,Q=($/z|0)+(H/h|0)+we*ee,R[ce]=$%z;return Q&&(R=[Q].concat(R)),R}function m(R,N,z,H){var $,X;if(z!=H)X=z>H?1:-1;else for($=X=0;$<z;$++)if(R[$]!=N[$]){X=R[$]>N[$]?1:-1;break}return X}function b(R,N,z,H){for(var $=0;z--;)R[z]-=$,$=R[z]<N[z]?1:0,R[z]=$*H+R[z]-N[z];for(;!R[0]&&R.length>1;R.splice(0,1));}return function(R,N,z,H,$){var X,ee,Q,ce,ge,we,xe,Ae,Be,_,d,y,B,V,re,oe,ve,Oe=R.s==N.s?1:-1,Se=R.c,be=N.c;if(!Se||!Se[0]||!be||!be[0])return new J(!R.s||!N.s||(Se?be&&Se[0]==be[0]:!be)?NaN:Se&&Se[0]==0||!be?Oe*0:Oe/0);for(Ae=new J(Oe),Be=Ae.c=[],ee=R.e-N.e,Oe=z+ee+1,$||($=c,ee=w(R.e/u)-w(N.e/u),Oe=Oe/u|0),Q=0;be[Q]==(Se[Q]||0);Q++);if(be[Q]>(Se[Q]||0)&&ee--,Oe<0)Be.push(1),ce=!0;else{for(V=Se.length,oe=be.length,Q=0,Oe+=2,ge=s($/(be[0]+1)),ge>1&&(be=S(be,ge,$),Se=S(Se,ge,$),oe=be.length,V=Se.length),B=oe,_=Se.slice(0,oe),d=_.length;d<oe;_[d++]=0);ve=be.slice(),ve=[0].concat(ve),re=be[0],be[1]>=$/2&&re++;do{if(ge=0,X=m(be,_,oe,d),X<0){if(y=_[0],oe!=d&&(y=y*$+(_[1]||0)),ge=s(y/re),ge>1)for(ge>=$&&(ge=$-1),we=S(be,ge,$),xe=we.length,d=_.length;m(we,_,xe,d)==1;)ge--,b(we,oe<xe?ve:be,xe,$),xe=we.length,X=1;else ge==0&&(X=ge=1),we=be.slice(),xe=we.length;if(xe<d&&(we=[0].concat(we)),b(_,we,d,$),d=_.length,X==-1)for(;m(be,_,oe,d)<1;)ge++,b(_,oe<d?ve:be,d,$),d=_.length}else X===0&&(ge++,_=[0]);Be[Q++]=ge,_[0]?_[d++]=Se[B]||0:(_=[Se[B]],d=1)}while((B++<V||_[0]!=null)&&Oe--);ce=_[0]!=null,Be[0]||Be.splice(0,1)}if($==c){for(Q=1,Oe=Be[0];Oe>=10;Oe/=10,Q++);ne(Ae,z+(Ae.e=Q+ee*u-1)+1,H,ce)}else Ae.e=ee,Ae.r=+ce;return Ae}}();function fe(S,m,b,R){var N,z,H,$,X;if(b==null?b=L:I(b,0,8),!S.c)return S.toString();if(N=S.c[0],H=S.e,m==null)X=v(S.c),X=R==1||R==2&&(H<=K||H>=D)?A(X,H):T(X,H,"0");else if(S=ne(new J(S),m,b),z=S.e,X=v(S.c),$=X.length,R==1||R==2&&(m<=z||z<=K)){for(;$<m;X+="0",$++);X=A(X,z)}else if(m-=H+(R===2&&z>H),X=T(X,z,"0"),z+1>$){if(--m>0)for(X+=".";m--;X+="0");}else if(m+=z-$,m>0)for(z+1==$&&(X+=".");m--;X+="0");return S.s<0&&N?"-"+X:X}function q(S,m){for(var b,R,N=1,z=new J(S[0]);N<S.length;N++)R=new J(S[N]),(!R.s||(b=E(z,R))===m||b===0&&z.s===m)&&(z=R);return z}function j(S,m,b){for(var R=1,N=m.length;!m[--N];m.pop());for(N=m[0];N>=10;N/=10,R++);return(b=R+b*u-1)>F?S.c=S.e=null:b<C?S.c=[S.e=0]:(S.e=b,S.c=m),S}U=function(){var S=/^(-?)0([xbo])(?=\w[\w.]*$)/i,m=/^([^.]+)\.$/,b=/^\.([^.]+)$/,R=/^-?(Infinity|NaN)$/,N=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(z,H,$,X){var ee,Q=$?H:H.replace(N,"");if(R.test(Q))z.s=isNaN(Q)?null:Q<0?-1:1;else{if(!$&&(Q=Q.replace(S,function(ce,ge,we){return ee=(we=we.toLowerCase())=="x"?16:we=="b"?2:8,!X||X==ee?ge:ce}),X&&(ee=X,Q=Q.replace(m,"$1").replace(b,"0.$1")),H!=Q))return new J(Q,ee);if(J.DEBUG)throw Error(o+"Not a"+(X?" base "+X:"")+" number: "+H);z.s=null}z.c=z.e=null}}();function ne(S,m,b,R){var N,z,H,$,X,ee,Q,ce=S.c,ge=f;if(ce){e:{for(N=1,$=ce[0];$>=10;$/=10,N++);if(z=m-N,z<0)z+=u,H=m,X=ce[ee=0],Q=s(X/ge[N-H-1]%10);else if(ee=i((z+1)/u),ee>=ce.length)if(R){for(;ce.length<=ee;ce.push(0));X=Q=0,N=1,z%=u,H=z-u+1}else break e;else{for(X=$=ce[ee],N=1;$>=10;$/=10,N++);z%=u,H=z-u+N,Q=H<0?0:s(X/ge[N-H-1]%10)}if(R=R||m<0||ce[ee+1]!=null||(H<0?X:X%ge[N-H-1]),R=b<4?(Q||R)&&(b==0||b==(S.s<0?3:2)):Q>5||Q==5&&(b==4||R||b==6&&(z>0?H>0?X/ge[N-H]:0:ce[ee-1])%10&1||b==(S.s<0?8:7)),m<1||!ce[0])return ce.length=0,R?(m-=S.e+1,ce[0]=ge[(u-m%u)%u],S.e=-m||0):ce[0]=S.e=0,S;if(z==0?(ce.length=ee,$=1,ee--):(ce.length=ee+1,$=ge[u-z],ce[ee]=H>0?s(X/ge[N-H]%ge[H])*$:0),R)for(;;)if(ee==0){for(z=1,H=ce[0];H>=10;H/=10,z++);for(H=ce[0]+=$,$=1;H>=10;H/=10,$++);z!=$&&(S.e++,ce[0]==c&&(ce[0]=1));break}else{if(ce[ee]+=$,ce[ee]!=c)break;ce[ee--]=0,$=1}for(z=ce.length;ce[--z]===0;ce.pop());}S.e>F?S.c=S.e=null:S.e<C&&(S.c=[S.e=0])}return S}function ae(S){var m,b=S.e;return b===null?S.toString():(m=v(S.c),m=b<=K||b>=D?A(m,b):T(m,b,"0"),S.s<0?"-"+m:m)}return G.absoluteValue=G.abs=function(){var S=new J(this);return S.s<0&&(S.s=1),S},G.comparedTo=function(S,m){return E(this,new J(S,m))},G.decimalPlaces=G.dp=function(S,m){var b,R,N,z=this;if(S!=null)return I(S,0,p),m==null?m=L:I(m,0,8),ne(new J(z),S+z.e+1,m);if(!(b=z.c))return null;if(R=((N=b.length-1)-w(this.e/u))*u,N=b[N])for(;N%10==0;N/=10,R--);return R<0&&(R=0),R},G.dividedBy=G.div=function(S,m){return P(this,new J(S,m),Z,L)},G.dividedToIntegerBy=G.idiv=function(S,m){return P(this,new J(S,m),0,1)},G.exponentiatedBy=G.pow=function(S,m){var b,R,N,z,H,$,X,ee,Q,ce=this;if(S=new J(S),S.c&&!S.isInteger())throw Error(o+"Exponent not an integer: "+ae(S));if(m!=null&&(m=new J(m)),$=S.e>14,!ce.c||!ce.c[0]||ce.c[0]==1&&!ce.e&&ce.c.length==1||!S.c||!S.c[0])return Q=new J(Math.pow(+ae(ce),$?S.s*(2-x(S)):+ae(S))),m?Q.mod(m):Q;if(X=S.s<0,m){if(m.c?!m.c[0]:!m.s)return new J(NaN);R=!X&&ce.isInteger()&&m.isInteger(),R&&(ce=ce.mod(m))}else{if(S.e>9&&(ce.e>0||ce.e<-1||(ce.e==0?ce.c[0]>1||$&&ce.c[1]>=24e7:ce.c[0]<8e13||$&&ce.c[0]<=9999975e7)))return z=ce.s<0&&x(S)?-0:0,ce.e>-1&&(z=1/z),new J(X?1/z:z);W&&(z=i(W/u+2))}for($?(b=new J(.5),X&&(S.s=1),ee=x(S)):(N=Math.abs(+ae(S)),ee=N%2),Q=new J(se);;){if(ee){if(Q=Q.times(ce),!Q.c)break;z?Q.c.length>z&&(Q.c.length=z):R&&(Q=Q.mod(m))}if(N){if(N=s(N/2),N===0)break;ee=N%2}else if(S=S.times(b),ne(S,S.e+1,1),S.e>14)ee=x(S);else{if(N=+ae(S),N===0)break;ee=N%2}ce=ce.times(ce),z?ce.c&&ce.c.length>z&&(ce.c.length=z):R&&(ce=ce.mod(m))}return R?Q:(X&&(Q=se.div(Q)),m?Q.mod(m):z?ne(Q,W,L,H):Q)},G.integerValue=function(S){var m=new J(this);return S==null?S=L:I(S,0,8),ne(m,m.e+1,S)},G.isEqualTo=G.eq=function(S,m){return E(this,new J(S,m))===0},G.isFinite=function(){return!!this.c},G.isGreaterThan=G.gt=function(S,m){return E(this,new J(S,m))>0},G.isGreaterThanOrEqualTo=G.gte=function(S,m){return(m=E(this,new J(S,m)))===1||m===0},G.isInteger=function(){return!!this.c&&w(this.e/u)>this.c.length-2},G.isLessThan=G.lt=function(S,m){return E(this,new J(S,m))<0},G.isLessThanOrEqualTo=G.lte=function(S,m){return(m=E(this,new J(S,m)))===-1||m===0},G.isNaN=function(){return!this.s},G.isNegative=function(){return this.s<0},G.isPositive=function(){return this.s>0},G.isZero=function(){return!!this.c&&this.c[0]==0},G.minus=function(S,m){var b,R,N,z,H=this,$=H.s;if(S=new J(S,m),m=S.s,!$||!m)return new J(NaN);if($!=m)return S.s=-m,H.plus(S);var X=H.e/u,ee=S.e/u,Q=H.c,ce=S.c;if(!X||!ee){if(!Q||!ce)return Q?(S.s=-m,S):new J(ce?H:NaN);if(!Q[0]||!ce[0])return ce[0]?(S.s=-m,S):new J(Q[0]?H:L==3?-0:0)}if(X=w(X),ee=w(ee),Q=Q.slice(),$=X-ee){for((z=$<0)?($=-$,N=Q):(ee=X,N=ce),N.reverse(),m=$;m--;N.push(0));N.reverse()}else for(R=(z=($=Q.length)<(m=ce.length))?$:m,$=m=0;m<R;m++)if(Q[m]!=ce[m]){z=Q[m]<ce[m];break}if(z&&(N=Q,Q=ce,ce=N,S.s=-S.s),m=(R=ce.length)-(b=Q.length),m>0)for(;m--;Q[b++]=0);for(m=c-1;R>$;){if(Q[--R]<ce[R]){for(b=R;b&&!Q[--b];Q[b]=m);--Q[b],Q[R]+=c}Q[R]-=ce[R]}for(;Q[0]==0;Q.splice(0,1),--ee);return Q[0]?j(S,Q,ee):(S.s=L==3?-1:1,S.c=[S.e=0],S)},G.modulo=G.mod=function(S,m){var b,R,N=this;return S=new J(S,m),!N.c||!S.s||S.c&&!S.c[0]?new J(NaN):!S.c||N.c&&!N.c[0]?new J(N):(k==9?(R=S.s,S.s=1,b=P(N,S,0,3),S.s=R,b.s*=R):b=P(N,S,0,k),S=N.minus(b.times(S)),!S.c[0]&&k==1&&(S.s=N.s),S)},G.multipliedBy=G.times=function(S,m){var b,R,N,z,H,$,X,ee,Q,ce,ge,we,xe,Ae,Be,_=this,d=_.c,y=(S=new J(S,m)).c;if(!d||!y||!d[0]||!y[0])return!_.s||!S.s||d&&!d[0]&&!y||y&&!y[0]&&!d?S.c=S.e=S.s=null:(S.s*=_.s,!d||!y?S.c=S.e=null:(S.c=[0],S.e=0)),S;for(R=w(_.e/u)+w(S.e/u),S.s*=_.s,X=d.length,ce=y.length,X<ce&&(xe=d,d=y,y=xe,N=X,X=ce,ce=N),N=X+ce,xe=[];N--;xe.push(0));for(Ae=c,Be=h,N=ce;--N>=0;){for(b=0,ge=y[N]%Be,we=y[N]/Be|0,H=X,z=N+H;z>N;)ee=d[--H]%Be,Q=d[H]/Be|0,$=we*ee+Q*ge,ee=ge*ee+$%Be*Be+xe[z]+b,b=(ee/Ae|0)+($/Be|0)+we*Q,xe[z--]=ee%Ae;xe[z]=b}return b?++R:xe.splice(0,1),j(S,xe,R)},G.negated=function(){var S=new J(this);return S.s=-S.s||null,S},G.plus=function(S,m){var b,R=this,N=R.s;if(S=new J(S,m),m=S.s,!N||!m)return new J(NaN);if(N!=m)return S.s=-m,R.minus(S);var z=R.e/u,H=S.e/u,$=R.c,X=S.c;if(!z||!H){if(!$||!X)return new J(N/0);if(!$[0]||!X[0])return X[0]?S:new J($[0]?R:N*0)}if(z=w(z),H=w(H),$=$.slice(),N=z-H){for(N>0?(H=z,b=X):(N=-N,b=$),b.reverse();N--;b.push(0));b.reverse()}for(N=$.length,m=X.length,N-m<0&&(b=X,X=$,$=b,m=N),N=0;m;)N=($[--m]=$[m]+X[m]+N)/c|0,$[m]=c===$[m]?0:$[m]%c;return N&&($=[N].concat($),++H),j(S,$,H)},G.precision=G.sd=function(S,m){var b,R,N,z=this;if(S!=null&&S!==!!S)return I(S,1,p),m==null?m=L:I(m,0,8),ne(new J(z),S,m);if(!(b=z.c))return null;if(N=b.length-1,R=N*u+1,N=b[N]){for(;N%10==0;N/=10,R--);for(N=b[0];N>=10;N/=10,R++);}return S&&z.e+1>R&&(R=z.e+1),R},G.shiftedBy=function(S){return I(S,-l,l),this.times("1e"+S)},G.squareRoot=G.sqrt=function(){var S,m,b,R,N,z=this,H=z.c,$=z.s,X=z.e,ee=Z+4,Q=new J("0.5");if($!==1||!H||!H[0])return new J(!$||$<0&&(!H||H[0])?NaN:H?z:1/0);if($=Math.sqrt(+ae(z)),$==0||$==1/0?(m=v(H),(m.length+X)%2==0&&(m+="0"),$=Math.sqrt(+m),X=w((X+1)/2)-(X<0||X%2),$==1/0?m="5e"+X:(m=$.toExponential(),m=m.slice(0,m.indexOf("e")+1)+X),b=new J(m)):b=new J($+""),b.c[0]){for(X=b.e,$=X+ee,$<3&&($=0);;)if(N=b,b=Q.times(N.plus(P(z,N,ee,1))),v(N.c).slice(0,$)===(m=v(b.c)).slice(0,$))if(b.e<X&&--$,m=m.slice($-3,$+1),m=="9999"||!R&&m=="4999"){if(!R&&(ne(N,N.e+Z+2,0),N.times(N).eq(z))){b=N;break}ee+=4,$+=4,R=1}else{(!+m||!+m.slice(1)&&m.charAt(0)=="5")&&(ne(b,b.e+Z+2,1),S=!b.times(b).eq(z));break}}return ne(b,b.e+Z+1,L,S)},G.toExponential=function(S,m){return S!=null&&(I(S,0,p),S++),fe(this,S,m,1)},G.toFixed=function(S,m){return S!=null&&(I(S,0,p),S=S+this.e+1),fe(this,S,m)},G.toFormat=function(S,m,b){var R,N=this;if(b==null)S!=null&&m&&typeof m=="object"?(b=m,m=null):S&&typeof S=="object"?(b=S,S=m=null):b=te;else if(typeof b!="object")throw Error(o+"Argument not an object: "+b);if(R=N.toFixed(S,m),N.c){var z,H=R.split("."),$=+b.groupSize,X=+b.secondaryGroupSize,ee=b.groupSeparator||"",Q=H[0],ce=H[1],ge=N.s<0,we=ge?Q.slice(1):Q,xe=we.length;if(X&&(z=$,$=X,X=z,xe-=z),$>0&&xe>0){for(z=xe%$||$,Q=we.substr(0,z);z<xe;z+=$)Q+=ee+we.substr(z,$);X>0&&(Q+=ee+we.slice(z)),ge&&(Q="-"+Q)}R=ce?Q+(b.decimalSeparator||"")+((X=+b.fractionGroupSize)?ce.replace(new RegExp("\\d{"+X+"}\\B","g"),"$&"+(b.fractionGroupSeparator||"")):ce):Q}return(b.prefix||"")+R+(b.suffix||"")},G.toFraction=function(S){var m,b,R,N,z,H,$,X,ee,Q,ce,ge,we=this,xe=we.c;if(S!=null&&($=new J(S),!$.isInteger()&&($.c||$.s!==1)||$.lt(se)))throw Error(o+"Argument "+($.isInteger()?"out of range: ":"not an integer: ")+ae($));if(!xe)return new J(we);for(m=new J(se),ee=b=new J(se),R=X=new J(se),ge=v(xe),z=m.e=ge.length-we.e-1,m.c[0]=f[(H=z%u)<0?u+H:H],S=!S||$.comparedTo(m)>0?z>0?m:ee:$,H=F,F=1/0,$=new J(ge),X.c[0]=0;Q=P($,m,0,1),N=b.plus(Q.times(R)),N.comparedTo(S)!=1;)b=R,R=N,ee=X.plus(Q.times(N=ee)),X=N,m=$.minus(Q.times(N=m)),$=N;return N=P(S.minus(b),R,0,1),X=X.plus(N.times(ee)),b=b.plus(N.times(R)),X.s=ee.s=we.s,z=z*2,ce=P(ee,R,z,L).minus(we).abs().comparedTo(P(X,b,z,L).minus(we).abs())<1?[ee,R]:[X,b],F=H,ce},G.toNumber=function(){return+ae(this)},G.toPrecision=function(S,m){return S!=null&&I(S,1,p),fe(this,S,m,2)},G.toString=function(S){var m,b=this,R=b.s,N=b.e;return N===null?R?(m="Infinity",R<0&&(m="-"+m)):m="NaN":(S==null?m=N<=K||N>=D?A(v(b.c),N):T(v(b.c),N,"0"):S===10&&he?(b=ne(new J(b),Z+N+1,L),m=T(v(b.c),b.e,"0")):(I(S,2,ie.length,"Base"),m=M(T(v(b.c),N,"0"),10,S,R,!0)),R<0&&b.c[0]&&(m="-"+m)),m},G.valueOf=G.toJSON=function(){return ae(this)},G._isBigNumber=!0,O!=null&&J.set(O),J}function w(O){var P=O|0;return O>0||O===P?P:P-1}function v(O){for(var P,M,U=1,G=O.length,se=O[0]+"";U<G;){for(P=O[U++]+"",M=u-P.length;M--;P="0"+P);se+=P}for(G=se.length;se.charCodeAt(--G)===48;);return se.slice(0,G+1||1)}function E(O,P){var M,U,G=O.c,se=P.c,Z=O.s,L=P.s,K=O.e,D=P.e;if(!Z||!L)return null;if(M=G&&!G[0],U=se&&!se[0],M||U)return M?U?0:-L:Z;if(Z!=L)return Z;if(M=Z<0,U=K==D,!G||!se)return U?0:!G^M?1:-1;if(!U)return K>D^M?1:-1;for(L=(K=G.length)<(D=se.length)?K:D,Z=0;Z<L;Z++)if(G[Z]!=se[Z])return G[Z]>se[Z]^M?1:-1;return K==D?0:K>D^M?1:-1}function I(O,P,M,U){if(O<P||O>M||O!==s(O))throw Error(o+(U||"Argument")+(typeof O=="number"?O<P||O>M?" out of range: ":" not an integer: ":" not a primitive number: ")+String(O))}function x(O){var P=O.c.length-1;return w(O.e/u)==P&&O.c[P]%2!=0}function A(O,P){return(O.length>1?O.charAt(0)+"."+O.slice(1):O)+(P<0?"e":"e+")+P}function T(O,P,M){var U,G;if(P<0){for(G=M+".";++P;G+=M);O=G+O}else if(U=O.length,++P>U){for(G=M,P-=U;--P;G+=M);O+=G}else P<U&&(O=O.slice(0,P)+"."+O.slice(P));return O}r=g(),r.default=r.BigNumber=r,t.exports?t.exports=r:(e||(e=typeof self<"u"&&self?self:window),e.BigNumber=r)})(Ee)})(Zg);var da=Zg.exports,Jg={},Je={},at={},Bh;function Ku(){if(Bh)return at;Bh=1;var t=Ee&&Ee.__createBinding||(Object.create?function(p,g,w,v){v===void 0&&(v=w),Object.defineProperty(p,v,{enumerable:!0,get:function(){return g[w]}})}:function(p,g,w,v){v===void 0&&(v=w),p[v]=g[w]}),e=Ee&&Ee.__setModuleDefault||(Object.create?function(p,g){Object.defineProperty(p,"default",{enumerable:!0,value:g})}:function(p,g){p.default=g}),r=Ee&&Ee.__importStar||function(p){if(p&&p.__esModule)return p;var g={};if(p!=null)for(var w in p)w!=="default"&&Object.prototype.hasOwnProperty.call(p,w)&&t(g,p,w);return e(g,p),g},n=Ee&&Ee.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};Object.defineProperty(at,"__esModule",{value:!0}),at.bigIntToHex=at.byteArrayToHex=at.boolToHex=at.utf8ToHex=at.zeroPadStringIfOddLength=at.isPaddedHex=at.numberToPaddedHex=void 0;const i=n(da),s=r(Qg());function o(p){let g;typeof p=="bigint"||typeof p=="number"?g=p:g=new i.default(p);const w=g.toString(16);return c(w)}at.numberToPaddedHex=o;function a(p){p=p||"";let g=Buffer.from(p,"hex").toString("hex");return p.toUpperCase()==g.toUpperCase()}at.isPaddedHex=a;function c(p){return p=p||"",p.length%2==1?"0"+p:p}at.zeroPadStringIfOddLength=c;function u(p){const g=Buffer.from(p).toString("hex");return c(g)}at.utf8ToHex=u;function l(p){return u(p.toString())}at.boolToHex=l;function f(p){const g=Buffer.from(p).toString("hex");return c(g)}at.byteArrayToHex=f;function h(p){return p==0?"":s.getHexMagnitudeOfBigInt(p)}return at.bigIntToHex=h,at}var Rh;function Qg(){if(Rh)return Je;Rh=1;var t=Ee&&Ee.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(Je,"__esModule",{value:!0}),Je.prependByteToBuffer=Je.flipBufferBitsInPlace=Je.getHexMagnitudeOfBigInt=Je.bigIntToBuffer=Je.bufferToBigInt=Je.cloneBuffer=Je.isMsbZero=Je.isMsbOne=void 0;const e=t(da),r=Ku();function n(f,h=0){return f[h]>>7==1}Je.isMsbOne=n;function i(f,h=0){return!n(f,h)}Je.isMsbZero=i;function s(f){let h=Buffer.alloc(f.length);return f.copy(h),h}Je.cloneBuffer=s;function o(f){let h=f.toString("hex");return new e.default(`0x${h}`,16)}Je.bufferToBigInt=o;function a(f){let h=c(f);return Buffer.from(h,"hex")}Je.bigIntToBuffer=a;function c(f){return f=new e.default(f),f?(f.isNegative()&&(f=f.multipliedBy(new e.default(-1))),r.numberToPaddedHex(f)):""}Je.getHexMagnitudeOfBigInt=c;function u(f){for(let h=0;h<f.length;h++)f[h]=~f[h]}Je.flipBufferBitsInPlace=u;function l(f,h){return Buffer.concat([Buffer.from([h]),f])}return Je.prependByteToBuffer=l,Je}(function(t){var e=Ee&&Ee.__createBinding||(Object.create?function(p,g,w,v){v===void 0&&(v=w),Object.defineProperty(p,v,{enumerable:!0,get:function(){return g[w]}})}:function(p,g,w,v){v===void 0&&(v=w),p[v]=g[w]}),r=Ee&&Ee.__setModuleDefault||(Object.create?function(p,g){Object.defineProperty(p,"default",{enumerable:!0,value:g})}:function(p,g){p.default=g}),n=Ee&&Ee.__importStar||function(p){if(p&&p.__esModule)return p;var g={};if(p!=null)for(var w in p)w!=="default"&&Object.prototype.hasOwnProperty.call(p,w)&&e(g,p,w);return r(g,p),g},i=Ee&&Ee.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};Object.defineProperty(t,"__esModule",{value:!0}),t.bufferToHex=t.utf8ToHex=t.bigIntToHex=t.bigIntToBuffer=t.bufferToBigInt=t.stringToBuffer=void 0;const s=i(da),o=n(Qg()),a=n(Ku());function c(p){return Buffer.from(p)}t.stringToBuffer=c;function u(p){return p.length==0?new s.default(0):o.bufferToBigInt(p)}t.bufferToBigInt=u;function l(p){return p==0?Buffer.from([]):o.bigIntToBuffer(p)}t.bigIntToBuffer=l;var f=Ku();Object.defineProperty(t,"bigIntToHex",{enumerable:!0,get:function(){return f.bigIntToHex}}),Object.defineProperty(t,"utf8ToHex",{enumerable:!0,get:function(){return f.utf8ToHex}});function h(p){const g=p.toString("hex");return a.zeroPadStringIfOddLength(g)}t.bufferToHex=h})(Jg);var pa={};Object.defineProperty(pa,"__esModule",{value:!0});pa.LibraryConfig=void 0;class e0{}pa.LibraryConfig=e0;e0.DefaultAddressHrp="erd";var me={};Object.defineProperty(me,"__esModule",{value:!0});me.EXTRA_GAS_LIMIT_FOR_RELAYED_TRANSACTIONS=me.EXTRA_GAS_LIMIT_FOR_GUARDED_TRANSACTIONS=me.EGLD_IDENTIFIER_FOR_MULTI_ESDTNFT_TRANSFER=me.UNKNOWN_SIGNER=me.SDK_JS_SIGNER=me.METACHAIN_ID=me.WasmVirtualMachine=me.CURRENT_NUMBER_OF_SHARDS_WITHOUT_META=me.HEX_TRANSACTION_HASH_LENGTH=me.MESSAGE_PREFIX=me.DEFAULT_MESSAGE_VERSION=me.GOVERNANCE_CONTRACT_ADDRESS_HEX=me.ESDT_CONTRACT_ADDRESS_HEX=me.DELEGATION_MANAGER_SC_ADDRESS_HEX=me.CONTRACT_DEPLOY_ADDRESS_HEX=me.VM_TYPE_WASM_VM=me.ARGUMENTS_SEPARATOR=me.ESDT_TRANSFER_VALUE=me.MULTI_ESDTNFT_TRANSFER_FUNCTION_NAME=me.ESDTNFT_TRANSFER_FUNCTION_NAME=me.ESDT_TRANSFER_FUNCTION_NAME=me.ESDT_TRANSFER_GAS_LIMIT=me.MIN_TRANSACTION_VERSION_THAT_SUPPORTS_OPTIONS=me.TRANSACTION_VERSION_DEFAULT=me.TRANSACTION_OPTIONS_TX_GUARDED=me.TRANSACTION_OPTIONS_TX_HASH_SIGN=me.TRANSACTION_OPTIONS_DEFAULT=me.TRANSACTION_MIN_GAS_PRICE=void 0;me.TRANSACTION_MIN_GAS_PRICE=1e9;me.TRANSACTION_OPTIONS_DEFAULT=0;me.TRANSACTION_OPTIONS_TX_HASH_SIGN=1;me.TRANSACTION_OPTIONS_TX_GUARDED=2;me.TRANSACTION_VERSION_DEFAULT=2;me.MIN_TRANSACTION_VERSION_THAT_SUPPORTS_OPTIONS=2;me.ESDT_TRANSFER_GAS_LIMIT=5e5;me.ESDT_TRANSFER_FUNCTION_NAME="ESDTTransfer";me.ESDTNFT_TRANSFER_FUNCTION_NAME="ESDTNFTTransfer";me.MULTI_ESDTNFT_TRANSFER_FUNCTION_NAME="MultiESDTNFTTransfer";me.ESDT_TRANSFER_VALUE="0";me.ARGUMENTS_SEPARATOR="@";me.VM_TYPE_WASM_VM=new Uint8Array([5,0]);me.CONTRACT_DEPLOY_ADDRESS_HEX="0000000000000000000000000000000000000000000000000000000000000000";me.DELEGATION_MANAGER_SC_ADDRESS_HEX="000000000000000000010000000000000000000000000000000000000004ffff";me.ESDT_CONTRACT_ADDRESS_HEX="000000000000000000010000000000000000000000000000000000000002ffff";me.GOVERNANCE_CONTRACT_ADDRESS_HEX="000000000000000000010000000000000000000000000000000000000003ffff";me.DEFAULT_MESSAGE_VERSION=1;me.MESSAGE_PREFIX=`Elrond Signed Message:
`;me.HEX_TRANSACTION_HASH_LENGTH=64;me.CURRENT_NUMBER_OF_SHARDS_WITHOUT_META=3;me.WasmVirtualMachine="0500";me.METACHAIN_ID=4294967295;me.SDK_JS_SIGNER="sdk-js";me.UNKNOWN_SIGNER="unknown";me.EGLD_IDENTIFIER_FOR_MULTI_ESDTNFT_TRANSFER="EGLD-000000";me.EXTRA_GAS_LIMIT_FOR_GUARDED_TRANSACTIONS=5e4;me.EXTRA_GAS_LIMIT_FOR_RELAYED_TRANSACTIONS=5e4;var le={};Object.defineProperty(le,"__esModule",{value:!0});le.ErrGasLimitCannotBeEstimated=le.ExpectedAccountConditionNotReachedError=le.ErrInvalidNetworkProviderKind=le.ErrContractQuery=le.ErrNetworkProvider=le.ErrBadAddress=le.ErrSignerCannotSign=le.ErrBadPEM=le.ErrBadMnemonicEntropy=le.ErrWrongMnemonic=le.ErrSmartContractQuery=le.ErrParseTransactionOutcome=le.ErrInvalidInnerTransaction=le.ErrBadUsage=le.ErrInvalidTokenIdentifier=le.ErrIsCompletedFieldIsMissingOnTransaction=le.ErrNotImplemented=le.ErrContractInteraction=le.ErrCodec=le.ErrCannotParseTransactionOutcome=le.ErrCannotParseContractResults=le.ErrMissingFieldOnEnum=le.ErrMissingFieldOnStruct=le.ErrTypingSystem=le.ErrMock=le.ErrContractHasNoAddress=le.ErrContract=le.ErrExpectedTransactionEventsNotFound=le.ErrExpectedTransactionStatusNotReached=le.ErrTransactionWatcherTimeout=le.ErrAsyncTimerAborted=le.ErrAsyncTimerAlreadyRunning=le.ErrInvalidFunctionName=le.ErrSignatureCannotCreate=le.ErrTransactionOptionsInvalid=le.ErrTransactionVersionInvalid=le.ErrNonceInvalid=le.ErrNotEnoughGas=le.ErrAddressEmpty=le.ErrAddressBadHrp=le.ErrAddressCannotCreate=le.ErrUnexpectedCondition=le.ErrInvariantFailed=le.ErrBadType=le.ErrUnsupportedOperation=le.ErrInvalidArgument=le.Err=void 0;let _e=class extends Error{constructor(e,r){super(e),this.inner=void 0,this.inner=r}summary(){const e=[];e.push({name:this.name,message:this.message});let r=this.inner;for(;r;)e.push({name:r.name,message:r.message}),r=r.inner;return e}};le.Err=_e;class WE extends _e{constructor(e,r){super(`Invalid argument: ${e}`,r)}}le.ErrInvalidArgument=WE;class GE extends _e{constructor(e,r="not specified"){super(`Operation "${e}" not supported. Reason: ${r}`)}}le.ErrUnsupportedOperation=GE;class YE extends _e{constructor(e,r,n){super(`Bad type of "${e}": ${n}. Expected type: ${r}`)}}le.ErrBadType=YE;class XE extends _e{constructor(e){super(`Invariant failed: [${e}]`)}}le.ErrInvariantFailed=XE;class ZE extends _e{constructor(e){super(`Unexpected condition: [${e}]`)}}le.ErrUnexpectedCondition=ZE;class JE extends _e{constructor(e,r){const n=`Cannot create address from: ${e}`;super(n,r)}}le.ErrAddressCannotCreate=JE;class QE extends _e{constructor(e,r){super(`Wrong address HRP. Expected: ${e}, got ${r}`)}}le.ErrAddressBadHrp=QE;class ev extends _e{constructor(){super("Address is empty")}}le.ErrAddressEmpty=ev;class tv extends _e{constructor(e){super(`Not enough gas provided: ${e}`)}}le.ErrNotEnoughGas=tv;class rv extends _e{constructor(e){super(`Invalid nonce: ${e}`)}}le.ErrNonceInvalid=rv;class nv extends _e{constructor(e){super(`Invalid transaction version: ${e}`)}}le.ErrTransactionVersionInvalid=nv;class iv extends _e{constructor(e){super(`Invalid transaction options: ${e}`)}}le.ErrTransactionOptionsInvalid=iv;class sv extends _e{constructor(e,r){const n=`Cannot create signature from: ${e}`;super(n,r)}}le.ErrSignatureCannotCreate=sv;class ov extends _e{constructor(){super("Invalid function name")}}le.ErrInvalidFunctionName=ov;class av extends _e{constructor(){super("Async timer already running")}}le.ErrAsyncTimerAlreadyRunning=av;class cv extends _e{constructor(){super("Async timer aborted")}}le.ErrAsyncTimerAborted=cv;class uv extends _e{constructor(){super("TransactionWatcher has timed out")}}le.ErrTransactionWatcherTimeout=uv;class lv extends _e{constructor(){super("Expected transaction status not reached")}}le.ErrExpectedTransactionStatusNotReached=lv;class fv extends _e{constructor(){super("Expected transaction events not found")}}le.ErrExpectedTransactionEventsNotFound=fv;class t0 extends _e{constructor(e){super(e)}}le.ErrContract=t0;class hv extends t0{constructor(){super(`
The smart contract has no address set. Make sure you provide the address in the constructor, or call setAddress() appropriately.
If you need to recompute the address of the contract, make use of SmartContract.computeAddress() (static method).
`)}}le.ErrContractHasNoAddress=hv;class dv extends _e{constructor(e){super(e)}}le.ErrMock=dv;class pv extends _e{constructor(e){super(e)}}le.ErrTypingSystem=pv;class gv extends _e{constructor(e,r){super(`field ${e} does not exist on struct ${r}`)}}le.ErrMissingFieldOnStruct=gv;class yv extends _e{constructor(e,r){super(`field ${e} does not exist on enum ${r}`)}}le.ErrMissingFieldOnEnum=yv;class wv extends _e{constructor(e){super(`cannot parse contract results: ${e}`)}}le.ErrCannotParseContractResults=wv;class mv extends _e{constructor(e,r){super(`cannot parse outcome of transaction ${e}: ${r}`)}}le.ErrCannotParseTransactionOutcome=mv;class bv extends _e{constructor(e){super(e)}}le.ErrCodec=bv;class Ev extends _e{constructor(e){super(e)}}le.ErrContractInteraction=Ev;let vv=class extends _e{constructor(){super("Method not yet implemented")}};le.ErrNotImplemented=vv;class _v extends _e{constructor(){super("The transaction watcher requires the `isCompleted` property to be defined on the transaction object. Perhaps you've used the sdk-network-provider's `ProxyNetworkProvider.getTransaction()` and in that case you should also pass `withProcessStatus=true`.")}}le.ErrIsCompletedFieldIsMissingOnTransaction=_v;class xv extends _e{constructor(e){super(e)}}le.ErrInvalidTokenIdentifier=xv;class Sv extends _e{constructor(e){super(e)}}le.ErrBadUsage=Sv;class Iv extends _e{constructor(e){super(e)}}le.ErrInvalidInnerTransaction=Iv;class Av extends _e{constructor(e){super(e)}}le.ErrParseTransactionOutcome=Av;class Tv extends _e{constructor(e,r){super(r),this.returnCode=e}}le.ErrSmartContractQuery=Tv;class Ov extends _e{constructor(){super("Wrong mnemonic format")}}le.ErrWrongMnemonic=Ov;class Cv extends _e{constructor(e){super("Bad mnemonic entropy",e)}}le.ErrBadMnemonicEntropy=Cv;class Dv extends _e{constructor(e){super(e?`Bad PEM: ${e}`:"Bad PEM")}}le.ErrBadPEM=Dv;class Bv extends _e{constructor(e){super("Cannot sign",e)}}le.ErrSignerCannotSign=Bv;let Rv=class extends _e{constructor(e,r){super(`Bad address: ${e}`,r)}};le.ErrBadAddress=Rv;class Nv extends _e{constructor(e,r,n){const i=`Request error on url [${e}]: [${r}]`;super(i,n)}}le.ErrNetworkProvider=Nv;class Pv extends _e{constructor(e){super(e.message.replace("executeQuery:",""))}}le.ErrContractQuery=Pv;class Uv extends _e{constructor(){super("Invalid network provider kind. Choose between `api` and `proxy`.")}}le.ErrInvalidNetworkProviderKind=Uv;class Lv extends _e{constructor(){super("The expected account condition was not reached.")}}le.ExpectedAccountConditionNotReachedError=Lv;class $v extends _e{constructor(e){super(`Failed to estimate gas limit: ${e}`,e)}}le.ErrGasLimitCannotBeEstimated=$v;var Wu={exports:{}},df={exports:{}},Si=typeof Reflect=="object"?Reflect:null,Nh=Si&&typeof Si.apply=="function"?Si.apply:function(e,r,n){return Function.prototype.apply.call(e,r,n)},So;Si&&typeof Si.ownKeys=="function"?So=Si.ownKeys:Object.getOwnPropertySymbols?So=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:So=function(e){return Object.getOwnPropertyNames(e)};function Mv(t){console&&console.warn&&console.warn(t)}var r0=Number.isNaN||function(e){return e!==e};function Me(){Me.init.call(this)}df.exports=Me;df.exports.once=qv;Me.EventEmitter=Me;Me.prototype._events=void 0;Me.prototype._eventsCount=0;Me.prototype._maxListeners=void 0;var Ph=10;function ga(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(Me,"defaultMaxListeners",{enumerable:!0,get:function(){return Ph},set:function(t){if(typeof t!="number"||t<0||r0(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Ph=t}});Me.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Me.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||r0(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function n0(t){return t._maxListeners===void 0?Me.defaultMaxListeners:t._maxListeners}Me.prototype.getMaxListeners=function(){return n0(this)};Me.prototype.emit=function(e){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(r.length>0&&(o=r[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")Nh(c,this,r);else for(var u=c.length,l=c0(c,u),n=0;n<u;++n)Nh(l[n],this,r);return!0};function i0(t,e,r,n){var i,s,o;if(ga(r),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),s=t._events),o=s[e]),o===void 0)o=s[e]=r,++t._eventsCount;else if(typeof o=="function"?o=s[e]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),i=n0(t),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,Mv(a)}return t}Me.prototype.addListener=function(e,r){return i0(this,e,r,!1)};Me.prototype.on=Me.prototype.addListener;Me.prototype.prependListener=function(e,r){return i0(this,e,r,!0)};function Fv(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function s0(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=Fv.bind(n);return i.listener=r,n.wrapFn=i,i}Me.prototype.once=function(e,r){return ga(r),this.on(e,s0(this,e,r)),this};Me.prototype.prependOnceListener=function(e,r){return ga(r),this.prependListener(e,s0(this,e,r)),this};Me.prototype.removeListener=function(e,r){var n,i,s,o,a;if(ga(r),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===r||n.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||r));else if(typeof n!="function"){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===r||n[o].listener===r){a=n[o].listener,s=o;break}if(s<0)return this;s===0?n.shift():kv(n,s),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||r)}return this};Me.prototype.off=Me.prototype.removeListener;Me.prototype.removeAllListeners=function(e){var r,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var s=Object.keys(n),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=n[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(i=r.length-1;i>=0;i--)this.removeListener(e,r[i]);return this};function o0(t,e,r){var n=t._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?r?[i.listener||i]:[i]:r?jv(i):c0(i,i.length)}Me.prototype.listeners=function(e){return o0(this,e,!0)};Me.prototype.rawListeners=function(e){return o0(this,e,!1)};Me.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):a0.call(t,e)};Me.prototype.listenerCount=a0;function a0(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}Me.prototype.eventNames=function(){return this._eventsCount>0?So(this._events):[]};function c0(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function kv(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function jv(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function qv(t,e){return new Promise(function(r,n){function i(o){t.removeListener(e,s),n(o)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",i),r([].slice.call(arguments))}u0(t,e,s,{once:!0}),e!=="error"&&zv(t,i,{once:!0})})}function zv(t,e,r){typeof t.on=="function"&&u0(t,"error",e,r)}function u0(t,e,r,n){if(typeof t.on=="function")n.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(s){n.once&&t.removeEventListener(e,i),r(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var zt=df.exports;const l0=of(zt);var f0=zt.EventEmitter;const Vv={},Hv=Object.freeze(Object.defineProperty({__proto__:null,default:Vv},Symbol.toStringTag,{value:"Module"})),h0=oa(Hv);var $c,Uh;function Kv(){if(Uh)return $c;Uh=1;function t(g,w){var v=Object.keys(g);if(Object.getOwnPropertySymbols){var E=Object.getOwnPropertySymbols(g);w&&(E=E.filter(function(I){return Object.getOwnPropertyDescriptor(g,I).enumerable})),v.push.apply(v,E)}return v}function e(g){for(var w=1;w<arguments.length;w++){var v=arguments[w]!=null?arguments[w]:{};w%2?t(Object(v),!0).forEach(function(E){r(g,E,v[E])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(v)):t(Object(v)).forEach(function(E){Object.defineProperty(g,E,Object.getOwnPropertyDescriptor(v,E))})}return g}function r(g,w,v){return w=o(w),w in g?Object.defineProperty(g,w,{value:v,enumerable:!0,configurable:!0,writable:!0}):g[w]=v,g}function n(g,w){if(!(g instanceof w))throw new TypeError("Cannot call a class as a function")}function i(g,w){for(var v=0;v<w.length;v++){var E=w[v];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(g,o(E.key),E)}}function s(g,w,v){return w&&i(g.prototype,w),Object.defineProperty(g,"prototype",{writable:!1}),g}function o(g){var w=a(g,"string");return typeof w=="symbol"?w:String(w)}function a(g,w){if(typeof g!="object"||g===null)return g;var v=g[Symbol.toPrimitive];if(v!==void 0){var E=v.call(g,w);if(typeof E!="object")return E;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(g)}var c=zi,u=c.Buffer,l=h0,f=l.inspect,h=f&&f.custom||"inspect";function p(g,w,v){u.prototype.copy.call(g,w,v)}return $c=function(){function g(){n(this,g),this.head=null,this.tail=null,this.length=0}return s(g,[{key:"push",value:function(v){var E={data:v,next:null};this.length>0?this.tail.next=E:this.head=E,this.tail=E,++this.length}},{key:"unshift",value:function(v){var E={data:v,next:this.head};this.length===0&&(this.tail=E),this.head=E,++this.length}},{key:"shift",value:function(){if(this.length!==0){var v=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,v}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(v){if(this.length===0)return"";for(var E=this.head,I=""+E.data;E=E.next;)I+=v+E.data;return I}},{key:"concat",value:function(v){if(this.length===0)return u.alloc(0);for(var E=u.allocUnsafe(v>>>0),I=this.head,x=0;I;)p(I.data,E,x),x+=I.data.length,I=I.next;return E}},{key:"consume",value:function(v,E){var I;return v<this.head.data.length?(I=this.head.data.slice(0,v),this.head.data=this.head.data.slice(v)):v===this.head.data.length?I=this.shift():I=E?this._getString(v):this._getBuffer(v),I}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(v){var E=this.head,I=1,x=E.data;for(v-=x.length;E=E.next;){var A=E.data,T=v>A.length?A.length:v;if(T===A.length?x+=A:x+=A.slice(0,v),v-=T,v===0){T===A.length?(++I,E.next?this.head=E.next:this.head=this.tail=null):(this.head=E,E.data=A.slice(T));break}++I}return this.length-=I,x}},{key:"_getBuffer",value:function(v){var E=u.allocUnsafe(v),I=this.head,x=1;for(I.data.copy(E),v-=I.data.length;I=I.next;){var A=I.data,T=v>A.length?A.length:v;if(A.copy(E,E.length-v,0,T),v-=T,v===0){T===A.length?(++x,I.next?this.head=I.next:this.head=this.tail=null):(this.head=I,I.data=A.slice(T));break}++x}return this.length-=x,E}},{key:h,value:function(v,E){return f(this,e(e({},E),{},{depth:0,customInspect:!1}))}}]),g}(),$c}function Wv(t,e){var r=this,n=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return n||i?(e?e(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(Gu,this,t)):process.nextTick(Gu,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(s){!e&&s?r._writableState?r._writableState.errorEmitted?process.nextTick(Io,r):(r._writableState.errorEmitted=!0,process.nextTick(Lh,r,s)):process.nextTick(Lh,r,s):e?(process.nextTick(Io,r),e(s)):process.nextTick(Io,r)}),this)}function Lh(t,e){Gu(t,e),Io(t)}function Io(t){t._writableState&&!t._writableState.emitClose||t._readableState&&!t._readableState.emitClose||t.emit("close")}function Gv(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function Gu(t,e){t.emit("error",e)}function Yv(t,e){var r=t._readableState,n=t._writableState;r&&r.autoDestroy||n&&n.autoDestroy?t.destroy(e):t.emit("error",e)}var d0={destroy:Wv,undestroy:Gv,errorOrDestroy:Yv},Qn={};function Xv(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var p0={};function tr(t,e,r){r||(r=Error);function n(s,o,a){return typeof e=="string"?e:e(s,o,a)}var i=function(s){Xv(o,s);function o(a,c,u){return s.call(this,n(a,c,u))||this}return o}(r);i.prototype.name=r.name,i.prototype.code=t,p0[t]=i}function $h(t,e){if(Array.isArray(t)){var r=t.length;return t=t.map(function(n){return String(n)}),r>2?"one of ".concat(e," ").concat(t.slice(0,r-1).join(", "),", or ")+t[r-1]:r===2?"one of ".concat(e," ").concat(t[0]," or ").concat(t[1]):"of ".concat(e," ").concat(t[0])}else return"of ".concat(e," ").concat(String(t))}function Zv(t,e,r){return t.substr(0,e.length)===e}function Jv(t,e,r){return(r===void 0||r>t.length)&&(r=t.length),t.substring(r-e.length,r)===e}function Qv(t,e,r){return typeof r!="number"&&(r=0),r+e.length>t.length?!1:t.indexOf(e,r)!==-1}tr("ERR_INVALID_OPT_VALUE",function(t,e){return'The value "'+e+'" is invalid for option "'+t+'"'},TypeError);tr("ERR_INVALID_ARG_TYPE",function(t,e,r){var n;typeof e=="string"&&Zv(e,"not ")?(n="must not be",e=e.replace(/^not /,"")):n="must be";var i;if(Jv(t," argument"))i="The ".concat(t," ").concat(n," ").concat($h(e,"type"));else{var s=Qv(t,".")?"property":"argument";i='The "'.concat(t,'" ').concat(s," ").concat(n," ").concat($h(e,"type"))}return i+=". Received type ".concat(typeof r),i},TypeError);tr("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");tr("ERR_METHOD_NOT_IMPLEMENTED",function(t){return"The "+t+" method is not implemented"});tr("ERR_STREAM_PREMATURE_CLOSE","Premature close");tr("ERR_STREAM_DESTROYED",function(t){return"Cannot call "+t+" after a stream was destroyed"});tr("ERR_MULTIPLE_CALLBACK","Callback called multiple times");tr("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");tr("ERR_STREAM_WRITE_AFTER_END","write after end");tr("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);tr("ERR_UNKNOWN_ENCODING",function(t){return"Unknown encoding: "+t},TypeError);tr("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");Qn.codes=p0;var e2=Qn.codes.ERR_INVALID_OPT_VALUE;function t2(t,e,r){return t.highWaterMark!=null?t.highWaterMark:e?t[r]:null}function r2(t,e,r,n){var i=t2(e,n,r);if(i!=null){if(!(isFinite(i)&&Math.floor(i)===i)||i<0){var s=n?r:"highWaterMark";throw new e2(s,i)}return Math.floor(i)}return t.objectMode?16:16*1024}var g0={getHighWaterMark:r2},Yu={exports:{}};typeof Object.create=="function"?Yu.exports=function(e,r){r&&(e.super_=r,e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:Yu.exports=function(e,r){if(r){e.super_=r;var n=function(){};n.prototype=r.prototype,e.prototype=new n,e.prototype.constructor=e}};var ks=Yu.exports,n2=i2;function i2(t,e){if(Mc("noDeprecation"))return t;var r=!1;function n(){if(!r){if(Mc("throwDeprecation"))throw new Error(e);Mc("traceDeprecation")?console.trace(e):console.warn(e),r=!0}return t.apply(this,arguments)}return n}function Mc(t){try{if(!Ee.localStorage)return!1}catch{return!1}var e=Ee.localStorage[t];return e==null?!1:String(e).toLowerCase()==="true"}var Fc,Mh;function y0(){if(Mh)return Fc;Mh=1,Fc=M;function t(q){var j=this;this.next=null,this.entry=null,this.finish=function(){fe(j,q)}}var e;M.WritableState=O;var r={deprecate:n2},n=f0,i=zi.Buffer,s=(typeof Ee<"u"?Ee:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function o(q){return i.from(q)}function a(q){return i.isBuffer(q)||q instanceof s}var c=d0,u=g0,l=u.getHighWaterMark,f=Qn.codes,h=f.ERR_INVALID_ARG_TYPE,p=f.ERR_METHOD_NOT_IMPLEMENTED,g=f.ERR_MULTIPLE_CALLBACK,w=f.ERR_STREAM_CANNOT_PIPE,v=f.ERR_STREAM_DESTROYED,E=f.ERR_STREAM_NULL_VALUES,I=f.ERR_STREAM_WRITE_AFTER_END,x=f.ERR_UNKNOWN_ENCODING,A=c.errorOrDestroy;ks(M,n);function T(){}function O(q,j,ne){e=e||Ui(),q=q||{},typeof ne!="boolean"&&(ne=j instanceof e),this.objectMode=!!q.objectMode,ne&&(this.objectMode=this.objectMode||!!q.writableObjectMode),this.highWaterMark=l(this,q,"writableHighWaterMark",ne),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var ae=q.decodeStrings===!1;this.decodeStrings=!ae,this.defaultEncoding=q.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(S){C(j,S)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=q.emitClose!==!1,this.autoDestroy=!!q.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new t(this)}O.prototype.getBuffer=function(){for(var j=this.bufferedRequest,ne=[];j;)ne.push(j),j=j.next;return ne},function(){try{Object.defineProperty(O.prototype,"buffer",{get:r.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var P;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(P=Function.prototype[Symbol.hasInstance],Object.defineProperty(M,Symbol.hasInstance,{value:function(j){return P.call(this,j)?!0:this!==M?!1:j&&j._writableState instanceof O}})):P=function(j){return j instanceof this};function M(q){e=e||Ui();var j=this instanceof e;if(!j&&!P.call(M,this))return new M(q);this._writableState=new O(q,this,j),this.writable=!0,q&&(typeof q.write=="function"&&(this._write=q.write),typeof q.writev=="function"&&(this._writev=q.writev),typeof q.destroy=="function"&&(this._destroy=q.destroy),typeof q.final=="function"&&(this._final=q.final)),n.call(this)}M.prototype.pipe=function(){A(this,new w)};function U(q,j){var ne=new I;A(q,ne),process.nextTick(j,ne)}function G(q,j,ne,ae){var S;return ne===null?S=new E:typeof ne!="string"&&!j.objectMode&&(S=new h("chunk",["string","Buffer"],ne)),S?(A(q,S),process.nextTick(ae,S),!1):!0}M.prototype.write=function(q,j,ne){var ae=this._writableState,S=!1,m=!ae.objectMode&&a(q);return m&&!i.isBuffer(q)&&(q=o(q)),typeof j=="function"&&(ne=j,j=null),m?j="buffer":j||(j=ae.defaultEncoding),typeof ne!="function"&&(ne=T),ae.ending?U(this,ne):(m||G(this,ae,q,ne))&&(ae.pendingcb++,S=Z(this,ae,m,q,j,ne)),S},M.prototype.cork=function(){this._writableState.corked++},M.prototype.uncork=function(){var q=this._writableState;q.corked&&(q.corked--,!q.writing&&!q.corked&&!q.bufferProcessing&&q.bufferedRequest&&k(this,q))},M.prototype.setDefaultEncoding=function(j){if(typeof j=="string"&&(j=j.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((j+"").toLowerCase())>-1))throw new x(j);return this._writableState.defaultEncoding=j,this},Object.defineProperty(M.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function se(q,j,ne){return!q.objectMode&&q.decodeStrings!==!1&&typeof j=="string"&&(j=i.from(j,ne)),j}Object.defineProperty(M.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function Z(q,j,ne,ae,S,m){if(!ne){var b=se(j,ae,S);ae!==b&&(ne=!0,S="buffer",ae=b)}var R=j.objectMode?1:ae.length;j.length+=R;var N=j.length<j.highWaterMark;if(N||(j.needDrain=!0),j.writing||j.corked){var z=j.lastBufferedRequest;j.lastBufferedRequest={chunk:ae,encoding:S,isBuf:ne,callback:m,next:null},z?z.next=j.lastBufferedRequest:j.bufferedRequest=j.lastBufferedRequest,j.bufferedRequestCount+=1}else L(q,j,!1,R,ae,S,m);return N}function L(q,j,ne,ae,S,m,b){j.writelen=ae,j.writecb=b,j.writing=!0,j.sync=!0,j.destroyed?j.onwrite(new v("write")):ne?q._writev(S,j.onwrite):q._write(S,m,j.onwrite),j.sync=!1}function K(q,j,ne,ae,S){--j.pendingcb,ne?(process.nextTick(S,ae),process.nextTick(he,q,j),q._writableState.errorEmitted=!0,A(q,ae)):(S(ae),q._writableState.errorEmitted=!0,A(q,ae),he(q,j))}function D(q){q.writing=!1,q.writecb=null,q.length-=q.writelen,q.writelen=0}function C(q,j){var ne=q._writableState,ae=ne.sync,S=ne.writecb;if(typeof S!="function")throw new g;if(D(ne),j)K(q,ne,ae,j,S);else{var m=W(ne)||q.destroyed;!m&&!ne.corked&&!ne.bufferProcessing&&ne.bufferedRequest&&k(q,ne),ae?process.nextTick(F,q,ne,m,S):F(q,ne,m,S)}}function F(q,j,ne,ae){ne||Y(q,j),j.pendingcb--,ae(),he(q,j)}function Y(q,j){j.length===0&&j.needDrain&&(j.needDrain=!1,q.emit("drain"))}function k(q,j){j.bufferProcessing=!0;var ne=j.bufferedRequest;if(q._writev&&ne&&ne.next){var ae=j.bufferedRequestCount,S=new Array(ae),m=j.corkedRequestsFree;m.entry=ne;for(var b=0,R=!0;ne;)S[b]=ne,ne.isBuf||(R=!1),ne=ne.next,b+=1;S.allBuffers=R,L(q,j,!0,j.length,S,"",m.finish),j.pendingcb++,j.lastBufferedRequest=null,m.next?(j.corkedRequestsFree=m.next,m.next=null):j.corkedRequestsFree=new t(j),j.bufferedRequestCount=0}else{for(;ne;){var N=ne.chunk,z=ne.encoding,H=ne.callback,$=j.objectMode?1:N.length;if(L(q,j,!1,$,N,z,H),ne=ne.next,j.bufferedRequestCount--,j.writing)break}ne===null&&(j.lastBufferedRequest=null)}j.bufferedRequest=ne,j.bufferProcessing=!1}M.prototype._write=function(q,j,ne){ne(new p("_write()"))},M.prototype._writev=null,M.prototype.end=function(q,j,ne){var ae=this._writableState;return typeof q=="function"?(ne=q,q=null,j=null):typeof j=="function"&&(ne=j,j=null),q!=null&&this.write(q,j),ae.corked&&(ae.corked=1,this.uncork()),ae.ending||J(this,ae,ne),this},Object.defineProperty(M.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function W(q){return q.ending&&q.length===0&&q.bufferedRequest===null&&!q.finished&&!q.writing}function te(q,j){q._final(function(ne){j.pendingcb--,ne&&A(q,ne),j.prefinished=!0,q.emit("prefinish"),he(q,j)})}function ie(q,j){!j.prefinished&&!j.finalCalled&&(typeof q._final=="function"&&!j.destroyed?(j.pendingcb++,j.finalCalled=!0,process.nextTick(te,q,j)):(j.prefinished=!0,q.emit("prefinish")))}function he(q,j){var ne=W(j);if(ne&&(ie(q,j),j.pendingcb===0&&(j.finished=!0,q.emit("finish"),j.autoDestroy))){var ae=q._readableState;(!ae||ae.autoDestroy&&ae.endEmitted)&&q.destroy()}return ne}function J(q,j,ne){j.ending=!0,he(q,j),ne&&(j.finished?process.nextTick(ne):q.once("finish",ne)),j.ended=!0,q.writable=!1}function fe(q,j,ne){var ae=q.entry;for(q.entry=null;ae;){var S=ae.callback;j.pendingcb--,S(ne),ae=ae.next}j.corkedRequestsFree.next=q}return Object.defineProperty(M.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(j){this._writableState&&(this._writableState.destroyed=j)}}),M.prototype.destroy=c.destroy,M.prototype._undestroy=c.undestroy,M.prototype._destroy=function(q,j){j(q)},Fc}var kc,Fh;function Ui(){if(Fh)return kc;Fh=1;var t=Object.keys||function(u){var l=[];for(var f in u)l.push(f);return l};kc=o;var e=m0(),r=y0();ks(o,e);for(var n=t(r.prototype),i=0;i<n.length;i++){var s=n[i];o.prototype[s]||(o.prototype[s]=r.prototype[s])}function o(u){if(!(this instanceof o))return new o(u);e.call(this,u),r.call(this,u),this.allowHalfOpen=!0,u&&(u.readable===!1&&(this.readable=!1),u.writable===!1&&(this.writable=!1),u.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",a)))}Object.defineProperty(o.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(o.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(o.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function a(){this._writableState.ended||process.nextTick(c,this)}function c(u){u.end()}return Object.defineProperty(o.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(l){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=l,this._writableState.destroyed=l)}}),kc}var jc={},ro={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var kh;function s2(){return kh||(kh=1,function(t,e){var r=zi,n=r.Buffer;function i(o,a){for(var c in o)a[c]=o[c]}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?t.exports=r:(i(r,e),e.Buffer=s);function s(o,a,c){return n(o,a,c)}s.prototype=Object.create(n.prototype),i(n,s),s.from=function(o,a,c){if(typeof o=="number")throw new TypeError("Argument must not be a number");return n(o,a,c)},s.alloc=function(o,a,c){if(typeof o!="number")throw new TypeError("Argument must be a number");var u=n(o);return a!==void 0?typeof c=="string"?u.fill(a,c):u.fill(a):u.fill(0),u},s.allocUnsafe=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return n(o)},s.allocUnsafeSlow=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return r.SlowBuffer(o)}}(ro,ro.exports)),ro.exports}var jh;function qh(){if(jh)return jc;jh=1;var t=s2().Buffer,e=t.isEncoding||function(E){switch(E=""+E,E&&E.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function r(E){if(!E)return"utf8";for(var I;;)switch(E){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return E;default:if(I)return;E=(""+E).toLowerCase(),I=!0}}function n(E){var I=r(E);if(typeof I!="string"&&(t.isEncoding===e||!e(E)))throw new Error("Unknown encoding: "+E);return I||E}jc.StringDecoder=i;function i(E){this.encoding=n(E);var I;switch(this.encoding){case"utf16le":this.text=f,this.end=h,I=4;break;case"utf8":this.fillLast=c,I=4;break;case"base64":this.text=p,this.end=g,I=3;break;default:this.write=w,this.end=v;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=t.allocUnsafe(I)}i.prototype.write=function(E){if(E.length===0)return"";var I,x;if(this.lastNeed){if(I=this.fillLast(E),I===void 0)return"";x=this.lastNeed,this.lastNeed=0}else x=0;return x<E.length?I?I+this.text(E,x):this.text(E,x):I||""},i.prototype.end=l,i.prototype.text=u,i.prototype.fillLast=function(E){if(this.lastNeed<=E.length)return E.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);E.copy(this.lastChar,this.lastTotal-this.lastNeed,0,E.length),this.lastNeed-=E.length};function s(E){return E<=127?0:E>>5===6?2:E>>4===14?3:E>>3===30?4:E>>6===2?-1:-2}function o(E,I,x){var A=I.length-1;if(A<x)return 0;var T=s(I[A]);return T>=0?(T>0&&(E.lastNeed=T-1),T):--A<x||T===-2?0:(T=s(I[A]),T>=0?(T>0&&(E.lastNeed=T-2),T):--A<x||T===-2?0:(T=s(I[A]),T>=0?(T>0&&(T===2?T=0:E.lastNeed=T-3),T):0))}function a(E,I,x){if((I[0]&192)!==128)return E.lastNeed=0,"";if(E.lastNeed>1&&I.length>1){if((I[1]&192)!==128)return E.lastNeed=1,"";if(E.lastNeed>2&&I.length>2&&(I[2]&192)!==128)return E.lastNeed=2,""}}function c(E){var I=this.lastTotal-this.lastNeed,x=a(this,E);if(x!==void 0)return x;if(this.lastNeed<=E.length)return E.copy(this.lastChar,I,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);E.copy(this.lastChar,I,0,E.length),this.lastNeed-=E.length}function u(E,I){var x=o(this,E,I);if(!this.lastNeed)return E.toString("utf8",I);this.lastTotal=x;var A=E.length-(x-this.lastNeed);return E.copy(this.lastChar,0,A),E.toString("utf8",I,A)}function l(E){var I=E&&E.length?this.write(E):"";return this.lastNeed?I+"":I}function f(E,I){if((E.length-I)%2===0){var x=E.toString("utf16le",I);if(x){var A=x.charCodeAt(x.length-1);if(A>=55296&&A<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=E[E.length-2],this.lastChar[1]=E[E.length-1],x.slice(0,-1)}return x}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=E[E.length-1],E.toString("utf16le",I,E.length-1)}function h(E){var I=E&&E.length?this.write(E):"";if(this.lastNeed){var x=this.lastTotal-this.lastNeed;return I+this.lastChar.toString("utf16le",0,x)}return I}function p(E,I){var x=(E.length-I)%3;return x===0?E.toString("base64",I):(this.lastNeed=3-x,this.lastTotal=3,x===1?this.lastChar[0]=E[E.length-1]:(this.lastChar[0]=E[E.length-2],this.lastChar[1]=E[E.length-1]),E.toString("base64",I,E.length-x))}function g(E){var I=E&&E.length?this.write(E):"";return this.lastNeed?I+this.lastChar.toString("base64",0,3-this.lastNeed):I}function w(E){return E.toString(this.encoding)}function v(E){return E&&E.length?this.write(E):""}return jc}var zh=Qn.codes.ERR_STREAM_PREMATURE_CLOSE;function o2(t){var e=!1;return function(){if(!e){e=!0;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];t.apply(this,n)}}}function a2(){}function c2(t){return t.setHeader&&typeof t.abort=="function"}function w0(t,e,r){if(typeof e=="function")return w0(t,null,e);e||(e={}),r=o2(r||a2);var n=e.readable||e.readable!==!1&&t.readable,i=e.writable||e.writable!==!1&&t.writable,s=function(){t.writable||a()},o=t._writableState&&t._writableState.finished,a=function(){i=!1,o=!0,n||r.call(t)},c=t._readableState&&t._readableState.endEmitted,u=function(){n=!1,c=!0,i||r.call(t)},l=function(g){r.call(t,g)},f=function(){var g;if(n&&!c)return(!t._readableState||!t._readableState.ended)&&(g=new zh),r.call(t,g);if(i&&!o)return(!t._writableState||!t._writableState.ended)&&(g=new zh),r.call(t,g)},h=function(){t.req.on("finish",a)};return c2(t)?(t.on("complete",a),t.on("abort",f),t.req?h():t.on("request",h)):i&&!t._writableState&&(t.on("end",s),t.on("close",s)),t.on("end",u),t.on("finish",a),e.error!==!1&&t.on("error",l),t.on("close",f),function(){t.removeListener("complete",a),t.removeListener("abort",f),t.removeListener("request",h),t.req&&t.req.removeListener("finish",a),t.removeListener("end",s),t.removeListener("close",s),t.removeListener("finish",a),t.removeListener("end",u),t.removeListener("error",l),t.removeListener("close",f)}}var pf=w0,qc,Vh;function u2(){if(Vh)return qc;Vh=1;var t;function e(x,A,T){return A=r(A),A in x?Object.defineProperty(x,A,{value:T,enumerable:!0,configurable:!0,writable:!0}):x[A]=T,x}function r(x){var A=n(x,"string");return typeof A=="symbol"?A:String(A)}function n(x,A){if(typeof x!="object"||x===null)return x;var T=x[Symbol.toPrimitive];if(T!==void 0){var O=T.call(x,A);if(typeof O!="object")return O;throw new TypeError("@@toPrimitive must return a primitive value.")}return(A==="string"?String:Number)(x)}var i=pf,s=Symbol("lastResolve"),o=Symbol("lastReject"),a=Symbol("error"),c=Symbol("ended"),u=Symbol("lastPromise"),l=Symbol("handlePromise"),f=Symbol("stream");function h(x,A){return{value:x,done:A}}function p(x){var A=x[s];if(A!==null){var T=x[f].read();T!==null&&(x[u]=null,x[s]=null,x[o]=null,A(h(T,!1)))}}function g(x){process.nextTick(p,x)}function w(x,A){return function(T,O){x.then(function(){if(A[c]){T(h(void 0,!0));return}A[l](T,O)},O)}}var v=Object.getPrototypeOf(function(){}),E=Object.setPrototypeOf((t={get stream(){return this[f]},next:function(){var A=this,T=this[a];if(T!==null)return Promise.reject(T);if(this[c])return Promise.resolve(h(void 0,!0));if(this[f].destroyed)return new Promise(function(U,G){process.nextTick(function(){A[a]?G(A[a]):U(h(void 0,!0))})});var O=this[u],P;if(O)P=new Promise(w(O,this));else{var M=this[f].read();if(M!==null)return Promise.resolve(h(M,!1));P=new Promise(this[l])}return this[u]=P,P}},e(t,Symbol.asyncIterator,function(){return this}),e(t,"return",function(){var A=this;return new Promise(function(T,O){A[f].destroy(null,function(P){if(P){O(P);return}T(h(void 0,!0))})})}),t),v),I=function(A){var T,O=Object.create(E,(T={},e(T,f,{value:A,writable:!0}),e(T,s,{value:null,writable:!0}),e(T,o,{value:null,writable:!0}),e(T,a,{value:null,writable:!0}),e(T,c,{value:A._readableState.endEmitted,writable:!0}),e(T,l,{value:function(M,U){var G=O[f].read();G?(O[u]=null,O[s]=null,O[o]=null,M(h(G,!1))):(O[s]=M,O[o]=U)},writable:!0}),T));return O[u]=null,i(A,function(P){if(P&&P.code!=="ERR_STREAM_PREMATURE_CLOSE"){var M=O[o];M!==null&&(O[u]=null,O[s]=null,O[o]=null,M(P)),O[a]=P;return}var U=O[s];U!==null&&(O[u]=null,O[s]=null,O[o]=null,U(h(void 0,!0))),O[c]=!0}),A.on("readable",g.bind(null,O)),O};return qc=I,qc}var zc,Hh;function l2(){return Hh||(Hh=1,zc=function(){throw new Error("Readable.from is not available in the browser")}),zc}var Vc,Kh;function m0(){if(Kh)return Vc;Kh=1,Vc=U;var t;U.ReadableState=M,zt.EventEmitter;var e=function(b,R){return b.listeners(R).length},r=f0,n=zi.Buffer,i=(typeof Ee<"u"?Ee:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function s(m){return n.from(m)}function o(m){return n.isBuffer(m)||m instanceof i}var a=h0,c;a&&a.debuglog?c=a.debuglog("stream"):c=function(){};var u=Kv(),l=d0,f=g0,h=f.getHighWaterMark,p=Qn.codes,g=p.ERR_INVALID_ARG_TYPE,w=p.ERR_STREAM_PUSH_AFTER_EOF,v=p.ERR_METHOD_NOT_IMPLEMENTED,E=p.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,I,x,A;ks(U,r);var T=l.errorOrDestroy,O=["error","close","destroy","pause","resume"];function P(m,b,R){if(typeof m.prependListener=="function")return m.prependListener(b,R);!m._events||!m._events[b]?m.on(b,R):Array.isArray(m._events[b])?m._events[b].unshift(R):m._events[b]=[R,m._events[b]]}function M(m,b,R){t=t||Ui(),m=m||{},typeof R!="boolean"&&(R=b instanceof t),this.objectMode=!!m.objectMode,R&&(this.objectMode=this.objectMode||!!m.readableObjectMode),this.highWaterMark=h(this,m,"readableHighWaterMark",R),this.buffer=new u,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=m.emitClose!==!1,this.autoDestroy=!!m.autoDestroy,this.destroyed=!1,this.defaultEncoding=m.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,m.encoding&&(I||(I=qh().StringDecoder),this.decoder=new I(m.encoding),this.encoding=m.encoding)}function U(m){if(t=t||Ui(),!(this instanceof U))return new U(m);var b=this instanceof t;this._readableState=new M(m,this,b),this.readable=!0,m&&(typeof m.read=="function"&&(this._read=m.read),typeof m.destroy=="function"&&(this._destroy=m.destroy)),r.call(this)}Object.defineProperty(U.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(b){this._readableState&&(this._readableState.destroyed=b)}}),U.prototype.destroy=l.destroy,U.prototype._undestroy=l.undestroy,U.prototype._destroy=function(m,b){b(m)},U.prototype.push=function(m,b){var R=this._readableState,N;return R.objectMode?N=!0:typeof m=="string"&&(b=b||R.defaultEncoding,b!==R.encoding&&(m=n.from(m,b),b=""),N=!0),G(this,m,b,!1,N)},U.prototype.unshift=function(m){return G(this,m,null,!0,!1)};function G(m,b,R,N,z){c("readableAddChunk",b);var H=m._readableState;if(b===null)H.reading=!1,C(m,H);else{var $;if(z||($=Z(H,b)),$)T(m,$);else if(H.objectMode||b&&b.length>0)if(typeof b!="string"&&!H.objectMode&&Object.getPrototypeOf(b)!==n.prototype&&(b=s(b)),N)H.endEmitted?T(m,new E):se(m,H,b,!0);else if(H.ended)T(m,new w);else{if(H.destroyed)return!1;H.reading=!1,H.decoder&&!R?(b=H.decoder.write(b),H.objectMode||b.length!==0?se(m,H,b,!1):k(m,H)):se(m,H,b,!1)}else N||(H.reading=!1,k(m,H))}return!H.ended&&(H.length<H.highWaterMark||H.length===0)}function se(m,b,R,N){b.flowing&&b.length===0&&!b.sync?(b.awaitDrain=0,m.emit("data",R)):(b.length+=b.objectMode?1:R.length,N?b.buffer.unshift(R):b.buffer.push(R),b.needReadable&&F(m)),k(m,b)}function Z(m,b){var R;return!o(b)&&typeof b!="string"&&b!==void 0&&!m.objectMode&&(R=new g("chunk",["string","Buffer","Uint8Array"],b)),R}U.prototype.isPaused=function(){return this._readableState.flowing===!1},U.prototype.setEncoding=function(m){I||(I=qh().StringDecoder);var b=new I(m);this._readableState.decoder=b,this._readableState.encoding=this._readableState.decoder.encoding;for(var R=this._readableState.buffer.head,N="";R!==null;)N+=b.write(R.data),R=R.next;return this._readableState.buffer.clear(),N!==""&&this._readableState.buffer.push(N),this._readableState.length=N.length,this};var L=1073741824;function K(m){return m>=L?m=L:(m--,m|=m>>>1,m|=m>>>2,m|=m>>>4,m|=m>>>8,m|=m>>>16,m++),m}function D(m,b){return m<=0||b.length===0&&b.ended?0:b.objectMode?1:m!==m?b.flowing&&b.length?b.buffer.head.data.length:b.length:(m>b.highWaterMark&&(b.highWaterMark=K(m)),m<=b.length?m:b.ended?b.length:(b.needReadable=!0,0))}U.prototype.read=function(m){c("read",m),m=parseInt(m,10);var b=this._readableState,R=m;if(m!==0&&(b.emittedReadable=!1),m===0&&b.needReadable&&((b.highWaterMark!==0?b.length>=b.highWaterMark:b.length>0)||b.ended))return c("read: emitReadable",b.length,b.ended),b.length===0&&b.ended?ne(this):F(this),null;if(m=D(m,b),m===0&&b.ended)return b.length===0&&ne(this),null;var N=b.needReadable;c("need readable",N),(b.length===0||b.length-m<b.highWaterMark)&&(N=!0,c("length less than watermark",N)),b.ended||b.reading?(N=!1,c("reading or ended",N)):N&&(c("do read"),b.reading=!0,b.sync=!0,b.length===0&&(b.needReadable=!0),this._read(b.highWaterMark),b.sync=!1,b.reading||(m=D(R,b)));var z;return m>0?z=j(m,b):z=null,z===null?(b.needReadable=b.length<=b.highWaterMark,m=0):(b.length-=m,b.awaitDrain=0),b.length===0&&(b.ended||(b.needReadable=!0),R!==m&&b.ended&&ne(this)),z!==null&&this.emit("data",z),z};function C(m,b){if(c("onEofChunk"),!b.ended){if(b.decoder){var R=b.decoder.end();R&&R.length&&(b.buffer.push(R),b.length+=b.objectMode?1:R.length)}b.ended=!0,b.sync?F(m):(b.needReadable=!1,b.emittedReadable||(b.emittedReadable=!0,Y(m)))}}function F(m){var b=m._readableState;c("emitReadable",b.needReadable,b.emittedReadable),b.needReadable=!1,b.emittedReadable||(c("emitReadable",b.flowing),b.emittedReadable=!0,process.nextTick(Y,m))}function Y(m){var b=m._readableState;c("emitReadable_",b.destroyed,b.length,b.ended),!b.destroyed&&(b.length||b.ended)&&(m.emit("readable"),b.emittedReadable=!1),b.needReadable=!b.flowing&&!b.ended&&b.length<=b.highWaterMark,q(m)}function k(m,b){b.readingMore||(b.readingMore=!0,process.nextTick(W,m,b))}function W(m,b){for(;!b.reading&&!b.ended&&(b.length<b.highWaterMark||b.flowing&&b.length===0);){var R=b.length;if(c("maybeReadMore read 0"),m.read(0),R===b.length)break}b.readingMore=!1}U.prototype._read=function(m){T(this,new v("_read()"))},U.prototype.pipe=function(m,b){var R=this,N=this._readableState;switch(N.pipesCount){case 0:N.pipes=m;break;case 1:N.pipes=[N.pipes,m];break;default:N.pipes.push(m);break}N.pipesCount+=1,c("pipe count=%d opts=%j",N.pipesCount,b);var z=(!b||b.end!==!1)&&m!==process.stdout&&m!==process.stderr,H=z?X:Be;N.endEmitted?process.nextTick(H):R.once("end",H),m.on("unpipe",$);function $(_,d){c("onunpipe"),_===R&&d&&d.hasUnpiped===!1&&(d.hasUnpiped=!0,ce())}function X(){c("onend"),m.end()}var ee=te(R);m.on("drain",ee);var Q=!1;function ce(){c("cleanup"),m.removeListener("close",xe),m.removeListener("finish",Ae),m.removeListener("drain",ee),m.removeListener("error",we),m.removeListener("unpipe",$),R.removeListener("end",X),R.removeListener("end",Be),R.removeListener("data",ge),Q=!0,N.awaitDrain&&(!m._writableState||m._writableState.needDrain)&&ee()}R.on("data",ge);function ge(_){c("ondata");var d=m.write(_);c("dest.write",d),d===!1&&((N.pipesCount===1&&N.pipes===m||N.pipesCount>1&&S(N.pipes,m)!==-1)&&!Q&&(c("false write response, pause",N.awaitDrain),N.awaitDrain++),R.pause())}function we(_){c("onerror",_),Be(),m.removeListener("error",we),e(m,"error")===0&&T(m,_)}P(m,"error",we);function xe(){m.removeListener("finish",Ae),Be()}m.once("close",xe);function Ae(){c("onfinish"),m.removeListener("close",xe),Be()}m.once("finish",Ae);function Be(){c("unpipe"),R.unpipe(m)}return m.emit("pipe",R),N.flowing||(c("pipe resume"),R.resume()),m};function te(m){return function(){var R=m._readableState;c("pipeOnDrain",R.awaitDrain),R.awaitDrain&&R.awaitDrain--,R.awaitDrain===0&&e(m,"data")&&(R.flowing=!0,q(m))}}U.prototype.unpipe=function(m){var b=this._readableState,R={hasUnpiped:!1};if(b.pipesCount===0)return this;if(b.pipesCount===1)return m&&m!==b.pipes?this:(m||(m=b.pipes),b.pipes=null,b.pipesCount=0,b.flowing=!1,m&&m.emit("unpipe",this,R),this);if(!m){var N=b.pipes,z=b.pipesCount;b.pipes=null,b.pipesCount=0,b.flowing=!1;for(var H=0;H<z;H++)N[H].emit("unpipe",this,{hasUnpiped:!1});return this}var $=S(b.pipes,m);return $===-1?this:(b.pipes.splice($,1),b.pipesCount-=1,b.pipesCount===1&&(b.pipes=b.pipes[0]),m.emit("unpipe",this,R),this)},U.prototype.on=function(m,b){var R=r.prototype.on.call(this,m,b),N=this._readableState;return m==="data"?(N.readableListening=this.listenerCount("readable")>0,N.flowing!==!1&&this.resume()):m==="readable"&&!N.endEmitted&&!N.readableListening&&(N.readableListening=N.needReadable=!0,N.flowing=!1,N.emittedReadable=!1,c("on readable",N.length,N.reading),N.length?F(this):N.reading||process.nextTick(he,this)),R},U.prototype.addListener=U.prototype.on,U.prototype.removeListener=function(m,b){var R=r.prototype.removeListener.call(this,m,b);return m==="readable"&&process.nextTick(ie,this),R},U.prototype.removeAllListeners=function(m){var b=r.prototype.removeAllListeners.apply(this,arguments);return(m==="readable"||m===void 0)&&process.nextTick(ie,this),b};function ie(m){var b=m._readableState;b.readableListening=m.listenerCount("readable")>0,b.resumeScheduled&&!b.paused?b.flowing=!0:m.listenerCount("data")>0&&m.resume()}function he(m){c("readable nexttick read 0"),m.read(0)}U.prototype.resume=function(){var m=this._readableState;return m.flowing||(c("resume"),m.flowing=!m.readableListening,J(this,m)),m.paused=!1,this};function J(m,b){b.resumeScheduled||(b.resumeScheduled=!0,process.nextTick(fe,m,b))}function fe(m,b){c("resume",b.reading),b.reading||m.read(0),b.resumeScheduled=!1,m.emit("resume"),q(m),b.flowing&&!b.reading&&m.read(0)}U.prototype.pause=function(){return c("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(c("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function q(m){var b=m._readableState;for(c("flow",b.flowing);b.flowing&&m.read()!==null;);}U.prototype.wrap=function(m){var b=this,R=this._readableState,N=!1;m.on("end",function(){if(c("wrapped end"),R.decoder&&!R.ended){var $=R.decoder.end();$&&$.length&&b.push($)}b.push(null)}),m.on("data",function($){if(c("wrapped data"),R.decoder&&($=R.decoder.write($)),!(R.objectMode&&$==null)&&!(!R.objectMode&&(!$||!$.length))){var X=b.push($);X||(N=!0,m.pause())}});for(var z in m)this[z]===void 0&&typeof m[z]=="function"&&(this[z]=function(X){return function(){return m[X].apply(m,arguments)}}(z));for(var H=0;H<O.length;H++)m.on(O[H],this.emit.bind(this,O[H]));return this._read=function($){c("wrapped _read",$),N&&(N=!1,m.resume())},this},typeof Symbol=="function"&&(U.prototype[Symbol.asyncIterator]=function(){return x===void 0&&(x=u2()),x(this)}),Object.defineProperty(U.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(U.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(U.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(b){this._readableState&&(this._readableState.flowing=b)}}),U._fromList=j,Object.defineProperty(U.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function j(m,b){if(b.length===0)return null;var R;return b.objectMode?R=b.buffer.shift():!m||m>=b.length?(b.decoder?R=b.buffer.join(""):b.buffer.length===1?R=b.buffer.first():R=b.buffer.concat(b.length),b.buffer.clear()):R=b.buffer.consume(m,b.decoder),R}function ne(m){var b=m._readableState;c("endReadable",b.endEmitted),b.endEmitted||(b.ended=!0,process.nextTick(ae,b,m))}function ae(m,b){if(c("endReadableNT",m.endEmitted,m.length),!m.endEmitted&&m.length===0&&(m.endEmitted=!0,b.readable=!1,b.emit("end"),m.autoDestroy)){var R=b._writableState;(!R||R.autoDestroy&&R.finished)&&b.destroy()}}typeof Symbol=="function"&&(U.from=function(m,b){return A===void 0&&(A=l2()),A(U,m,b)});function S(m,b){for(var R=0,N=m.length;R<N;R++)if(m[R]===b)return R;return-1}return Vc}var b0=Gr,ya=Qn.codes,f2=ya.ERR_METHOD_NOT_IMPLEMENTED,h2=ya.ERR_MULTIPLE_CALLBACK,d2=ya.ERR_TRANSFORM_ALREADY_TRANSFORMING,p2=ya.ERR_TRANSFORM_WITH_LENGTH_0,wa=Ui();ks(Gr,wa);function g2(t,e){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(n===null)return this.emit("error",new h2);r.writechunk=null,r.writecb=null,e!=null&&this.push(e),n(t);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function Gr(t){if(!(this instanceof Gr))return new Gr(t);wa.call(this,t),this._transformState={afterTransform:g2.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&(typeof t.transform=="function"&&(this._transform=t.transform),typeof t.flush=="function"&&(this._flush=t.flush)),this.on("prefinish",y2)}function y2(){var t=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(e,r){Wh(t,e,r)}):Wh(this,null,null)}Gr.prototype.push=function(t,e){return this._transformState.needTransform=!1,wa.prototype.push.call(this,t,e)};Gr.prototype._transform=function(t,e,r){r(new f2("_transform()"))};Gr.prototype._write=function(t,e,r){var n=this._transformState;if(n.writecb=r,n.writechunk=t,n.writeencoding=e,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}};Gr.prototype._read=function(t){var e=this._transformState;e.writechunk!==null&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0};Gr.prototype._destroy=function(t,e){wa.prototype._destroy.call(this,t,function(r){e(r)})};function Wh(t,e,r){if(e)return t.emit("error",e);if(r!=null&&t.push(r),t._writableState.length)throw new p2;if(t._transformState.transforming)throw new d2;return t.push(null)}var w2=As,E0=b0;ks(As,E0);function As(t){if(!(this instanceof As))return new As(t);E0.call(this,t)}As.prototype._transform=function(t,e,r){r(null,t)};var Hc;function m2(t){var e=!1;return function(){e||(e=!0,t.apply(void 0,arguments))}}var v0=Qn.codes,b2=v0.ERR_MISSING_ARGS,E2=v0.ERR_STREAM_DESTROYED;function Gh(t){if(t)throw t}function v2(t){return t.setHeader&&typeof t.abort=="function"}function _2(t,e,r,n){n=m2(n);var i=!1;t.on("close",function(){i=!0}),Hc===void 0&&(Hc=pf),Hc(t,{readable:e,writable:r},function(o){if(o)return n(o);i=!0,n()});var s=!1;return function(o){if(!i&&!s){if(s=!0,v2(t))return t.abort();if(typeof t.destroy=="function")return t.destroy();n(o||new E2("pipe"))}}}function Yh(t){t()}function x2(t,e){return t.pipe(e)}function S2(t){return!t.length||typeof t[t.length-1]!="function"?Gh:t.pop()}function I2(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=S2(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new b2("streams");var i,s=e.map(function(o,a){var c=a<e.length-1,u=a>0;return _2(o,c,u,function(l){i||(i=l),l&&s.forEach(Yh),!c&&(s.forEach(Yh),n(i))})});return e.reduce(x2)}var A2=I2;(function(t,e){e=t.exports=m0(),e.Stream=e,e.Readable=e,e.Writable=y0(),e.Duplex=Ui(),e.Transform=b0,e.PassThrough=w2,e.finished=pf,e.pipeline=A2})(Wu,Wu.exports);var _0=Wu.exports;const{Transform:T2}=_0;var O2=t=>class x0 extends T2{constructor(r,n,i,s,o){super(o),this._rate=r,this._capacity=n,this._delimitedSuffix=i,this._hashBitLength=s,this._options=o,this._state=new t,this._state.initialize(r,n),this._finalized=!1}_transform(r,n,i){let s=null;try{this.update(r,n)}catch(o){s=o}i(s)}_flush(r){let n=null;try{this.push(this.digest())}catch(i){n=i}r(n)}update(r,n){if(!Buffer.isBuffer(r)&&typeof r!="string")throw new TypeError("Data must be a string or a buffer");if(this._finalized)throw new Error("Digest already called");return Buffer.isBuffer(r)||(r=Buffer.from(r,n)),this._state.absorb(r),this}digest(r){if(this._finalized)throw new Error("Digest already called");this._finalized=!0,this._delimitedSuffix&&this._state.absorbLastFewBits(this._delimitedSuffix);let n=this._state.squeeze(this._hashBitLength/8);return r!==void 0&&(n=n.toString(r)),this._resetState(),n}_resetState(){return this._state.initialize(this._rate,this._capacity),this}_clone(){const r=new x0(this._rate,this._capacity,this._delimitedSuffix,this._hashBitLength,this._options);return this._state.copy(r._state),r._finalized=this._finalized,r}};const{Transform:C2}=_0;var D2=t=>class S0 extends C2{constructor(r,n,i,s){super(s),this._rate=r,this._capacity=n,this._delimitedSuffix=i,this._options=s,this._state=new t,this._state.initialize(r,n),this._finalized=!1}_transform(r,n,i){let s=null;try{this.update(r,n)}catch(o){s=o}i(s)}_flush(){}_read(r){this.push(this.squeeze(r))}update(r,n){if(!Buffer.isBuffer(r)&&typeof r!="string")throw new TypeError("Data must be a string or a buffer");if(this._finalized)throw new Error("Squeeze already called");return Buffer.isBuffer(r)||(r=Buffer.from(r,n)),this._state.absorb(r),this}squeeze(r,n){this._finalized||(this._finalized=!0,this._state.absorbLastFewBits(this._delimitedSuffix));let i=this._state.squeeze(r);return n!==void 0&&(i=i.toString(n)),i}_resetState(){return this._state.initialize(this._rate,this._capacity),this}_clone(){const r=new S0(this._rate,this._capacity,this._delimitedSuffix,this._options);return this._state.copy(r._state),r._finalized=this._finalized,r}};const B2=O2,R2=D2;var N2=function(t){const e=B2(t),r=R2(t);return function(n,i){switch(typeof n=="string"?n.toLowerCase():n){case"keccak224":return new e(1152,448,null,224,i);case"keccak256":return new e(1088,512,null,256,i);case"keccak384":return new e(832,768,null,384,i);case"keccak512":return new e(576,1024,null,512,i);case"sha3-224":return new e(1152,448,6,224,i);case"sha3-256":return new e(1088,512,6,256,i);case"sha3-384":return new e(832,768,6,384,i);case"sha3-512":return new e(576,1024,6,512,i);case"shake128":return new r(1344,256,31,i);case"shake256":return new r(1088,512,31,i);default:throw new Error("Invald algorithm: "+n)}}},I0={};const Xh=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648];I0.p1600=function(t){for(let e=0;e<24;++e){const r=t[0]^t[10]^t[20]^t[30]^t[40],n=t[1]^t[11]^t[21]^t[31]^t[41],i=t[2]^t[12]^t[22]^t[32]^t[42],s=t[3]^t[13]^t[23]^t[33]^t[43],o=t[4]^t[14]^t[24]^t[34]^t[44],a=t[5]^t[15]^t[25]^t[35]^t[45],c=t[6]^t[16]^t[26]^t[36]^t[46],u=t[7]^t[17]^t[27]^t[37]^t[47],l=t[8]^t[18]^t[28]^t[38]^t[48],f=t[9]^t[19]^t[29]^t[39]^t[49];let h=l^(i<<1|s>>>31),p=f^(s<<1|i>>>31);const g=t[0]^h,w=t[1]^p,v=t[10]^h,E=t[11]^p,I=t[20]^h,x=t[21]^p,A=t[30]^h,T=t[31]^p,O=t[40]^h,P=t[41]^p;h=r^(o<<1|a>>>31),p=n^(a<<1|o>>>31);const M=t[2]^h,U=t[3]^p,G=t[12]^h,se=t[13]^p,Z=t[22]^h,L=t[23]^p,K=t[32]^h,D=t[33]^p,C=t[42]^h,F=t[43]^p;h=i^(c<<1|u>>>31),p=s^(u<<1|c>>>31);const Y=t[4]^h,k=t[5]^p,W=t[14]^h,te=t[15]^p,ie=t[24]^h,he=t[25]^p,J=t[34]^h,fe=t[35]^p,q=t[44]^h,j=t[45]^p;h=o^(l<<1|f>>>31),p=a^(f<<1|l>>>31);const ne=t[6]^h,ae=t[7]^p,S=t[16]^h,m=t[17]^p,b=t[26]^h,R=t[27]^p,N=t[36]^h,z=t[37]^p,H=t[46]^h,$=t[47]^p;h=c^(r<<1|n>>>31),p=u^(n<<1|r>>>31);const X=t[8]^h,ee=t[9]^p,Q=t[18]^h,ce=t[19]^p,ge=t[28]^h,we=t[29]^p,xe=t[38]^h,Ae=t[39]^p,Be=t[48]^h,_=t[49]^p,d=g,y=w,B=E<<4|v>>>28,V=v<<4|E>>>28,re=I<<3|x>>>29,oe=x<<3|I>>>29,ve=T<<9|A>>>23,Oe=A<<9|T>>>23,Se=O<<18|P>>>14,be=P<<18|O>>>14,Ue=M<<1|U>>>31,Ha=U<<1|M>>>31,Ka=se<<12|G>>>20,Wa=G<<12|se>>>20,Ga=Z<<10|L>>>22,Ya=L<<10|Z>>>22,Xa=D<<13|K>>>19,Za=K<<13|D>>>19,Ja=C<<2|F>>>30,Qa=F<<2|C>>>30,ec=k<<30|Y>>>2,tc=Y<<30|k>>>2,rc=W<<6|te>>>26,nc=te<<6|W>>>26,ic=he<<11|ie>>>21,sc=ie<<11|he>>>21,oc=J<<15|fe>>>17,ac=fe<<15|J>>>17,cc=j<<29|q>>>3,uc=q<<29|j>>>3,lc=ne<<28|ae>>>4,fc=ae<<28|ne>>>4,hc=m<<23|S>>>9,dc=S<<23|m>>>9,pc=b<<25|R>>>7,gc=R<<25|b>>>7,yc=N<<21|z>>>11,wc=z<<21|N>>>11,mc=$<<24|H>>>8,bc=H<<24|$>>>8,Ec=X<<27|ee>>>5,vc=ee<<27|X>>>5,_c=Q<<20|ce>>>12,xc=ce<<20|Q>>>12,Sc=we<<7|ge>>>25,Ic=ge<<7|we>>>25,Ac=xe<<8|Ae>>>24,Tc=Ae<<8|xe>>>24,Oc=Be<<14|_>>>18,Cc=_<<14|Be>>>18;t[0]=d^~Ka&ic,t[1]=y^~Wa&sc,t[10]=lc^~_c&re,t[11]=fc^~xc&oe,t[20]=Ue^~rc&pc,t[21]=Ha^~nc&gc,t[30]=Ec^~B&Ga,t[31]=vc^~V&Ya,t[40]=ec^~hc&Sc,t[41]=tc^~dc&Ic,t[2]=Ka^~ic&yc,t[3]=Wa^~sc&wc,t[12]=_c^~re&Xa,t[13]=xc^~oe&Za,t[22]=rc^~pc&Ac,t[23]=nc^~gc&Tc,t[32]=B^~Ga&oc,t[33]=V^~Ya&ac,t[42]=hc^~Sc&ve,t[43]=dc^~Ic&Oe,t[4]=ic^~yc&Oc,t[5]=sc^~wc&Cc,t[14]=re^~Xa&cc,t[15]=oe^~Za&uc,t[24]=pc^~Ac&Se,t[25]=gc^~Tc&be,t[34]=Ga^~oc&mc,t[35]=Ya^~ac&bc,t[44]=Sc^~ve&Ja,t[45]=Ic^~Oe&Qa,t[6]=yc^~Oc&d,t[7]=wc^~Cc&y,t[16]=Xa^~cc&lc,t[17]=Za^~uc&fc,t[26]=Ac^~Se&Ue,t[27]=Tc^~be&Ha,t[36]=oc^~mc&Ec,t[37]=ac^~bc&vc,t[46]=ve^~Ja&ec,t[47]=Oe^~Qa&tc,t[8]=Oc^~d&Ka,t[9]=Cc^~y&Wa,t[18]=cc^~lc&_c,t[19]=uc^~fc&xc,t[28]=Se^~Ue&rc,t[29]=be^~Ha&nc,t[38]=mc^~Ec&B,t[39]=bc^~vc&V,t[48]=Ja^~ec&hc,t[49]=Qa^~tc&dc,t[0]^=Xh[e*2],t[1]^=Xh[e*2+1]}};const $o=I0;function Vi(){this.state=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.blockSize=null,this.count=0,this.squeezing=!1}Vi.prototype.initialize=function(t,e){for(let r=0;r<50;++r)this.state[r]=0;this.blockSize=t/8,this.count=0,this.squeezing=!1};Vi.prototype.absorb=function(t){for(let e=0;e<t.length;++e)this.state[~~(this.count/4)]^=t[e]<<8*(this.count%4),this.count+=1,this.count===this.blockSize&&($o.p1600(this.state),this.count=0)};Vi.prototype.absorbLastFewBits=function(t){this.state[~~(this.count/4)]^=t<<8*(this.count%4),t&128&&this.count===this.blockSize-1&&$o.p1600(this.state),this.state[~~((this.blockSize-1)/4)]^=128<<8*((this.blockSize-1)%4),$o.p1600(this.state),this.count=0,this.squeezing=!0};Vi.prototype.squeeze=function(t){this.squeezing||this.absorbLastFewBits(1);const e=Buffer.alloc(t);for(let r=0;r<t;++r)e[r]=this.state[~~(this.count/4)]>>>8*(this.count%4)&255,this.count+=1,this.count===this.blockSize&&($o.p1600(this.state),this.count=0);return e};Vi.prototype.copy=function(t){for(let e=0;e<50;++e)t.state[e]=this.state[e];t.blockSize=this.blockSize,t.count=this.count,t.squeezing=this.squeezing};var P2=Vi,A0=N2(P2),U2=Ee&&Ee.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),L2=Ee&&Ee.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),T0=Ee&&Ee.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&U2(e,t,r);return L2(e,t),e},$2=Ee&&Ee.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Sn,"__esModule",{value:!0});Sn.AddressComputer=Sn.Address=void 0;const bi=T0(KE),M2=$2(da),F2=Jg,Ei=pa,Kc=me,Mn=T0(le),k2=A0,Wc=32,j2="0".repeat(16);class xr{constructor(e,r){if(!e){this.publicKey=Buffer.from([]),this.hrp=r||Ei.LibraryConfig.DefaultAddressHrp;return}if(ArrayBuffer.isView(e)){if(e.length!=Wc)throw new Mn.ErrAddressCannotCreate(e);this.publicKey=Buffer.from(e),this.hrp=r||Ei.LibraryConfig.DefaultAddressHrp;return}if(e instanceof xr){if(r)throw new Mn.ErrInvalidArgument("this variant of the Address constructor does not accept the 'hrp' argument");this.publicKey=e.publicKey,this.hrp=e.hrp;return}if(typeof e=="string"){if(xr.isValidHex(e)){this.publicKey=Buffer.from(e,"hex"),this.hrp=r||Ei.LibraryConfig.DefaultAddressHrp;return}if(r)throw new Mn.ErrInvalidArgument("this variant of the Address constructor does not accept the 'hrp' argument");const{hrp:n,pubkey:i}=Zh({value:e,allowCustomHrp:!1});this.publicKey=i,this.hrp=n;return}throw new Mn.ErrAddressCannotCreate(e)}static newFromBech32(e){const{hrp:r,pubkey:n}=Zh({value:e,allowCustomHrp:!0});return new xr(n,r)}static newFromHex(e,r){if(!xr.isValidHex(e))throw new Mn.ErrAddressCannotCreate(e);return new xr(Buffer.from(e,"hex"),r)}toHex(){return this.isEmpty()?"":this.publicKey.toString("hex")}toBech32(){if(this.isEmpty())return"";let e=bi.toWords(this.getPublicKey());return bi.encode(this.hrp,e)}getPublicKey(){return this.publicKey}getHrp(){return this.hrp}static empty(){return new xr("")}static isValid(e){const r=bi.decodeUnsafe(e),n=r==null?void 0:r.prefix,i=r?Buffer.from(bi.fromWords(r.words)):void 0;return!(n!==Ei.LibraryConfig.DefaultAddressHrp||(i==null?void 0:i.length)!==Wc)}static isValidHex(e){return Buffer.from(e,"hex").length==Wc}isEmpty(){return this.publicKey.length==0}equals(e){return e?this.publicKey.toString()==e.publicKey.toString():!1}toString(){return this.toBech32()}toJSON(){return{bech32:this.toBech32(),pubkey:this.toHex()}}static Zero(){return new xr("0".repeat(64))}isSmartContract(){return this.toHex().startsWith(j2)}}Sn.Address=xr;class q2{constructor(e){this.numberOfShardsWithoutMeta=e||Kc.CURRENT_NUMBER_OF_SHARDS_WITHOUT_META}computeContractAddress(e,r){const n=Buffer.alloc(8,0),i=e.getPublicKey(),s=i.slice(30),o=Buffer.alloc(8),a=new M2.default(r.toString()),c=F2.bigIntToBuffer(a);o.write(c.reverse().toString("hex"),"hex");const u=Buffer.concat([i,o]),l=k2("keccak256").update(u).digest(),f=Buffer.from(Kc.WasmVirtualMachine,"hex"),h=Buffer.concat([n,f,l.slice(10,30),s]);return new xr(h)}getShardOfAddress(e){return this.getShardOfPubkey(e.getPublicKey(),this.numberOfShardsWithoutMeta)}getShardOfPubkey(e,r){const n=parseInt("11",2),i=parseInt("01",2),s=e[31];if(this.isPubkeyOfMetachain(e))return Kc.METACHAIN_ID;let o=s&n;return o>r-1&&(o=s&i),o}isPubkeyOfMetachain(e){const r=Buffer.from([0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),n=Buffer.from(e).slice(0,r.length);return!!(r.equals(n)||Buffer.alloc(32).equals(Buffer.from(e)))}}Sn.AddressComputer=q2;function Zh(t){const e=t.value,r=t.allowCustomHrp;let n,i;try{const s=bi.decode(e);n=s.prefix,i=Buffer.from(bi.fromWords(s.words))}catch(s){throw new Mn.ErrAddressCannotCreate(e,s)}if(!r&&n!=Ei.LibraryConfig.DefaultAddressHrp)throw new Mn.ErrAddressBadHrp(Ei.LibraryConfig.DefaultAddressHrp,n);return{hrp:n,pubkey:i}}Object.defineProperty(Pi,"__esModule",{value:!0});Pi.MessageComputer=Pi.Message=void 0;const z2=Sn,gs=me,V2=A0;class O0{constructor(e){this.data=e.data,this.signature=e.signature,this.address=e.address,this.version=e.version||gs.DEFAULT_MESSAGE_VERSION,this.signer=e.signer||gs.SDK_JS_SIGNER}}Pi.Message=O0;class H2{constructor(){}computeBytesForSigning(e){const r=Buffer.from(e.data.length.toString()),n=Buffer.concat([r,e.data]);let i=Buffer.concat([Buffer.from(gs.MESSAGE_PREFIX),n]);return V2("keccak256").update(i).digest()}computeBytesForVerifying(e){return this.computeBytesForSigning(e)}packMessage(e){return{message:Buffer.from(e.data).toString("hex"),signature:e.signature?Buffer.from(e.signature).toString("hex"):"",address:e.address?e.address.toBech32():"",version:e.version,signer:e.signer}}unpackMessage(e){const r=this.trimHexPrefix(e.message),n=Buffer.from(r,"hex"),i=this.trimHexPrefix(e.signature||""),s=Buffer.from(i,"hex");let o;e.address&&(o=z2.Address.newFromBech32(e.address));const a=e.version||gs.DEFAULT_MESSAGE_VERSION,c=e.signer||gs.UNKNOWN_SIGNER;return new O0({data:n,signature:s,address:o,version:a,signer:c})}trimHexPrefix(e){return e.startsWith("0x")||e.startsWith("0X")?e.slice(2):e}}Pi.MessageComputer=H2;var pe={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Xu=function(t,e){return Xu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},Xu(t,e)};function K2(t,e){Xu(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Zu=function(){return Zu=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Zu.apply(this,arguments)};function W2(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function G2(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s}function Y2(t,e){return function(r,n){e(r,n,t)}}function X2(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Z2(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(f){o(f)}}function c(l){try{u(n.throw(l))}catch(f){o(f)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(t,e||[])).next())})}function J2(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){r.label=u[1];break}if(u[0]===6&&r.label<s[1]){r.label=s[1],s=u;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(u);break}s[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(l){u=[6,l],i=0}finally{n=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Q2(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function e_(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Ju(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function C0(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}function t_(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(C0(arguments[e]));return t}function r_(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)n[i]=s[o];return n}function Ts(t){return this instanceof Ts?(this.v=t,this):new Ts(t)}function n_(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(h){n[h]&&(i[h]=function(p){return new Promise(function(g,w){s.push([h,p,g,w])>1||a(h,p)})})}function a(h,p){try{c(n[h](p))}catch(g){f(s[0][3],g)}}function c(h){h.value instanceof Ts?Promise.resolve(h.value.v).then(u,l):f(s[0][2],h)}function u(h){a("next",h)}function l(h){a("throw",h)}function f(h,p){h(p),s.shift(),s.length&&a(s[0][0],s[0][1])}}function i_(t){var e,r;return e={},n("next"),n("throw",function(i){throw i}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(i,s){e[i]=t[i]?function(o){return(r=!r)?{value:Ts(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function s_(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Ju=="function"?Ju(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function o_(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function a_(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function c_(t){return t&&t.__esModule?t:{default:t}}function u_(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function l_(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const f_=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Zu},__asyncDelegator:i_,__asyncGenerator:n_,__asyncValues:s_,__await:Ts,__awaiter:Z2,__classPrivateFieldGet:u_,__classPrivateFieldSet:l_,__createBinding:Q2,__decorate:G2,__exportStar:e_,__extends:K2,__generator:J2,__importDefault:c_,__importStar:a_,__makeTemplateObject:o_,__metadata:X2,__param:Y2,__read:C0,__rest:W2,__spread:t_,__spreadArrays:r_,__values:Ju},Symbol.toStringTag,{value:"Module"})),js=oa(f_);var Gc={},Yi={},Jh;function h_(){if(Jh)return Yi;Jh=1,Object.defineProperty(Yi,"__esModule",{value:!0}),Yi.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return Yi.delay=t,Yi}var Rn={},Yc={},Nn={},Qh;function d_(){return Qh||(Qh=1,Object.defineProperty(Nn,"__esModule",{value:!0}),Nn.ONE_THOUSAND=Nn.ONE_HUNDRED=void 0,Nn.ONE_HUNDRED=100,Nn.ONE_THOUSAND=1e3),Nn}var Xc={},ed;function p_(){return ed||(ed=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(Xc)),Xc}var td;function D0(){return td||(td=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=js;e.__exportStar(d_(),t),e.__exportStar(p_(),t)}(Yc)),Yc}var rd;function g_(){if(rd)return Rn;rd=1,Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.fromMiliseconds=Rn.toMiliseconds=void 0;const t=D0();function e(n){return n*t.ONE_THOUSAND}Rn.toMiliseconds=e;function r(n){return Math.floor(n/t.ONE_THOUSAND)}return Rn.fromMiliseconds=r,Rn}var nd;function y_(){return nd||(nd=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=js;e.__exportStar(h_(),t),e.__exportStar(g_(),t)}(Gc)),Gc}var li={},id;function w_(){if(id)return li;id=1,Object.defineProperty(li,"__esModule",{value:!0}),li.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const n=this.get(r);if(typeof n.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const i=Date.now()-n.started;this.timestamps.set(r,{started:n.started,elapsed:i})}get(r){const n=this.timestamps.get(r);if(typeof n>"u")throw new Error(`No timestamp found for label: ${r}`);return n}elapsed(r){const n=this.get(r);return n.elapsed||Date.now()-n.started}}return li.Watch=t,li.default=t,li}var Zc={},Xi={},sd;function m_(){if(sd)return Xi;sd=1,Object.defineProperty(Xi,"__esModule",{value:!0}),Xi.IWatch=void 0;class t{}return Xi.IWatch=t,Xi}var od;function b_(){return od||(od=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),js.__exportStar(m_(),t)}(Zc)),Zc}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=js;e.__exportStar(y_(),t),e.__exportStar(w_(),t),e.__exportStar(b_(),t),e.__exportStar(D0(),t)})(pe);class ei{}let E_=class extends ei{constructor(e){super()}};const ad=pe.FIVE_SECONDS,ti={pulse:"heartbeat_pulse"};let v_=class B0 extends E_{constructor(e){super(e),this.events=new zt.EventEmitter,this.interval=ad,this.interval=(e==null?void 0:e.interval)||ad}static async init(e){const r=new B0(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),pe.toMiliseconds(this.interval))}pulse(){this.events.emit(ti.pulse)}};const __=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,x_=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,S_=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function I_(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){A_(t);return}return e}function A_(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function no(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const r=t.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!S_.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(__.test(t)||x_.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,I_)}return JSON.parse(t)}catch(n){if(e.strict)throw n;return t}}function T_(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function nt(t,...e){try{return T_(t(...e))}catch(r){return Promise.reject(r)}}function O_(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function C_(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function Ao(t){if(O_(t))return String(t);if(C_(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return Ao(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Qu="base64:";function D_(t){return typeof t=="string"?t:Qu+N_(t)}function B_(t){return typeof t!="string"||!t.startsWith(Qu)?t:R_(t.slice(Qu.length))}function R_(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function N_(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function Dt(t){var e;return t&&((e=t.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function P_(...t){return Dt(t.join(":"))}function io(t){return t=Dt(t),t?t+":":""}function U_(t,e){if(e===void 0)return!0;let r=0,n=t.indexOf(":");for(;n>-1;)r++,n=t.indexOf(":",n+1);return r<=e}function L_(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const $_="memory",M_=()=>{const t=new Map;return{name:$_,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function F_(t={}){const e={mounts:{"":t.driver||M_()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=u=>{for(const l of e.mountpoints)if(u.startsWith(l))return{base:l,relativeKey:u.slice(l.length),driver:e.mounts[l]};return{base:"",relativeKey:u,driver:e.mounts[""]}},n=(u,l)=>e.mountpoints.filter(f=>f.startsWith(u)||l&&u.startsWith(f)).map(f=>({relativeBase:u.length>f.length?u.slice(f.length):void 0,mountpoint:f,driver:e.mounts[f]})),i=(u,l)=>{if(e.watching){l=Dt(l);for(const f of e.watchListeners)f(u,l)}},s=async()=>{if(!e.watching){e.watching=!0;for(const u in e.mounts)e.unwatch[u]=await cd(e.mounts[u],i,u)}},o=async()=>{if(e.watching){for(const u in e.unwatch)await e.unwatch[u]();e.unwatch={},e.watching=!1}},a=(u,l,f)=>{const h=new Map,p=g=>{let w=h.get(g.base);return w||(w={driver:g.driver,base:g.base,items:[]},h.set(g.base,w)),w};for(const g of u){const w=typeof g=="string",v=Dt(w?g:g.key),E=w?void 0:g.value,I=w||!g.options?l:{...l,...g.options},x=r(v);p(x).items.push({key:v,value:E,relativeKey:x.relativeKey,options:I})}return Promise.all([...h.values()].map(g=>f(g))).then(g=>g.flat())},c={hasItem(u,l={}){u=Dt(u);const{relativeKey:f,driver:h}=r(u);return nt(h.hasItem,f,l)},getItem(u,l={}){u=Dt(u);const{relativeKey:f,driver:h}=r(u);return nt(h.getItem,f,l).then(p=>no(p))},getItems(u,l={}){return a(u,l,f=>f.driver.getItems?nt(f.driver.getItems,f.items.map(h=>({key:h.relativeKey,options:h.options})),l).then(h=>h.map(p=>({key:P_(f.base,p.key),value:no(p.value)}))):Promise.all(f.items.map(h=>nt(f.driver.getItem,h.relativeKey,h.options).then(p=>({key:h.key,value:no(p)})))))},getItemRaw(u,l={}){u=Dt(u);const{relativeKey:f,driver:h}=r(u);return h.getItemRaw?nt(h.getItemRaw,f,l):nt(h.getItem,f,l).then(p=>B_(p))},async setItem(u,l,f={}){if(l===void 0)return c.removeItem(u);u=Dt(u);const{relativeKey:h,driver:p}=r(u);p.setItem&&(await nt(p.setItem,h,Ao(l),f),p.watch||i("update",u))},async setItems(u,l){await a(u,l,async f=>{if(f.driver.setItems)return nt(f.driver.setItems,f.items.map(h=>({key:h.relativeKey,value:Ao(h.value),options:h.options})),l);f.driver.setItem&&await Promise.all(f.items.map(h=>nt(f.driver.setItem,h.relativeKey,Ao(h.value),h.options)))})},async setItemRaw(u,l,f={}){if(l===void 0)return c.removeItem(u,f);u=Dt(u);const{relativeKey:h,driver:p}=r(u);if(p.setItemRaw)await nt(p.setItemRaw,h,l,f);else if(p.setItem)await nt(p.setItem,h,D_(l),f);else return;p.watch||i("update",u)},async removeItem(u,l={}){typeof l=="boolean"&&(l={removeMeta:l}),u=Dt(u);const{relativeKey:f,driver:h}=r(u);h.removeItem&&(await nt(h.removeItem,f,l),(l.removeMeta||l.removeMata)&&await nt(h.removeItem,f+"$",l),h.watch||i("remove",u))},async getMeta(u,l={}){typeof l=="boolean"&&(l={nativeOnly:l}),u=Dt(u);const{relativeKey:f,driver:h}=r(u),p=Object.create(null);if(h.getMeta&&Object.assign(p,await nt(h.getMeta,f,l)),!l.nativeOnly){const g=await nt(h.getItem,f+"$",l).then(w=>no(w));g&&typeof g=="object"&&(typeof g.atime=="string"&&(g.atime=new Date(g.atime)),typeof g.mtime=="string"&&(g.mtime=new Date(g.mtime)),Object.assign(p,g))}return p},setMeta(u,l,f={}){return this.setItem(u+"$",l,f)},removeMeta(u,l={}){return this.removeItem(u+"$",l)},async getKeys(u,l={}){var v;u=io(u);const f=n(u,!0);let h=[];const p=[];let g=!0;for(const E of f){(v=E.driver.flags)!=null&&v.maxDepth||(g=!1);const I=await nt(E.driver.getKeys,E.relativeBase,l);for(const x of I){const A=E.mountpoint+Dt(x);h.some(T=>A.startsWith(T))||p.push(A)}h=[E.mountpoint,...h.filter(x=>!x.startsWith(E.mountpoint))]}const w=l.maxDepth!==void 0&&!g;return p.filter(E=>(!w||U_(E,l.maxDepth))&&L_(E,u))},async clear(u,l={}){u=io(u),await Promise.all(n(u,!1).map(async f=>{if(f.driver.clear)return nt(f.driver.clear,f.relativeBase,l);if(f.driver.removeItem){const h=await f.driver.getKeys(f.relativeBase||"",l);return Promise.all(h.map(p=>f.driver.removeItem(p,l)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(u=>ud(u)))},async watch(u){return await s(),e.watchListeners.push(u),async()=>{e.watchListeners=e.watchListeners.filter(l=>l!==u),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(u,l){if(u=io(u),u&&e.mounts[u])throw new Error(`already mounted at ${u}`);return u&&(e.mountpoints.push(u),e.mountpoints.sort((f,h)=>h.length-f.length)),e.mounts[u]=l,e.watching&&Promise.resolve(cd(l,i,u)).then(f=>{e.unwatch[u]=f}).catch(console.error),c},async unmount(u,l=!0){var f,h;u=io(u),!(!u||!e.mounts[u])&&(e.watching&&u in e.unwatch&&((h=(f=e.unwatch)[u])==null||h.call(f),delete e.unwatch[u]),l&&await ud(e.mounts[u]),e.mountpoints=e.mountpoints.filter(p=>p!==u),delete e.mounts[u])},getMount(u=""){u=Dt(u)+":";const l=r(u);return{driver:l.driver,base:l.base}},getMounts(u="",l={}){return u=Dt(u),n(u,l.parents).map(h=>({driver:h.driver,base:h.mountpoint}))},keys:(u,l={})=>c.getKeys(u,l),get:(u,l={})=>c.getItem(u,l),set:(u,l,f={})=>c.setItem(u,l,f),has:(u,l={})=>c.hasItem(u,l),del:(u,l={})=>c.removeItem(u,l),remove:(u,l={})=>c.removeItem(u,l)};return c}function cd(t,e,r){return t.watch?t.watch((n,i)=>e(n,r+i)):()=>{}}async function ud(t){typeof t.dispose=="function"&&await nt(t.dispose)}function ri(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function R0(t,e){let r;const n=()=>{if(r)return r;const i=indexedDB.open(t);return i.onupgradeneeded=()=>i.result.createObjectStore(e),r=ri(i),r.then(s=>{s.onclose=()=>r=void 0},()=>{}),r};return(i,s)=>n().then(o=>s(o.transaction(e,i).objectStore(e)))}let Jc;function qs(){return Jc||(Jc=R0("keyval-store","keyval")),Jc}function ld(t,e=qs()){return e("readonly",r=>ri(r.get(t)))}function k_(t,e,r=qs()){return r("readwrite",n=>(n.put(e,t),ri(n.transaction)))}function j_(t,e=qs()){return e("readwrite",r=>(r.delete(t),ri(r.transaction)))}function q_(t=qs()){return t("readwrite",e=>(e.clear(),ri(e.transaction)))}function z_(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},ri(t.transaction)}function V_(t=qs()){return t("readonly",e=>{if(e.getAllKeys)return ri(e.getAllKeys());const r=[];return z_(e,n=>r.push(n.key)).then(()=>r)})}const H_=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),K_=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(n,i)=>typeof i=="string"&&i.match(/^\d+n$/)?BigInt(i.substring(0,i.length-1)):i)};function Li(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return K_(t)}catch{return t}}function Yn(t){return typeof t=="string"?t:H_(t)||""}const W_="idb-keyval";var G_=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=i=>e+i;let n;return t.dbName&&t.storeName&&(n=R0(t.dbName,t.storeName)),{name:W_,options:t,async hasItem(i){return!(typeof await ld(r(i),n)>"u")},async getItem(i){return await ld(r(i),n)??null},setItem(i,s){return k_(r(i),s,n)},removeItem(i){return j_(r(i),n)},getKeys(){return V_(n)},clear(){return q_(n)}}};const Y_="WALLET_CONNECT_V2_INDEXED_DB",X_="keyvaluestorage";let Z_=class{constructor(){this.indexedDb=F_({driver:G_({dbName:Y_,storeName:X_})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,Yn(r))}async removeItem(e){await this.indexedDb.removeItem(e)}};var Qc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},To={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,n){this[r]=String(n)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Qc<"u"&&Qc.localStorage?To.exports=Qc.localStorage:typeof window<"u"&&window.localStorage?To.exports=window.localStorage:To.exports=new e})();function J_(t){var e;return[t[0],Li((e=t[1])!=null?e:"")]}let Q_=class{constructor(){this.localStorage=To.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(J_)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return Li(r)}async setItem(e,r){this.localStorage.setItem(e,Yn(r))}async removeItem(e){this.localStorage.removeItem(e)}};const ex="wc_storage_version",fd=1,tx=async(t,e,r)=>{const n=ex,i=await e.getItem(n);if(i&&i>=fd){r(e);return}const s=await t.getKeys();if(!s.length){r(e);return}const o=[];for(;s.length;){const a=s.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const u=await t.getItem(a);await e.setItem(a,u),o.push(a)}}await e.setItem(n,fd),r(e),rx(t,o)},rx=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};let nx=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new Q_;this.storage=e;try{const r=new Z_;tx(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}};var ma={exports:{}};function ix(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var sx=ox;function ox(t,e,r){var n=r&&r.stringify||ix,i=1;if(typeof t=="object"&&t!==null){var s=e.length+i;if(s===1)return t;var o=new Array(s);o[0]=n(t);for(var a=1;a<s;a++)o[a]=n(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var u="",l=1-i,f=-1,h=t&&t.length||0,p=0;p<h;){if(t.charCodeAt(p)===37&&p+1<h){switch(f=f>-1?f:0,t.charCodeAt(p+1)){case 100:case 102:if(l>=c||e[l]==null)break;f<p&&(u+=t.slice(f,p)),u+=Number(e[l]),f=p+2,p++;break;case 105:if(l>=c||e[l]==null)break;f<p&&(u+=t.slice(f,p)),u+=Math.floor(Number(e[l])),f=p+2,p++;break;case 79:case 111:case 106:if(l>=c||e[l]===void 0)break;f<p&&(u+=t.slice(f,p));var g=typeof e[l];if(g==="string"){u+="'"+e[l]+"'",f=p+2,p++;break}if(g==="function"){u+=e[l].name||"<anonymous>",f=p+2,p++;break}u+=n(e[l]),f=p+2,p++;break;case 115:if(l>=c)break;f<p&&(u+=t.slice(f,p)),u+=String(e[l]),f=p+2,p++;break;case 37:f<p&&(u+=t.slice(f,p)),u+="%",f=p+2,p++,l--;break}++l}++p}return f===-1?t:(f<h&&(u+=t.slice(f)),u)}const hd=sx;ma.exports=Yr;const Os=vx().console||{},ax={mapHttpRequest:so,mapHttpResponse:so,wrapRequestSerializer:eu,wrapResponseSerializer:eu,wrapErrorSerializer:eu,req:so,res:so,err:pd,errWithCause:pd};function En(t,e){return t==="silent"?1/0:e.levels.values[t]}const gf=Symbol("pino.logFuncs"),el=Symbol("pino.hierarchy"),cx={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function dd(t,e){const r={logger:e,parent:t[el]};e[el]=r}function ux(t,e,r){const n={};e.forEach(i=>{n[i]=r[i]?r[i]:Os[i]||Os[cx[i]||"log"]||Ii}),t[gf]=n}function lx(t,e){return Array.isArray(t)?t.filter(function(n){return n!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function Yr(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||Os;t.browser.write&&(t.browser.asObject=!0);const n=t.serializers||{},i=lx(t.browser.serialize,n);let s=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(s=!1);const o=Object.keys(t.customLevels||{}),a=["error","fatal","warn","info","debug","trace"].concat(o);typeof r=="function"&&a.forEach(function(w){r[w]=r}),(t.enabled===!1||t.browser.disabled)&&(t.level="silent");const c=t.level||"info",u=Object.create(r);u.log||(u.log=Ii),ux(u,a,r),dd({},u),Object.defineProperty(u,"levelVal",{get:f}),Object.defineProperty(u,"level",{get:h,set:p});const l={transmit:e,serialize:i,asObject:t.browser.asObject,asObjectBindingsOnly:t.browser.asObjectBindingsOnly,formatters:t.browser.formatters,levels:a,timestamp:mx(t),messageKey:t.messageKey||"msg",onChild:t.onChild||Ii};u.levels=fx(t),u.level=c,u.isLevelEnabled=function(w){return this.levels.values[w]?this.levels.values[w]>=this.levels.values[this.level]:!1},u.setMaxListeners=u.getMaxListeners=u.emit=u.addListener=u.on=u.prependListener=u.once=u.prependOnceListener=u.removeListener=u.removeAllListeners=u.listeners=u.listenerCount=u.eventNames=u.write=u.flush=Ii,u.serializers=n,u._serialize=i,u._stdErrSerialize=s,u.child=function(...w){return g.call(this,l,...w)},e&&(u._logEvent=tl());function f(){return En(this.level,this)}function h(){return this._level}function p(w){if(w!=="silent"&&!this.levels.values[w])throw Error("unknown level "+w);this._level=w,Pn(this,l,u,"error"),Pn(this,l,u,"fatal"),Pn(this,l,u,"warn"),Pn(this,l,u,"info"),Pn(this,l,u,"debug"),Pn(this,l,u,"trace"),o.forEach(v=>{Pn(this,l,u,v)})}function g(w,v,E){if(!v)throw new Error("missing bindings for child Pino");E=E||{},i&&v.serializers&&(E.serializers=v.serializers);const I=E.serializers;if(i&&I){var x=Object.assign({},n,I),A=t.browser.serialize===!0?Object.keys(x):i;delete v.serializers,yf([v],A,x,this._stdErrSerialize)}function T(P){this._childLevel=(P._childLevel|0)+1,this.bindings=v,x&&(this.serializers=x,this._serialize=A),e&&(this._logEvent=tl([].concat(P._logEvent.bindings,v)))}T.prototype=this;const O=new T(this);return dd(this,O),O.child=function(...P){return g.call(this,w,...P)},O.level=E.level||this.level,w.onChild(O),O}return u}function fx(t){const e=t.customLevels||{},r=Object.assign({},Yr.levels.values,e),n=Object.assign({},Yr.levels.labels,hx(e));return{values:r,labels:n}}function hx(t){const e={};return Object.keys(t).forEach(function(r){e[t[r]]=r}),e}Yr.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};Yr.stdSerializers=ax;Yr.stdTimeFunctions=Object.assign({},{nullTime:N0,epochTime:P0,unixTime:bx,isoTime:Ex});function dx(t){const e=[];t.bindings&&e.push(t.bindings);let r=t[el];for(;r.parent;)r=r.parent,r.logger.bindings&&e.push(r.logger.bindings);return e.reverse()}function Pn(t,e,r,n){if(Object.defineProperty(t,n,{value:En(t.level,r)>En(n,r)?Ii:r[gf][n],writable:!0,enumerable:!0,configurable:!0}),t[n]===Ii){if(!e.transmit)return;const s=e.transmit.level||t.level,o=En(s,r);if(En(n,r)<o)return}t[n]=gx(t,e,r,n);const i=dx(t);i.length!==0&&(t[n]=px(i,t[n]))}function px(t,e){return function(){return e.apply(this,[...t,...arguments])}}function gx(t,e,r,n){return function(i){return function(){const o=e.timestamp(),a=new Array(arguments.length),c=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Os?Os:this;for(var u=0;u<a.length;u++)a[u]=arguments[u];var l=!1;if(e.serialize&&(yf(a,this._serialize,this.serializers,this._stdErrSerialize),l=!0),e.asObject||e.formatters?i.call(c,...yx(this,n,a,o,e)):i.apply(c,a),e.transmit){const f=e.transmit.level||t._level,h=En(f,r),p=En(n,r);if(p<h)return;wx(this,{ts:o,methodLevel:n,methodValue:p,transmitValue:r.levels.values[e.transmit.level||t._level],send:e.transmit.send,val:En(t._level,r)},a,l)}}}(t[gf][n])}function yx(t,e,r,n,i){const{level:s,log:o=f=>f}=i.formatters||{},a=r.slice();let c=a[0];const u={};let l=(t._childLevel|0)+1;if(l<1&&(l=1),n&&(u.time=n),s){const f=s(e,t.levels.values[e]);Object.assign(u,f)}else u.level=t.levels.values[e];if(i.asObjectBindingsOnly){if(c!==null&&typeof c=="object")for(;l--&&typeof a[0]=="object";)Object.assign(u,a.shift());return[o(u),...a]}else{if(c!==null&&typeof c=="object"){for(;l--&&typeof a[0]=="object";)Object.assign(u,a.shift());c=a.length?hd(a.shift(),a):void 0}else typeof c=="string"&&(c=hd(a.shift(),a));return c!==void 0&&(u[i.messageKey]=c),[o(u)]}}function yf(t,e,r,n){for(const i in t)if(n&&t[i]instanceof Error)t[i]=Yr.stdSerializers.err(t[i]);else if(typeof t[i]=="object"&&!Array.isArray(t[i])&&e)for(const s in t[i])e.indexOf(s)>-1&&s in r&&(t[i][s]=r[s](t[i][s]))}function wx(t,e,r,n=!1){const i=e.send,s=e.ts,o=e.methodLevel,a=e.methodValue,c=e.val,u=t._logEvent.bindings;n||yf(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=s,t._logEvent.messages=r.filter(function(l){return u.indexOf(l)===-1}),t._logEvent.level.label=o,t._logEvent.level.value=a,i(o,t._logEvent,c),t._logEvent=tl(u)}function tl(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function pd(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function mx(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?N0:P0}function so(){return{}}function eu(t){return t}function Ii(){}function N0(){return!1}function P0(){return Date.now()}function bx(){return Math.round(Date.now()/1e3)}function Ex(){return new Date(Date.now()).toISOString()}function vx(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}ma.exports.default=Yr;ma.exports.pino=Yr;var wi=ma.exports;const U0=of(wi),_x={level:"info"},ba="custom_context",wf=1e3*1024;var xx=Object.defineProperty,Sx=(t,e,r)=>e in t?xx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,wn=(t,e,r)=>Sx(t,typeof e!="symbol"?e+"":e,r);let Ix=class{constructor(e){wn(this,"nodeValue"),wn(this,"sizeInBytes"),wn(this,"next"),this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},gd=class{constructor(e){wn(this,"lengthInNodes"),wn(this,"sizeInBytes"),wn(this,"head"),wn(this,"tail"),wn(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new Ix(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}};var Ax=Object.defineProperty,Tx=(t,e,r)=>e in t?Ax(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,oo=(t,e,r)=>Tx(t,typeof e!="symbol"?e+"":e,r);class L0{constructor(e,r=wf){oo(this,"logs"),oo(this,"level"),oo(this,"levelValue"),oo(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=e??"error",this.levelValue=wi.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new gd(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===wi.levels.values.error?console.error(e):r===wi.levels.values.warn?console.warn(e):r===wi.levels.values.debug?console.debug(e):r===wi.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(Yn({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new gd(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(Yn({extraMetadata:e})),new Blob(r,{type:"application/json"})}}var Ox=Object.defineProperty,Cx=(t,e,r)=>e in t?Ox(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Dx=(t,e,r)=>Cx(t,e+"",r);class Bx{constructor(e,r=wf){Dx(this,"baseChunkLogger"),this.baseChunkLogger=new L0(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),n=document.createElement("a");n.href=r,n.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}}var Rx=Object.defineProperty,Nx=(t,e,r)=>e in t?Rx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Px=(t,e,r)=>Nx(t,e+"",r);let Ux=class{constructor(e,r=wf){Px(this,"baseChunkLogger"),this.baseChunkLogger=new L0(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var Lx=Object.defineProperty,$x=Object.defineProperties,Mx=Object.getOwnPropertyDescriptors,yd=Object.getOwnPropertySymbols,Fx=Object.prototype.hasOwnProperty,kx=Object.prototype.propertyIsEnumerable,wd=(t,e,r)=>e in t?Lx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Mo=(t,e)=>{for(var r in e||(e={}))Fx.call(e,r)&&wd(t,r,e[r]);if(yd)for(var r of yd(e))kx.call(e,r)&&wd(t,r,e[r]);return t},Fo=(t,e)=>$x(t,Mx(e));function jx(t){return Fo(Mo({},t),{level:(t==null?void 0:t.level)||_x.level})}function qx(t,e,r=ba){return t[r]=e,t}function Lt(t,e=ba){return t[e]||""}function zx(t,e,r=ba){const n=Lt(t,r);return n.trim()?`${n}/${e}`:e}function Vt(t,e,r=ba){const n=zx(t,e,r),i=t.child({context:n});return qx(i,n,r)}function Vx(t){var e,r;const n=new Bx((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:U0(Fo(Mo({},t.opts),{level:"trace",browser:Fo(Mo({},(r=t.opts)==null?void 0:r.browser),{write:i=>n.write(i)})})),chunkLoggerController:n}}function Hx(t){var e;const r=new Ux((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:U0(Fo(Mo({},t.opts),{level:"trace"}),r),chunkLoggerController:r}}function $0(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?Vx(t):Hx(t)}var Kx=Object.defineProperty,Wx=(t,e,r)=>e in t?Kx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,md=(t,e,r)=>Wx(t,typeof e!="symbol"?e+"":e,r);let Gx=class extends ei{constructor(e){super(),this.opts=e,md(this,"protocol","wc"),md(this,"version",2)}};var Yx=Object.defineProperty,Xx=(t,e,r)=>e in t?Yx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Zx=(t,e,r)=>Xx(t,e+"",r);class Jx extends ei{constructor(e,r){super(),this.core=e,this.logger=r,Zx(this,"records",new Map)}}class Qx{constructor(e,r){this.logger=e,this.core=r}}let eS=class extends ei{constructor(e,r){super(),this.relayer=e,this.logger=r}},tS=class extends ei{constructor(e){super()}},rS=class{constructor(e,r,n,i){this.core=e,this.logger=r,this.name=n}},nS=class extends ei{constructor(e,r){super(),this.relayer=e,this.logger=r}},iS=class extends ei{constructor(e,r){super(),this.core=e,this.logger=r}},sS=class{constructor(e,r,n){this.core=e,this.logger=r,this.store=n}},oS=class{constructor(e,r){this.projectId=e,this.logger=r}},aS=class{constructor(e,r,n){this.core=e,this.logger=r,this.telemetryEnabled=n}};var cS=Object.defineProperty,uS=(t,e,r)=>e in t?cS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,bd=(t,e,r)=>uS(t,typeof e!="symbol"?e+"":e,r);let lS=class{constructor(e){this.opts=e,bd(this,"protocol","wc"),bd(this,"version",2)}},fS=class{constructor(e){this.client=e}};function hS(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function M0(t,...e){if(!hS(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Ed(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function dS(t,e){M0(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const fi=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const tu=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function pS(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function F0(t){return typeof t=="string"&&(t=pS(t)),M0(t),t}let gS=class{clone(){return this._cloneInto()}};function yS(t){const e=n=>t().update(F0(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function k0(t=32){if(fi&&typeof fi.getRandomValues=="function")return fi.getRandomValues(new Uint8Array(t));if(fi&&typeof fi.randomBytes=="function")return fi.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function wS(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}let mS=class extends gS{constructor(e,r,n,i){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=tu(this.buffer)}update(e){Ed(this);const{view:r,buffer:n,blockLen:i}=this;e=F0(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=tu(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ed(this),dS(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let f=o;f<i;f++)r[f]=0;wS(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=tu(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<u;f++)a.setUint32(4*f,l[f],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%r&&e.buffer.set(n),e}};const ao=BigInt(2**32-1),rl=BigInt(32);function j0(t,e=!1){return e?{h:Number(t&ao),l:Number(t>>rl&ao)}:{h:Number(t>>rl&ao)|0,l:Number(t&ao)|0}}function bS(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:s,l:o}=j0(t[i],e);[r[i],n[i]]=[s,o]}return[r,n]}const ES=(t,e)=>BigInt(t>>>0)<<rl|BigInt(e>>>0),vS=(t,e,r)=>t>>>r,_S=(t,e,r)=>t<<32-r|e>>>r,xS=(t,e,r)=>t>>>r|e<<32-r,SS=(t,e,r)=>t<<32-r|e>>>r,IS=(t,e,r)=>t<<64-r|e>>>r-32,AS=(t,e,r)=>t>>>r-32|e<<64-r,TS=(t,e)=>e,OS=(t,e)=>t,CS=(t,e,r)=>t<<r|e>>>32-r,DS=(t,e,r)=>e<<r|t>>>32-r,BS=(t,e,r)=>e<<r-32|t>>>64-r,RS=(t,e,r)=>t<<r-32|e>>>64-r;function NS(t,e,r,n){const i=(e>>>0)+(n>>>0);return{h:t+r+(i/2**32|0)|0,l:i|0}}const PS=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),US=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,LS=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),$S=(t,e,r,n,i)=>e+r+n+i+(t/2**32|0)|0,MS=(t,e,r,n,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(i>>>0),FS=(t,e,r,n,i,s)=>e+r+n+i+s+(t/2**32|0)|0,Te={fromBig:j0,split:bS,toBig:ES,shrSH:vS,shrSL:_S,rotrSH:xS,rotrSL:SS,rotrBH:IS,rotrBL:AS,rotr32H:TS,rotr32L:OS,rotlSH:CS,rotlSL:DS,rotlBH:BS,rotlBL:RS,add:NS,add3L:PS,add3H:US,add4L:LS,add4H:$S,add5H:FS,add5L:MS},[kS,jS]=Te.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),Qr=new Uint32Array(80),en=new Uint32Array(80);let qS=class extends mS{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:f,Fl:h,Gh:p,Gl:g,Hh:w,Hl:v}=this;return[e,r,n,i,s,o,a,c,u,l,f,h,p,g,w,v]}set(e,r,n,i,s,o,a,c,u,l,f,h,p,g,w,v){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=f|0,this.Fl=h|0,this.Gh=p|0,this.Gl=g|0,this.Hh=w|0,this.Hl=v|0}process(e,r){for(let x=0;x<16;x++,r+=4)Qr[x]=e.getUint32(r),en[x]=e.getUint32(r+=4);for(let x=16;x<80;x++){const A=Qr[x-15]|0,T=en[x-15]|0,O=Te.rotrSH(A,T,1)^Te.rotrSH(A,T,8)^Te.shrSH(A,T,7),P=Te.rotrSL(A,T,1)^Te.rotrSL(A,T,8)^Te.shrSL(A,T,7),M=Qr[x-2]|0,U=en[x-2]|0,G=Te.rotrSH(M,U,19)^Te.rotrBH(M,U,61)^Te.shrSH(M,U,6),se=Te.rotrSL(M,U,19)^Te.rotrBL(M,U,61)^Te.shrSL(M,U,6),Z=Te.add4L(P,se,en[x-7],en[x-16]),L=Te.add4H(Z,O,G,Qr[x-7],Qr[x-16]);Qr[x]=L|0,en[x]=Z|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:f,El:h,Fh:p,Fl:g,Gh:w,Gl:v,Hh:E,Hl:I}=this;for(let x=0;x<80;x++){const A=Te.rotrSH(f,h,14)^Te.rotrSH(f,h,18)^Te.rotrBH(f,h,41),T=Te.rotrSL(f,h,14)^Te.rotrSL(f,h,18)^Te.rotrBL(f,h,41),O=f&p^~f&w,P=h&g^~h&v,M=Te.add5L(I,T,P,jS[x],en[x]),U=Te.add5H(M,E,A,O,kS[x],Qr[x]),G=M|0,se=Te.rotrSH(n,i,28)^Te.rotrBH(n,i,34)^Te.rotrBH(n,i,39),Z=Te.rotrSL(n,i,28)^Te.rotrBL(n,i,34)^Te.rotrBL(n,i,39),L=n&s^n&a^s&a,K=i&o^i&c^o&c;E=w|0,I=v|0,w=p|0,v=g|0,p=f|0,g=h|0,{h:f,l:h}=Te.add(u|0,l|0,U|0,G|0),u=a|0,l=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const D=Te.add3L(G,Z,K);n=Te.add3H(D,U,se,L),i=D|0}({h:n,l:i}=Te.add(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=Te.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Te.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=Te.add(this.Dh|0,this.Dl|0,u|0,l|0),{h:f,l:h}=Te.add(this.Eh|0,this.El|0,f|0,h|0),{h:p,l:g}=Te.add(this.Fh|0,this.Fl|0,p|0,g|0),{h:w,l:v}=Te.add(this.Gh|0,this.Gl|0,w|0,v|0),{h:E,l:I}=Te.add(this.Hh|0,this.Hl|0,E|0,I|0),this.set(n,i,s,o,a,c,u,l,f,h,p,g,w,v,E,I)}roundClean(){Qr.fill(0),en.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const zS=yS(()=>new qS);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const mf=BigInt(0),q0=BigInt(1),VS=BigInt(2);function bf(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ef(t){if(!bf(t))throw new Error("Uint8Array expected")}function ru(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const HS=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function vf(t){Ef(t);let e="";for(let r=0;r<t.length;r++)e+=HS[t[r]];return e}function z0(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?mf:BigInt("0x"+t)}const Cr={_0:48,_9:57,A:65,F:70,a:97,f:102};function vd(t){if(t>=Cr._0&&t<=Cr._9)return t-Cr._0;if(t>=Cr.A&&t<=Cr.F)return t-(Cr.A-10);if(t>=Cr.a&&t<=Cr.f)return t-(Cr.a-10)}function V0(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=vd(t.charCodeAt(s)),a=vd(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function KS(t){return z0(vf(t))}function Oo(t){return Ef(t),z0(vf(Uint8Array.from(t).reverse()))}function H0(t,e){return V0(t.toString(16).padStart(e*2,"0"))}function nl(t,e){return H0(t,e).reverse()}function Dr(t,e,r){let n;if(typeof e=="string")try{n=V0(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(bf(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}function _d(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Ef(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}const nu=t=>typeof t=="bigint"&&mf<=t;function WS(t,e,r){return nu(t)&&nu(e)&&nu(r)&&e<=t&&t<r}function Zi(t,e,r,n){if(!WS(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function GS(t){let e;for(e=0;t>mf;t>>=q0,e+=1);return e}const YS=t=>(VS<<BigInt(t-1))-q0,XS={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||bf(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function _f(t,e,r={}){const n=(i,s,o)=>{const a=XS[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(r))n(i,s,!0);return t}function xd(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}const ot=BigInt(0),We=BigInt(1),Fn=BigInt(2),ZS=BigInt(3),il=BigInt(4),Sd=BigInt(5),Id=BigInt(8);function et(t,e){const r=t%e;return r>=ot?r:e+r}function JS(t,e,r){if(e<ot)throw new Error("invalid exponent, negatives unsupported");if(r<=ot)throw new Error("invalid modulus");if(r===We)return ot;let n=We;for(;e>ot;)e&We&&(n=n*t%r),t=t*t%r,e>>=We;return n}function pr(t,e,r){let n=t;for(;e-- >ot;)n*=n,n%=r;return n}function Ad(t,e){if(t===ot)throw new Error("invert: expected non-zero number");if(e<=ot)throw new Error("invert: expected positive modulus, got "+e);let r=et(t,e),n=e,i=ot,s=We;for(;r!==ot;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==We)throw new Error("invert: does not exist");return et(i,e)}function QS(t){const e=(t-We)/Fn;let r,n,i;for(r=t-We,n=0;r%Fn===ot;r/=Fn,n++);for(i=Fn;i<t&&JS(i,e,t)!==t-We;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(t+We)/il;return function(a,c){const u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(r+We)/Fn;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=n,u=o.pow(o.mul(o.ONE,i),r),l=o.pow(a,s),f=o.pow(a,r);for(;!o.eql(f,o.ONE);){if(o.eql(f,o.ZERO))return o.ZERO;let h=1;for(let g=o.sqr(f);h<c&&!o.eql(g,o.ONE);h++)g=o.sqr(g);const p=o.pow(u,We<<BigInt(c-h-1));u=o.sqr(p),l=o.mul(l,p),f=o.mul(f,u),c=h}return l}}function eI(t){if(t%il===ZS){const e=(t+We)/il;return function(r,n){const i=r.pow(n,e);if(!r.eql(r.sqr(i),n))throw new Error("Cannot find square root");return i}}if(t%Id===Sd){const e=(t-Sd)/Id;return function(r,n){const i=r.mul(n,Fn),s=r.pow(i,e),o=r.mul(n,s),a=r.mul(r.mul(o,Fn),s),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),n))throw new Error("Cannot find square root");return c}}return QS(t)}const tI=(t,e)=>(et(t,e)&We)===We,rI=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function nI(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=rI.reduce((n,i)=>(n[i]="function",n),e);return _f(t,r)}function iI(t,e,r){if(r<ot)throw new Error("invalid exponent, negatives unsupported");if(r===ot)return t.ONE;if(r===We)return e;let n=t.ONE,i=e;for(;r>ot;)r&We&&(n=t.mul(n,i)),i=t.sqr(i),r>>=We;return n}function sI(t,e){const r=new Array(e.length),n=e.reduce((s,o,a)=>t.is0(o)?s:(r[a]=s,t.mul(s,o)),t.ONE),i=t.inv(n);return e.reduceRight((s,o,a)=>t.is0(o)?s:(r[a]=t.mul(s,r[a]),t.mul(s,o)),i),r}function K0(t,e){const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function W0(t,e,r=!1,n={}){if(t<=ot)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=K0(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:i,BYTES:s,MASK:YS(i),ZERO:ot,ONE:We,create:c=>et(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return ot<=c&&c<t},is0:c=>c===ot,isOdd:c=>(c&We)===We,neg:c=>et(-c,t),eql:(c,u)=>c===u,sqr:c=>et(c*c,t),add:(c,u)=>et(c+u,t),sub:(c,u)=>et(c-u,t),mul:(c,u)=>et(c*u,t),pow:(c,u)=>iI(a,c,u),div:(c,u)=>et(c*Ad(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Ad(c,t),sqrt:n.sqrt||(c=>(o||(o=eI(t)),o(a,c))),invertBatch:c=>sI(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>r?nl(c,s):H0(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?Oo(c):KS(c)}});return Object.freeze(a)}const Td=BigInt(0),co=BigInt(1);function iu(t,e){const r=e.negate();return t?r:e}function G0(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function su(t,e){G0(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1);return{windows:r,windowSize:n}}function oI(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function aI(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const ou=new WeakMap,Y0=new WeakMap;function au(t){return Y0.get(t)||1}function cI(t,e){return{constTimeNegate:iu,hasPrecomputes(r){return au(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>Td;)n&co&&(i=i.add(s)),s=s.double(),n>>=co;return i},precomputeWindow(r,n){const{windows:i,windowSize:s}=su(n,e),o=[];let a=r,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,i){const{windows:s,windowSize:o}=su(r,e);let a=t.ZERO,c=t.BASE;const u=BigInt(2**r-1),l=2**r,f=BigInt(r);for(let h=0;h<s;h++){const p=h*o;let g=Number(i&u);i>>=f,g>o&&(g-=l,i+=co);const w=p,v=p+Math.abs(g)-1,E=h%2!==0,I=g<0;g===0?c=c.add(iu(E,n[w])):a=a.add(iu(I,n[v]))}return{p:a,f:c}},wNAFUnsafe(r,n,i,s=t.ZERO){const{windows:o,windowSize:a}=su(r,e),c=BigInt(2**r-1),u=2**r,l=BigInt(r);for(let f=0;f<o;f++){const h=f*a;if(i===Td)break;let p=Number(i&c);if(i>>=l,p>a&&(p-=u,i+=co),p===0)continue;let g=n[h+Math.abs(p)-1];p<0&&(g=g.negate()),s=s.add(g)}return s},getPrecomputes(r,n,i){let s=ou.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&ou.set(n,i(s))),s},wNAFCached(r,n,i){const s=au(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){const o=au(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){G0(n,e),Y0.set(r,n),ou.delete(r)}}}function uI(t,e,r,n){if(oI(r,t),aI(n,e),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,s=GS(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),u=Math.floor((e.BITS-1)/o)*o;let l=i;for(let f=u;f>=0;f-=o){c.fill(i);for(let p=0;p<n.length;p++){const g=n[p],w=Number(g>>BigInt(f)&BigInt(a));c[w]=c[w].add(r[p])}let h=i;for(let p=c.length-1,g=i;p>0;p--)g=g.add(c[p]),h=h.add(g);if(l=l.add(h),f!==0)for(let p=0;p<o;p++)l=l.double()}return l}function lI(t){return nI(t.Fp),_f(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...K0(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const nr=BigInt(0),Ot=BigInt(1),uo=BigInt(2),fI=BigInt(8),hI={zip215:!0};function dI(t){const e=lI(t);return _f(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function pI(t){const e=dI(t),{Fp:r,n,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=e,u=uo<<BigInt(a*8)-Ot,l=r.create,f=W0(e.n,e.nBitLength),h=e.uvRatio||((D,C)=>{try{return{isValid:!0,value:r.sqrt(D*r.inv(C))}}catch{return{isValid:!1,value:nr}}}),p=e.adjustScalarBytes||(D=>D),g=e.domain||((D,C,F)=>{if(ru("phflag",F),C.length||F)throw new Error("Contexts/pre-hash are not supported");return D});function w(D,C){Zi("coordinate "+D,C,nr,u)}function v(D){if(!(D instanceof x))throw new Error("ExtendedPoint expected")}const E=xd((D,C)=>{const{ex:F,ey:Y,ez:k}=D,W=D.is0();C==null&&(C=W?fI:r.inv(k));const te=l(F*C),ie=l(Y*C),he=l(k*C);if(W)return{x:nr,y:Ot};if(he!==Ot)throw new Error("invZ was invalid");return{x:te,y:ie}}),I=xd(D=>{const{a:C,d:F}=e;if(D.is0())throw new Error("bad point: ZERO");const{ex:Y,ey:k,ez:W,et:te}=D,ie=l(Y*Y),he=l(k*k),J=l(W*W),fe=l(J*J),q=l(ie*C),j=l(J*l(q+he)),ne=l(fe+l(F*l(ie*he)));if(j!==ne)throw new Error("bad point: equation left != right (1)");const ae=l(Y*k),S=l(W*te);if(ae!==S)throw new Error("bad point: equation left != right (2)");return!0});class x{constructor(C,F,Y,k){this.ex=C,this.ey=F,this.ez=Y,this.et=k,w("x",C),w("y",F),w("z",Y),w("t",k),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(C){if(C instanceof x)throw new Error("extended point not allowed");const{x:F,y:Y}=C||{};return w("x",F),w("y",Y),new x(F,Y,Ot,l(F*Y))}static normalizeZ(C){const F=r.invertBatch(C.map(Y=>Y.ez));return C.map((Y,k)=>Y.toAffine(F[k])).map(x.fromAffine)}static msm(C,F){return uI(x,f,C,F)}_setWindowSize(C){O.setWindowSize(this,C)}assertValidity(){I(this)}equals(C){v(C);const{ex:F,ey:Y,ez:k}=this,{ex:W,ey:te,ez:ie}=C,he=l(F*ie),J=l(W*k),fe=l(Y*ie),q=l(te*k);return he===J&&fe===q}is0(){return this.equals(x.ZERO)}negate(){return new x(l(-this.ex),this.ey,this.ez,l(-this.et))}double(){const{a:C}=e,{ex:F,ey:Y,ez:k}=this,W=l(F*F),te=l(Y*Y),ie=l(uo*l(k*k)),he=l(C*W),J=F+Y,fe=l(l(J*J)-W-te),q=he+te,j=q-ie,ne=he-te,ae=l(fe*j),S=l(q*ne),m=l(fe*ne),b=l(j*q);return new x(ae,S,b,m)}add(C){v(C);const{a:F,d:Y}=e,{ex:k,ey:W,ez:te,et:ie}=this,{ex:he,ey:J,ez:fe,et:q}=C;if(F===BigInt(-1)){const ee=l((W-k)*(J+he)),Q=l((W+k)*(J-he)),ce=l(Q-ee);if(ce===nr)return this.double();const ge=l(te*uo*q),we=l(ie*uo*fe),xe=we+ge,Ae=Q+ee,Be=we-ge,_=l(xe*ce),d=l(Ae*Be),y=l(xe*Be),B=l(ce*Ae);return new x(_,d,B,y)}const j=l(k*he),ne=l(W*J),ae=l(ie*Y*q),S=l(te*fe),m=l((k+W)*(he+J)-j-ne),b=S-ae,R=S+ae,N=l(ne-F*j),z=l(m*b),H=l(R*N),$=l(m*N),X=l(b*R);return new x(z,H,X,$)}subtract(C){return this.add(C.negate())}wNAF(C){return O.wNAFCached(this,C,x.normalizeZ)}multiply(C){const F=C;Zi("scalar",F,Ot,n);const{p:Y,f:k}=this.wNAF(F);return x.normalizeZ([Y,k])[0]}multiplyUnsafe(C,F=x.ZERO){const Y=C;return Zi("scalar",Y,nr,n),Y===nr?T:this.is0()||Y===Ot?this:O.wNAFCachedUnsafe(this,Y,x.normalizeZ,F)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return O.unsafeLadder(this,n).is0()}toAffine(C){return E(this,C)}clearCofactor(){const{h:C}=e;return C===Ot?this:this.multiplyUnsafe(C)}static fromHex(C,F=!1){const{d:Y,a:k}=e,W=r.BYTES;C=Dr("pointHex",C,W),ru("zip215",F);const te=C.slice(),ie=C[W-1];te[W-1]=ie&-129;const he=Oo(te),J=F?u:r.ORDER;Zi("pointHex.y",he,nr,J);const fe=l(he*he),q=l(fe-Ot),j=l(Y*fe-k);let{isValid:ne,value:ae}=h(q,j);if(!ne)throw new Error("Point.fromHex: invalid y coordinate");const S=(ae&Ot)===Ot,m=(ie&128)!==0;if(!F&&ae===nr&&m)throw new Error("Point.fromHex: x=0 and x_0=1");return m!==S&&(ae=l(-ae)),x.fromAffine({x:ae,y:he})}static fromPrivateKey(C){return U(C).point}toRawBytes(){const{x:C,y:F}=this.toAffine(),Y=nl(F,r.BYTES);return Y[Y.length-1]|=C&Ot?128:0,Y}toHex(){return vf(this.toRawBytes())}}x.BASE=new x(e.Gx,e.Gy,Ot,l(e.Gx*e.Gy)),x.ZERO=new x(nr,Ot,Ot,nr);const{BASE:A,ZERO:T}=x,O=cI(x,a*8);function P(D){return et(D,n)}function M(D){return P(Oo(D))}function U(D){const C=r.BYTES;D=Dr("private key",D,C);const F=Dr("hashed private key",s(D),2*C),Y=p(F.slice(0,C)),k=F.slice(C,2*C),W=M(Y),te=A.multiply(W),ie=te.toRawBytes();return{head:Y,prefix:k,scalar:W,point:te,pointBytes:ie}}function G(D){return U(D).pointBytes}function se(D=new Uint8Array,...C){const F=_d(...C);return M(s(g(F,Dr("context",D),!!i)))}function Z(D,C,F={}){D=Dr("message",D),i&&(D=i(D));const{prefix:Y,scalar:k,pointBytes:W}=U(C),te=se(F.context,Y,D),ie=A.multiply(te).toRawBytes(),he=se(F.context,ie,W,D),J=P(te+he*k);Zi("signature.s",J,nr,n);const fe=_d(ie,nl(J,r.BYTES));return Dr("result",fe,r.BYTES*2)}const L=hI;function K(D,C,F,Y=L){const{context:k,zip215:W}=Y,te=r.BYTES;D=Dr("signature",D,2*te),C=Dr("message",C),F=Dr("publicKey",F,te),W!==void 0&&ru("zip215",W),i&&(C=i(C));const ie=Oo(D.slice(te,2*te));let he,J,fe;try{he=x.fromHex(F,W),J=x.fromHex(D.slice(0,te),W),fe=A.multiplyUnsafe(ie)}catch{return!1}if(!W&&he.isSmallOrder())return!1;const q=se(k,J.toRawBytes(),he.toRawBytes(),C);return J.add(he.multiplyUnsafe(q)).subtract(fe).clearCofactor().equals(x.ZERO)}return A._setWindowSize(8),{CURVE:e,getPublicKey:G,sign:Z,verify:K,ExtendedPoint:x,utils:{getExtendedPublicKey:U,randomPrivateKey:()=>o(r.BYTES),precompute(D=8,C=x.BASE){return C._setWindowSize(D),C.multiply(BigInt(3)),C}}}}BigInt(0),BigInt(1);const xf=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Od=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const gI=BigInt(1),Cd=BigInt(2);BigInt(3);const yI=BigInt(5),wI=BigInt(8);function mI(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=xf,o=t*t%s*t%s,a=pr(o,Cd,s)*o%s,c=pr(a,gI,s)*t%s,u=pr(c,yI,s)*c%s,l=pr(u,e,s)*u%s,f=pr(l,r,s)*l%s,h=pr(f,n,s)*f%s,p=pr(h,i,s)*h%s,g=pr(p,i,s)*h%s,w=pr(g,e,s)*u%s;return{pow_p_5_8:pr(w,Cd,s)*t%s,b2:o}}function bI(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function EI(t,e){const r=xf,n=et(e*e*e,r),i=et(n*n*e,r),s=mI(t*i).pow_p_5_8;let o=et(t*n*s,r);const a=et(e*o*o,r),c=o,u=et(o*Od,r),l=a===t,f=a===et(-t,r),h=a===et(-t*Od,r);return l&&(o=c),(f||h)&&(o=u),tI(o,r)&&(o=et(-o,r)),{isValid:l||f,value:o}}const vI=W0(xf,void 0,!0),_I={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:vI,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:wI,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:zS,randomBytes:k0,adjustScalarBytes:bI,uvRatio:EI},X0=pI(_I),xI="EdDSA",SI="JWT",ko=".",Ea="base64url",Z0="utf8",J0="utf8",II=":",AI="did",TI="key",Dd="base58btc",OI="z",CI="K36",DI=32;function Sf(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Q0(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Sf(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function ey(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const r=Q0(e);let n=0;for(const i of t)r.set(i,n),n+=i.length;return Sf(r)}function BI(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function f(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var w=0,v=0,E=0,I=g.length;E!==I&&g[E]===0;)E++,w++;for(var x=(I-E)*l+1>>>0,A=new Uint8Array(x);E!==I;){for(var T=g[E],O=0,P=x-1;(T!==0||O<v)&&P!==-1;P--,O++)T+=256*A[P]>>>0,A[P]=T%a>>>0,T=T/a>>>0;if(T!==0)throw new Error("Non-zero carry");v=O,E++}for(var M=x-v;M!==x&&A[M]===0;)M++;for(var U=c.repeat(w);M<x;++M)U+=t.charAt(A[M]);return U}function h(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var w=0;if(g[w]!==" "){for(var v=0,E=0;g[w]===c;)v++,w++;for(var I=(g.length-w)*u+1>>>0,x=new Uint8Array(I);g[w];){var A=r[g.charCodeAt(w)];if(A===255)return;for(var T=0,O=I-1;(A!==0||T<E)&&O!==-1;O--,T++)A+=a*x[O]>>>0,x[O]=A%256>>>0,A=A/256>>>0;if(A!==0)throw new Error("Non-zero carry");E=T,w++}if(g[w]!==" "){for(var P=I-E;P!==I&&x[P]===0;)P++;for(var M=new Uint8Array(v+(I-P)),U=v;P!==I;)M[U++]=x[P++];return M}}}function p(g){var w=h(g);if(w)return w;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:h,decode:p}}var RI=BI,NI=RI;const ty=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},PI=t=>new TextEncoder().encode(t),UI=t=>new TextDecoder().decode(t);let LI=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},$I=class{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ry(this,e)}},MI=class{constructor(e){this.decoders=e}or(e){return ry(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const ry=(t,e)=>new MI({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let FI=class{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new LI(e,r,n),this.decoder=new $I(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const va=({name:t,prefix:e,encode:r,decode:n})=>new FI(t,e,r,n),zs=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=NI(r,e);return va({prefix:t,name:e,encode:n,decode:s=>ty(i(s))})},kI=(t,e,r,n)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const f=i[t[l]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|f,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},jI=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},ft=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>va({prefix:e,name:t,encode(i){return jI(i,n,r)},decode(i){return kI(i,n,r,t)}}),qI=va({prefix:"\0",name:"identity",encode:t=>UI(t),decode:t=>PI(t)});var zI=Object.freeze({__proto__:null,identity:qI});const VI=ft({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var HI=Object.freeze({__proto__:null,base2:VI});const KI=ft({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var WI=Object.freeze({__proto__:null,base8:KI});const GI=zs({prefix:"9",name:"base10",alphabet:"0123456789"});var YI=Object.freeze({__proto__:null,base10:GI});const XI=ft({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ZI=ft({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var JI=Object.freeze({__proto__:null,base16:XI,base16upper:ZI});const QI=ft({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),e3=ft({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),t3=ft({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),r3=ft({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),n3=ft({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),i3=ft({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),s3=ft({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),o3=ft({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),a3=ft({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var c3=Object.freeze({__proto__:null,base32:QI,base32upper:e3,base32pad:t3,base32padupper:r3,base32hex:n3,base32hexupper:i3,base32hexpad:s3,base32hexpadupper:o3,base32z:a3});const u3=zs({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),l3=zs({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var f3=Object.freeze({__proto__:null,base36:u3,base36upper:l3});const h3=zs({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),d3=zs({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var p3=Object.freeze({__proto__:null,base58btc:h3,base58flickr:d3});const g3=ft({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),y3=ft({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),w3=ft({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),m3=ft({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var b3=Object.freeze({__proto__:null,base64:g3,base64pad:y3,base64url:w3,base64urlpad:m3});const ny=Array.from(""),E3=ny.reduce((t,e,r)=>(t[r]=e,t),[]),v3=ny.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function _3(t){return t.reduce((e,r)=>(e+=E3[r],e),"")}function x3(t){const e=[];for(const r of t){const n=v3[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const S3=va({prefix:"",name:"base256emoji",encode:_3,decode:x3});var I3=Object.freeze({__proto__:null,base256emoji:S3}),A3=iy,Bd=128,T3=-128,O3=Math.pow(2,31);function iy(t,e,r){e=e||[],r=r||0;for(var n=r;t>=O3;)e[r++]=t&255|Bd,t/=128;for(;t&T3;)e[r++]=t&255|Bd,t>>>=7;return e[r]=t|0,iy.bytes=r-n+1,e}var C3=sl,D3=128,Rd=127;function sl(t,n){var r=0,n=n||0,i=0,s=n,o,a=t.length;do{if(s>=a)throw sl.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=i<28?(o&Rd)<<i:(o&Rd)*Math.pow(2,i),i+=7}while(o>=D3);return sl.bytes=s-n,r}var B3=Math.pow(2,7),R3=Math.pow(2,14),N3=Math.pow(2,21),P3=Math.pow(2,28),U3=Math.pow(2,35),L3=Math.pow(2,42),$3=Math.pow(2,49),M3=Math.pow(2,56),F3=Math.pow(2,63),k3=function(t){return t<B3?1:t<R3?2:t<N3?3:t<P3?4:t<U3?5:t<L3?6:t<$3?7:t<M3?8:t<F3?9:10},j3={encode:A3,decode:C3,encodingLength:k3},sy=j3;const Nd=(t,e,r=0)=>(sy.encode(t,e,r),e),Pd=t=>sy.encodingLength(t),ol=(t,e)=>{const r=e.byteLength,n=Pd(t),i=n+Pd(r),s=new Uint8Array(i+r);return Nd(t,s,0),Nd(r,s,n),s.set(e,i),new q3(t,r,e,s)};let q3=class{constructor(e,r,n,i){this.code=e,this.size=r,this.digest=n,this.bytes=i}};const oy=({name:t,code:e,encode:r})=>new z3(t,e,r);let z3=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?ol(this.code,r):r.then(n=>ol(this.code,n))}else throw Error("Unknown type, must be binary type")}};const ay=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),V3=oy({name:"sha2-256",code:18,encode:ay("SHA-256")}),H3=oy({name:"sha2-512",code:19,encode:ay("SHA-512")});var K3=Object.freeze({__proto__:null,sha256:V3,sha512:H3});const cy=0,W3="identity",uy=ty,G3=t=>ol(cy,uy(t)),Y3={code:cy,name:W3,encode:uy,digest:G3};var X3=Object.freeze({__proto__:null,identity:Y3});new TextEncoder,new TextDecoder;const Ud={...zI,...HI,...WI,...YI,...JI,...c3,...f3,...p3,...b3,...I3};({...K3,...X3});function ly(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const Ld=ly("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),cu=ly("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Q0(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),fy={utf8:Ld,"utf-8":Ld,hex:Ud.base16,latin1:cu,ascii:cu,binary:cu,...Ud};function _a(t,e="utf8"){const r=fy[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function Hi(t,e="utf8"){const r=fy[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Sf(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function $d(t){return Li(_a(Hi(t,Ea),Z0))}function jo(t){return _a(Hi(Yn(t),Z0),Ea)}function hy(t){const e=Hi(CI,Dd),r=OI+_a(ey([e,t]),Dd);return[AI,TI,r].join(II)}function Z3(t){return _a(t,Ea)}function J3(t){return Hi(t,Ea)}function Q3(t){return Hi([jo(t.header),jo(t.payload)].join(ko),J0)}function e8(t){return[jo(t.header),jo(t.payload),Z3(t.signature)].join(ko)}function al(t){const e=t.split(ko),r=$d(e[0]),n=$d(e[1]),i=J3(e[2]),s=Hi(e.slice(0,2).join(ko),J0);return{header:r,payload:n,signature:i,data:s}}function Md(t=k0(DI)){const e=X0.getPublicKey(t);return{secretKey:ey([t,e]),publicKey:e}}async function t8(t,e,r,n,i=pe.fromMiliseconds(Date.now())){const s={alg:xI,typ:SI},o=hy(n.publicKey),a=i+r,c={iss:o,sub:t,aud:e,iat:i,exp:a},u=Q3({header:s,payload:c}),l=X0.sign(u,n.secretKey.slice(0,32));return e8({header:s,payload:c,signature:l})}var Fd=function(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))},r8=function(){function t(e,r,n){this.name=e,this.version=r,this.os=n,this.type="browser"}return t}(),n8=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),i8=function(){function t(e,r,n,i){this.name=e,this.version=r,this.os=n,this.bot=i,this.type="bot-device"}return t}(),s8=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),o8=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),a8=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,c8=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,kd=3,u8=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",a8]],jd=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function l8(t){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new o8:typeof navigator<"u"?h8(navigator.userAgent):p8()}function f8(t){return t!==""&&u8.reduce(function(e,r){var n=r[0],i=r[1];if(e)return e;var s=i.exec(t);return!!s&&[n,s]},!1)}function h8(t){var e=f8(t);if(!e)return null;var r=e[0],n=e[1];if(r==="searchbot")return new s8;var i=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);i?i.length<kd&&(i=Fd(Fd([],i,!0),g8(kd-i.length),!0)):i=[];var s=i.join("."),o=d8(t),a=c8.exec(t);return a&&a[1]?new i8(r,s,o,a[1]):new r8(r,s,o)}function d8(t){for(var e=0,r=jd.length;e<r;e++){var n=jd[e],i=n[0],s=n[1],o=s.exec(t);if(o)return i}return null}function p8(){var t=typeof process<"u"&&process.version;return t?new n8(process.version.slice(1)):null}function g8(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var je={};Object.defineProperty(je,"__esModule",{value:!0});je.getLocalStorage=je.getLocalStorageOrThrow=je.getCrypto=je.getCryptoOrThrow=Af=je.getLocation=je.getLocationOrThrow=If=je.getNavigator=je.getNavigatorOrThrow=Xn=je.getDocument=je.getDocumentOrThrow=je.getFromWindowOrThrow=je.getFromWindow=void 0;function ni(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}je.getFromWindow=ni;function Ki(t){const e=ni(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}je.getFromWindowOrThrow=Ki;function y8(){return Ki("document")}je.getDocumentOrThrow=y8;function w8(){return ni("document")}var Xn=je.getDocument=w8;function m8(){return Ki("navigator")}je.getNavigatorOrThrow=m8;function b8(){return ni("navigator")}var If=je.getNavigator=b8;function E8(){return Ki("location")}je.getLocationOrThrow=E8;function v8(){return ni("location")}var Af=je.getLocation=v8;function _8(){return Ki("crypto")}je.getCryptoOrThrow=_8;function x8(){return ni("crypto")}je.getCrypto=x8;function S8(){return Ki("localStorage")}je.getLocalStorageOrThrow=S8;function I8(){return ni("localStorage")}je.getLocalStorage=I8;var Tf={};Object.defineProperty(Tf,"__esModule",{value:!0});var dy=Tf.getWindowMetadata=void 0;const qd=je;function A8(){let t,e;try{t=qd.getDocumentOrThrow(),e=qd.getLocationOrThrow()}catch{return null}function r(){const f=t.getElementsByTagName("link"),h=[];for(let p=0;p<f.length;p++){const g=f[p],w=g.getAttribute("rel");if(w&&w.toLowerCase().indexOf("icon")>-1){const v=g.getAttribute("href");if(v)if(v.toLowerCase().indexOf("https:")===-1&&v.toLowerCase().indexOf("http:")===-1&&v.indexOf("//")!==0){let E=e.protocol+"//"+e.host;if(v.indexOf("/")===0)E+=v;else{const I=e.pathname.split("/");I.pop();const x=I.join("/");E+=x+"/"+v}h.push(E)}else if(v.indexOf("//")===0){const E=e.protocol+v;h.push(E)}else h.push(v)}}return h}function n(...f){const h=t.getElementsByTagName("meta");for(let p=0;p<h.length;p++){const g=h[p],w=["itemprop","property","name"].map(v=>g.getAttribute(v)).filter(v=>v?f.includes(v):!1);if(w.length&&w){const v=g.getAttribute("content");if(v)return v}}return""}function i(){let f=n("name","og:site_name","og:title","twitter:title");return f||(f=t.title),f}function s(){return n("description","og:description","twitter:description","keywords")}const o=i(),a=s(),c=e.origin,u=r();return{description:a,url:c,icons:u,name:o}}dy=Tf.getWindowMetadata=A8;const T8="0.1.1";function O8(){return T8}class ze extends Error{constructor(e,r={}){const n=(()=>{var c;if(r.cause instanceof ze){if(r.cause.details)return r.cause.details;if(r.cause.shortMessage)return r.cause.shortMessage}return r.cause&&"details"in r.cause&&typeof r.cause.details=="string"?r.cause.details:(c=r.cause)!=null&&c.message?r.cause.message:r.details})(),i=r.cause instanceof ze&&r.cause.docsPath||r.docsPath,o=`https://oxlib.sh${i??""}`,a=[e||"An error occurred.",...r.metaMessages?["",...r.metaMessages]:[],...n||i?["",n?`Details: ${n}`:void 0,i?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${O8()}`}),this.cause=r.cause,this.details=n,this.docs=o,this.docsPath=i,this.shortMessage=e}walk(e){return py(this,e)}}function py(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?py(t.cause,e):e?null:t}const hi=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function C8(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Cs(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Zn(t,...e){if(!C8(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function D8(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Cs(t.outputLen),Cs(t.blockLen)}function $i(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function gy(t,e){Zn(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function B8(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Mi(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function uu(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function gr(t,e){return t<<32-e|t>>>e}const R8=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function N8(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function P8(t){for(let e=0;e<t.length;e++)t[e]=N8(t[e]);return t}const zd=R8?t=>t:P8;function U8(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function xa(t){return typeof t=="string"&&(t=U8(t)),Zn(t),t}function L8(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Zn(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}class Of{}function yy(t){const e=n=>t().update(xa(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function $8(t=32){if(hi&&typeof hi.getRandomValues=="function")return hi.getRandomValues(new Uint8Array(t));if(hi&&typeof hi.randomBytes=="function")return Uint8Array.from(hi.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}function M8(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}function F8(t,e,r){return t&e^~t&r}function k8(t,e,r){return t&e^t&r^e&r}class j8 extends Of{constructor(e,r,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=uu(this.buffer)}update(e){$i(this),e=xa(e),Zn(e);const{view:r,buffer:n,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=uu(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){$i(this),gy(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,Mi(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(n,0),o=0);for(let f=o;f<i;f++)r[f]=0;M8(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=uu(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<u;f++)a.setUint32(4*f,l[f],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}}const tn=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),lo=BigInt(2**32-1),Vd=BigInt(32);function q8(t,e=!1){return e?{h:Number(t&lo),l:Number(t>>Vd&lo)}:{h:Number(t>>Vd&lo)|0,l:Number(t&lo)|0}}function z8(t,e=!1){const r=t.length;let n=new Uint32Array(r),i=new Uint32Array(r);for(let s=0;s<r;s++){const{h:o,l:a}=q8(t[s],e);[n[s],i[s]]=[o,a]}return[n,i]}const V8=(t,e,r)=>t<<r|e>>>32-r,H8=(t,e,r)=>e<<r|t>>>32-r,K8=(t,e,r)=>e<<r-32|t>>>64-r,W8=(t,e,r)=>t<<r-32|e>>>64-r,G8=BigInt(0),Ji=BigInt(1),Y8=BigInt(2),X8=BigInt(7),Z8=BigInt(256),J8=BigInt(113),wy=[],my=[],by=[];for(let t=0,e=Ji,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],wy.push(2*(5*n+r)),my.push((t+1)*(t+2)/2%64);let i=G8;for(let s=0;s<7;s++)e=(e<<Ji^(e>>X8)*J8)%Z8,e&Y8&&(i^=Ji<<(Ji<<BigInt(s))-Ji);by.push(i)}const Ey=z8(by,!0),Q8=Ey[0],eA=Ey[1],Hd=(t,e,r)=>r>32?K8(t,e,r):V8(t,e,r),Kd=(t,e,r)=>r>32?W8(t,e,r):H8(t,e,r);function tA(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=r[c],l=r[c+1],f=Hd(u,l,1)^r[a],h=Kd(u,l,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=f,t[o+p+1]^=h}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=my[o],c=Hd(i,s,a),u=Kd(i,s,a),l=wy[o];i=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=Q8[n],t[1]^=eA[n]}Mi(r)}class Cf extends Of{constructor(e,r,n,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=i,this.rounds=s,Cs(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=B8(this.state)}clone(){return this._cloneInto()}keccak(){zd(this.state32),tA(this.state32,this.rounds),zd(this.state32),this.posOut=0,this.pos=0}update(e){$i(this),e=xa(e),Zn(e);const{blockLen:r,state:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);for(let a=0;a<o;a++)n[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:i}=this;e[n]^=r,r&128&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){$i(this,!1),Zn(e),this.finish();const r=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,s-i);e.set(r.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Cs(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(gy(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Mi(this.state)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new Cf(r,n,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}const rA=(t,e,r)=>yy(()=>new Cf(e,t,r)),nA=rA(1,136,256/8),iA=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),rn=new Uint32Array(64);class sA extends j8{constructor(e=32){super(64,e,8,!1),this.A=tn[0]|0,this.B=tn[1]|0,this.C=tn[2]|0,this.D=tn[3]|0,this.E=tn[4]|0,this.F=tn[5]|0,this.G=tn[6]|0,this.H=tn[7]|0}get(){const{A:e,B:r,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,r,n,i,s,o,a,c]}set(e,r,n,i,s,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let f=0;f<16;f++,r+=4)rn[f]=e.getUint32(r,!1);for(let f=16;f<64;f++){const h=rn[f-15],p=rn[f-2],g=gr(h,7)^gr(h,18)^h>>>3,w=gr(p,17)^gr(p,19)^p>>>10;rn[f]=w+rn[f-7]+g+rn[f-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let f=0;f<64;f++){const h=gr(a,6)^gr(a,11)^gr(a,25),p=l+h+F8(a,c,u)+iA[f]+rn[f]|0,w=(gr(n,2)^gr(n,13)^gr(n,22))+k8(n,i,s)|0;l=u,u=c,c=a,a=o+p|0,o=s,s=i,i=n,n=p+w|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,i,s,o,a,c,u,l)}roundClean(){Mi(rn)}destroy(){this.set(0,0,0,0,0,0,0,0),Mi(this.buffer)}}const oA=yy(()=>new sA);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Df=BigInt(0),cl=BigInt(1);function Vs(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Bf(t){if(!Vs(t))throw new Error("Uint8Array expected")}function Ds(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function fo(t){const e=t.toString(16);return e.length&1?"0"+e:e}function vy(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Df:BigInt("0x"+t)}const _y=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",aA=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Bs(t){if(Bf(t),_y)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=aA[t[r]];return e}const Br={_0:48,_9:57,A:65,F:70,a:97,f:102};function Wd(t){if(t>=Br._0&&t<=Br._9)return t-Br._0;if(t>=Br.A&&t<=Br.F)return t-(Br.A-10);if(t>=Br.a&&t<=Br.f)return t-(Br.a-10)}function qo(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(_y)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=Wd(t.charCodeAt(s)),a=Wd(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function Wn(t){return vy(Bs(t))}function xy(t){return Bf(t),vy(Bs(Uint8Array.from(t).reverse()))}function Hs(t,e){return qo(t.toString(16).padStart(e*2,"0"))}function Sy(t,e){return Hs(t,e).reverse()}function Xt(t,e,r){let n;if(typeof e=="string")try{n=qo(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Vs(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}function zo(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Bf(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}const lu=t=>typeof t=="bigint"&&Df<=t;function Rf(t,e,r){return lu(t)&&lu(e)&&lu(r)&&e<=t&&t<r}function Ai(t,e,r,n){if(!Rf(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function cA(t){let e;for(e=0;t>Df;t>>=cl,e+=1);return e}const Sa=t=>(cl<<BigInt(t))-cl,fu=t=>new Uint8Array(t),Gd=t=>Uint8Array.from(t);function uA(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=fu(t),i=fu(t),s=0;const o=()=>{n.fill(1),i.fill(0),s=0},a=(...f)=>r(i,n,...f),c=(f=fu(0))=>{i=a(Gd([0]),f),n=a(),f.length!==0&&(i=a(Gd([1]),f),n=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const h=[];for(;f<e;){n=a();const p=n.slice();h.push(p),f+=n.length}return zo(...h)};return(f,h)=>{o(),c(f);let p;for(;!(p=h(u()));)c();return o(),p}}const lA={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Vs(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Ia(t,e,r={}){const n=(i,s,o)=>{const a=lA[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(r))n(i,s,!0);return t}function Yd(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}function fA(t,e){if(Qd(t)>e)throw new RA({givenSize:Qd(t),maxSize:e})}const Rr={zero:48,nine:57,A:65,F:70,a:97,f:102};function Xd(t){if(t>=Rr.zero&&t<=Rr.nine)return t-Rr.zero;if(t>=Rr.A&&t<=Rr.F)return t-(Rr.A-10);if(t>=Rr.a&&t<=Rr.f)return t-(Rr.a-10)}function hA(t,e={}){const{dir:r,size:n=32}=e;if(n===0)return t;if(t.length>n)throw new NA({size:t.length,targetSize:n,type:"Bytes"});const i=new Uint8Array(n);for(let s=0;s<n;s++){const o=r==="right";i[o?s:n-s-1]=t[o?s:t.length-s-1]}return i}function Iy(t,e){if(In(t)>e)throw new _A({givenSize:In(t),maxSize:e})}function dA(t,e){if(typeof e=="number"&&e>0&&e>In(t)-1)throw new Oy({offset:e,position:"start",size:In(t)})}function pA(t,e,r){if(typeof e=="number"&&typeof r=="number"&&In(t)!==r-e)throw new Oy({offset:r,position:"end",size:In(t)})}function Ay(t,e={}){const{dir:r,size:n=32}=e;if(n===0)return t;const i=t.replace("0x","");if(i.length>n*2)throw new xA({size:Math.ceil(i.length/2),targetSize:n,type:"Hex"});return`0x${i[r==="right"?"padEnd":"padStart"](n*2,"0")}`}const gA="#__bigint";function Nf(t,e,r){return JSON.stringify(t,(n,i)=>typeof i=="bigint"?i.toString()+gA:i,r)}const yA=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function wA(t,e={}){const{strict:r=!1}=e;if(!t)throw new Zd(t);if(typeof t!="string")throw new Zd(t);if(r&&!/^0x[0-9a-fA-F]*$/.test(t))throw new Jd(t);if(!t.startsWith("0x"))throw new Jd(t)}function mA(...t){return`0x${t.reduce((e,r)=>e+r.replace("0x",""),"")}`}function Pf(t){return t instanceof Uint8Array?Vo(t):Array.isArray(t)?Vo(new Uint8Array(t)):t}function Vo(t,e={}){let r="";for(let i=0;i<t.length;i++)r+=yA[t[i]];const n=`0x${r}`;return typeof e.size=="number"?(Iy(n,e.size),Ty(n,e.size)):n}function hu(t,e={}){const{signed:r,size:n}=e,i=BigInt(t);let s;n?r?s=(1n<<BigInt(n)*8n-1n)-1n:s=2n**(BigInt(n)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&r?-s-1n:0;if(s&&i>s||i<o){const u=typeof t=="bigint"?"n":"";throw new vA({max:s?`${s}${u}`:void 0,min:`${o}${u}`,signed:r,size:n,value:`${t}${u}`})}const c=`0x${(r&&i<0?(1n<<BigInt(n*8))+BigInt(i):i).toString(16)}`;return n?bA(c,n):c}function bA(t,e){return Ay(t,{dir:"left",size:e})}function Ty(t,e){return Ay(t,{dir:"right",size:e})}function Mr(t,e,r,n={}){const{strict:i}=n;dA(t,e);const s=`0x${t.replace("0x","").slice((e??0)*2,(r??t.length)*2)}`;return i&&pA(s,e,r),s}function In(t){return Math.ceil((t.length-2)/2)}function EA(t,e={}){const{strict:r=!1}=e;try{return wA(t,{strict:r}),!0}catch{return!1}}class vA extends ze{constructor({max:e,min:r,signed:n,size:i,value:s}){super(`Number \`${s}\` is not in safe${i?` ${i*8}-bit`:""}${n?" signed":" unsigned"} integer range ${e?`(\`${r}\` to \`${e}\`)`:`(above \`${r}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class Zd extends ze{constructor(e){super(`Value \`${typeof e=="object"?Nf(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class Jd extends ze{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}let _A=class extends ze{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}};class Oy extends ze{constructor({offset:e,position:r,size:n}){super(`Slice ${r==="start"?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}let xA=class extends ze{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}};const SA=new TextEncoder;function IA(t){if(!(t instanceof Uint8Array)){if(!t)throw new ho(t);if(typeof t!="object")throw new ho(t);if(!("BYTES_PER_ELEMENT"in t))throw new ho(t);if(t.BYTES_PER_ELEMENT!==1||t.constructor.name!=="Uint8Array")throw new ho(t)}}function AA(t){return t instanceof Uint8Array?t:typeof t=="string"?OA(t):TA(t)}function TA(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function OA(t,e={}){const{size:r}=e;let n=t;r&&(Iy(t,r),n=Ty(t,r));let i=n.slice(2);i.length%2&&(i=`0${i}`);const s=i.length/2,o=new Uint8Array(s);for(let a=0,c=0;a<s;a++){const u=Xd(i.charCodeAt(c++)),l=Xd(i.charCodeAt(c++));if(u===void 0||l===void 0)throw new ze(`Invalid byte sequence ("${i[c-2]}${i[c-1]}" in "${i}").`);o[a]=u*16+l}return o}function CA(t,e={}){const{size:r}=e,n=SA.encode(t);return typeof r=="number"?(fA(n,r),DA(n,r)):n}function DA(t,e){return hA(t,{dir:"right",size:e})}function Qd(t){return t.length}function BA(t){try{return IA(t),!0}catch{return!1}}class ho extends ze{constructor(e){super(`Value \`${typeof e=="object"?Nf(e):e}\` of type \`${typeof e}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class RA extends ze{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class NA extends ze{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}function Cy(t,e={}){const{as:r=typeof t=="string"?"Hex":"Bytes"}=e,n=nA(AA(t));return r==="Bytes"?n:Vo(n)}class PA extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const n=this.keys().next().value;n&&this.delete(n)}return this}}const UA={checksum:new PA(8192)},du=UA.checksum;function Dy(t,e={}){const{compressed:r}=e,{prefix:n,x:i,y:s}=t;if(r===!1||typeof i=="bigint"&&typeof s=="bigint"){if(n!==4)throw new ep({prefix:n,cause:new jA});return}if(r===!0||typeof i=="bigint"&&typeof s>"u"){if(n!==3&&n!==2)throw new ep({prefix:n,cause:new kA});return}throw new FA({publicKey:t})}function LA(t){const e=(()=>{if(EA(t))return By(t);if(BA(t))return $A(t);const{prefix:r,x:n,y:i}=t;return typeof n=="bigint"&&typeof i=="bigint"?{prefix:r??4,x:n,y:i}:{prefix:r,x:n}})();return Dy(e),e}function $A(t){return By(Vo(t))}function By(t){if(t.length!==132&&t.length!==130&&t.length!==68)throw new qA({publicKey:t});if(t.length===130){const n=BigInt(Mr(t,0,32)),i=BigInt(Mr(t,32,64));return{prefix:4,x:n,y:i}}if(t.length===132){const n=Number(Mr(t,0,1)),i=BigInt(Mr(t,1,33)),s=BigInt(Mr(t,33,65));return{prefix:n,x:i,y:s}}const e=Number(Mr(t,0,1)),r=BigInt(Mr(t,1,33));return{prefix:e,x:r}}function MA(t,e={}){Dy(t);const{prefix:r,x:n,y:i}=t,{includePrefix:s=!0}=e;return mA(s?hu(r,{size:1}):"0x",hu(n,{size:32}),typeof i=="bigint"?hu(i,{size:32}):"0x")}class FA extends ze{constructor({publicKey:e}){super(`Value \`${Nf(e)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class ep extends ze{constructor({prefix:e,cause:r}){super(`Prefix "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class kA extends ze{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class jA extends ze{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}let qA=class extends ze{constructor({publicKey:e}){super(`Value \`${e}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${In(Pf(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}};const zA=/^0x[a-fA-F0-9]{40}$/;function Ry(t,e={}){const{strict:r=!0}=e;if(!zA.test(t))throw new tp({address:t,cause:new KA});if(r){if(t.toLowerCase()===t)return;if(Ny(t)!==t)throw new tp({address:t,cause:new WA})}}function Ny(t){if(du.has(t))return du.get(t);Ry(t,{strict:!1});const e=t.substring(2).toLowerCase(),r=Cy(CA(e),{as:"Bytes"}),n=e.split("");for(let s=0;s<40;s+=2)r[s>>1]>>4>=8&&n[s]&&(n[s]=n[s].toUpperCase()),(r[s>>1]&15)>=8&&n[s+1]&&(n[s+1]=n[s+1].toUpperCase());const i=`0x${n.join("")}`;return du.set(t,i),i}function VA(t,e={}){const{checksum:r=!1}=e;return Ry(t),r?Ny(t):t}function HA(t,e={}){const r=Cy(`0x${MA(t).slice(4)}`).substring(26);return VA(`0x${r}`,e)}class tp extends ze{constructor({address:e,cause:r}){super(`Address "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class KA extends ze{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class WA extends ze{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}class Py extends Of{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,D8(e);const n=xa(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Mi(s)}update(e){return $i(this),this.iHash.update(e),this}digestInto(e){$i(this),Zn(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Uy=(t,e,r)=>new Py(t,e).update(r).digest();Uy.create=(t,e)=>new Py(t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Nt=BigInt(0),At=BigInt(1),qn=BigInt(2),GA=BigInt(3),Ly=BigInt(4),$y=BigInt(5),My=BigInt(8);function Bt(t,e){const r=t%e;return r>=Nt?r:e+r}function Ht(t,e,r){let n=t;for(;e-- >Nt;)n*=n,n%=r;return n}function ul(t,e){if(t===Nt)throw new Error("invert: expected non-zero number");if(e<=Nt)throw new Error("invert: expected positive modulus, got "+e);let r=Bt(t,e),n=e,i=Nt,s=At;for(;r!==Nt;){const a=n/r,c=n%r,u=i-s*a;n=r,r=c,i=s,s=u}if(n!==At)throw new Error("invert: does not exist");return Bt(i,e)}function Fy(t,e){const r=(t.ORDER+At)/Ly,n=t.pow(e,r);if(!t.eql(t.sqr(n),e))throw new Error("Cannot find square root");return n}function YA(t,e){const r=(t.ORDER-$y)/My,n=t.mul(e,qn),i=t.pow(n,r),s=t.mul(e,i),o=t.mul(t.mul(s,qn),i),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function XA(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-At,r=0;for(;e%qn===Nt;)e/=qn,r++;let n=qn;const i=Uf(t);for(;rp(i,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Fy;let s=i.pow(n,e);const o=(e+At)/qn;return function(c,u){if(c.is0(u))return u;if(rp(c,u)!==1)throw new Error("Cannot find square root");let l=r,f=c.mul(c.ONE,s),h=c.pow(u,e),p=c.pow(u,o);for(;!c.eql(h,c.ONE);){if(c.is0(h))return c.ZERO;let g=1,w=c.sqr(h);for(;!c.eql(w,c.ONE);)if(g++,w=c.sqr(w),g===l)throw new Error("Cannot find square root");const v=At<<BigInt(l-g-1),E=c.pow(f,v);l=g,f=c.sqr(E),h=c.mul(h,f),p=c.mul(p,E)}return p}}function ZA(t){return t%Ly===GA?Fy:t%My===$y?YA:XA(t)}const JA=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function QA(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=JA.reduce((n,i)=>(n[i]="function",n),e);return Ia(t,r)}function eT(t,e,r){if(r<Nt)throw new Error("invalid exponent, negatives unsupported");if(r===Nt)return t.ONE;if(r===At)return e;let n=t.ONE,i=e;for(;r>Nt;)r&At&&(n=t.mul(n,i)),i=t.sqr(i),r>>=At;return n}function ky(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),s),n}function rp(t,e){const r=(t.ORDER-At)/qn,n=t.pow(e,r),i=t.eql(n,t.ONE),s=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function jy(t,e){e!==void 0&&Cs(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Uf(t,e,r=!1,n={}){if(t<=Nt)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=jy(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:i,BYTES:s,MASK:Sa(i),ZERO:Nt,ONE:At,create:c=>Bt(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Nt<=c&&c<t},is0:c=>c===Nt,isOdd:c=>(c&At)===At,neg:c=>Bt(-c,t),eql:(c,u)=>c===u,sqr:c=>Bt(c*c,t),add:(c,u)=>Bt(c+u,t),sub:(c,u)=>Bt(c-u,t),mul:(c,u)=>Bt(c*u,t),pow:(c,u)=>eT(a,c,u),div:(c,u)=>Bt(c*ul(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>ul(c,t),sqrt:n.sqrt||(c=>(o||(o=ZA(t)),o(a,c))),toBytes:c=>r?Sy(c,s):Hs(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?xy(c):Wn(c)},invertBatch:c=>ky(a,c),cmov:(c,u,l)=>l?u:c});return Object.freeze(a)}function qy(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function zy(t){const e=qy(t);return e+Math.ceil(e/2)}function tT(t,e,r=!1){const n=t.length,i=qy(e),s=zy(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=r?xy(t):Wn(t),a=Bt(o,e-At)+At;return r?Sy(a,i):Hs(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const np=BigInt(0),ll=BigInt(1);function pu(t,e){const r=e.negate();return t?r:e}function Vy(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function gu(t,e){Vy(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),i=2**t,s=Sa(t),o=BigInt(t);return{windows:r,windowSize:n,mask:s,maxNumber:i,shiftBy:o}}function ip(t,e,r){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=r;let a=Number(t&i),c=t>>o;a>n&&(a-=s,c+=ll);const u=e*n,l=u+Math.abs(a)-1,f=a===0,h=a<0,p=e%2!==0;return{nextN:c,offset:l,isZero:f,isNeg:h,isNegF:p,offsetF:u}}function rT(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function nT(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const yu=new WeakMap,Hy=new WeakMap;function wu(t){return Hy.get(t)||1}function iT(t,e){return{constTimeNegate:pu,hasPrecomputes(r){return wu(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>np;)n&ll&&(i=i.add(s)),s=s.double(),n>>=ll;return i},precomputeWindow(r,n){const{windows:i,windowSize:s}=gu(n,e),o=[];let a=r,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,i){let s=t.ZERO,o=t.BASE;const a=gu(r,e);for(let c=0;c<a.windows;c++){const{nextN:u,offset:l,isZero:f,isNeg:h,isNegF:p,offsetF:g}=ip(i,c,a);i=u,f?o=o.add(pu(p,n[g])):s=s.add(pu(h,n[l]))}return{p:s,f:o}},wNAFUnsafe(r,n,i,s=t.ZERO){const o=gu(r,e);for(let a=0;a<o.windows&&i!==np;a++){const{nextN:c,offset:u,isZero:l,isNeg:f}=ip(i,a,o);if(i=c,!l){const h=n[u];s=s.add(f?h.negate():h)}}return s},getPrecomputes(r,n,i){let s=yu.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&yu.set(n,i(s))),s},wNAFCached(r,n,i){const s=wu(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){const o=wu(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){Vy(n,e),Hy.set(r,n),yu.delete(r)}}}function sT(t,e,r,n){rT(r,t),nT(n,e);const i=r.length,s=n.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=cA(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=Sa(c),l=new Array(Number(u)+1).fill(o),f=Math.floor((e.BITS-1)/c)*c;let h=o;for(let p=f;p>=0;p-=c){l.fill(o);for(let w=0;w<s;w++){const v=n[w],E=Number(v>>BigInt(p)&u);l[E]=l[E].add(r[w])}let g=o;for(let w=l.length-1,v=o;w>0;w--)v=v.add(l[w]),g=g.add(v);if(h=h.add(g),p!==0)for(let w=0;w<c;w++)h=h.double()}return h}function Ky(t){return QA(t.Fp),Ia(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...jy(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function sp(t){t.lowS!==void 0&&Ds("lowS",t.lowS),t.prehash!==void 0&&Ds("prehash",t.prehash)}function oT(t){const e=Ky(t);Ia(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:r,Fp:n,a:i}=e;if(r){if(!n.eql(i,n.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class aT extends Error{constructor(e=""){super(e)}}const Fr={Err:aT,_tlv:{encode:(t,e)=>{const{Err:r}=Fr;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,i=fo(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");const s=n>127?fo(i.length/2|128):"";return fo(t)+s+i+e},decode(t,e){const{Err:r}=Fr;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const u=e.subarray(n,n+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=Fr;if(t<zr)throw new e("integer: negative integers are not allowed");let r=fo(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Fr;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Wn(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=Fr,i=Xt("signature",t),{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:u,l}=n.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){const{_tlv:e,_int:r}=Fr,n=e.encode(2,r.encode(t.r)),i=e.encode(2,r.encode(t.s)),s=n+i;return e.encode(48,s)}};function mu(t,e){return Bs(Hs(t,e))}const zr=BigInt(0),st=BigInt(1);BigInt(2);const bu=BigInt(3),cT=BigInt(4);function uT(t){const e=oT(t),{Fp:r}=e,n=Uf(e.n,e.nBitLength),i=e.toBytes||((x,A,T)=>{const O=A.toAffine();return zo(Uint8Array.from([4]),r.toBytes(O.x),r.toBytes(O.y))}),s=e.fromBytes||(x=>{const A=x.subarray(1),T=r.fromBytes(A.subarray(0,r.BYTES)),O=r.fromBytes(A.subarray(r.BYTES,2*r.BYTES));return{x:T,y:O}});function o(x){const{a:A,b:T}=e,O=r.sqr(x),P=r.mul(O,x);return r.add(r.add(P,r.mul(x,A)),T)}function a(x,A){const T=r.sqr(A),O=o(x);return r.eql(T,O)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=r.mul(r.pow(e.a,bu),cT),u=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(c,u)))throw new Error("bad curve params: a or b");function l(x){return Rf(x,st,e.n)}function f(x){const{allowedPrivateKeyLengths:A,nByteLength:T,wrapPrivateKey:O,n:P}=e;if(A&&typeof x!="bigint"){if(Vs(x)&&(x=Bs(x)),typeof x!="string"||!A.includes(x.length))throw new Error("invalid private key");x=x.padStart(T*2,"0")}let M;try{M=typeof x=="bigint"?x:Wn(Xt("private key",x,T))}catch{throw new Error("invalid private key, expected hex or "+T+" bytes, got "+typeof x)}return O&&(M=Bt(M,P)),Ai("private key",M,st,P),M}function h(x){if(!(x instanceof w))throw new Error("ProjectivePoint expected")}const p=Yd((x,A)=>{const{px:T,py:O,pz:P}=x;if(r.eql(P,r.ONE))return{x:T,y:O};const M=x.is0();A==null&&(A=M?r.ONE:r.inv(P));const U=r.mul(T,A),G=r.mul(O,A),se=r.mul(P,A);if(M)return{x:r.ZERO,y:r.ZERO};if(!r.eql(se,r.ONE))throw new Error("invZ was invalid");return{x:U,y:G}}),g=Yd(x=>{if(x.is0()){if(e.allowInfinityPoint&&!r.is0(x.py))return;throw new Error("bad point: ZERO")}const{x:A,y:T}=x.toAffine();if(!r.isValid(A)||!r.isValid(T))throw new Error("bad point: x or y not FE");if(!a(A,T))throw new Error("bad point: equation left != right");if(!x.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class w{constructor(A,T,O){if(A==null||!r.isValid(A))throw new Error("x required");if(T==null||!r.isValid(T)||r.is0(T))throw new Error("y required");if(O==null||!r.isValid(O))throw new Error("z required");this.px=A,this.py=T,this.pz=O,Object.freeze(this)}static fromAffine(A){const{x:T,y:O}=A||{};if(!A||!r.isValid(T)||!r.isValid(O))throw new Error("invalid affine point");if(A instanceof w)throw new Error("projective point not allowed");const P=M=>r.eql(M,r.ZERO);return P(T)&&P(O)?w.ZERO:new w(T,O,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(A){const T=ky(r,A.map(O=>O.pz));return A.map((O,P)=>O.toAffine(T[P])).map(w.fromAffine)}static fromHex(A){const T=w.fromAffine(s(Xt("pointHex",A)));return T.assertValidity(),T}static fromPrivateKey(A){return w.BASE.multiply(f(A))}static msm(A,T){return sT(w,n,A,T)}_setWindowSize(A){I.setWindowSize(this,A)}assertValidity(){g(this)}hasEvenY(){const{y:A}=this.toAffine();if(r.isOdd)return!r.isOdd(A);throw new Error("Field doesn't support isOdd")}equals(A){h(A);const{px:T,py:O,pz:P}=this,{px:M,py:U,pz:G}=A,se=r.eql(r.mul(T,G),r.mul(M,P)),Z=r.eql(r.mul(O,G),r.mul(U,P));return se&&Z}negate(){return new w(this.px,r.neg(this.py),this.pz)}double(){const{a:A,b:T}=e,O=r.mul(T,bu),{px:P,py:M,pz:U}=this;let G=r.ZERO,se=r.ZERO,Z=r.ZERO,L=r.mul(P,P),K=r.mul(M,M),D=r.mul(U,U),C=r.mul(P,M);return C=r.add(C,C),Z=r.mul(P,U),Z=r.add(Z,Z),G=r.mul(A,Z),se=r.mul(O,D),se=r.add(G,se),G=r.sub(K,se),se=r.add(K,se),se=r.mul(G,se),G=r.mul(C,G),Z=r.mul(O,Z),D=r.mul(A,D),C=r.sub(L,D),C=r.mul(A,C),C=r.add(C,Z),Z=r.add(L,L),L=r.add(Z,L),L=r.add(L,D),L=r.mul(L,C),se=r.add(se,L),D=r.mul(M,U),D=r.add(D,D),L=r.mul(D,C),G=r.sub(G,L),Z=r.mul(D,K),Z=r.add(Z,Z),Z=r.add(Z,Z),new w(G,se,Z)}add(A){h(A);const{px:T,py:O,pz:P}=this,{px:M,py:U,pz:G}=A;let se=r.ZERO,Z=r.ZERO,L=r.ZERO;const K=e.a,D=r.mul(e.b,bu);let C=r.mul(T,M),F=r.mul(O,U),Y=r.mul(P,G),k=r.add(T,O),W=r.add(M,U);k=r.mul(k,W),W=r.add(C,F),k=r.sub(k,W),W=r.add(T,P);let te=r.add(M,G);return W=r.mul(W,te),te=r.add(C,Y),W=r.sub(W,te),te=r.add(O,P),se=r.add(U,G),te=r.mul(te,se),se=r.add(F,Y),te=r.sub(te,se),L=r.mul(K,W),se=r.mul(D,Y),L=r.add(se,L),se=r.sub(F,L),L=r.add(F,L),Z=r.mul(se,L),F=r.add(C,C),F=r.add(F,C),Y=r.mul(K,Y),W=r.mul(D,W),F=r.add(F,Y),Y=r.sub(C,Y),Y=r.mul(K,Y),W=r.add(W,Y),C=r.mul(F,W),Z=r.add(Z,C),C=r.mul(te,W),se=r.mul(k,se),se=r.sub(se,C),C=r.mul(k,F),L=r.mul(te,L),L=r.add(L,C),new w(se,Z,L)}subtract(A){return this.add(A.negate())}is0(){return this.equals(w.ZERO)}wNAF(A){return I.wNAFCached(this,A,w.normalizeZ)}multiplyUnsafe(A){const{endo:T,n:O}=e;Ai("scalar",A,zr,O);const P=w.ZERO;if(A===zr)return P;if(this.is0()||A===st)return this;if(!T||I.hasPrecomputes(this))return I.wNAFCachedUnsafe(this,A,w.normalizeZ);let{k1neg:M,k1:U,k2neg:G,k2:se}=T.splitScalar(A),Z=P,L=P,K=this;for(;U>zr||se>zr;)U&st&&(Z=Z.add(K)),se&st&&(L=L.add(K)),K=K.double(),U>>=st,se>>=st;return M&&(Z=Z.negate()),G&&(L=L.negate()),L=new w(r.mul(L.px,T.beta),L.py,L.pz),Z.add(L)}multiply(A){const{endo:T,n:O}=e;Ai("scalar",A,st,O);let P,M;if(T){const{k1neg:U,k1:G,k2neg:se,k2:Z}=T.splitScalar(A);let{p:L,f:K}=this.wNAF(G),{p:D,f:C}=this.wNAF(Z);L=I.constTimeNegate(U,L),D=I.constTimeNegate(se,D),D=new w(r.mul(D.px,T.beta),D.py,D.pz),P=L.add(D),M=K.add(C)}else{const{p:U,f:G}=this.wNAF(A);P=U,M=G}return w.normalizeZ([P,M])[0]}multiplyAndAddUnsafe(A,T,O){const P=w.BASE,M=(G,se)=>se===zr||se===st||!G.equals(P)?G.multiplyUnsafe(se):G.multiply(se),U=M(this,T).add(M(A,O));return U.is0()?void 0:U}toAffine(A){return p(this,A)}isTorsionFree(){const{h:A,isTorsionFree:T}=e;if(A===st)return!0;if(T)return T(w,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:A,clearCofactor:T}=e;return A===st?this:T?T(w,this):this.multiplyUnsafe(e.h)}toRawBytes(A=!0){return Ds("isCompressed",A),this.assertValidity(),i(w,this,A)}toHex(A=!0){return Ds("isCompressed",A),Bs(this.toRawBytes(A))}}w.BASE=new w(e.Gx,e.Gy,r.ONE),w.ZERO=new w(r.ZERO,r.ONE,r.ZERO);const{endo:v,nBitLength:E}=e,I=iT(w,v?Math.ceil(E/2):E);return{CURVE:e,ProjectivePoint:w,normPrivateKeyToScalar:f,weierstrassEquation:o,isWithinCurveOrder:l}}function lT(t){const e=Ky(t);return Ia(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function fT(t){const e=lT(t),{Fp:r,n,nByteLength:i,nBitLength:s}=e,o=r.BYTES+1,a=2*r.BYTES+1;function c(D){return Bt(D,n)}function u(D){return ul(D,n)}const{ProjectivePoint:l,normPrivateKeyToScalar:f,weierstrassEquation:h,isWithinCurveOrder:p}=uT({...e,toBytes(D,C,F){const Y=C.toAffine(),k=r.toBytes(Y.x),W=zo;return Ds("isCompressed",F),F?W(Uint8Array.from([C.hasEvenY()?2:3]),k):W(Uint8Array.from([4]),k,r.toBytes(Y.y))},fromBytes(D){const C=D.length,F=D[0],Y=D.subarray(1);if(C===o&&(F===2||F===3)){const k=Wn(Y);if(!Rf(k,st,r.ORDER))throw new Error("Point is not on curve");const W=h(k);let te;try{te=r.sqrt(W)}catch(J){const fe=J instanceof Error?": "+J.message:"";throw new Error("Point is not on curve"+fe)}const ie=(te&st)===st;return(F&1)===1!==ie&&(te=r.neg(te)),{x:k,y:te}}else if(C===a&&F===4){const k=r.fromBytes(Y.subarray(0,r.BYTES)),W=r.fromBytes(Y.subarray(r.BYTES,2*r.BYTES));return{x:k,y:W}}else{const k=o,W=a;throw new Error("invalid Point, expected length of "+k+", or uncompressed "+W+", got "+C)}}});function g(D){const C=n>>st;return D>C}function w(D){return g(D)?c(-D):D}const v=(D,C,F)=>Wn(D.slice(C,F));class E{constructor(C,F,Y){Ai("r",C,st,n),Ai("s",F,st,n),this.r=C,this.s=F,Y!=null&&(this.recovery=Y),Object.freeze(this)}static fromCompact(C){const F=i;return C=Xt("compactSignature",C,F*2),new E(v(C,0,F),v(C,F,2*F))}static fromDER(C){const{r:F,s:Y}=Fr.toSig(Xt("DER",C));return new E(F,Y)}assertValidity(){}addRecoveryBit(C){return new E(this.r,this.s,C)}recoverPublicKey(C){const{r:F,s:Y,recovery:k}=this,W=P(Xt("msgHash",C));if(k==null||![0,1,2,3].includes(k))throw new Error("recovery id invalid");const te=k===2||k===3?F+e.n:F;if(te>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const ie=k&1?"03":"02",he=l.fromHex(ie+mu(te,r.BYTES)),J=u(te),fe=c(-W*J),q=c(Y*J),j=l.BASE.multiplyAndAddUnsafe(he,fe,q);if(!j)throw new Error("point at infinify");return j.assertValidity(),j}hasHighS(){return g(this.s)}normalizeS(){return this.hasHighS()?new E(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return qo(this.toDERHex())}toDERHex(){return Fr.hexFromSig(this)}toCompactRawBytes(){return qo(this.toCompactHex())}toCompactHex(){const C=i;return mu(this.r,C)+mu(this.s,C)}}const I={isValidPrivateKey(D){try{return f(D),!0}catch{return!1}},normPrivateKeyToScalar:f,randomPrivateKey:()=>{const D=zy(e.n);return tT(e.randomBytes(D),e.n)},precompute(D=8,C=l.BASE){return C._setWindowSize(D),C.multiply(BigInt(3)),C}};function x(D,C=!0){return l.fromPrivateKey(D).toRawBytes(C)}function A(D){if(typeof D=="bigint")return!1;if(D instanceof l)return!0;const F=Xt("key",D).length,Y=r.BYTES,k=Y+1,W=2*Y+1;if(!(e.allowedPrivateKeyLengths||i===k))return F===k||F===W}function T(D,C,F=!0){if(A(D)===!0)throw new Error("first arg must be private key");if(A(C)===!1)throw new Error("second arg must be public key");return l.fromHex(C).multiply(f(D)).toRawBytes(F)}const O=e.bits2int||function(D){if(D.length>8192)throw new Error("input is too large");const C=Wn(D),F=D.length*8-s;return F>0?C>>BigInt(F):C},P=e.bits2int_modN||function(D){return c(O(D))},M=Sa(s);function U(D){return Ai("num < 2^"+s,D,zr,M),Hs(D,i)}function G(D,C,F=se){if(["recovered","canonical"].some(ae=>ae in F))throw new Error("sign() legacy options not supported");const{hash:Y,randomBytes:k}=e;let{lowS:W,prehash:te,extraEntropy:ie}=F;W==null&&(W=!0),D=Xt("msgHash",D),sp(F),te&&(D=Xt("prehashed msgHash",Y(D)));const he=P(D),J=f(C),fe=[U(J),U(he)];if(ie!=null&&ie!==!1){const ae=ie===!0?k(r.BYTES):ie;fe.push(Xt("extraEntropy",ae))}const q=zo(...fe),j=he;function ne(ae){const S=O(ae);if(!p(S))return;const m=u(S),b=l.BASE.multiply(S).toAffine(),R=c(b.x);if(R===zr)return;const N=c(m*c(j+R*J));if(N===zr)return;let z=(b.x===R?0:2)|Number(b.y&st),H=N;return W&&g(N)&&(H=w(N),z^=1),new E(R,H,z)}return{seed:q,k2sig:ne}}const se={lowS:e.lowS,prehash:!1},Z={lowS:e.lowS,prehash:!1};function L(D,C,F=se){const{seed:Y,k2sig:k}=G(D,C,F),W=e;return uA(W.hash.outputLen,W.nByteLength,W.hmac)(Y,k)}l.BASE._setWindowSize(8);function K(D,C,F,Y=Z){var z;const k=D;C=Xt("msgHash",C),F=Xt("publicKey",F);const{lowS:W,prehash:te,format:ie}=Y;if(sp(Y),"strict"in Y)throw new Error("options.strict was renamed to lowS");if(ie!==void 0&&ie!=="compact"&&ie!=="der")throw new Error("format must be compact or der");const he=typeof k=="string"||Vs(k),J=!he&&!ie&&typeof k=="object"&&k!==null&&typeof k.r=="bigint"&&typeof k.s=="bigint";if(!he&&!J)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let fe,q;try{if(J&&(fe=new E(k.r,k.s)),he){try{ie!=="compact"&&(fe=E.fromDER(k))}catch(H){if(!(H instanceof Fr.Err))throw H}!fe&&ie!=="der"&&(fe=E.fromCompact(k))}q=l.fromHex(F)}catch{return!1}if(!fe||W&&fe.hasHighS())return!1;te&&(C=e.hash(C));const{r:j,s:ne}=fe,ae=P(C),S=u(ne),m=c(ae*S),b=c(j*S),R=(z=l.BASE.multiplyAndAddUnsafe(q,m,b))==null?void 0:z.toAffine();return R?c(R.x)===j:!1}return{CURVE:e,getPublicKey:x,getSharedSecret:T,sign:L,verify:K,ProjectivePoint:l,Signature:E,utils:I}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function hT(t){return{hash:t,hmac:(e,...r)=>Uy(t,e,L8(...r)),randomBytes:$8}}function dT(t,e){const r=n=>fT({...t,...hT(n)});return{...r(e),create:r}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Wy=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),op=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),pT=BigInt(0),gT=BigInt(1),fl=BigInt(2),ap=(t,e)=>(t+e/fl)/e;function yT(t){const e=Wy,r=BigInt(3),n=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=t*t*t%e,l=u*u*t%e,f=Ht(l,r,e)*l%e,h=Ht(f,r,e)*l%e,p=Ht(h,fl,e)*u%e,g=Ht(p,i,e)*p%e,w=Ht(g,s,e)*g%e,v=Ht(w,a,e)*w%e,E=Ht(v,c,e)*v%e,I=Ht(E,a,e)*w%e,x=Ht(I,r,e)*l%e,A=Ht(x,o,e)*g%e,T=Ht(A,n,e)*u%e,O=Ht(T,fl,e);if(!hl.eql(hl.sqr(O),t))throw new Error("Cannot find square root");return O}const hl=Uf(Wy,void 0,void 0,{sqrt:yT}),wT=dT({a:pT,b:BigInt(7),Fp:hl,n:op,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=op,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-gT*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,o=BigInt("0x100000000000000000000000000000000"),a=ap(s*t,e),c=ap(-n*t,e);let u=Bt(t-a*r-c*i,e),l=Bt(-a*n-c*s,e);const f=u>o,h=l>o;if(f&&(u=e-u),h&&(l=e-l),u>o||l>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:f,k1:u,k2neg:h,k2:l}}}},oA);function mT(t){if(t.length!==130&&t.length!==132)throw new ET({signature:t});const e=BigInt(Mr(t,0,32)),r=BigInt(Mr(t,32,64)),n=(()=>{const i=+`0x${t.slice(130)}`;if(!Number.isNaN(i))try{return bT(i)}catch{throw new vT({value:i})}})();return typeof n>"u"?{r:e,s:r}:{r:e,s:r,yParity:n}}function bT(t){if(t===0||t===27)return 0;if(t===1||t===28)return 1;if(t>=35)return t%2===0?1:0;throw new _T({value:t})}class ET extends ze{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${In(Pf(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class vT extends ze{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class _T extends ze{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function xT(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Gy(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(r=>typeof r=="string"):e.every(r=>Number.isSafeInteger(r)):!1}function Ho(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function Lf(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function dl(t){if(!Array.isArray(t))throw new Error("array expected")}function Ko(t,e){if(!Gy(!0,e))throw new Error(`${t}: array of strings expected`)}function ST(t,e){if(!Gy(!1,e))throw new Error(`${t}: array of numbers expected`)}function IT(...t){const e=s=>s,r=(s,o)=>a=>s(o(a)),n=t.map(s=>s.encode).reduceRight(r,e),i=t.map(s=>s.decode).reduce(r,e);return{encode:n,decode:i}}function AT(t){const e=typeof t=="string"?t.split(""):t,r=e.length;Ko("alphabet",e);const n=new Map(e.map((i,s)=>[i,s]));return{encode:i=>(dl(i),i.map(s=>{if(!Number.isSafeInteger(s)||s<0||s>=r)throw new Error(`alphabet.encode: digit index outside alphabet "${s}". Allowed: ${t}`);return e[s]})),decode:i=>(dl(i),i.map(s=>{Ho("alphabet.decode",s);const o=n.get(s);if(o===void 0)throw new Error(`Unknown letter: "${s}". Allowed: ${t}`);return o}))}}function TT(t=""){return Ho("join",t),{encode:e=>(Ko("join.decode",e),e.join(t)),decode:e=>(Ho("join.decode",e),e.split(t))}}function OT(t,e="="){return Lf(t),Ho("padding",e),{encode(r){for(Ko("padding.encode",r);r.length*t%8;)r.push(e);return r},decode(r){Ko("padding.decode",r);let n=r.length;if(n*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;n>0&&r[n-1]===e;n--)if((n-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return r.slice(0,n)}}}const Yy=(t,e)=>e===0?t:Yy(e,t%e),Wo=(t,e)=>t+(e-Yy(t,e)),Eu=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function cp(t,e,r,n){if(dl(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(Wo(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${Wo(e,r)}`);let i=0,s=0;const o=Eu[e],a=Eu[r]-1,c=[];for(const u of t){if(Lf(u),u>=o)throw new Error(`convertRadix2: invalid data word=${u} from=${e}`);if(i=i<<e|u,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=r;s-=r)c.push((i>>s-r&a)>>>0);const l=Eu[s];if(l===void 0)throw new Error("invalid carry");i&=l-1}if(i=i<<r-s&a,!n&&s>=e)throw new Error("Excess padding");if(!n&&i>0)throw new Error(`Non-zero padding: ${i}`);return n&&s>0&&c.push(i>>>0),c}function CT(t,e=!1){if(Lf(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Wo(8,t)>32||Wo(t,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!xT(r))throw new Error("radix2.encode input should be Uint8Array");return cp(Array.from(r),8,t,!e)},decode:r=>(ST("radix2.decode",r),Uint8Array.from(cp(r,t,8,e)))}}const DT=IT(CT(5),AT("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),OT(5),TT(""));function BT(t){return HA(RT(t))}function RT(t){const{payload:e,signature:r}=t,{r:n,s:i,yParity:s}=r,a=new wT.Signature(BigInt(n),BigInt(i)).addRecoveryBit(s).recoverPublicKey(Pf(e).substring(2));return LA(a)}function NT(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let u=0;u<e.length;u++)e[u]=255;for(let u=0;u<t.length;u++){const l=t.charAt(u),f=l.charCodeAt(0);if(e[f]!==255)throw new TypeError(l+" is ambiguous");e[f]=u}const r=t.length,n=t.charAt(0),i=Math.log(r)/Math.log(256),s=Math.log(256)/Math.log(r);function o(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";let l=0,f=0,h=0;const p=u.length;for(;h!==p&&u[h]===0;)h++,l++;const g=(p-h)*s+1>>>0,w=new Uint8Array(g);for(;h!==p;){let I=u[h],x=0;for(let A=g-1;(I!==0||x<f)&&A!==-1;A--,x++)I+=256*w[A]>>>0,w[A]=I%r>>>0,I=I/r>>>0;if(I!==0)throw new Error("Non-zero carry");f=x,h++}let v=g-f;for(;v!==g&&w[v]===0;)v++;let E=n.repeat(l);for(;v<g;++v)E+=t.charAt(w[v]);return E}function a(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;let l=0,f=0,h=0;for(;u[l]===n;)f++,l++;const p=(u.length-l)*i+1>>>0,g=new Uint8Array(p);for(;l<u.length;){const I=u.charCodeAt(l);if(I>255)return;let x=e[I];if(x===255)return;let A=0;for(let T=p-1;(x!==0||A<h)&&T!==-1;T--,A++)x+=r*g[T]>>>0,g[T]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");h=A,l++}let w=p-h;for(;w!==p&&g[w]===0;)w++;const v=new Uint8Array(f+(p-w));let E=f;for(;w!==p;)v[E++]=g[w++];return v}function c(u){const l=a(u);if(l)return l;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var PT="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const Ks=NT(PT);function UT(t){const e=t.length;let r=0,n=0;for(;n<e;){let i=t.charCodeAt(n++);if(i&4294967168)if(!(i&4294965248))r+=2;else{if(i>=55296&&i<=56319&&n<e){const s=t.charCodeAt(n);(s&64512)===56320&&(++n,i=((i&1023)<<10)+(s&1023)+65536)}i&4294901760?r+=4:r+=3}else{r++;continue}}return r}function LT(t,e,r){const n=t.length;let i=r,s=0;for(;s<n;){let o=t.charCodeAt(s++);if(o&4294967168)if(!(o&4294965248))e[i++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&s<n){const a=t.charCodeAt(s);(a&64512)===56320&&(++s,o=((o&1023)<<10)+(a&1023)+65536)}o&4294901760?(e[i++]=o>>18&7|240,e[i++]=o>>12&63|128,e[i++]=o>>6&63|128):(e[i++]=o>>12&15|224,e[i++]=o>>6&63|128)}else{e[i++]=o;continue}e[i++]=o&63|128}}const $T=new TextEncoder,MT=50;function FT(t,e,r){$T.encodeInto(t,e.subarray(r))}function kT(t,e,r){t.length>MT?FT(t,e,r):LT(t,e,r)}const jT=4096;function Xy(t,e,r){let n=e;const i=n+r,s=[];let o="";for(;n<i;){const a=t[n++];if(!(a&128))s.push(a);else if((a&224)===192){const c=t[n++]&63;s.push((a&31)<<6|c)}else if((a&240)===224){const c=t[n++]&63,u=t[n++]&63;s.push((a&31)<<12|c<<6|u)}else if((a&248)===240){const c=t[n++]&63,u=t[n++]&63,l=t[n++]&63;let f=(a&7)<<18|c<<12|u<<6|l;f>65535&&(f-=65536,s.push(f>>>10&1023|55296),f=56320|f&1023),s.push(f)}else s.push(a);s.length>=jT&&(o+=String.fromCharCode(...s),s.length=0)}return s.length>0&&(o+=String.fromCharCode(...s)),o}const qT=new TextDecoder,zT=200;function VT(t,e,r){const n=t.subarray(e,e+r);return qT.decode(n)}function HT(t,e,r){return r>zT?VT(t,e,r):Xy(t,e,r)}class po{constructor(e,r){this.type=e,this.data=r}}class Ft extends Error{constructor(e){super(e);const r=Object.create(Ft.prototype);Object.setPrototypeOf(this,r),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:Ft.name})}}const Qi=4294967295;function KT(t,e,r){const n=r/4294967296,i=r;t.setUint32(e,n),t.setUint32(e+4,i)}function Zy(t,e,r){const n=Math.floor(r/4294967296),i=r;t.setUint32(e,n),t.setUint32(e+4,i)}function Jy(t,e){const r=t.getInt32(e),n=t.getUint32(e+4);return r*4294967296+n}function WT(t,e){const r=t.getUint32(e),n=t.getUint32(e+4);return r*4294967296+n}const GT=-1,YT=4294967296-1,XT=17179869184-1;function ZT({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=XT)if(e===0&&t<=YT){const r=new Uint8Array(4);return new DataView(r.buffer).setUint32(0,t),r}else{const r=t/4294967296,n=t&4294967295,i=new Uint8Array(8),s=new DataView(i.buffer);return s.setUint32(0,e<<2|r&3),s.setUint32(4,n),i}else{const r=new Uint8Array(12),n=new DataView(r.buffer);return n.setUint32(0,e),Zy(n,4,t),r}}function JT(t){const e=t.getTime(),r=Math.floor(e/1e3),n=(e-r*1e3)*1e6,i=Math.floor(n/1e9);return{sec:r+i,nsec:n-i*1e9}}function QT(t){if(t instanceof Date){const e=JT(t);return ZT(e)}else return null}function eO(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const r=e.getUint32(0),n=e.getUint32(4),i=(r&3)*4294967296+n,s=r>>>2;return{sec:i,nsec:s}}case 12:{const r=Jy(e,4),n=e.getUint32(0);return{sec:r,nsec:n}}default:throw new Ft(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function tO(t){const e=eO(t);return new Date(e.sec*1e3+e.nsec/1e6)}const rO={type:GT,encode:QT,decode:tO};class Go{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(rO)}register({type:e,encode:r,decode:n}){if(e>=0)this.encoders[e]=r,this.decoders[e]=n;else{const i=-1-e;this.builtInEncoders[i]=r,this.builtInDecoders[i]=n}}tryToEncode(e,r){for(let n=0;n<this.builtInEncoders.length;n++){const i=this.builtInEncoders[n];if(i!=null){const s=i(e,r);if(s!=null){const o=-1-n;return new po(o,s)}}}for(let n=0;n<this.encoders.length;n++){const i=this.encoders[n];if(i!=null){const s=i(e,r);if(s!=null){const o=n;return new po(o,s)}}}return e instanceof po?e:null}decode(e,r,n){const i=r<0?this.builtInDecoders[-1-r]:this.decoders[r];return i?i(e,r,n):new po(r,e)}}Go.defaultCodec=new Go;function nO(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function pl(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):nO(t)?new Uint8Array(t):Uint8Array.from(t)}const iO=100,sO=2048;let oO=class Qy{constructor(e){this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??Go.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.maxDepth=(e==null?void 0:e.maxDepth)??iO,this.initialBufferSize=(e==null?void 0:e.initialBufferSize)??sO,this.sortKeys=(e==null?void 0:e.sortKeys)??!1,this.forceFloat32=(e==null?void 0:e.forceFloat32)??!1,this.ignoreUndefined=(e==null?void 0:e.ignoreUndefined)??!1,this.forceIntegerToFloat=(e==null?void 0:e.forceIntegerToFloat)??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new Qy({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,r){if(r>this.maxDepth)throw new Error(`Too deep objects in depth ${r}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,r)}ensureBufferSizeToWrite(e){const r=this.pos+e;this.view.byteLength<r&&this.resizeBuffer(r*2)}resizeBuffer(e){const r=new ArrayBuffer(e),n=new Uint8Array(r),i=new DataView(r);n.set(this.bytes),this.view=i,this.bytes=n}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const n=UT(e);this.ensureBufferSizeToWrite(5+n),this.writeStringHeader(n),kT(e,this.bytes,this.pos),this.pos+=n}encodeObject(e,r){const n=this.extensionCodec.tryToEncode(e,this.context);if(n!=null)this.encodeExtension(n);else if(Array.isArray(e))this.encodeArray(e,r);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,r);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const r=e.byteLength;if(r<256)this.writeU8(196),this.writeU8(r);else if(r<65536)this.writeU8(197),this.writeU16(r);else if(r<4294967296)this.writeU8(198),this.writeU32(r);else throw new Error(`Too large binary: ${r}`);const n=pl(e);this.writeU8a(n)}encodeArray(e,r){const n=e.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else if(n<4294967296)this.writeU8(221),this.writeU32(n);else throw new Error(`Too large array: ${n}`);for(const i of e)this.doEncode(i,r+1)}countWithoutUndefined(e,r){let n=0;for(const i of r)e[i]!==void 0&&n++;return n}encodeMap(e,r){const n=Object.keys(e);this.sortKeys&&n.sort();const i=this.ignoreUndefined?this.countWithoutUndefined(e,n):n.length;if(i<16)this.writeU8(128+i);else if(i<65536)this.writeU8(222),this.writeU16(i);else if(i<4294967296)this.writeU8(223),this.writeU32(i);else throw new Error(`Too large map object: ${i}`);for(const s of n){const o=e[s];this.ignoreUndefined&&o===void 0||(this.encodeString(s),this.doEncode(o,r+1))}}encodeExtension(e){if(typeof e.data=="function"){const n=e.data(this.pos+6),i=n.length;if(i>=4294967296)throw new Error(`Too large extension object: ${i}`);this.writeU8(201),this.writeU32(i),this.writeI8(e.type),this.writeU8a(n);return}const r=e.data.length;if(r===1)this.writeU8(212);else if(r===2)this.writeU8(213);else if(r===4)this.writeU8(214);else if(r===8)this.writeU8(215);else if(r===16)this.writeU8(216);else if(r<256)this.writeU8(199),this.writeU8(r);else if(r<65536)this.writeU8(200),this.writeU16(r);else if(r<4294967296)this.writeU8(201),this.writeU32(r);else throw new Error(`Too large extension object: ${r}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const r=e.length;this.ensureBufferSizeToWrite(r),this.bytes.set(e,this.pos),this.pos+=r}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),KT(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),Zy(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function aO(t,e){return new oO(e).encodeSharedRef(t)}function vu(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const cO=16,uO=16;class lO{constructor(e=cO,r=uO){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=r,this.caches=[];for(let n=0;n<this.maxKeyLength;n++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,r,n){const i=this.caches[n-1];e:for(const s of i){const o=s.bytes;for(let a=0;a<n;a++)if(o[a]!==e[r+a])continue e;return s.str}return null}store(e,r){const n=this.caches[e.length-1],i={bytes:e,str:r};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=i:n.push(i)}decode(e,r,n){const i=this.find(e,r,n);if(i!=null)return this.hit++,i;this.miss++;const s=Xy(e,r,n),o=Uint8Array.prototype.slice.call(e,r,r+n);return this.store(o,s),s}}const gl="array",ys="map_key",ew="map_value",fO=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new Ft("The type of key must be string or number but "+typeof t)};class hO{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const r=this.getUninitializedStateFromPool();r.type=gl,r.position=0,r.size=e,r.array=new Array(e)}pushMapState(e){const r=this.getUninitializedStateFromPool();r.type=ys,r.readCount=0,r.size=e,r.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===gl){const n=e;n.size=0,n.array=void 0,n.position=0,n.type=void 0}if(e.type===ys||e.type===ew){const n=e;n.size=0,n.map=void 0,n.readCount=0,n.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const es=-1,$f=new DataView(new ArrayBuffer(0)),dO=new Uint8Array($f.buffer);try{$f.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const up=new RangeError("Insufficient data"),pO=new lO;let gO=class tw{constructor(e){this.totalPos=0,this.pos=0,this.view=$f,this.bytes=dO,this.headByte=es,this.stack=new hO,this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??Go.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.rawStrings=(e==null?void 0:e.rawStrings)??!1,this.maxStrLength=(e==null?void 0:e.maxStrLength)??Qi,this.maxBinLength=(e==null?void 0:e.maxBinLength)??Qi,this.maxArrayLength=(e==null?void 0:e.maxArrayLength)??Qi,this.maxMapLength=(e==null?void 0:e.maxMapLength)??Qi,this.maxExtLength=(e==null?void 0:e.maxExtLength)??Qi,this.keyDecoder=(e==null?void 0:e.keyDecoder)!==void 0?e.keyDecoder:pO,this.mapKeyConverter=(e==null?void 0:e.mapKeyConverter)??fO}clone(){return new tw({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=es,this.stack.reset()}setBuffer(e){const r=pl(e);this.bytes=r,this.view=new DataView(r.buffer,r.byteOffset,r.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===es&&!this.hasRemaining(1))this.setBuffer(e);else{const r=this.bytes.subarray(this.pos),n=pl(e),i=new Uint8Array(r.length+n.length);i.set(r),i.set(n,r.length),this.setBuffer(i)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:r,pos:n}=this;return new RangeError(`Extra ${r.byteLength-n} of ${r.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const r=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return r}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let r=!1,n;for await(const a of e){if(r)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{n=this.doDecodeSync(),r=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(r){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return n}const{headByte:i,pos:s,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${vu(i)} at ${o} (${s} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,r){if(this.entered){yield*this.clone().decodeMultiAsync(e,r);return}try{this.entered=!0;let n=r,i=-1;for await(const s of e){if(r&&i===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s),n&&(i=this.readArraySize(),n=!1,this.complete());try{for(;yield this.doDecodeSync(),--i!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let r;if(e>=224)r=e-256;else if(e<192)if(e<128)r=e;else if(e<144){const i=e-128;if(i!==0){this.pushMapState(i),this.complete();continue e}else r={}}else if(e<160){const i=e-144;if(i!==0){this.pushArrayState(i),this.complete();continue e}else r=[]}else{const i=e-160;r=this.decodeString(i,0)}else if(e===192)r=null;else if(e===194)r=!1;else if(e===195)r=!0;else if(e===202)r=this.readF32();else if(e===203)r=this.readF64();else if(e===204)r=this.readU8();else if(e===205)r=this.readU16();else if(e===206)r=this.readU32();else if(e===207)this.useBigInt64?r=this.readU64AsBigInt():r=this.readU64();else if(e===208)r=this.readI8();else if(e===209)r=this.readI16();else if(e===210)r=this.readI32();else if(e===211)this.useBigInt64?r=this.readI64AsBigInt():r=this.readI64();else if(e===217){const i=this.lookU8();r=this.decodeString(i,1)}else if(e===218){const i=this.lookU16();r=this.decodeString(i,2)}else if(e===219){const i=this.lookU32();r=this.decodeString(i,4)}else if(e===220){const i=this.readU16();if(i!==0){this.pushArrayState(i),this.complete();continue e}else r=[]}else if(e===221){const i=this.readU32();if(i!==0){this.pushArrayState(i),this.complete();continue e}else r=[]}else if(e===222){const i=this.readU16();if(i!==0){this.pushMapState(i),this.complete();continue e}else r={}}else if(e===223){const i=this.readU32();if(i!==0){this.pushMapState(i),this.complete();continue e}else r={}}else if(e===196){const i=this.lookU8();r=this.decodeBinary(i,1)}else if(e===197){const i=this.lookU16();r=this.decodeBinary(i,2)}else if(e===198){const i=this.lookU32();r=this.decodeBinary(i,4)}else if(e===212)r=this.decodeExtension(1,0);else if(e===213)r=this.decodeExtension(2,0);else if(e===214)r=this.decodeExtension(4,0);else if(e===215)r=this.decodeExtension(8,0);else if(e===216)r=this.decodeExtension(16,0);else if(e===199){const i=this.lookU8();r=this.decodeExtension(i,1)}else if(e===200){const i=this.lookU16();r=this.decodeExtension(i,2)}else if(e===201){const i=this.lookU32();r=this.decodeExtension(i,4)}else throw new Ft(`Unrecognized type byte: ${vu(e)}`);this.complete();const n=this.stack;for(;n.length>0;){const i=n.top();if(i.type===gl)if(i.array[i.position]=r,i.position++,i.position===i.size)r=i.array,n.release(i);else continue e;else if(i.type===ys){if(r==="__proto__")throw new Ft("The key __proto__ is not allowed");i.key=this.mapKeyConverter(r),i.type=ew;continue e}else if(i.map[i.key]=r,i.readCount++,i.readCount===i.size)r=i.map,n.release(i);else{i.key=null,i.type=ys;continue e}}return r}}readHeadByte(){return this.headByte===es&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=es}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new Ft(`Unrecognized array type byte: ${vu(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new Ft(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new Ft(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,r){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,r):this.decodeBinary(e,r)}decodeUtf8String(e,r){var s;if(e>this.maxStrLength)throw new Ft(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+r+e)throw up;const n=this.pos+r;let i;return this.stateIsMapKey()&&((s=this.keyDecoder)!=null&&s.canBeCached(e))?i=this.keyDecoder.decode(this.bytes,n,e):i=HT(this.bytes,n,e),this.pos+=r+e,i}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===ys:!1}decodeBinary(e,r){if(e>this.maxBinLength)throw new Ft(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+r))throw up;const n=this.pos+r,i=this.bytes.subarray(n,n+e);return this.pos+=r+e,i}decodeExtension(e,r){if(e>this.maxExtLength)throw new Ft(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const n=this.view.getInt8(this.pos+r),i=this.decodeBinary(e,r+1);return this.extensionCodec.decode(i,n,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=WT(this.view,this.pos);return this.pos+=8,e}readI64(){const e=Jy(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function yO(t,e){return new gO(e).decode(t)}function Mf(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function rw(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Mf(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function ws(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const r=rw(e);let n=0;for(const i of t)r.set(i,n),n+=i.length;return Mf(r)}function wO(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function f(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var w=0,v=0,E=0,I=g.length;E!==I&&g[E]===0;)E++,w++;for(var x=(I-E)*l+1>>>0,A=new Uint8Array(x);E!==I;){for(var T=g[E],O=0,P=x-1;(T!==0||O<v)&&P!==-1;P--,O++)T+=256*A[P]>>>0,A[P]=T%a>>>0,T=T/a>>>0;if(T!==0)throw new Error("Non-zero carry");v=O,E++}for(var M=x-v;M!==x&&A[M]===0;)M++;for(var U=c.repeat(w);M<x;++M)U+=t.charAt(A[M]);return U}function h(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var w=0;if(g[w]!==" "){for(var v=0,E=0;g[w]===c;)v++,w++;for(var I=(g.length-w)*u+1>>>0,x=new Uint8Array(I);g[w];){var A=r[g.charCodeAt(w)];if(A===255)return;for(var T=0,O=I-1;(A!==0||T<E)&&O!==-1;O--,T++)A+=a*x[O]>>>0,x[O]=A%256>>>0,A=A/256>>>0;if(A!==0)throw new Error("Non-zero carry");E=T,w++}if(g[w]!==" "){for(var P=I-E;P!==I&&x[P]===0;)P++;for(var M=new Uint8Array(v+(I-P)),U=v;P!==I;)M[U++]=x[P++];return M}}}function p(g){var w=h(g);if(w)return w;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:h,decode:p}}var mO=wO,bO=mO;const EO=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},vO=t=>new TextEncoder().encode(t),_O=t=>new TextDecoder().decode(t);class xO{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class SO{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return nw(this,e)}}class IO{constructor(e){this.decoders=e}or(e){return nw(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const nw=(t,e)=>new IO({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class AO{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new xO(e,r,n),this.decoder=new SO(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Aa=({name:t,prefix:e,encode:r,decode:n})=>new AO(t,e,r,n),Ws=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=bO(r,e);return Aa({prefix:t,name:e,encode:n,decode:s=>EO(i(s))})},TO=(t,e,r,n)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const f=i[t[l]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|f,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},OO=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},ht=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>Aa({prefix:e,name:t,encode(i){return OO(i,n,r)},decode(i){return TO(i,n,r,t)}}),CO=Aa({prefix:"\0",name:"identity",encode:t=>_O(t),decode:t=>vO(t)}),DO=Object.freeze(Object.defineProperty({__proto__:null,identity:CO},Symbol.toStringTag,{value:"Module"})),BO=ht({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),RO=Object.freeze(Object.defineProperty({__proto__:null,base2:BO},Symbol.toStringTag,{value:"Module"})),NO=ht({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),PO=Object.freeze(Object.defineProperty({__proto__:null,base8:NO},Symbol.toStringTag,{value:"Module"})),UO=Ws({prefix:"9",name:"base10",alphabet:"0123456789"}),LO=Object.freeze(Object.defineProperty({__proto__:null,base10:UO},Symbol.toStringTag,{value:"Module"})),$O=ht({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),MO=ht({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),FO=Object.freeze(Object.defineProperty({__proto__:null,base16:$O,base16upper:MO},Symbol.toStringTag,{value:"Module"})),kO=ht({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),jO=ht({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),qO=ht({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),zO=ht({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),VO=ht({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),HO=ht({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),KO=ht({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),WO=ht({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),GO=ht({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),YO=Object.freeze(Object.defineProperty({__proto__:null,base32:kO,base32hex:VO,base32hexpad:KO,base32hexpadupper:WO,base32hexupper:HO,base32pad:qO,base32padupper:zO,base32upper:jO,base32z:GO},Symbol.toStringTag,{value:"Module"})),XO=Ws({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ZO=Ws({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),JO=Object.freeze(Object.defineProperty({__proto__:null,base36:XO,base36upper:ZO},Symbol.toStringTag,{value:"Module"})),QO=Ws({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),eC=Ws({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),tC=Object.freeze(Object.defineProperty({__proto__:null,base58btc:QO,base58flickr:eC},Symbol.toStringTag,{value:"Module"})),rC=ht({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),nC=ht({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),iC=ht({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),sC=ht({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),oC=Object.freeze(Object.defineProperty({__proto__:null,base64:rC,base64pad:nC,base64url:iC,base64urlpad:sC},Symbol.toStringTag,{value:"Module"})),iw=Array.from(""),aC=iw.reduce((t,e,r)=>(t[r]=e,t),[]),cC=iw.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function uC(t){return t.reduce((e,r)=>(e+=aC[r],e),"")}function lC(t){const e=[];for(const r of t){const n=cC[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const fC=Aa({prefix:"",name:"base256emoji",encode:uC,decode:lC}),hC=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:fC},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const lp={...DO,...RO,...PO,...LO,...FO,...YO,...JO,...tC,...oC,...hC};function sw(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const fp=sw("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),_u=sw("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=rw(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),ow={utf8:fp,"utf-8":fp,hex:lp.base16,latin1:_u,ascii:_u,binary:_u,...lp};function Jt(t,e="utf8"){const r=ow[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Mf(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Ut(t,e="utf8"){const r=ow[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}const dC={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}},pC="Input must be an string, Buffer or Uint8Array";function gC(t){let e;if(t instanceof Uint8Array)e=t;else if(typeof t=="string")e=new TextEncoder().encode(t);else throw new Error(pC);return e}function yC(t){return Array.prototype.map.call(t,function(e){return(e<16?"0":"")+e.toString(16)}).join("")}function go(t){return(4294967296+t).toString(16).substring(1)}function wC(t,e,r){let n=`
`+t+" = ";for(let i=0;i<e.length;i+=2){if(r===32)n+=go(e[i]).toUpperCase(),n+=" ",n+=go(e[i+1]).toUpperCase();else if(r===64)n+=go(e[i+1]).toUpperCase(),n+=go(e[i]).toUpperCase();else throw new Error("Invalid size "+r);i%6===4?n+=`
`+new Array(t.length+4).join(" "):i<e.length-2&&(n+=" ")}console.log(n)}function mC(t,e,r){let n=new Date().getTime();const i=new Uint8Array(e);for(let o=0;o<e;o++)i[o]=o%256;const s=new Date().getTime();console.log("Generated random input in "+(s-n)+"ms"),n=s;for(let o=0;o<r;o++){const a=t(i),c=new Date().getTime(),u=c-n;n=c,console.log("Hashed in "+u+"ms: "+a.substring(0,20)+"..."),console.log(Math.round(e/(1<<20)/(u/1e3)*100)/100+" MB PER SECOND")}}var aw={normalizeInput:gC,toHex:yC,debugPrint:wC,testSpeed:mC};const Co=aw;function yo(t,e,r){const n=t[e]+t[r];let i=t[e+1]+t[r+1];n>=4294967296&&i++,t[e]=n,t[e+1]=i}function hp(t,e,r,n){let i=t[e]+r;r<0&&(i+=4294967296);let s=t[e+1]+n;i>=4294967296&&s++,t[e]=i,t[e+1]=s}function cw(t,e){return t[e]^t[e+1]<<8^t[e+2]<<16^t[e+3]<<24}function nn(t,e,r,n,i,s){const o=us[i],a=us[i+1],c=us[s],u=us[s+1];yo(Ie,t,e),hp(Ie,t,o,a);let l=Ie[n]^Ie[t],f=Ie[n+1]^Ie[t+1];Ie[n]=f,Ie[n+1]=l,yo(Ie,r,n),l=Ie[e]^Ie[r],f=Ie[e+1]^Ie[r+1],Ie[e]=l>>>24^f<<8,Ie[e+1]=f>>>24^l<<8,yo(Ie,t,e),hp(Ie,t,c,u),l=Ie[n]^Ie[t],f=Ie[n+1]^Ie[t+1],Ie[n]=l>>>16^f<<16,Ie[n+1]=f>>>16^l<<16,yo(Ie,r,n),l=Ie[e]^Ie[r],f=Ie[e+1]^Ie[r+1],Ie[e]=f>>>31^l<<1,Ie[e+1]=l>>>31^f<<1}const uw=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),bC=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],pt=new Uint8Array(bC.map(function(t){return t*2})),Ie=new Uint32Array(32),us=new Uint32Array(32);function lw(t,e){let r=0;for(r=0;r<16;r++)Ie[r]=t.h[r],Ie[r+16]=uw[r];for(Ie[24]=Ie[24]^t.t,Ie[25]=Ie[25]^t.t/4294967296,e&&(Ie[28]=~Ie[28],Ie[29]=~Ie[29]),r=0;r<32;r++)us[r]=cw(t.b,4*r);for(r=0;r<12;r++)nn(0,8,16,24,pt[r*16+0],pt[r*16+1]),nn(2,10,18,26,pt[r*16+2],pt[r*16+3]),nn(4,12,20,28,pt[r*16+4],pt[r*16+5]),nn(6,14,22,30,pt[r*16+6],pt[r*16+7]),nn(0,10,20,30,pt[r*16+8],pt[r*16+9]),nn(2,12,22,24,pt[r*16+10],pt[r*16+11]),nn(4,14,16,26,pt[r*16+12],pt[r*16+13]),nn(6,8,18,28,pt[r*16+14],pt[r*16+15]);for(r=0;r<16;r++)t.h[r]=t.h[r]^Ie[r]^Ie[r+16]}const sn=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function fw(t,e,r,n){if(t===0||t>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(e&&e.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(r&&r.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(n&&n.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const i={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:t};sn.fill(0),sn[0]=t,e&&(sn[1]=e.length),sn[2]=1,sn[3]=1,r&&sn.set(r,32),n&&sn.set(n,48);for(let s=0;s<16;s++)i.h[s]=uw[s]^cw(sn,s*4);return e&&(Ff(i,e),i.c=128),i}function Ff(t,e){for(let r=0;r<e.length;r++)t.c===128&&(t.t+=t.c,lw(t,!1),t.c=0),t.b[t.c++]=e[r]}function hw(t){for(t.t+=t.c;t.c<128;)t.b[t.c++]=0;lw(t,!0);const e=new Uint8Array(t.outlen);for(let r=0;r<t.outlen;r++)e[r]=t.h[r>>2]>>8*(r&3);return e}function dw(t,e,r,n,i){r=r||64,t=Co.normalizeInput(t),n&&(n=Co.normalizeInput(n)),i&&(i=Co.normalizeInput(i));const s=fw(r,e,n,i);return Ff(s,t),hw(s)}function EC(t,e,r,n,i){const s=dw(t,e,r,n,i);return Co.toHex(s)}var vC={blake2b:dw,blake2bHex:EC,blake2bInit:fw,blake2bUpdate:Ff,blake2bFinal:hw};const pw=aw;function _C(t,e){return t[e]^t[e+1]<<8^t[e+2]<<16^t[e+3]<<24}function on(t,e,r,n,i,s){Pe[t]=Pe[t]+Pe[e]+i,Pe[n]=wo(Pe[n]^Pe[t],16),Pe[r]=Pe[r]+Pe[n],Pe[e]=wo(Pe[e]^Pe[r],12),Pe[t]=Pe[t]+Pe[e]+s,Pe[n]=wo(Pe[n]^Pe[t],8),Pe[r]=Pe[r]+Pe[n],Pe[e]=wo(Pe[e]^Pe[r],7)}function wo(t,e){return t>>>e^t<<32-e}const gw=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),gt=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),Pe=new Uint32Array(16),ct=new Uint32Array(16);function yw(t,e){let r=0;for(r=0;r<8;r++)Pe[r]=t.h[r],Pe[r+8]=gw[r];for(Pe[12]^=t.t,Pe[13]^=t.t/4294967296,e&&(Pe[14]=~Pe[14]),r=0;r<16;r++)ct[r]=_C(t.b,4*r);for(r=0;r<10;r++)on(0,4,8,12,ct[gt[r*16+0]],ct[gt[r*16+1]]),on(1,5,9,13,ct[gt[r*16+2]],ct[gt[r*16+3]]),on(2,6,10,14,ct[gt[r*16+4]],ct[gt[r*16+5]]),on(3,7,11,15,ct[gt[r*16+6]],ct[gt[r*16+7]]),on(0,5,10,15,ct[gt[r*16+8]],ct[gt[r*16+9]]),on(1,6,11,12,ct[gt[r*16+10]],ct[gt[r*16+11]]),on(2,7,8,13,ct[gt[r*16+12]],ct[gt[r*16+13]]),on(3,4,9,14,ct[gt[r*16+14]],ct[gt[r*16+15]]);for(r=0;r<8;r++)t.h[r]^=Pe[r]^Pe[r+8]}function ww(t,e){if(!(t>0&&t<=32))throw new Error("Incorrect output length, should be in [1, 32]");const r=e?e.length:0;if(e&&!(r>0&&r<=32))throw new Error("Incorrect key length, should be in [1, 32]");const n={h:new Uint32Array(gw),b:new Uint8Array(64),c:0,t:0,outlen:t};return n.h[0]^=16842752^r<<8^t,r>0&&(kf(n,e),n.c=64),n}function kf(t,e){for(let r=0;r<e.length;r++)t.c===64&&(t.t+=t.c,yw(t,!1),t.c=0),t.b[t.c++]=e[r]}function mw(t){for(t.t+=t.c;t.c<64;)t.b[t.c++]=0;yw(t,!0);const e=new Uint8Array(t.outlen);for(let r=0;r<t.outlen;r++)e[r]=t.h[r>>2]>>8*(r&3)&255;return e}function bw(t,e,r){r=r||32,t=pw.normalizeInput(t);const n=ww(r,e);return kf(n,t),mw(n)}function xC(t,e,r){const n=bw(t,e,r);return pw.toHex(n)}var SC={blake2s:bw,blake2sHex:xC,blake2sInit:ww,blake2sUpdate:kf,blake2sFinal:mw};const ts=vC,rs=SC;var IC={blake2b:ts.blake2b,blake2bHex:ts.blake2bHex,blake2bInit:ts.blake2bInit,blake2bUpdate:ts.blake2bUpdate,blake2bFinal:ts.blake2bFinal,blake2s:rs.blake2s,blake2sHex:rs.blake2sHex,blake2sInit:rs.blake2sInit,blake2sUpdate:rs.blake2sUpdate,blake2sFinal:rs.blake2sFinal},AC={};const Ta=":";function Ti(t){const[e,r]=t.split(Ta);return{namespace:e,reference:r}}function Ew(t){const{namespace:e,reference:r}=t;return[e,r].join(Ta)}function jf(t){const[e,r,n]=t.split(Ta);return{namespace:e,reference:r,address:n}}function vw(t){const{namespace:e,reference:r,address:n}=t;return[e,r,n].join(Ta)}function qf(t,e){const r=[];return t.forEach(n=>{const i=e(n);r.includes(i)||r.push(i)}),r}function _w(t){const{address:e}=jf(t);return e}function xw(t){const{namespace:e,reference:r}=jf(t);return Ew({namespace:e,reference:r})}function TC(t,e){const{namespace:r,reference:n}=Ti(e);return vw({namespace:r,reference:n,address:t})}function OC(t){return qf(t,_w)}function Sw(t){return qf(t,xw)}function CC(t,e=[]){const r=[];return Object.keys(t).forEach(n=>{if(e.length&&!e.includes(n))return;const i=t[n];r.push(...i.accounts)}),r}function DC(t,e=[]){const r=[];return Object.keys(t).forEach(n=>{if(e.length&&!e.includes(n))return;const i=t[n];r.push(...Sw(i.accounts))}),r}function BC(t,e=[]){const r=[];return Object.keys(t).forEach(n=>{if(e.length&&!e.includes(n))return;const i=t[n];r.push(...Oa(n,i))}),r}function Oa(t,e){return t.includes(":")?[t]:e.chains||[]}var RC=Object.defineProperty,NC=Object.defineProperties,PC=Object.getOwnPropertyDescriptors,dp=Object.getOwnPropertySymbols,UC=Object.prototype.hasOwnProperty,LC=Object.prototype.propertyIsEnumerable,yl=(t,e,r)=>e in t?RC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,pp=(t,e)=>{for(var r in e||(e={}))UC.call(e,r)&&yl(t,r,e[r]);if(dp)for(var r of dp(e))LC.call(e,r)&&yl(t,r,e[r]);return t},$C=(t,e)=>NC(t,PC(e)),gp=(t,e,r)=>yl(t,typeof e!="symbol"?e+"":e,r);const Iw="ReactNative",It={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Yo=" ",MC=":",Aw="/",zf=2,FC=1e3,Tw="js";function Rs(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Jr(){return!Xn()&&!!If()&&navigator.product===Iw}function Ow(){return Jr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function Cw(){return Jr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function ii(){return!Rs()&&!!If()&&!!Xn()}function si(){return Jr()?It.reactNative:Rs()?It.node:ii()?It.browser:It.unknown}function wl(){var t;try{return Jr()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function Dw(t,e){const r=new URLSearchParams(t);return Object.entries(e).sort(([n],[i])=>n.localeCompare(i)).forEach(([n,i])=>{i!=null&&r.set(n,String(i))}),r.toString()}function Bw(t){var e,r;const n=Vf();try{return t!=null&&t.url&&n.url&&new URL(t.url).host!==new URL(n.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${n.url}. This is probably unintended and can lead to issues.`),t.url=n.url),(e=t==null?void 0:t.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(i=>i!=="")),$C(pp(pp({},n),t),{url:(t==null?void 0:t.url)||n.url,name:(t==null?void 0:t.name)||n.name,description:(t==null?void 0:t.description)||n.description,icons:(r=t==null?void 0:t.icons)!=null&&r.length&&t.icons.length>0?t.icons:n.icons})}catch(i){return console.warn("Error populating app metadata",i),t||n}}function Vf(){return dy()||{name:"",description:"",url:"",icons:[""]}}function kC(t,e){var r;const n=si(),i={protocol:t,version:e,env:n};return n==="browser"&&(i.host=((r=Af())==null?void 0:r.host)||"unknown"),i}function Rw(){if(si()===It.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:n}=global.Platform;return[r,n].join("-")}const t=l8();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function Nw(){var t;const e=si();return e===It.browser?[e,((t=Af())==null?void 0:t.host)||"unknown"].join(":"):e}function Hf(t,e,r){const n=Rw(),i=Nw();return[[t,e].join("-"),[Tw,r].join("-"),n,i].join("/")}function Pw({protocol:t,version:e,relayUrl:r,sdkVersion:n,auth:i,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){const u=r.split("?"),l=Hf(t,e,n),f={auth:i,ua:l,projectId:s,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:a||void 0},h=Dw(u[1]||"",f);return u[0]+"?"+h}function jC(t){let e=(t.match(/^[^:]+(?=:\/\/)/gi)||[])[0];const r=typeof e<"u"?t.split("://")[1]:t;return e=e==="wss"?"https":"http",[e,r].join("://")}function qC(t,e,r){if(!t[e]||typeof t[e]!==r)throw new Error(`Missing or invalid "${e}" param`)}function Uw(t,e=zf){return Lw(t.split(Aw),e)}function zC(t){return Uw(t).join(Yo)}function vn(t,e){return t.filter(r=>e.includes(r)).length===t.length}function Lw(t,e=zf){return t.slice(Math.max(t.length-e,0))}function Xo(t){return Object.fromEntries(t.entries())}function Zo(t){return new Map(Object.entries(t))}function VC(t,e){const r={};return Object.keys(t).forEach(n=>{r[n]=e(t[n])}),r}const HC=t=>t;function $w(t){return t.trim().replace(/^\w/,e=>e.toUpperCase())}function KC(t){return t.split(Yo).map(e=>$w(e)).join(Yo)}function dn(t=pe.FIVE_MINUTES,e){const r=pe.toMiliseconds(t||pe.FIVE_MINUTES);let n,i,s,o;return{resolve:a=>{s&&n&&(clearTimeout(s),n(a),o=Promise.resolve(a))},reject:a=>{s&&i&&(clearTimeout(s),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{const u=new Error(e);o=Promise.reject(u),c(u)},r),n=a,i=c})}}function ur(t,e,r){return new Promise(async(n,i)=>{const s=setTimeout(()=>i(new Error(r)),e);try{const o=await t;n(o)}catch(o){i(o)}clearTimeout(s)})}function Kf(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function Mw(t){return Kf("topic",t)}function Fw(t){return Kf("id",t)}function Wf(t){const[e,r]=t.split(":"),n={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")n.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))n.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return n}function Xe(t,e){return pe.fromMiliseconds((e||Date.now())+pe.toMiliseconds(t))}function kr(t){return Date.now()>=pe.toMiliseconds(t)}function Le(t,e){return`${t}${e?`:${e}`:""}`}function Qt(t=[],e=[]){return[...new Set([...t,...e])]}async function kw({id:t,topic:e,wcDeepLink:r}){var n;try{if(!r)return;const i=typeof r=="string"?JSON.parse(r):r,s=i==null?void 0:i.href;if(typeof s!="string")return;const o=jw(s,t,e),a=si();if(a===It.browser){if(!((n=Xn())!=null&&n.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}qw(o)}else a===It.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(i){console.error(i)}}function jw(t,e,r){const n=`requestId=${e}&sessionTopic=${r}`;t.endsWith("/")&&(t=t.slice(0,-1));let i=`${t}`;if(t.startsWith("https://t.me")){const s=t.includes("?")?"&startapp=":"?startapp=";i=`${i}${s}${Kw(n,!0)}`}else i=`${i}/wc?${n}`;return i}function qw(t){let e="_self";Hw()?e="_top":(Vw()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function zw(t,e){let r="";try{if(ii()&&(r=localStorage.getItem(e),r))return r;r=await t.getItem(e)}catch(n){console.error(n)}return r}function ml(t,e){return t.filter(r=>e.includes(r))}function bl(t,e){if(!t.includes(e))return null;const r=t.split(/([&,?,=])/),n=r.indexOf(e);return r[n+2]}function El(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function Ca(){return typeof process<"u"&&AC.IS_VITEST==="true"}function Vw(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function Hw(){try{return window.self!==window.top}catch{return!1}}function Kw(t,e=!1){const r=Buffer.from(t).toString("base64");return e?r.replace(/[=]/g,""):r}function Gf(t){return Buffer.from(t,"base64").toString("utf-8")}function Ww(t){return new Promise(e=>setTimeout(e,t))}let Gw=class{constructor({limit:e}){gp(this,"limit"),gp(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const r=this.set.values().next().value;r&&this.set.delete(r)}this.set.add(e)}}has(e){return this.set.has(e)}};const mo=BigInt(2**32-1),yp=BigInt(32);function Yw(t,e=!1){return e?{h:Number(t&mo),l:Number(t>>yp&mo)}:{h:Number(t>>yp&mo)|0,l:Number(t&mo)|0}}function Xw(t,e=!1){const r=t.length;let n=new Uint32Array(r),i=new Uint32Array(r);for(let s=0;s<r;s++){const{h:o,l:a}=Yw(t[s],e);[n[s],i[s]]=[o,a]}return[n,i]}const wp=(t,e,r)=>t>>>r,mp=(t,e,r)=>t<<32-r|e>>>r,pn=(t,e,r)=>t>>>r|e<<32-r,gn=(t,e,r)=>t<<32-r|e>>>r,ls=(t,e,r)=>t<<64-r|e>>>r-32,fs=(t,e,r)=>t>>>r-32|e<<64-r,WC=(t,e)=>e,GC=(t,e)=>t,YC=(t,e,r)=>t<<r|e>>>32-r,XC=(t,e,r)=>e<<r|t>>>32-r,ZC=(t,e,r)=>e<<r-32|t>>>64-r,JC=(t,e,r)=>t<<r-32|e>>>64-r;function cr(t,e,r,n){const i=(e>>>0)+(n>>>0);return{h:t+r+(i/2**32|0)|0,l:i|0}}const Yf=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),Xf=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,QC=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),e4=(t,e,r,n,i)=>e+r+n+i+(t/2**32|0)|0,t4=(t,e,r,n,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(i>>>0),r4=(t,e,r,n,i,s)=>e+r+n+i+s+(t/2**32|0)|0,di=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Da(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Xr(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function dr(t,...e){if(!Da(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Ba(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Xr(t.outputLen),Xr(t.blockLen)}function An(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Zf(t,e){dr(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Ns(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function er(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function xu(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function yr(t,e){return t<<32-e|t>>>e}const Zw=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Jw(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const Lr=Zw?t=>t:t=>Jw(t);function n4(t){for(let e=0;e<t.length;e++)t[e]=Jw(t[e]);return t}const yn=Zw?t=>t:n4,Qw=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",i4=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Oi(t){if(dr(t),Qw)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=i4[t[r]];return e}const Nr={_0:48,_9:57,A:65,F:70,a:97,f:102};function bp(t){if(t>=Nr._0&&t<=Nr._9)return t-Nr._0;if(t>=Nr.A&&t<=Nr.F)return t-(Nr.A-10);if(t>=Nr.a&&t<=Nr.f)return t-(Nr.a-10)}function Jo(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Qw)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=bp(t.charCodeAt(s)),a=bp(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function em(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function hr(t){return typeof t=="string"&&(t=em(t)),dr(t),t}function mn(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];dr(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}class Ra{}function Gs(t){const e=n=>t().update(hr(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function s4(t){const e=(n,i)=>t(i).update(hr(n)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}function oi(t=32){if(di&&typeof di.getRandomValues=="function")return di.getRandomValues(new Uint8Array(t));if(di&&typeof di.randomBytes=="function")return Uint8Array.from(di.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const o4=BigInt(0),ns=BigInt(1),a4=BigInt(2),c4=BigInt(7),u4=BigInt(256),l4=BigInt(113),tm=[],rm=[],nm=[];for(let t=0,e=ns,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],tm.push(2*(5*n+r)),rm.push((t+1)*(t+2)/2%64);let i=o4;for(let s=0;s<7;s++)e=(e<<ns^(e>>c4)*l4)%u4,e&a4&&(i^=ns<<(ns<<BigInt(s))-ns);nm.push(i)}const im=Xw(nm,!0),f4=im[0],h4=im[1],Ep=(t,e,r)=>r>32?ZC(t,e,r):YC(t,e,r),vp=(t,e,r)=>r>32?JC(t,e,r):XC(t,e,r);function d4(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=r[c],l=r[c+1],f=Ep(u,l,1)^r[a],h=vp(u,l,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=f,t[o+p+1]^=h}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=rm[o],c=Ep(i,s,a),u=vp(i,s,a),l=tm[o];i=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=f4[n],t[1]^=h4[n]}er(r)}let p4=class sm extends Ra{constructor(e,r,n,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=i,this.rounds=s,Xr(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Ns(this.state)}clone(){return this._cloneInto()}keccak(){yn(this.state32),d4(this.state32,this.rounds),yn(this.state32),this.posOut=0,this.pos=0}update(e){An(this),e=hr(e),dr(e);const{blockLen:r,state:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);for(let a=0;a<o;a++)n[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:i}=this;e[n]^=r,r&128&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){An(this,!1),dr(e),this.finish();const r=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,s-i);e.set(r.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Xr(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Zf(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,er(this.state)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new sm(r,n,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}};const g4=(t,e,r)=>Gs(()=>new p4(e,t,r)),y4=g4(1,136,256/8);function w4(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}function m4(t,e,r){return t&e^~t&r}function b4(t,e,r){return t&e^t&r^e&r}let om=class extends Ra{constructor(e,r,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=xu(this.buffer)}update(e){An(this),e=hr(e),dr(e);const{view:r,buffer:n,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=xu(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){An(this),Zf(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,er(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(n,0),o=0);for(let f=o;f<i;f++)r[f]=0;w4(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=xu(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<u;f++)a.setUint32(4*f,l[f],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}};const an=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),yt=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),wt=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),E4=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),cn=new Uint32Array(64);class v4 extends om{constructor(e=32){super(64,e,8,!1),this.A=an[0]|0,this.B=an[1]|0,this.C=an[2]|0,this.D=an[3]|0,this.E=an[4]|0,this.F=an[5]|0,this.G=an[6]|0,this.H=an[7]|0}get(){const{A:e,B:r,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,r,n,i,s,o,a,c]}set(e,r,n,i,s,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let f=0;f<16;f++,r+=4)cn[f]=e.getUint32(r,!1);for(let f=16;f<64;f++){const h=cn[f-15],p=cn[f-2],g=yr(h,7)^yr(h,18)^h>>>3,w=yr(p,17)^yr(p,19)^p>>>10;cn[f]=w+cn[f-7]+g+cn[f-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let f=0;f<64;f++){const h=yr(a,6)^yr(a,11)^yr(a,25),p=l+h+m4(a,c,u)+E4[f]+cn[f]|0,g=(yr(n,2)^yr(n,13)^yr(n,22))+b4(n,i,s)|0;l=u,u=c,c=a,a=o+p|0,o=s,s=i,i=n,n=p+g|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,i,s,o,a,c,u,l)}roundClean(){er(cn)}destroy(){this.set(0,0,0,0,0,0,0,0),er(this.buffer)}}const am=Xw(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),_4=am[0],x4=am[1],un=new Uint32Array(80),ln=new Uint32Array(80);let Jf=class extends om{constructor(e=64){super(128,e,16,!1),this.Ah=wt[0]|0,this.Al=wt[1]|0,this.Bh=wt[2]|0,this.Bl=wt[3]|0,this.Ch=wt[4]|0,this.Cl=wt[5]|0,this.Dh=wt[6]|0,this.Dl=wt[7]|0,this.Eh=wt[8]|0,this.El=wt[9]|0,this.Fh=wt[10]|0,this.Fl=wt[11]|0,this.Gh=wt[12]|0,this.Gl=wt[13]|0,this.Hh=wt[14]|0,this.Hl=wt[15]|0}get(){const{Ah:e,Al:r,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:f,Fl:h,Gh:p,Gl:g,Hh:w,Hl:v}=this;return[e,r,n,i,s,o,a,c,u,l,f,h,p,g,w,v]}set(e,r,n,i,s,o,a,c,u,l,f,h,p,g,w,v){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=f|0,this.Fl=h|0,this.Gh=p|0,this.Gl=g|0,this.Hh=w|0,this.Hl=v|0}process(e,r){for(let x=0;x<16;x++,r+=4)un[x]=e.getUint32(r),ln[x]=e.getUint32(r+=4);for(let x=16;x<80;x++){const A=un[x-15]|0,T=ln[x-15]|0,O=pn(A,T,1)^pn(A,T,8)^wp(A,T,7),P=gn(A,T,1)^gn(A,T,8)^mp(A,T,7),M=un[x-2]|0,U=ln[x-2]|0,G=pn(M,U,19)^ls(M,U,61)^wp(M,U,6),se=gn(M,U,19)^fs(M,U,61)^mp(M,U,6),Z=QC(P,se,ln[x-7],ln[x-16]),L=e4(Z,O,G,un[x-7],un[x-16]);un[x]=L|0,ln[x]=Z|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:f,El:h,Fh:p,Fl:g,Gh:w,Gl:v,Hh:E,Hl:I}=this;for(let x=0;x<80;x++){const A=pn(f,h,14)^pn(f,h,18)^ls(f,h,41),T=gn(f,h,14)^gn(f,h,18)^fs(f,h,41),O=f&p^~f&w,P=h&g^~h&v,M=t4(I,T,P,x4[x],ln[x]),U=r4(M,E,A,O,_4[x],un[x]),G=M|0,se=pn(n,i,28)^ls(n,i,34)^ls(n,i,39),Z=gn(n,i,28)^fs(n,i,34)^fs(n,i,39),L=n&s^n&a^s&a,K=i&o^i&c^o&c;E=w|0,I=v|0,w=p|0,v=g|0,p=f|0,g=h|0,{h:f,l:h}=cr(u|0,l|0,U|0,G|0),u=a|0,l=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const D=Yf(G,Z,K);n=Xf(D,U,se,L),i=D|0}({h:n,l:i}=cr(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=cr(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=cr(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=cr(this.Dh|0,this.Dl|0,u|0,l|0),{h:f,l:h}=cr(this.Eh|0,this.El|0,f|0,h|0),{h:p,l:g}=cr(this.Fh|0,this.Fl|0,p|0,g|0),{h:w,l:v}=cr(this.Gh|0,this.Gl|0,w|0,v|0),{h:E,l:I}=cr(this.Hh|0,this.Hl|0,E|0,I|0),this.set(n,i,s,o,a,c,u,l,f,h,p,g,w,v,E,I)}roundClean(){er(un,ln)}destroy(){er(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};class S4 extends Jf{constructor(){super(48),this.Ah=yt[0]|0,this.Al=yt[1]|0,this.Bh=yt[2]|0,this.Bl=yt[3]|0,this.Ch=yt[4]|0,this.Cl=yt[5]|0,this.Dh=yt[6]|0,this.Dl=yt[7]|0,this.Eh=yt[8]|0,this.El=yt[9]|0,this.Fh=yt[10]|0,this.Fl=yt[11]|0,this.Gh=yt[12]|0,this.Gl=yt[13]|0,this.Hh=yt[14]|0,this.Hl=yt[15]|0}}const mt=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class I4 extends Jf{constructor(){super(32),this.Ah=mt[0]|0,this.Al=mt[1]|0,this.Bh=mt[2]|0,this.Bl=mt[3]|0,this.Ch=mt[4]|0,this.Cl=mt[5]|0,this.Dh=mt[6]|0,this.Dl=mt[7]|0,this.Eh=mt[8]|0,this.El=mt[9]|0,this.Fh=mt[10]|0,this.Fl=mt[11]|0,this.Gh=mt[12]|0,this.Gl=mt[13]|0,this.Hh=mt[14]|0,this.Hl=mt[15]|0}}const Na=Gs(()=>new v4),A4=Gs(()=>new Jf),T4=Gs(()=>new S4),O4=Gs(()=>new I4),C4=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),Qe=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),ye=new Uint32Array(32);function fn(t,e,r,n,i,s){const o=i[s],a=i[s+1];let c=ye[2*t],u=ye[2*t+1],l=ye[2*e],f=ye[2*e+1],h=ye[2*r],p=ye[2*r+1],g=ye[2*n],w=ye[2*n+1],v=Yf(c,l,o);u=Xf(v,u,f,a),c=v|0,{Dh:w,Dl:g}={Dh:w^u,Dl:g^c},{Dh:w,Dl:g}={Dh:WC(w,g),Dl:GC(w)},{h:p,l:h}=cr(p,h,w,g),{Bh:f,Bl:l}={Bh:f^p,Bl:l^h},{Bh:f,Bl:l}={Bh:pn(f,l,24),Bl:gn(f,l,24)},ye[2*t]=c,ye[2*t+1]=u,ye[2*e]=l,ye[2*e+1]=f,ye[2*r]=h,ye[2*r+1]=p,ye[2*n]=g,ye[2*n+1]=w}function hn(t,e,r,n,i,s){const o=i[s],a=i[s+1];let c=ye[2*t],u=ye[2*t+1],l=ye[2*e],f=ye[2*e+1],h=ye[2*r],p=ye[2*r+1],g=ye[2*n],w=ye[2*n+1],v=Yf(c,l,o);u=Xf(v,u,f,a),c=v|0,{Dh:w,Dl:g}={Dh:w^u,Dl:g^c},{Dh:w,Dl:g}={Dh:pn(w,g,16),Dl:gn(w,g,16)},{h:p,l:h}=cr(p,h,w,g),{Bh:f,Bl:l}={Bh:f^p,Bl:l^h},{Bh:f,Bl:l}={Bh:ls(f,l,63),Bl:fs(f,l,63)},ye[2*t]=c,ye[2*t+1]=u,ye[2*e]=l,ye[2*e+1]=f,ye[2*r]=h,ye[2*r+1]=p,ye[2*n]=g,ye[2*n+1]=w}function D4(t,e={},r,n,i){if(Xr(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:s,salt:o,personalization:a}=e;if(s!==void 0&&(s.length<1||s.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==n)throw new Error("salt must be undefined or "+n);if(a!==void 0&&a.length!==i)throw new Error("personalization must be undefined or "+i)}class B4 extends Ra{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,Xr(e),Xr(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=Ns(this.buffer)}update(e){An(this),e=hr(e),dr(e);const{blockLen:r,buffer:n,buffer32:i}=this,s=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<s;){this.pos===r&&(yn(i),this.compress(i,0,!1),yn(i),this.pos=0);const u=Math.min(r-this.pos,s-c),l=o+c;if(u===r&&!(l%4)&&c+u<s){const f=new Uint32Array(a,l,Math.floor((s-c)/4));yn(f);for(let h=0;c+r<s;h+=i.length,c+=r)this.length+=r,this.compress(f,h,!1);yn(f);continue}n.set(e.subarray(c,c+u),this.pos),this.pos+=u,this.length+=u,c+=u}return this}digestInto(e){An(this),Zf(e,this);const{pos:r,buffer32:n}=this;this.finished=!0,er(this.buffer.subarray(r)),yn(n),this.compress(n,0,!0),yn(n);const i=Ns(e);this.get().forEach((s,o)=>i[o]=Lr(s))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){const{buffer:r,length:n,finished:i,destroyed:s,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=s,e.finished=i,e.length=n,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class R4 extends B4{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=Qe[0]|0,this.v0h=Qe[1]|0,this.v1l=Qe[2]|0,this.v1h=Qe[3]|0,this.v2l=Qe[4]|0,this.v2h=Qe[5]|0,this.v3l=Qe[6]|0,this.v3h=Qe[7]|0,this.v4l=Qe[8]|0,this.v4h=Qe[9]|0,this.v5l=Qe[10]|0,this.v5h=Qe[11]|0,this.v6l=Qe[12]|0,this.v6h=Qe[13]|0,this.v7l=Qe[14]|0,this.v7h=Qe[15]|0,D4(r,e,64,16,16);let{key:n,personalization:i,salt:s}=e,o=0;if(n!==void 0&&(n=hr(n),o=n.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,s!==void 0){s=hr(s);const a=Ns(s);this.v4l^=Lr(a[0]),this.v4h^=Lr(a[1]),this.v5l^=Lr(a[2]),this.v5h^=Lr(a[3])}if(i!==void 0){i=hr(i);const a=Ns(i);this.v6l^=Lr(a[0]),this.v6h^=Lr(a[1]),this.v7l^=Lr(a[2]),this.v7h^=Lr(a[3])}if(n!==void 0){const a=new Uint8Array(this.blockLen);a.set(n),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:n,v1h:i,v2l:s,v2h:o,v3l:a,v3h:c,v4l:u,v4h:l,v5l:f,v5h:h,v6l:p,v6h:g,v7l:w,v7h:v}=this;return[e,r,n,i,s,o,a,c,u,l,f,h,p,g,w,v]}set(e,r,n,i,s,o,a,c,u,l,f,h,p,g,w,v){this.v0l=e|0,this.v0h=r|0,this.v1l=n|0,this.v1h=i|0,this.v2l=s|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=u|0,this.v4h=l|0,this.v5l=f|0,this.v5h=h|0,this.v6l=p|0,this.v6h=g|0,this.v7l=w|0,this.v7h=v|0}compress(e,r,n){this.get().forEach((c,u)=>ye[u]=c),ye.set(Qe,16);let{h:i,l:s}=Yw(BigInt(this.length));ye[24]=Qe[8]^s,ye[25]=Qe[9]^i,n&&(ye[28]=~ye[28],ye[29]=~ye[29]);let o=0;const a=C4;for(let c=0;c<12;c++)fn(0,4,8,12,e,r+2*a[o++]),hn(0,4,8,12,e,r+2*a[o++]),fn(1,5,9,13,e,r+2*a[o++]),hn(1,5,9,13,e,r+2*a[o++]),fn(2,6,10,14,e,r+2*a[o++]),hn(2,6,10,14,e,r+2*a[o++]),fn(3,7,11,15,e,r+2*a[o++]),hn(3,7,11,15,e,r+2*a[o++]),fn(0,5,10,15,e,r+2*a[o++]),hn(0,5,10,15,e,r+2*a[o++]),fn(1,6,11,12,e,r+2*a[o++]),hn(1,6,11,12,e,r+2*a[o++]),fn(2,7,8,13,e,r+2*a[o++]),hn(2,7,8,13,e,r+2*a[o++]),fn(3,4,9,14,e,r+2*a[o++]),hn(3,4,9,14,e,r+2*a[o++]);this.v0l^=ye[0]^ye[16],this.v0h^=ye[1]^ye[17],this.v1l^=ye[2]^ye[18],this.v1h^=ye[3]^ye[19],this.v2l^=ye[4]^ye[20],this.v2h^=ye[5]^ye[21],this.v3l^=ye[6]^ye[22],this.v3h^=ye[7]^ye[23],this.v4l^=ye[8]^ye[24],this.v4h^=ye[9]^ye[25],this.v5l^=ye[10]^ye[26],this.v5h^=ye[11]^ye[27],this.v6l^=ye[12]^ye[28],this.v6h^=ye[13]^ye[29],this.v7l^=ye[14]^ye[30],this.v7h^=ye[15]^ye[31],er(ye)}destroy(){this.destroyed=!0,er(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const N4=s4(t=>new R4(t)),P4="https://rpc.walletconnect.org/v1";function Qf(t){const e=`Ethereum Signed Message:
${t.length}`,r=new TextEncoder().encode(e+t);return"0x"+Buffer.from(y4(r)).toString("hex")}async function cm(t,e,r,n,i,s){switch(r.t){case"eip191":return await um(t,e,r.s);case"eip1271":return await lm(t,e,r.s,n,i,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}function um(t,e,r){const n=mT(r);return BT({payload:Qf(e),signature:n}).toLowerCase()===t.toLowerCase()}async function lm(t,e,r,n,i,s){const o=Ti(n);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${n}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",u=r.substring(2),l=(u.length/2).toString(16).padStart(64,"0"),f=(e.startsWith("0x")?e:Qf(e)).substring(2),h=a+f+c+l+u,p=await fetch(`${s||P4}/?chainId=${n}&projectId=${i}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:U4(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:h},"latest"]})}),{result:g}=await p.json();return g?g.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function U4(){return Date.now()+Math.floor(Math.random()*1e3)}function fm(t){const e=atob(t),r=new Uint8Array(e.length);for(let o=0;o<e.length;o++)r[o]=e.charCodeAt(o);const n=r[0];if(n===0)throw new Error("No signatures found");const i=1+n*64;if(r.length<i)throw new Error("Transaction data too short for claimed signature count");if(r.length<100)throw new Error("Transaction too short");const s=Buffer.from(t,"base64").slice(1,65);return Ks.encode(s)}function hm(t){const e=new Uint8Array(Buffer.from(t,"base64")),r=Array.from("TransactionData::").map(s=>s.charCodeAt(0)),n=new Uint8Array(r.length+e.length);n.set(r),n.set(e,r.length);const i=N4(n,{dkLen:32});return Ks.encode(i)}function vl(t){const e=new Uint8Array(Na(dm(t)));return Ks.encode(e)}function dm(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function _l(t){const e=Buffer.from(t,"base64"),r=yO(e).txn;if(!r)throw new Error("Invalid signed transaction: missing 'txn' field");const n=aO(r),i=Buffer.from("TX"),s=Buffer.concat([i,Buffer.from(n)]),o=O4(s);return DT.encode(o).replace(/=+$/,"")}function Su(t){const e=[];let r=BigInt(t);for(;r>=BigInt(128);)e.push(Number(r&BigInt(127)|BigInt(128))),r>>=BigInt(7);return e.push(Number(r)),Buffer.from(e)}function pm(t){const e=Buffer.from(t.signed.bodyBytes,"base64"),r=Buffer.from(t.signed.authInfoBytes,"base64"),n=Buffer.from(t.signature.signature,"base64"),i=[];i.push(Buffer.from([10])),i.push(Su(e.length)),i.push(e),i.push(Buffer.from([18])),i.push(Su(r.length)),i.push(r),i.push(Buffer.from([26])),i.push(Su(n.length)),i.push(n);const s=Buffer.concat(i),o=Na(s);return Buffer.from(o).toString("hex").toUpperCase()}function gm(t){var e,r;const n=[];try{if(typeof t=="string")return n.push(t),n;if(typeof t!="object")return n;t!=null&&t.id&&n.push(t.id);const i=(r=(e=t==null?void 0:t.capabilities)==null?void 0:e.caip345)==null?void 0:r.transactionHashes;i&&n.push(...i)}catch(i){console.warn("getWalletSendCallsHashes failed: ",i)}return n}var L4=Object.defineProperty,$4=Object.defineProperties,M4=Object.getOwnPropertyDescriptors,_p=Object.getOwnPropertySymbols,F4=Object.prototype.hasOwnProperty,k4=Object.prototype.propertyIsEnumerable,xp=(t,e,r)=>e in t?L4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,eh=(t,e)=>{for(var r in e||(e={}))F4.call(e,r)&&xp(t,r,e[r]);if(_p)for(var r of _p(e))k4.call(e,r)&&xp(t,r,e[r]);return t},ym=(t,e)=>$4(t,M4(e));const j4="did:pkh:",Pa=t=>t==null?void 0:t.split(":"),wm=t=>{const e=t&&Pa(t);if(e)return t.includes(j4)?e[3]:e[1]},Qo=t=>{const e=t&&Pa(t);if(e)return e[2]+":"+e[3]},Ps=t=>{const e=t&&Pa(t);if(e)return e.pop()};async function xl(t){const{cacao:e,projectId:r}=t,{s:n,p:i}=e,s=th(i,i.iss),o=Ps(i.iss);return await cm(o,s,n,Qo(i.iss),r)}const th=(t,e)=>{const r=`${t.domain} wants you to sign in with your Ethereum account:`,n=Ps(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let i=t.statement||void 0;const s=`URI: ${t.aud||t.uri}`,o=`Version: ${t.version}`,a=`Chain ID: ${wm(e)}`,c=`Nonce: ${t.nonce}`,u=`Issued At: ${t.iat}`,l=t.exp?`Expiration Time: ${t.exp}`:void 0,f=t.nbf?`Not Before: ${t.nbf}`:void 0,h=t.requestId?`Request ID: ${t.requestId}`:void 0,p=t.resources?`Resources:${t.resources.map(w=>`
- ${w}`).join("")}`:void 0,g=Gn(t.resources);if(g){const w=Tn(g);i=ih(i,w)}return[r,n,"",i,"",s,o,a,c,u,l,f,h,p].filter(w=>w!=null).join(`
`)};function q4(t,e,r){return r.includes("did:pkh:")||(r=`did:pkh:${r}`),{h:{t:"caip122"},p:{iss:r,domain:t.domain,aud:t.aud,version:t.version,nonce:t.nonce,iat:t.iat,statement:t.statement,requestId:t.requestId,resources:t.resources,nbf:t.nbf,exp:t.exp},s:e}}function z4(t){var e;const{authPayload:r,chains:n,methods:i}=t,s=r.statement||"";if(!(n!=null&&n.length))return r;const o=r.chains,a=ml(o,n);if(!(a!=null&&a.length))throw new Error("No supported chains");const c=mm(r.resources);if(!c)return r;Ar(c);const u=bm(c,"eip155");let l=(r==null?void 0:r.resources)||[];if(u!=null&&u.length){const f=Em(u),h=ml(f,i);if(!(h!=null&&h.length))throw new Error(`Supported methods don't satisfy the requested: ${JSON.stringify(f)}, supported: ${JSON.stringify(i)}`);const p=rh("request",h,{chains:a}),g=Sm(c,"eip155",p);l=((e=r==null?void 0:r.resources)==null?void 0:e.slice(0,-1))||[],l.push(Ua(g))}return ym(eh({},r),{statement:Om(s,Gn(l)),chains:a,resources:r!=null&&r.resources||l.length>0?l:void 0})}function mm(t){const e=Gn(t);if(e&&nh(e))return Tn(e)}function V4(t,e){var r;return(r=t==null?void 0:t.att)==null?void 0:r.hasOwnProperty(e)}function bm(t,e){var r,n;return(r=t==null?void 0:t.att)!=null&&r[e]?Object.keys((n=t==null?void 0:t.att)==null?void 0:n[e]):[]}function H4(t){return(t==null?void 0:t.map(e=>Object.keys(e)))||[]}function Em(t){return(t==null?void 0:t.map(e=>{var r;return(r=e.split("/"))==null?void 0:r[1]}))||[]}function vm(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function _m(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function Ar(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(r=>{const n=t.att[r];if(Array.isArray(n))throw new Error(`Resource must be an object: ${r}`);if(typeof n!="object")throw new Error(`Resource must be an object: ${r}`);if(!Object.keys(n).length)throw new Error(`Resource object is empty: ${r}`);Object.keys(n).forEach(i=>{const s=n[i];if(!Array.isArray(s))throw new Error(`Ability limits ${i} must be an array of objects, found: ${s}`);if(!s.length)throw new Error(`Value of ${i} is empty array, must be an array with objects`);s.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${i}) must be an array of objects, found: ${o}`)})})})}function xm(t,e,r,n={}){return r==null||r.sort((i,s)=>i.localeCompare(s)),{att:{[t]:rh(e,r,n)}}}function Sm(t,e,r){var n;t.att[e]=eh({},r);const i=(n=Object.keys(t.att))==null?void 0:n.sort((o,a)=>o.localeCompare(a)),s={att:{}};return i.reduce((o,a)=>(o.att[a]=t.att[a],o),s)}function rh(t,e,r={}){e=e==null?void 0:e.sort((i,s)=>i.localeCompare(s));const n=e.map(i=>({[`${t}/${i}`]:[r]}));return Object.assign({},...n)}function Ua(t){return Ar(t),`urn:recap:${vm(t).replace(/=/g,"")}`}function Tn(t){const e=_m(t.replace("urn:recap:",""));return Ar(e),e}function Im(t,e,r){const n=xm(t,e,r);return Ua(n)}function nh(t){return t&&t.includes("urn:recap:")}function Am(t,e){const r=Tn(t),n=Tn(e),i=Tm(r,n);return Ua(i)}function Tm(t,e){Ar(t),Ar(e);const r=Object.keys(t.att).concat(Object.keys(e.att)).sort((i,s)=>i.localeCompare(s)),n={att:{}};return r.forEach(i=>{var s,o;Object.keys(((s=t.att)==null?void 0:s[i])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[i])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,u;n.att[i]=ym(eh({},n.att[i]),{[a]:((c=t.att[i])==null?void 0:c[a])||((u=e.att[i])==null?void 0:u[a])})})}),n}function ih(t="",e){Ar(e);const r="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(r))return t;const n=[];let i=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(f=>({ability:f.split("/")[0],action:f.split("/")[1]}));c.sort((f,h)=>f.action.localeCompare(h.action));const u={};c.forEach(f=>{u[f.ability]||(u[f.ability]=[]),u[f.ability].push(f.action)});const l=Object.keys(u).map(f=>(i++,`(${i}) '${f}': '${u[f].join("', '")}' for '${a}'.`));n.push(l.join(", ").replace(".,","."))});const s=n.join(" "),o=`${r}${s}`;return`${t?t+" ":""}${o}`}function Sl(t){var e;const r=Tn(t);Ar(r);const n=(e=r.att)==null?void 0:e.eip155;return n?Object.keys(n).map(i=>i.split("/")[1]):[]}function Il(t){const e=Tn(t);Ar(e);const r=[];return Object.values(e.att).forEach(n=>{Object.values(n).forEach(i=>{var s;(s=i==null?void 0:i[0])!=null&&s.chains&&r.push(i[0].chains)})}),[...new Set(r.flat())]}function Om(t,e){if(!e)return t;const r=Tn(e);return Ar(r),ih(t,r)}function Gn(t){if(!t)return;const e=t==null?void 0:t[t.length-1];return nh(e)?e:void 0}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function Cm(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Al(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function Iu(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Rt(t,...e){if(!Cm(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Sp(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function K4(t,e){Rt(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function xn(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Fi(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function W4(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const G4=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Y4(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Tl(t){if(typeof t=="string")t=Y4(t);else if(Cm(t))t=Ol(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function X4(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function Z4(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}const J4=(t,e)=>{function r(n,...i){if(Rt(n),!G4)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const u=i[0];if(!u)throw new Error("nonce / iv required");t.varSizeNonce?Rt(u):Rt(u,t.nonceLength)}const s=t.tagLength;s&&i[1]!==void 0&&Rt(i[1]);const o=e(n,...i),a=(u,l)=>{if(l!==void 0){if(u!==2)throw new Error("cipher output not supported");Rt(l)}};let c=!1;return{encrypt(u,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Rt(u),a(o.encrypt.length,l),o.encrypt(u,l)},decrypt(u,l){if(Rt(u),s&&u.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,l),o.decrypt(u,l)}}}return Object.assign(r,t),r};function Ip(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!eD(e))throw new Error("invalid output, must be aligned");return e}function Ap(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s);t.setUint32(e+4,o,n),t.setUint32(e+0,a,n)}function Q4(t,e,r){Al(r);const n=new Uint8Array(16),i=W4(n);return Ap(i,0,BigInt(e),r),Ap(i,8,BigInt(t),r),n}function eD(t){return t.byteOffset%4===0}function Ol(t){return Uint8Array.from(t)}const Dm=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),tD=Dm("expand 16-byte k"),rD=Dm("expand 32-byte k"),nD=xn(tD),iD=xn(rD);function Re(t,e){return t<<e|t>>>32-e}function Cl(t){return t.byteOffset%4===0}const bo=64,sD=16,Bm=2**32-1,Tp=new Uint32Array;function oD(t,e,r,n,i,s,o,a){const c=i.length,u=new Uint8Array(bo),l=xn(u),f=Cl(i)&&Cl(s),h=f?xn(i):Tp,p=f?xn(s):Tp;for(let g=0;g<c;o++){if(t(e,r,n,l,o,a),o>=Bm)throw new Error("arx: counter overflow");const w=Math.min(bo,c-g);if(f&&w===bo){const v=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let E=0,I;E<sD;E++)I=v+E,p[I]=h[I]^l[E];g+=bo;continue}for(let v=0,E;v<w;v++)E=g+v,s[E]=i[E]^u[v];g+=w}}function aD(t,e){const{allowShortKeys:r,extendNonceFn:n,counterLength:i,counterRight:s,rounds:o}=X4({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Iu(i),Iu(o),Al(s),Al(r),(a,c,u,l,f=0)=>{Rt(a),Rt(c),Rt(u);const h=u.length;if(l===void 0&&(l=new Uint8Array(h)),Rt(l),Iu(f),f<0||f>=Bm)throw new Error("arx: counter overflow");if(l.length<h)throw new Error(`arx: output (${l.length}) is shorter than data (${h})`);const p=[];let g=a.length,w,v;if(g===32)p.push(w=Ol(a)),v=iD;else if(g===16&&r)w=new Uint8Array(32),w.set(a),w.set(a,16),v=nD,p.push(w);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);Cl(c)||p.push(c=Ol(c));const E=xn(w);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(v,E,xn(c.subarray(0,16)),E),c=c.subarray(16)}const I=16-i;if(I!==c.length)throw new Error(`arx: nonce must be ${I} or 16 bytes`);if(I!==12){const A=new Uint8Array(12);A.set(c,s?0:12-c.length),c=A,p.push(c)}const x=xn(c);return oD(t,v,E,x,u,l,f,o),Fi(...p),l}}const ut=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class cD{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Tl(e),Rt(e,32);const r=ut(e,0),n=ut(e,2),i=ut(e,4),s=ut(e,6),o=ut(e,8),a=ut(e,10),c=ut(e,12),u=ut(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let l=0;l<8;l++)this.pad[l]=ut(e,16+2*l)}process(e,r,n=!1){const i=n?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],u=o[2],l=o[3],f=o[4],h=o[5],p=o[6],g=o[7],w=o[8],v=o[9],E=ut(e,r+0),I=ut(e,r+2),x=ut(e,r+4),A=ut(e,r+6),T=ut(e,r+8),O=ut(e,r+10),P=ut(e,r+12),M=ut(e,r+14);let U=s[0]+(E&8191),G=s[1]+((E>>>13|I<<3)&8191),se=s[2]+((I>>>10|x<<6)&8191),Z=s[3]+((x>>>7|A<<9)&8191),L=s[4]+((A>>>4|T<<12)&8191),K=s[5]+(T>>>1&8191),D=s[6]+((T>>>14|O<<2)&8191),C=s[7]+((O>>>11|P<<5)&8191),F=s[8]+((P>>>8|M<<8)&8191),Y=s[9]+(M>>>5|i),k=0,W=k+U*a+G*(5*v)+se*(5*w)+Z*(5*g)+L*(5*p);k=W>>>13,W&=8191,W+=K*(5*h)+D*(5*f)+C*(5*l)+F*(5*u)+Y*(5*c),k+=W>>>13,W&=8191;let te=k+U*c+G*a+se*(5*v)+Z*(5*w)+L*(5*g);k=te>>>13,te&=8191,te+=K*(5*p)+D*(5*h)+C*(5*f)+F*(5*l)+Y*(5*u),k+=te>>>13,te&=8191;let ie=k+U*u+G*c+se*a+Z*(5*v)+L*(5*w);k=ie>>>13,ie&=8191,ie+=K*(5*g)+D*(5*p)+C*(5*h)+F*(5*f)+Y*(5*l),k+=ie>>>13,ie&=8191;let he=k+U*l+G*u+se*c+Z*a+L*(5*v);k=he>>>13,he&=8191,he+=K*(5*w)+D*(5*g)+C*(5*p)+F*(5*h)+Y*(5*f),k+=he>>>13,he&=8191;let J=k+U*f+G*l+se*u+Z*c+L*a;k=J>>>13,J&=8191,J+=K*(5*v)+D*(5*w)+C*(5*g)+F*(5*p)+Y*(5*h),k+=J>>>13,J&=8191;let fe=k+U*h+G*f+se*l+Z*u+L*c;k=fe>>>13,fe&=8191,fe+=K*a+D*(5*v)+C*(5*w)+F*(5*g)+Y*(5*p),k+=fe>>>13,fe&=8191;let q=k+U*p+G*h+se*f+Z*l+L*u;k=q>>>13,q&=8191,q+=K*c+D*a+C*(5*v)+F*(5*w)+Y*(5*g),k+=q>>>13,q&=8191;let j=k+U*g+G*p+se*h+Z*f+L*l;k=j>>>13,j&=8191,j+=K*u+D*c+C*a+F*(5*v)+Y*(5*w),k+=j>>>13,j&=8191;let ne=k+U*w+G*g+se*p+Z*h+L*f;k=ne>>>13,ne&=8191,ne+=K*l+D*u+C*c+F*a+Y*(5*v),k+=ne>>>13,ne&=8191;let ae=k+U*v+G*w+se*g+Z*p+L*h;k=ae>>>13,ae&=8191,ae+=K*f+D*l+C*u+F*c+Y*a,k+=ae>>>13,ae&=8191,k=(k<<2)+k|0,k=k+W|0,W=k&8191,k=k>>>13,te+=k,s[0]=W,s[1]=te,s[2]=ie,s[3]=he,s[4]=J,s[5]=fe,s[6]=q,s[7]=j,s[8]=ne,s[9]=ae}finalize(){const{h:e,pad:r}=this,n=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,n[0]=e[0]+5,i=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+i,i=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;Fi(n)}update(e){Sp(this),e=Tl(e),Rt(e);const{buffer:r,blockLen:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o===n){for(;n<=i-s;s+=n)this.process(e,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){Fi(this.h,this.r,this.buffer,this.pad)}digestInto(e){Sp(this),K4(e,this),this.finished=!0;const{buffer:r,h:n}=this;let{pos:i}=this;if(i){for(r[i++]=1;i<16;i++)r[i]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=n[o]>>>0,e[s++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}}function uD(t){const e=(n,i)=>t(i).update(Tl(n)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}const lD=uD(t=>new cD(t));function fD(t,e,r,n,i,s=20){let o=t[0],a=t[1],c=t[2],u=t[3],l=e[0],f=e[1],h=e[2],p=e[3],g=e[4],w=e[5],v=e[6],E=e[7],I=i,x=r[0],A=r[1],T=r[2],O=o,P=a,M=c,U=u,G=l,se=f,Z=h,L=p,K=g,D=w,C=v,F=E,Y=I,k=x,W=A,te=T;for(let he=0;he<s;he+=2)O=O+G|0,Y=Re(Y^O,16),K=K+Y|0,G=Re(G^K,12),O=O+G|0,Y=Re(Y^O,8),K=K+Y|0,G=Re(G^K,7),P=P+se|0,k=Re(k^P,16),D=D+k|0,se=Re(se^D,12),P=P+se|0,k=Re(k^P,8),D=D+k|0,se=Re(se^D,7),M=M+Z|0,W=Re(W^M,16),C=C+W|0,Z=Re(Z^C,12),M=M+Z|0,W=Re(W^M,8),C=C+W|0,Z=Re(Z^C,7),U=U+L|0,te=Re(te^U,16),F=F+te|0,L=Re(L^F,12),U=U+L|0,te=Re(te^U,8),F=F+te|0,L=Re(L^F,7),O=O+se|0,te=Re(te^O,16),C=C+te|0,se=Re(se^C,12),O=O+se|0,te=Re(te^O,8),C=C+te|0,se=Re(se^C,7),P=P+Z|0,Y=Re(Y^P,16),F=F+Y|0,Z=Re(Z^F,12),P=P+Z|0,Y=Re(Y^P,8),F=F+Y|0,Z=Re(Z^F,7),M=M+L|0,k=Re(k^M,16),K=K+k|0,L=Re(L^K,12),M=M+L|0,k=Re(k^M,8),K=K+k|0,L=Re(L^K,7),U=U+G|0,W=Re(W^U,16),D=D+W|0,G=Re(G^D,12),U=U+G|0,W=Re(W^U,8),D=D+W|0,G=Re(G^D,7);let ie=0;n[ie++]=o+O|0,n[ie++]=a+P|0,n[ie++]=c+M|0,n[ie++]=u+U|0,n[ie++]=l+G|0,n[ie++]=f+se|0,n[ie++]=h+Z|0,n[ie++]=p+L|0,n[ie++]=g+K|0,n[ie++]=w+D|0,n[ie++]=v+C|0,n[ie++]=E+F|0,n[ie++]=I+Y|0,n[ie++]=x+k|0,n[ie++]=A+W|0,n[ie++]=T+te|0}const hD=aD(fD,{counterRight:!1,counterLength:4,allowShortKeys:!1}),dD=new Uint8Array(16),Op=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(dD.subarray(r))},pD=new Uint8Array(32);function Cp(t,e,r,n,i){const s=t(e,r,pD),o=lD.create(s);i&&Op(o,i),Op(o,n);const a=Q4(n.length,i?i.length:0,!0);o.update(a);const c=o.digest();return Fi(s,a),c}const gD=t=>(e,r,n)=>({encrypt(i,s){const o=i.length;s=Ip(o+16,s,!1),s.set(i);const a=s.subarray(0,-16);t(e,r,a,a,1);const c=Cp(t,e,r,a,n);return s.set(c,o),Fi(c),s},decrypt(i,s){s=Ip(i.length-16,s,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=Cp(t,e,r,o,n);if(!Z4(a,c))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),t(e,r,s,s,1),Fi(c),s}}),Rm=J4({blockSize:64,nonceLength:12,tagLength:16},gD(hD));let Nm=class extends Ra{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Ba(e);const n=hr(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),er(s)}update(e){return An(this),this.iHash.update(e),this}digestInto(e){An(this),dr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const La=(t,e,r)=>new Nm(t,e).update(r).digest();La.create=(t,e)=>new Nm(t,e);function yD(t,e,r){return Ba(t),r===void 0&&(r=new Uint8Array(t.outputLen)),La(t,hr(r),hr(e))}const Au=Uint8Array.from([0]),Dp=Uint8Array.of();function wD(t,e,r,n=32){Ba(t),Xr(n);const i=t.outputLen;if(n>255*i)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(n/i);r===void 0&&(r=Dp);const o=new Uint8Array(s*i),a=La.create(t,e),c=a._cloneInto(),u=new Uint8Array(a.outputLen);for(let l=0;l<s;l++)Au[0]=l+1,c.update(l===0?Dp:u).update(r).update(Au).digestInto(u),o.set(u,i*l),a._cloneInto(c);return a.destroy(),c.destroy(),er(u,Au),o.slice(0,n)}const mD=(t,e,r,n,i)=>wD(t,yD(t,e,r),n,i),$a=Na,sh=BigInt(0),Dl=BigInt(1);function ea(t,e=""){if(typeof t!="boolean"){const r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function zn(t,e,r=""){const n=Da(t),i=t==null?void 0:t.length,s=e!==void 0;if(!n||s&&i!==e){const o=r&&`"${r}" `,a=s?` of length ${e}`:"",c=n?`length=${i}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function Eo(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Pm(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?sh:BigInt("0x"+t)}function Ma(t){return Pm(Oi(t))}function ta(t){return dr(t),Pm(Oi(Uint8Array.from(t).reverse()))}function oh(t,e){return Jo(t.toString(16).padStart(e*2,"0"))}function ah(t,e){return oh(t,e).reverse()}function vt(t,e,r){let n;if(typeof e=="string")try{n=Jo(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Da(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}const Tu=t=>typeof t=="bigint"&&sh<=t;function bD(t,e,r){return Tu(t)&&Tu(e)&&Tu(r)&&e<=t&&t<r}function Bl(t,e,r,n){if(!bD(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function Um(t){let e;for(e=0;t>sh;t>>=Dl,e+=1);return e}const Ys=t=>(Dl<<BigInt(t))-Dl;function ED(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const n=h=>new Uint8Array(h),i=h=>Uint8Array.of(h);let s=n(t),o=n(t),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},u=(...h)=>r(o,s,...h),l=(h=n(0))=>{o=u(i(0),h),s=u(),h.length!==0&&(o=u(i(1),h),s=u())},f=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const p=[];for(;h<e;){s=u();const g=s.slice();p.push(g),h+=s.length}return mn(...p)};return(h,p)=>{c(),l(h);let g;for(;!(g=p(f()));)l();return c(),g}}function Fa(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(i,s,o){const a=t[i];if(o&&a===void 0)return;const c=typeof a;if(c!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([i,s])=>n(i,s,!1)),Object.entries(r).forEach(([i,s])=>n(i,s,!0))}function Bp(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}const Pt=BigInt(0),Tt=BigInt(1),Vn=BigInt(2),Lm=BigInt(3),$m=BigInt(4),Mm=BigInt(5),vD=BigInt(7),Fm=BigInt(8),_D=BigInt(9),km=BigInt(16);function kt(t,e){const r=t%e;return r>=Pt?r:e+r}function or(t,e,r){let n=t;for(;e-- >Pt;)n*=n,n%=r;return n}function Rp(t,e){if(t===Pt)throw new Error("invert: expected non-zero number");if(e<=Pt)throw new Error("invert: expected positive modulus, got "+e);let r=kt(t,e),n=e,i=Pt,s=Tt;for(;r!==Pt;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==Tt)throw new Error("invert: does not exist");return kt(i,e)}function ch(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function jm(t,e){const r=(t.ORDER+Tt)/$m,n=t.pow(e,r);return ch(t,n,e),n}function xD(t,e){const r=(t.ORDER-Mm)/Fm,n=t.mul(e,Vn),i=t.pow(n,r),s=t.mul(e,i),o=t.mul(t.mul(s,Vn),i),a=t.mul(s,t.sub(o,t.ONE));return ch(t,a,e),a}function SD(t){const e=Bn(t),r=qm(t),n=r(e,e.neg(e.ONE)),i=r(e,n),s=r(e,e.neg(n)),o=(t+vD)/km;return(a,c)=>{let u=a.pow(c,o),l=a.mul(u,n);const f=a.mul(u,i),h=a.mul(u,s),p=a.eql(a.sqr(l),c),g=a.eql(a.sqr(f),c);u=a.cmov(u,l,p),l=a.cmov(h,f,g);const w=a.eql(a.sqr(l),c),v=a.cmov(u,l,w);return ch(a,v,c),v}}function qm(t){if(t<Lm)throw new Error("sqrt is not defined for small field");let e=t-Tt,r=0;for(;e%Vn===Pt;)e/=Vn,r++;let n=Vn;const i=Bn(t);for(;Np(i,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return jm;let s=i.pow(n,e);const o=(e+Tt)/Vn;return function(a,c){if(a.is0(c))return c;if(Np(a,c)!==1)throw new Error("Cannot find square root");let u=r,l=a.mul(a.ONE,s),f=a.pow(c,e),h=a.pow(c,o);for(;!a.eql(f,a.ONE);){if(a.is0(f))return a.ZERO;let p=1,g=a.sqr(f);for(;!a.eql(g,a.ONE);)if(p++,g=a.sqr(g),p===u)throw new Error("Cannot find square root");const w=Tt<<BigInt(u-p-1),v=a.pow(l,w);u=p,l=a.sqr(v),f=a.mul(f,l),h=a.mul(h,v)}return h}}function ID(t){return t%$m===Lm?jm:t%Fm===Mm?xD:t%km===_D?SD(t):qm(t)}const AD=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function TD(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=AD.reduce((n,i)=>(n[i]="function",n),e);return Fa(t,r),t}function OD(t,e,r){if(r<Pt)throw new Error("invalid exponent, negatives unsupported");if(r===Pt)return t.ONE;if(r===Tt)return e;let n=t.ONE,i=e;for(;r>Pt;)r&Tt&&(n=t.mul(n,i)),i=t.sqr(i),r>>=Tt;return n}function zm(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),s),n}function Np(t,e){const r=(t.ORDER-Tt)/Vn,n=t.pow(e,r),i=t.eql(n,t.ONE),s=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function Vm(t,e){e!==void 0&&Xr(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Bn(t,e,r=!1,n={}){if(t<=Pt)throw new Error("invalid field: expected ORDER > 0, got "+t);let i,s,o=!1,a;if(typeof e=="object"&&e!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");const h=e;h.BITS&&(i=h.BITS),h.sqrt&&(s=h.sqrt),typeof h.isLE=="boolean"&&(r=h.isLE),typeof h.modFromBytes=="boolean"&&(o=h.modFromBytes),a=h.allowedLengths}else typeof e=="number"&&(i=e),n.sqrt&&(s=n.sqrt);const{nBitLength:c,nByteLength:u}=Vm(t,i);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let l;const f=Object.freeze({ORDER:t,isLE:r,BITS:c,BYTES:u,MASK:Ys(c),ZERO:Pt,ONE:Tt,allowedLengths:a,create:h=>kt(h,t),isValid:h=>{if(typeof h!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof h);return Pt<=h&&h<t},is0:h=>h===Pt,isValidNot0:h=>!f.is0(h)&&f.isValid(h),isOdd:h=>(h&Tt)===Tt,neg:h=>kt(-h,t),eql:(h,p)=>h===p,sqr:h=>kt(h*h,t),add:(h,p)=>kt(h+p,t),sub:(h,p)=>kt(h-p,t),mul:(h,p)=>kt(h*p,t),pow:(h,p)=>OD(f,h,p),div:(h,p)=>kt(h*Rp(p,t),t),sqrN:h=>h*h,addN:(h,p)=>h+p,subN:(h,p)=>h-p,mulN:(h,p)=>h*p,inv:h=>Rp(h,t),sqrt:s||(h=>(l||(l=ID(t)),l(f,h))),toBytes:h=>r?ah(h,u):oh(h,u),fromBytes:(h,p=!0)=>{if(a){if(!a.includes(h.length)||h.length>u)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+h.length);const w=new Uint8Array(u);w.set(h,r?0:w.length-h.length),h=w}if(h.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+h.length);let g=r?ta(h):Ma(h);if(o&&(g=kt(g,t)),!p&&!f.isValid(g))throw new Error("invalid field element: outside of range 0..ORDER");return g},invertBatch:h=>zm(f,h),cmov:(h,p,g)=>g?p:h});return Object.freeze(f)}function Hm(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Km(t){const e=Hm(t);return e+Math.ceil(e/2)}function CD(t,e,r=!1){const n=t.length,i=Hm(e),s=Km(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=r?ta(t):Ma(t),a=kt(o,e-Tt)+Tt;return r?ah(a,i):oh(a,i)}const ki=BigInt(0),Hn=BigInt(1);function ra(t,e){const r=e.negate();return t?r:e}function Ou(t,e){const r=zm(t.Fp,e.map(n=>n.Z));return e.map((n,i)=>t.fromAffine(n.toAffine(r[i])))}function Wm(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Cu(t,e){Wm(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),i=2**t,s=Ys(t),o=BigInt(t);return{windows:r,windowSize:n,mask:s,maxNumber:i,shiftBy:o}}function Pp(t,e,r){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=r;let a=Number(t&i),c=t>>o;a>n&&(a-=s,c+=Hn);const u=e*n,l=u+Math.abs(a)-1,f=a===0,h=a<0,p=e%2!==0;return{nextN:c,offset:l,isZero:f,isNeg:h,isNegF:p,offsetF:u}}function DD(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function BD(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const Du=new WeakMap,Gm=new WeakMap;function Bu(t){return Gm.get(t)||1}function Up(t){if(t!==ki)throw new Error("invalid wNAF")}class RD{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,n=this.ZERO){let i=e;for(;r>ki;)r&Hn&&(n=n.add(i)),i=i.double(),r>>=Hn;return n}precomputeWindow(e,r){const{windows:n,windowSize:i}=Cu(r,this.bits),s=[];let o=e,a=o;for(let c=0;c<n;c++){a=o,s.push(a);for(let u=1;u<i;u++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(e,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let i=this.ZERO,s=this.BASE;const o=Cu(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:u,isZero:l,isNeg:f,isNegF:h,offsetF:p}=Pp(n,a,o);n=c,l?s=s.add(ra(h,r[p])):i=i.add(ra(f,r[u]))}return Up(n),{p:i,f:s}}wNAFUnsafe(e,r,n,i=this.ZERO){const s=Cu(e,this.bits);for(let o=0;o<s.windows&&n!==ki;o++){const{nextN:a,offset:c,isZero:u,isNeg:l}=Pp(n,o,s);if(n=a,!u){const f=r[c];i=i.add(l?f.negate():f)}}return Up(n),i}getPrecomputes(e,r,n){let i=Du.get(r);return i||(i=this.precomputeWindow(r,e),e!==1&&(typeof n=="function"&&(i=n(i)),Du.set(r,i))),i}cached(e,r,n){const i=Bu(e);return this.wNAF(i,this.getPrecomputes(i,e,n),r)}unsafe(e,r,n,i){const s=Bu(e);return s===1?this._unsafeLadder(e,r,i):this.wNAFUnsafe(s,this.getPrecomputes(s,e,n),r,i)}createCache(e,r){Wm(r,this.bits),Gm.set(e,r),Du.delete(e)}hasCache(e){return Bu(e)!==1}}function ND(t,e,r,n){let i=e,s=t.ZERO,o=t.ZERO;for(;r>ki||n>ki;)r&Hn&&(s=s.add(i)),n&Hn&&(o=o.add(i)),i=i.double(),r>>=Hn,n>>=Hn;return{p1:s,p2:o}}function PD(t,e,r,n){DD(r,t),BD(n,e);const i=r.length,s=n.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=Um(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=Ys(c),l=new Array(Number(u)+1).fill(o),f=Math.floor((e.BITS-1)/c)*c;let h=o;for(let p=f;p>=0;p-=c){l.fill(o);for(let w=0;w<s;w++){const v=n[w],E=Number(v>>BigInt(p)&u);l[E]=l[E].add(r[w])}let g=o;for(let w=l.length-1,v=o;w>0;w--)v=v.add(l[w]),g=g.add(v);if(h=h.add(g),p!==0)for(let w=0;w<c;w++)h=h.double()}return h}function Lp(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return TD(e),e}else return Bn(t,{isLE:r})}function UD(t,e,r={},n){if(n===void 0&&(n=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>ki))throw new Error(`CURVE.${a} must be positive bigint`)}const i=Lp(e.p,r.Fp,n),s=Lp(e.n,r.Fn,n),o=["Gx","Gy","a","b"];for(const a of o)if(!i.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:i,Fn:s}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),em("HashToScalar-");const is=BigInt(0),pi=BigInt(1),vo=BigInt(2);function LD(t){return Fa(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function $D(t){const e=LD(t),{P:r,type:n,adjustScalarBytes:i,powPminus2:s,randomBytes:o}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");const c=o||oi,u=a?255:448,l=a?32:56,f=BigInt(a?9:5),h=BigInt(a?121665:39081),p=a?vo**BigInt(254):vo**BigInt(447),g=a?BigInt(8)*vo**BigInt(251)-pi:BigInt(4)*vo**BigInt(445)-pi,w=p+g+pi,v=Z=>kt(Z,r),E=I(f);function I(Z){return ah(v(Z),l)}function x(Z){const L=vt("u coordinate",Z,l);return a&&(L[31]&=127),v(ta(L))}function A(Z){return ta(i(vt("scalar",Z,l)))}function T(Z,L){const K=M(x(L),A(Z));if(K===is)throw new Error("invalid private or public key received");return I(K)}function O(Z){return T(Z,E)}function P(Z,L,K){const D=v(Z*(L-K));return L=v(L-D),K=v(K+D),{x_2:L,x_3:K}}function M(Z,L){Bl("u",Z,is,r),Bl("scalar",L,p,w);const K=L,D=Z;let C=pi,F=is,Y=Z,k=pi,W=is;for(let ie=BigInt(u-1);ie>=is;ie--){const he=K>>ie&pi;W^=he,{x_2:C,x_3:Y}=P(W,C,Y),{x_2:F,x_3:k}=P(W,F,k),W=he;const J=C+F,fe=v(J*J),q=C-F,j=v(q*q),ne=fe-j,ae=Y+k,S=Y-k,m=v(S*J),b=v(ae*q),R=m+b,N=m-b;Y=v(R*R),k=v(D*v(N*N)),C=v(fe*j),F=v(ne*(fe+v(h*ne)))}({x_2:C,x_3:Y}=P(W,C,Y)),{x_2:F,x_3:k}=P(W,F,k);const te=s(F);return v(C*te)}const U={secretKey:l,publicKey:l,seed:l},G=(Z=c(l))=>(dr(Z,U.seed),Z);function se(Z){const L=G(Z);return{secretKey:L,publicKey:O(L)}}return{keygen:se,getSharedSecret:(Z,L)=>T(Z,L),getPublicKey:Z=>O(Z),scalarMult:T,scalarMultBase:O,utils:{randomSecretKey:G,randomPrivateKey:G},GuBytes:E.slice(),lengths:U}}const MD=BigInt(1),$p=BigInt(2),FD=BigInt(3),kD=BigInt(5);BigInt(8);const Ym=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),jD={p:Ym,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function qD(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=Ym,o=t*t%s*t%s,a=or(o,$p,s)*o%s,c=or(a,MD,s)*t%s,u=or(c,kD,s)*c%s,l=or(u,e,s)*u%s,f=or(l,r,s)*l%s,h=or(f,n,s)*f%s,p=or(h,i,s)*h%s,g=or(p,i,s)*h%s,w=or(g,e,s)*u%s;return{pow_p_5_8:or(w,$p,s)*t%s,b2:o}}function zD(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const VD=Bn(jD.p,{isLE:!0}),Rl=(()=>{const t=VD.ORDER;return $D({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:r,b2:n}=qD(e);return kt(or(r,FD,t)*n,t)},adjustScalarBytes:zD})})(),Mp=(t,e)=>(t+(t>=0?e:-e)/Xm)/e;function HD(t,e,r){const[[n,i],[s,o]]=e,a=Mp(o*t,r),c=Mp(-i*t,r);let u=t-a*n-c*s,l=-a*i-c*o;const f=u<Kr,h=l<Kr;f&&(u=-u),h&&(l=-l);const p=Ys(Math.ceil(Um(r)/2))+Ci;if(u<Kr||u>=p||l<Kr||l>=p)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:f,k1:u,k2neg:h,k2:l}}function Nl(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function Ru(t,e){const r={};for(let n of Object.keys(e))r[n]=t[n]===void 0?e[n]:t[n];return ea(r.lowS,"lowS"),ea(r.prehash,"prehash"),r.format!==void 0&&Nl(r.format),r}class KD extends Error{constructor(e=""){super(e)}}const jr={Err:KD,_tlv:{encode:(t,e)=>{const{Err:r}=jr;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,i=Eo(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");const s=n>127?Eo(i.length/2|128):"";return Eo(t)+s+i+e},decode(t,e){const{Err:r}=jr;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const u=e.subarray(n,n+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=jr;if(t<Kr)throw new e("integer: negative integers are not allowed");let r=Eo(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=jr;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Ma(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=jr,i=vt("signature",t),{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:u,l}=n.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){const{_tlv:e,_int:r}=jr,n=e.encode(2,r.encode(t.r)),i=e.encode(2,r.encode(t.s)),s=n+i;return e.encode(48,s)}},Kr=BigInt(0),Ci=BigInt(1),Xm=BigInt(2),_o=BigInt(3),WD=BigInt(4);function vi(t,e){const{BYTES:r}=t;let n;if(typeof e=="bigint")n=e;else{let i=vt("private key",e);try{n=t.fromBytes(i)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function GD(t,e={}){const r=UD("weierstrass",t,e),{Fp:n,Fn:i}=r;let s=r.CURVE;const{h:o,n:a}=s;Fa(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!n.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const u=Jm(n,i);function l(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function f(Z,L,K){const{x:D,y:C}=L.toAffine(),F=n.toBytes(D);if(ea(K,"isCompressed"),K){l();const Y=!n.isOdd(C);return mn(Zm(Y),F)}else return mn(Uint8Array.of(4),F,n.toBytes(C))}function h(Z){zn(Z,void 0,"Point");const{publicKey:L,publicKeyUncompressed:K}=u,D=Z.length,C=Z[0],F=Z.subarray(1);if(D===L&&(C===2||C===3)){const Y=n.fromBytes(F);if(!n.isValid(Y))throw new Error("bad point: is not on curve, wrong x");const k=w(Y);let W;try{W=n.sqrt(k)}catch(ie){const he=ie instanceof Error?": "+ie.message:"";throw new Error("bad point: is not on curve, sqrt error"+he)}l();const te=n.isOdd(W);return(C&1)===1!==te&&(W=n.neg(W)),{x:Y,y:W}}else if(D===K&&C===4){const Y=n.BYTES,k=n.fromBytes(F.subarray(0,Y)),W=n.fromBytes(F.subarray(Y,Y*2));if(!v(k,W))throw new Error("bad point: is not on curve");return{x:k,y:W}}else throw new Error(`bad point: got length ${D}, expected compressed=${L} or uncompressed=${K}`)}const p=e.toBytes||f,g=e.fromBytes||h;function w(Z){const L=n.sqr(Z),K=n.mul(L,Z);return n.add(n.add(K,n.mul(Z,s.a)),s.b)}function v(Z,L){const K=n.sqr(L),D=w(Z);return n.eql(K,D)}if(!v(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const E=n.mul(n.pow(s.a,_o),WD),I=n.mul(n.sqr(s.b),BigInt(27));if(n.is0(n.add(E,I)))throw new Error("bad curve params: a or b");function x(Z,L,K=!1){if(!n.isValid(L)||K&&n.is0(L))throw new Error(`bad point coordinate ${Z}`);return L}function A(Z){if(!(Z instanceof U))throw new Error("ProjectivePoint expected")}function T(Z){if(!c||!c.basises)throw new Error("no endo");return HD(Z,c.basises,i.ORDER)}const O=Bp((Z,L)=>{const{X:K,Y:D,Z:C}=Z;if(n.eql(C,n.ONE))return{x:K,y:D};const F=Z.is0();L==null&&(L=F?n.ONE:n.inv(C));const Y=n.mul(K,L),k=n.mul(D,L),W=n.mul(C,L);if(F)return{x:n.ZERO,y:n.ZERO};if(!n.eql(W,n.ONE))throw new Error("invZ was invalid");return{x:Y,y:k}}),P=Bp(Z=>{if(Z.is0()){if(e.allowInfinityPoint&&!n.is0(Z.Y))return;throw new Error("bad point: ZERO")}const{x:L,y:K}=Z.toAffine();if(!n.isValid(L)||!n.isValid(K))throw new Error("bad point: x or y not field elements");if(!v(L,K))throw new Error("bad point: equation left != right");if(!Z.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function M(Z,L,K,D,C){return K=new U(n.mul(K.X,Z),K.Y,K.Z),L=ra(D,L),K=ra(C,K),L.add(K)}class U{constructor(L,K,D){this.X=x("x",L),this.Y=x("y",K,!0),this.Z=x("z",D),Object.freeze(this)}static CURVE(){return s}static fromAffine(L){const{x:K,y:D}=L||{};if(!L||!n.isValid(K)||!n.isValid(D))throw new Error("invalid affine point");if(L instanceof U)throw new Error("projective point not allowed");return n.is0(K)&&n.is0(D)?U.ZERO:new U(K,D,n.ONE)}static fromBytes(L){const K=U.fromAffine(g(zn(L,void 0,"point")));return K.assertValidity(),K}static fromHex(L){return U.fromBytes(vt("pointHex",L))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(L=8,K=!0){return se.createCache(this,L),K||this.multiply(_o),this}assertValidity(){P(this)}hasEvenY(){const{y:L}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(L)}equals(L){A(L);const{X:K,Y:D,Z:C}=this,{X:F,Y,Z:k}=L,W=n.eql(n.mul(K,k),n.mul(F,C)),te=n.eql(n.mul(D,k),n.mul(Y,C));return W&&te}negate(){return new U(this.X,n.neg(this.Y),this.Z)}double(){const{a:L,b:K}=s,D=n.mul(K,_o),{X:C,Y:F,Z:Y}=this;let k=n.ZERO,W=n.ZERO,te=n.ZERO,ie=n.mul(C,C),he=n.mul(F,F),J=n.mul(Y,Y),fe=n.mul(C,F);return fe=n.add(fe,fe),te=n.mul(C,Y),te=n.add(te,te),k=n.mul(L,te),W=n.mul(D,J),W=n.add(k,W),k=n.sub(he,W),W=n.add(he,W),W=n.mul(k,W),k=n.mul(fe,k),te=n.mul(D,te),J=n.mul(L,J),fe=n.sub(ie,J),fe=n.mul(L,fe),fe=n.add(fe,te),te=n.add(ie,ie),ie=n.add(te,ie),ie=n.add(ie,J),ie=n.mul(ie,fe),W=n.add(W,ie),J=n.mul(F,Y),J=n.add(J,J),ie=n.mul(J,fe),k=n.sub(k,ie),te=n.mul(J,he),te=n.add(te,te),te=n.add(te,te),new U(k,W,te)}add(L){A(L);const{X:K,Y:D,Z:C}=this,{X:F,Y,Z:k}=L;let W=n.ZERO,te=n.ZERO,ie=n.ZERO;const he=s.a,J=n.mul(s.b,_o);let fe=n.mul(K,F),q=n.mul(D,Y),j=n.mul(C,k),ne=n.add(K,D),ae=n.add(F,Y);ne=n.mul(ne,ae),ae=n.add(fe,q),ne=n.sub(ne,ae),ae=n.add(K,C);let S=n.add(F,k);return ae=n.mul(ae,S),S=n.add(fe,j),ae=n.sub(ae,S),S=n.add(D,C),W=n.add(Y,k),S=n.mul(S,W),W=n.add(q,j),S=n.sub(S,W),ie=n.mul(he,ae),W=n.mul(J,j),ie=n.add(W,ie),W=n.sub(q,ie),ie=n.add(q,ie),te=n.mul(W,ie),q=n.add(fe,fe),q=n.add(q,fe),j=n.mul(he,j),ae=n.mul(J,ae),q=n.add(q,j),j=n.sub(fe,j),j=n.mul(he,j),ae=n.add(ae,j),fe=n.mul(q,ae),te=n.add(te,fe),fe=n.mul(S,ae),W=n.mul(ne,W),W=n.sub(W,fe),fe=n.mul(ne,q),ie=n.mul(S,ie),ie=n.add(ie,fe),new U(W,te,ie)}subtract(L){return this.add(L.negate())}is0(){return this.equals(U.ZERO)}multiply(L){const{endo:K}=e;if(!i.isValidNot0(L))throw new Error("invalid scalar: out of range");let D,C;const F=Y=>se.cached(this,Y,k=>Ou(U,k));if(K){const{k1neg:Y,k1:k,k2neg:W,k2:te}=T(L),{p:ie,f:he}=F(k),{p:J,f:fe}=F(te);C=he.add(fe),D=M(K.beta,ie,J,Y,W)}else{const{p:Y,f:k}=F(L);D=Y,C=k}return Ou(U,[D,C])[0]}multiplyUnsafe(L){const{endo:K}=e,D=this;if(!i.isValid(L))throw new Error("invalid scalar: out of range");if(L===Kr||D.is0())return U.ZERO;if(L===Ci)return D;if(se.hasCache(this))return this.multiply(L);if(K){const{k1neg:C,k1:F,k2neg:Y,k2:k}=T(L),{p1:W,p2:te}=ND(U,D,F,k);return M(K.beta,W,te,C,Y)}else return se.unsafe(D,L)}multiplyAndAddUnsafe(L,K,D){const C=this.multiplyUnsafe(K).add(L.multiplyUnsafe(D));return C.is0()?void 0:C}toAffine(L){return O(this,L)}isTorsionFree(){const{isTorsionFree:L}=e;return o===Ci?!0:L?L(U,this):se.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:L}=e;return o===Ci?this:L?L(U,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(L=!0){return ea(L,"isCompressed"),this.assertValidity(),p(U,this,L)}toHex(L=!0){return Oi(this.toBytes(L))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(L=!0){return this.toBytes(L)}_setWindowSize(L){this.precompute(L)}static normalizeZ(L){return Ou(U,L)}static msm(L,K){return PD(U,i,L,K)}static fromPrivateKey(L){return U.BASE.multiply(vi(i,L))}}U.BASE=new U(s.Gx,s.Gy,n.ONE),U.ZERO=new U(n.ZERO,n.ONE,n.ZERO),U.Fp=n,U.Fn=i;const G=i.BITS,se=new RD(U,e.endo?Math.ceil(G/2):G);return U.BASE.precompute(8),U}function Zm(t){return Uint8Array.of(t?2:3)}function Jm(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function YD(t,e={}){const{Fn:r}=t,n=e.randomBytes||oi,i=Object.assign(Jm(t.Fp,r),{seed:Km(r.ORDER)});function s(h){try{return!!vi(r,h)}catch{return!1}}function o(h,p){const{publicKey:g,publicKeyUncompressed:w}=i;try{const v=h.length;return p===!0&&v!==g||p===!1&&v!==w?!1:!!t.fromBytes(h)}catch{return!1}}function a(h=n(i.seed)){return CD(zn(h,i.seed,"seed"),r.ORDER)}function c(h,p=!0){return t.BASE.multiply(vi(r,h)).toBytes(p)}function u(h){const p=a(h);return{secretKey:p,publicKey:c(p)}}function l(h){if(typeof h=="bigint")return!1;if(h instanceof t)return!0;const{secretKey:p,publicKey:g,publicKeyUncompressed:w}=i;if(r.allowedLengths||p===g)return;const v=vt("key",h).length;return v===g||v===w}function f(h,p,g=!0){if(l(h)===!0)throw new Error("first arg must be private key");if(l(p)===!1)throw new Error("second arg must be public key");const w=vi(r,h);return t.fromHex(p).multiply(w).toBytes(g)}return Object.freeze({getPublicKey:c,getSharedSecret:f,keygen:u,Point:t,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:h=>vi(r,h),precompute(h=8,p=t.BASE){return p.precompute(h,!1)}},lengths:i})}function XD(t,e,r={}){Ba(e),Fa(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=r.randomBytes||oi,i=r.hmac||((K,...D)=>La(e,K,mn(...D))),{Fp:s,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:u,getPublicKey:l,getSharedSecret:f,utils:h,lengths:p}=YD(t,r),g={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},w="compact";function v(K){const D=a>>Ci;return K>D}function E(K,D){if(!o.isValidNot0(D))throw new Error(`invalid signature ${K}: out of range 1..Point.Fn.ORDER`);return D}function I(K,D){Nl(D);const C=p.signature,F=D==="compact"?C:D==="recovered"?C+1:void 0;return zn(K,F,`${D} signature`)}class x{constructor(D,C,F){this.r=E("r",D),this.s=E("s",C),F!=null&&(this.recovery=F),Object.freeze(this)}static fromBytes(D,C=w){I(D,C);let F;if(C==="der"){const{r:te,s:ie}=jr.toSig(zn(D));return new x(te,ie)}C==="recovered"&&(F=D[0],C="compact",D=D.subarray(1));const Y=o.BYTES,k=D.subarray(0,Y),W=D.subarray(Y,Y*2);return new x(o.fromBytes(k),o.fromBytes(W),F)}static fromHex(D,C){return this.fromBytes(Jo(D),C)}addRecoveryBit(D){return new x(this.r,this.s,D)}recoverPublicKey(D){const C=s.ORDER,{r:F,s:Y,recovery:k}=this;if(k==null||![0,1,2,3].includes(k))throw new Error("recovery id invalid");if(a*Xm<C&&k>1)throw new Error("recovery id is ambiguous for h>1 curve");const W=k===2||k===3?F+a:F;if(!s.isValid(W))throw new Error("recovery id 2 or 3 invalid");const te=s.toBytes(W),ie=t.fromBytes(mn(Zm((k&1)===0),te)),he=o.inv(W),J=T(vt("msgHash",D)),fe=o.create(-J*he),q=o.create(Y*he),j=t.BASE.multiplyUnsafe(fe).add(ie.multiplyUnsafe(q));if(j.is0())throw new Error("point at infinify");return j.assertValidity(),j}hasHighS(){return v(this.s)}toBytes(D=w){if(Nl(D),D==="der")return Jo(jr.hexFromSig(this));const C=o.toBytes(this.r),F=o.toBytes(this.s);if(D==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return mn(Uint8Array.of(this.recovery),C,F)}return mn(C,F)}toHex(D){return Oi(this.toBytes(D))}assertValidity(){}static fromCompact(D){return x.fromBytes(vt("sig",D),"compact")}static fromDER(D){return x.fromBytes(vt("sig",D),"der")}normalizeS(){return this.hasHighS()?new x(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Oi(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Oi(this.toBytes("compact"))}}const A=r.bits2int||function(K){if(K.length>8192)throw new Error("input is too large");const D=Ma(K),C=K.length*8-c;return C>0?D>>BigInt(C):D},T=r.bits2int_modN||function(K){return o.create(A(K))},O=Ys(c);function P(K){return Bl("num < 2^"+c,K,Kr,O),o.toBytes(K)}function M(K,D){return zn(K,void 0,"message"),D?zn(e(K),void 0,"prehashed message"):K}function U(K,D,C){if(["recovered","canonical"].some(q=>q in C))throw new Error("sign() legacy options not supported");const{lowS:F,prehash:Y,extraEntropy:k}=Ru(C,g);K=M(K,Y);const W=T(K),te=vi(o,D),ie=[P(te),P(W)];if(k!=null&&k!==!1){const q=k===!0?n(p.secretKey):k;ie.push(vt("extraEntropy",q))}const he=mn(...ie),J=W;function fe(q){const j=A(q);if(!o.isValidNot0(j))return;const ne=o.inv(j),ae=t.BASE.multiply(j).toAffine(),S=o.create(ae.x);if(S===Kr)return;const m=o.create(ne*o.create(J+S*te));if(m===Kr)return;let b=(ae.x===S?0:2)|Number(ae.y&Ci),R=m;return F&&v(m)&&(R=o.neg(m),b^=1),new x(S,R,b)}return{seed:he,k2sig:fe}}function G(K,D,C={}){K=vt("message",K);const{seed:F,k2sig:Y}=U(K,D,C);return ED(e.outputLen,o.BYTES,i)(F,Y)}function se(K){let D;const C=typeof K=="string"||Da(K),F=!C&&K!==null&&typeof K=="object"&&typeof K.r=="bigint"&&typeof K.s=="bigint";if(!C&&!F)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(F)D=new x(K.r,K.s);else if(C){try{D=x.fromBytes(vt("sig",K),"der")}catch(Y){if(!(Y instanceof jr.Err))throw Y}if(!D)try{D=x.fromBytes(vt("sig",K),"compact")}catch{return!1}}return D||!1}function Z(K,D,C,F={}){const{lowS:Y,prehash:k,format:W}=Ru(F,g);if(C=vt("publicKey",C),D=M(vt("message",D),k),"strict"in F)throw new Error("options.strict was renamed to lowS");const te=W===void 0?se(K):x.fromBytes(vt("sig",K),W);if(te===!1)return!1;try{const ie=t.fromBytes(C);if(Y&&te.hasHighS())return!1;const{r:he,s:J}=te,fe=T(D),q=o.inv(J),j=o.create(fe*q),ne=o.create(he*q),ae=t.BASE.multiplyUnsafe(j).add(ie.multiplyUnsafe(ne));return ae.is0()?!1:o.create(ae.x)===he}catch{return!1}}function L(K,D,C={}){const{prehash:F}=Ru(C,g);return D=M(D,F),x.fromBytes(K,"recovered").recoverPublicKey(D).toBytes()}return Object.freeze({keygen:u,getPublicKey:l,getSharedSecret:f,utils:h,lengths:p,Point:t,sign:G,verify:Z,recoverPublicKey:L,Signature:x,hash:e})}function ZD(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp;let n=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const i=Bn(e.n,{BITS:t.nBitLength,allowedLengths:n,modFromBytes:t.wrapPrivateKey}),s={Fp:r,Fn:i,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:s}}function JD(t){const{CURVE:e,curveOpts:r}=ZD(t),n={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:n}}function QD(t,e){const r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,Vm(r.Fn.ORDER,r.Fn.BITS))})}function eB(t){const{CURVE:e,curveOpts:r,hash:n,ecdsaOpts:i}=JD(t),s=GD(e,r),o=XD(s,n,i);return QD(t,o)}function Pl(t,e){const r=n=>eB({...t,hash:n});return{...r(e),create:r}}const Qm={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},e1={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},t1={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},tB=Bn(Qm.p),rB=Bn(e1.p),nB=Bn(t1.p),iB=Pl({...Qm,Fp:tB,lowS:!1},Na);Pl({...e1,Fp:rB,lowS:!1},T4),Pl({...t1,Fp:nB,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},A4);const sB=iB,uh="base10",_t="base16",St="base64pad",Vr="base64url",Wi="utf8",lh=0,Ir=1,Gi=2,oB=0,Fp=1,ms=12,fh=32;function r1(){const t=Rl.utils.randomPrivateKey(),e=Rl.getPublicKey(t);return{privateKey:Ut(t,_t),publicKey:Ut(e,_t)}}function na(){const t=oi(fh);return Ut(t,_t)}function n1(t,e){const r=Rl.getSharedSecret(Jt(t,_t),Jt(e,_t)),n=mD($a,r,void 0,void 0,fh);return Ut(n,_t)}function bs(t){const e=$a(Jt(t,_t));return Ut(e,_t)}function jt(t){const e=$a(Jt(t,Wi));return Ut(e,_t)}function hh(t){return Jt(`${t}`,uh)}function On(t){return Number(Ut(t,uh))}function i1(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function s1(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return e+"=".repeat(r)}function o1(t){const e=hh(typeof t.type<"u"?t.type:lh);if(On(e)===Ir&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?Jt(t.senderPublicKey,_t):void 0,n=typeof t.iv<"u"?Jt(t.iv,_t):oi(ms),i=Jt(t.symKey,_t),s=Rm(i,n).encrypt(Jt(t.message,Wi)),o=dh({type:e,sealed:s,iv:n,senderPublicKey:r});return t.encoding===Vr?i1(o):o}function a1(t){const e=Jt(t.symKey,_t),{sealed:r,iv:n}=ji({encoded:t.encoded,encoding:t.encoding}),i=Rm(e,n).decrypt(r);if(i===null)throw new Error("Failed to decrypt");return Ut(i,Wi)}function c1(t,e){const r=hh(Gi),n=oi(ms),i=Jt(t,Wi),s=dh({type:r,sealed:i,iv:n});return e===Vr?i1(s):s}function u1(t,e){const{sealed:r}=ji({encoded:t,encoding:e});return Ut(r,Wi)}function dh(t){if(On(t.type)===Gi)return Ut(ws([t.type,t.sealed]),St);if(On(t.type)===Ir){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Ut(ws([t.type,t.senderPublicKey,t.iv,t.sealed]),St)}return Ut(ws([t.type,t.iv,t.sealed]),St)}function ji(t){const e=(t.encoding||St)===Vr?s1(t.encoded):t.encoded,r=Jt(e,St),n=r.slice(oB,Fp),i=Fp;if(On(n)===Ir){const c=i+fh,u=c+ms,l=r.slice(i,c),f=r.slice(c,u),h=r.slice(u);return{type:n,sealed:h,iv:f,senderPublicKey:l}}if(On(n)===Gi){const c=r.slice(i),u=oi(ms);return{type:n,sealed:c,iv:u}}const s=i+ms,o=r.slice(i,s),a=r.slice(s);return{type:n,sealed:a,iv:o}}function l1(t,e){const r=ji({encoded:t,encoding:e==null?void 0:e.encoding});return ph({type:On(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?Ut(r.senderPublicKey,_t):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function ph(t){const e=(t==null?void 0:t.type)||lh;if(e===Ir){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function Ul(t){return t.type===Ir&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function Ll(t){return t.type===Gi}function f1(t){const e=Buffer.from(t.x,"base64"),r=Buffer.from(t.y,"base64");return ws([new Uint8Array([4]),e,r])}function h1(t,e){const[r,n,i]=t.split("."),s=Buffer.from(s1(i),"base64");if(s.length!==64)throw new Error("Invalid signature length");const o=s.slice(0,32),a=s.slice(32,64),c=`${r}.${n}`,u=$a(c),l=f1(e);if(!sB.verify(ws([o,a]),u,l))throw new Error("Invalid signature");return al(t).payload}const d1="irn";function Us(t){return(t==null?void 0:t.relay)||{protocol:d1}}function Kn(t){const e=dC[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var aB=Object.defineProperty,cB=Object.defineProperties,uB=Object.getOwnPropertyDescriptors,kp=Object.getOwnPropertySymbols,lB=Object.prototype.hasOwnProperty,fB=Object.prototype.propertyIsEnumerable,jp=(t,e,r)=>e in t?aB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Nu=(t,e)=>{for(var r in e||(e={}))lB.call(e,r)&&jp(t,r,e[r]);if(kp)for(var r of kp(e))fB.call(e,r)&&jp(t,r,e[r]);return t},hB=(t,e)=>cB(t,uB(e));function p1(t,e="-"){const r={},n="relay"+e;return Object.keys(t).forEach(i=>{if(i.startsWith(n)){const s=i.replace(n,""),o=t[i];r[s]=o}}),r}function $l(t){if(!t.includes("wc:")){const u=Gf(t);u!=null&&u.includes("wc:")&&(t=u)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,n=t.substring(0,e),i=t.substring(e+1,r).split("@"),s=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(s),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:n,topic:g1(i[0]),version:parseInt(i[1],10),symKey:a.symKey,relay:p1(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function g1(t){return t.startsWith("//")?t.substring(2):t}function y1(t,e="-"){const r="relay",n={};return Object.keys(t).forEach(i=>{const s=i,o=r+e+s;t[s]&&(n[o]=t[s])}),n}function Ml(t){const e=new URLSearchParams,r=Nu(Nu(hB(Nu({},y1(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(r).sort(([n],[i])=>n.localeCompare(i)).forEach(([n,i])=>{i!==void 0&&e.append(n,String(i))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}function hs(t,e,r){return`${t}?wc_ev=${r}&topic=${e}`}var dB=Object.defineProperty,pB=Object.defineProperties,gB=Object.getOwnPropertyDescriptors,qp=Object.getOwnPropertySymbols,yB=Object.prototype.hasOwnProperty,wB=Object.prototype.propertyIsEnumerable,zp=(t,e,r)=>e in t?dB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,mB=(t,e)=>{for(var r in e||(e={}))yB.call(e,r)&&zp(t,r,e[r]);if(qp)for(var r of qp(e))wB.call(e,r)&&zp(t,r,e[r]);return t},bB=(t,e)=>pB(t,gB(e));function ai(t){const e=[];return t.forEach(r=>{const[n,i]=r.split(":");e.push(`${n}:${i}`)}),e}function w1(t){const e=[];return Object.values(t).forEach(r=>{e.push(...ai(r.accounts))}),e}function m1(t,e){const r=[];return Object.values(t).forEach(n=>{ai(n.accounts).includes(e)&&r.push(...n.methods)}),r}function b1(t,e){const r=[];return Object.values(t).forEach(n=>{ai(n.accounts).includes(e)&&r.push(...n.events)}),r}function EB(t,e){const r=Es(t,e);if(r)throw new Error(r.message);const n={};for(const[i,s]of Object.entries(t))n[i]={methods:s.methods,events:s.events,chains:s.accounts.map(o=>`${o.split(":")[0]}:${o.split(":")[1]}`)};return n}function vB(t){var e;const{proposal:{requiredNamespaces:r,optionalNamespaces:n={}},supportedNamespaces:i}=t,s=Ls(r),o=Ls(n),a={};Object.keys(i).forEach(l=>{const f=i[l].chains,h=i[l].methods,p=i[l].events,g=i[l].accounts;f.forEach(w=>{if(!g.some(v=>v.includes(w)))throw new Error(`No accounts provided for chain ${w} in namespace ${l}`)}),a[l]={chains:f,methods:h,events:p,accounts:g}});const c=ia(r,a,"approve()");if(c)throw new Error(c.message);const u={};if(!Object.keys(r).length&&!Object.keys(n).length)return a;Object.keys(s).forEach(l=>{const f=i[l].chains.filter(w=>{var v,E;return(E=(v=s[l])==null?void 0:v.chains)==null?void 0:E.includes(w)}),h=i[l].methods.filter(w=>{var v,E;return(E=(v=s[l])==null?void 0:v.methods)==null?void 0:E.includes(w)}),p=i[l].events.filter(w=>{var v,E;return(E=(v=s[l])==null?void 0:v.events)==null?void 0:E.includes(w)}),g=f.map(w=>i[l].accounts.filter(v=>v.includes(`${w}:`))).flat();u[l]={chains:f,methods:h,events:p,accounts:g}}),Object.keys(o).forEach(l=>{var f,h,p,g,w,v;if(!i[l])return;const E=(h=(f=o[l])==null?void 0:f.chains)==null?void 0:h.filter(T=>i[l].chains.includes(T)),I=i[l].methods.filter(T=>{var O,P;return(P=(O=o[l])==null?void 0:O.methods)==null?void 0:P.includes(T)}),x=i[l].events.filter(T=>{var O,P;return(P=(O=o[l])==null?void 0:O.events)==null?void 0:P.includes(T)}),A=E==null?void 0:E.map(T=>i[l].accounts.filter(O=>O.includes(`${T}:`))).flat();u[l]={chains:Qt((p=u[l])==null?void 0:p.chains,E),methods:Qt((g=u[l])==null?void 0:g.methods,I),events:Qt((w=u[l])==null?void 0:w.events,x),accounts:Qt((v=u[l])==null?void 0:v.accounts,A)}});for(const[l,f]of Object.entries(u))(f.accounts.length===0||((e=f==null?void 0:f.chains)==null?void 0:e.length)===0)&&delete u[l];return u}function gh(t){return t.includes(":")}function E1(t){return gh(t)?t.split(":")[0]:t}function Ls(t){var e,r,n;const i={};if(!qi(t))return i;for(const[s,o]of Object.entries(t)){const a=gh(s)?[s]:o.chains,c=o.methods||[],u=o.events||[],l=E1(s);i[l]=bB(mB({},i[l]),{chains:Qt(a,(e=i[l])==null?void 0:e.chains),methods:Qt(c,(r=i[l])==null?void 0:r.methods),events:Qt(u,(n=i[l])==null?void 0:n.events)})}return i}function v1(t){const e={};return t==null||t.forEach(r=>{var n;const[i,s]=r.split(":");e[i]||(e[i]={accounts:[],chains:[],events:[],methods:[]}),e[i].accounts.push(r),(n=e[i].chains)==null||n.push(`${i}:${s}`)}),e}function Fl(t,e){e=e.map(n=>n.replace("did:pkh:",""));const r=v1(e);for(const[n,i]of Object.entries(r))i.methods?i.methods=Qt(i.methods,t):i.methods=t,i.events=["chainChanged","accountsChanged"];return r}function _1(t,e){var r,n,i,s,o,a;const c=Ls(t),u=Ls(e),l={},f=Object.keys(c).concat(Object.keys(u));for(const h of f)l[h]={chains:Qt((r=c[h])==null?void 0:r.chains,(n=u[h])==null?void 0:n.chains),methods:Qt((i=c[h])==null?void 0:i.methods,(s=u[h])==null?void 0:s.methods),events:Qt((o=c[h])==null?void 0:o.events,(a=u[h])==null?void 0:a.events)};return l}const x1={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},S1={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function de(t,e){const{message:r,code:n}=S1[t];return{message:e?`${r} ${e}`:r,code:n}}function Ve(t,e){const{message:r,code:n}=x1[t];return{message:e?`${r} ${e}`:r,code:n}}function Jn(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function qi(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Ze(t){return typeof t>"u"}function Ke(t,e){return e&&Ze(t)?!0:typeof t=="string"&&!!t.trim().length}function ka(t,e){return e&&Ze(t)?!0:typeof t=="number"&&!isNaN(t)}function I1(t,e){const{requiredNamespaces:r}=e,n=Object.keys(t.namespaces),i=Object.keys(r);let s=!0;return vn(i,n)?(n.forEach(o=>{const{accounts:a,methods:c,events:u}=t.namespaces[o],l=ai(a),f=r[o];(!vn(Oa(o,f),l)||!vn(f.methods,c)||!vn(f.events,u))&&(s=!1)}),s):!1}function $s(t){return Ke(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function A1(t){if(Ke(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&$s(r)}}return!1}function T1(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(Ke(t,!1)){if(e(t))return!0;const r=Gf(t);return e(r)}}catch{}return!1}function O1(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function C1(t){return t==null?void 0:t.topic}function D1(t,e){let r=null;return Ke(t==null?void 0:t.publicKey,!1)||(r=de("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function kl(t){let e=!0;return Jn(t)?t.length&&(e=t.every(r=>Ke(r,!1))):e=!1,e}function B1(t,e,r){let n=null;return Jn(e)&&e.length?e.forEach(i=>{n||$s(i)||(n=Ve("UNSUPPORTED_CHAINS",`${r}, chain ${i} should be a string and conform to "namespace:chainId" format`))}):$s(t)||(n=Ve("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),n}function R1(t,e,r){let n=null;return Object.entries(t).forEach(([i,s])=>{if(n)return;const o=B1(i,Oa(i,s),`${e} ${r}`);o&&(n=o)}),n}function N1(t,e){let r=null;return Jn(t)?t.forEach(n=>{r||A1(n)||(r=Ve("UNSUPPORTED_ACCOUNTS",`${e}, account ${n} should be a string and conform to "namespace:chainId:address" format`))}):r=Ve("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function P1(t,e){let r=null;return Object.values(t).forEach(n=>{if(r)return;const i=N1(n==null?void 0:n.accounts,`${e} namespace`);i&&(r=i)}),r}function U1(t,e){let r=null;return kl(t==null?void 0:t.methods)?kl(t==null?void 0:t.events)||(r=Ve("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=Ve("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function yh(t,e){let r=null;return Object.values(t).forEach(n=>{if(r)return;const i=U1(n,`${e}, namespace`);i&&(r=i)}),r}function L1(t,e,r){let n=null;if(t&&qi(t)){const i=yh(t,e);i&&(n=i);const s=R1(t,e,r);s&&(n=s)}else n=de("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return n}function Es(t,e){let r=null;if(t&&qi(t)){const n=yh(t,e);n&&(r=n);const i=P1(t,e);i&&(r=i)}else r=de("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function wh(t){return Ke(t.protocol,!0)}function $1(t,e){let r=!1;return e&&!t?r=!0:t&&Jn(t)&&t.length&&t.forEach(n=>{r=wh(n)}),r}function M1(t){return typeof t=="number"}function xt(t){return typeof t<"u"&&typeof t!==null}function F1(t){return!(!t||typeof t!="object"||!t.code||!ka(t.code,!1)||!t.message||!Ke(t.message,!1))}function k1(t){return!(Ze(t)||!Ke(t.method,!1))}function j1(t){return!(Ze(t)||Ze(t.result)&&Ze(t.error)||!ka(t.id,!1)||!Ke(t.jsonrpc,!1))}function q1(t){return!(Ze(t)||!Ke(t.name,!1))}function jl(t,e){return!(!$s(e)||!w1(t).includes(e))}function z1(t,e,r){return Ke(r,!1)?m1(t,e).includes(r):!1}function V1(t,e,r){return Ke(r,!1)?b1(t,e).includes(r):!1}function ia(t,e,r){let n=null;const i=_B(t),s=xB(e),o=Object.keys(i),a=Object.keys(s),c=Vp(Object.keys(t)),u=Vp(Object.keys(e)),l=c.filter(f=>!u.includes(f));return l.length&&(n=de("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${l.toString()}
      Received: ${Object.keys(e).toString()}`)),vn(o,a)||(n=de("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(f=>{if(!f.includes(":")||n)return;const h=ai(e[f].accounts);h.includes(f)||(n=de("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${f}
        Required: ${f}
        Approved: ${h.toString()}`))}),o.forEach(f=>{n||(vn(i[f].methods,s[f].methods)?vn(i[f].events,s[f].events)||(n=de("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${f}`)):n=de("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${f}`))}),n}function _B(t){const e={};return Object.keys(t).forEach(r=>{var n;r.includes(":")?e[r]=t[r]:(n=t[r].chains)==null||n.forEach(i=>{e[i]={methods:t[r].methods,events:t[r].events}})}),e}function Vp(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function xB(t){const e={};return Object.keys(t).forEach(r=>{if(r.includes(":"))e[r]=t[r];else{const n=ai(t[r].accounts);n==null||n.forEach(i=>{e[i]={accounts:t[r].accounts.filter(s=>s.includes(`${i}:`)),methods:t[r].methods,events:t[r].events}})}}),e}function H1(t,e){return ka(t,!1)&&t<=e.max&&t>=e.min}function ql(){const t=si();return new Promise(e=>{switch(t){case It.browser:e(K1());break;case It.reactNative:e(W1());break;case It.node:e(G1());break;default:e(!0)}})}function K1(){return ii()&&(navigator==null?void 0:navigator.onLine)}async function W1(){if(Jr()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t==null?void 0:t.isConnected}return!0}function G1(){return!0}function Y1(t){switch(si()){case It.browser:X1(t);break;case It.reactNative:Z1(t);break;case It.node:break}}function X1(t){!Jr()&&ii()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function Z1(t){Jr()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(e=>t(e==null?void 0:e.isConnected)))}function J1(){var t;return ii()&&Xn()?((t=Xn())==null?void 0:t.visibilityState)==="visible":!0}const Pu={};class mi{static get(e){return Pu[e]}static set(e,r){Pu[e]=r}static delete(e){delete Pu[e]}}function Q1(t){const e=Ks.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function eb({publicKey:t,signature:e,payload:r}){var n;const i=zl(r.method),s=128|parseInt(((n=r.version)==null?void 0:n.toString())||"4"),o=IB(r.address),a=r.era==="00"?new Uint8Array([0]):zl(r.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(r.nonce,16),u=new Uint8Array([c&255,c>>8&255]),l=BigInt(`0x${SB(r.tip)}`),f=TB(l),h=new Uint8Array([0,...t,o,...e,...a,...u,...f,...i]),p=AB(h.length+1);return new Uint8Array([...p,s,...h])}function tb(t){const e=zl(t),r=IC.blake2b(e,void 0,32);return"0x"+Buffer.from(r).toString("hex")}function zl(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function SB(t){return t.startsWith("0x")?t.slice(2):t}function IB(t){const e=Ks.decode(t)[0];return e===42?0:e===60?2:1}function AB(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function TB(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function rb(t){const e=Uint8Array.from(Buffer.from(t.signature,"hex")),r=Q1(t.transaction.address),n=eb({publicKey:r,signature:e,payload:t.transaction}),i=Buffer.from(n).toString("hex");return tb(i)}function mh({logger:t,name:e}){const r=typeof t=="string"?$0({opts:{level:t,name:e}}).logger:t;return r.level=typeof t=="string"?t:t.level,r}const OB=Object.freeze(Object.defineProperty({__proto__:null,BASE10:uh,BASE16:_t,BASE64:St,BASE64URL:Vr,COLON:MC,DEFAULT_DEPTH:zf,EMPTY_SPACE:Yo,ENV_MAP:It,INTERNAL_ERRORS:S1,LimitedSet:Gw,MemoryStore:mi,ONE_THOUSAND:FC,REACT_NATIVE_PRODUCT:Iw,RELAYER_DEFAULT_PROTOCOL:d1,SDK_ERRORS:x1,SDK_TYPE:Tw,SLASH:Aw,TYPE_0:lh,TYPE_1:Ir,TYPE_2:Gi,UTF8:Wi,addResourceToRecap:Sm,addSignatureToExtrinsic:eb,appendToQueryString:Dw,assertType:qC,assignAbilityToActions:rh,base64Decode:_m,base64Encode:vm,buildApprovedNamespaces:vB,buildAuthObject:q4,buildNamespacesFromAuth:Fl,buildRecapStatement:Om,buildSignedExtrinsicHash:rb,calcExpiry:Xe,capitalize:KC,capitalizeWord:$w,createDelayedPromise:dn,createEncodedRecap:Im,createExpiringPromise:ur,createLogger:mh,createRecap:xm,decodeRecap:Tn,decodeTypeByte:On,decodeTypeTwoEnvelope:u1,decrypt:a1,deriveExtrinsicHash:tb,deriveSymKey:n1,deserialize:ji,encodeRecap:Ua,encodeTypeByte:hh,encodeTypeTwoEnvelope:c1,encrypt:o1,engineEvent:Le,enumify:HC,extractSolanaTransactionId:fm,formatAccountId:vw,formatAccountWithChain:TC,formatChainId:Ew,formatDeeplinkUrl:jw,formatExpirerTarget:Kf,formatIdTarget:Fw,formatMessage:th,formatMessageContext:zC,formatRelayParams:y1,formatRelayRpcUrl:Pw,formatStatementFromRecap:ih,formatTopicTarget:Mw,formatUA:Hf,formatUri:Ml,fromBase64:Gf,generateKeyPair:r1,generateRandomBytes32:na,getAccountsChains:ai,getAccountsFromNamespaces:CC,getAddressFromAccount:_w,getAddressesFromAccounts:OC,getAlgorandTransactionId:_l,getAppId:wl,getAppMetadata:Vf,getBrowserOnlineStatus:K1,getChainFromAccount:xw,getChainsFromAccounts:Sw,getChainsFromNamespace:Oa,getChainsFromNamespaces:DC,getChainsFromRecap:Il,getChainsFromRequiredNamespaces:BC,getCommonValuesInArrays:ml,getCryptoKeyFromKeyData:f1,getDecodedRecapFromResources:mm,getDeepLink:zw,getDidAddress:Ps,getDidAddressSegments:Pa,getDidChainId:wm,getEnvironment:si,getHttpUrl:jC,getInternalError:de,getJavascriptID:Nw,getJavascriptOS:Rw,getLastItems:Lw,getLinkModeURL:hs,getMethodsFromRecap:Sl,getNamespacedDidChainId:Qo,getNamespacesChains:w1,getNamespacesEventsForChainId:b1,getNamespacesFromAccounts:v1,getNamespacesMethodsForChainId:m1,getNearTransactionIdFromSignedTransaction:vl,getNearUint8ArrayFromBytes:dm,getNodeOnlineStatus:G1,getReCapActions:Em,getReactNativeOnlineStatus:W1,getRecapAbilitiesFromResource:H4,getRecapFromResources:Gn,getRecapResource:bm,getRelayClientMetadata:kC,getRelayProtocolApi:Kn,getRelayProtocolName:Us,getRequiredNamespacesFromNamespaces:EB,getSdkError:Ve,getSearchParamFromURL:bl,getSignDirectHash:pm,getSuiDigest:hm,getUniqueValues:qf,getWalletSendCallsHashes:gm,handleDeeplinkRedirect:kw,hasOverlap:vn,hashEthereumMessage:Qf,hashKey:bs,hashMessage:jt,isAndroid:Ow,isAppVisible:J1,isBrowser:ii,isCaipNamespace:gh,isConformingNamespaces:ia,isExpired:kr,isIframe:Hw,isIos:Cw,isNode:Rs,isOnline:ql,isProposalStruct:O1,isReactNative:Jr,isRecap:nh,isSessionCompatible:I1,isSessionStruct:C1,isTelegram:Vw,isTestRun:Ca,isTypeOneEnvelope:Ul,isTypeTwoEnvelope:Ll,isUndefined:Ze,isValidAccountId:A1,isValidAccounts:N1,isValidActions:U1,isValidArray:Jn,isValidChainId:$s,isValidChains:B1,isValidController:D1,isValidEip1271Signature:lm,isValidEip191Signature:um,isValidErrorReason:F1,isValidEvent:q1,isValidId:M1,isValidNamespaceAccounts:P1,isValidNamespaceActions:yh,isValidNamespaceChains:R1,isValidNamespaceMethodsOrEvents:kl,isValidNamespaces:Es,isValidNamespacesChainId:jl,isValidNamespacesEvent:V1,isValidNamespacesRequest:z1,isValidNumber:ka,isValidObject:qi,isValidParams:xt,isValidRecap:Ar,isValidRelay:wh,isValidRelays:$1,isValidRequest:k1,isValidRequestExpiry:H1,isValidRequiredNamespaces:L1,isValidResponse:j1,isValidString:Ke,isValidUrl:T1,mapEntries:VC,mapToObj:Xo,mergeArrays:Qt,mergeEncodedRecaps:Am,mergeRecaps:Tm,mergeRequiredAndOptionalNamespaces:_1,normalizeNamespaces:Ls,objToMap:Zo,openDeeplink:qw,parseAccountId:jf,parseChainId:Ti,parseContextNames:Uw,parseExpirerTarget:Wf,parseNamespaceKey:E1,parseRelayParams:p1,parseTopic:g1,parseUri:$l,populateAppMetadata:Bw,populateAuthPayload:z4,recapHasResource:V4,serialize:dh,sleep:Ww,ss58AddressToPublicKey:Q1,subscribeToBrowserNetworkChange:X1,subscribeToNetworkChange:Y1,subscribeToReactNativeNetworkChange:Z1,toBase64:Kw,uuidv4:El,validateDecoding:l1,validateEncoding:ph,validateSignedCacao:xl,verifyP256Jwt:h1,verifySignature:cm},Symbol.toStringTag,{value:"Module"})),CB="PARSE_ERROR",DB="INVALID_REQUEST",BB="METHOD_NOT_FOUND",RB="INVALID_PARAMS",nb="INTERNAL_ERROR",bh="SERVER_ERROR",NB=[-32700,-32600,-32601,-32602,-32603],vs={[CB]:{code:-32700,message:"Parse error"},[DB]:{code:-32600,message:"Invalid Request"},[BB]:{code:-32601,message:"Method not found"},[RB]:{code:-32602,message:"Invalid params"},[nb]:{code:-32603,message:"Internal error"},[bh]:{code:-32e3,message:"Server error"}},ib=bh;function PB(t){return NB.includes(t)}function Hp(t){return Object.keys(vs).includes(t)?vs[t]:vs[ib]}function UB(t){const e=Object.values(vs).find(r=>r.code===t);return e||vs[ib]}function LB(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var sb={},Pr={},Kp;function $B(){if(Kp)return Pr;Kp=1,Object.defineProperty(Pr,"__esModule",{value:!0}),Pr.isBrowserCryptoAvailable=Pr.getSubtleCrypto=Pr.getBrowerCrypto=void 0;function t(){return(Ee==null?void 0:Ee.crypto)||(Ee==null?void 0:Ee.msCrypto)||{}}Pr.getBrowerCrypto=t;function e(){const n=t();return n.subtle||n.webkitSubtle}Pr.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return Pr.isBrowserCryptoAvailable=r,Pr}var Ur={},Wp;function MB(){if(Wp)return Ur;Wp=1,Object.defineProperty(Ur,"__esModule",{value:!0}),Ur.isBrowser=Ur.isNode=Ur.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Ur.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Ur.isNode=e;function r(){return!t()&&!e()}return Ur.isBrowser=r,Ur}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=js;e.__exportStar($B(),t),e.__exportStar(MB(),t)})(sb);function br(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function _n(t=6){return BigInt(br(t))}function qr(t,e,r){return{id:r||br(),jsonrpc:"2.0",method:t,params:e}}function sa(t,e){return{id:t,jsonrpc:"2.0",result:e}}function Eh(t,e,r){return{id:t,jsonrpc:"2.0",error:FB(e)}}function FB(t,e){return typeof t>"u"?Hp(nb):(typeof t=="string"&&(t=Object.assign(Object.assign({},Hp(bh)),{message:t})),PB(t.code)&&(t=UB(t.code)),t)}class kB{}class jB extends kB{constructor(){super()}}class qB extends jB{constructor(e){super()}}const zB="^wss?:";function VB(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function HB(t,e){const r=VB(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function Gp(t){return HB(t,zB)}function KB(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function ob(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function vh(t){return ob(t)&&"method"in t}function ja(t){return ob(t)&&(Er(t)||Zt(t))}function Er(t){return"result"in t}function Zt(t){return"error"in t}class WB extends qB{constructor(e){super(e),this.events=new zt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(qr(e.method,e.params||[],e.id||_n().toString()),r)}async requestStrict(e,r){return new Promise(async(n,i)=>{if(!this.connection.connected)try{await this.open()}catch(s){i(s)}this.events.on(`${e.id}`,s=>{Zt(s)?i(s.error):n(s.result)});try{await this.connection.send(e,r)}catch(s){i(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),ja(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const GB=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),YB=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Yp=t=>t.split("?")[0],Xp=10,XB=GB();let ZB=class{constructor(e){if(this.url=e,this.events=new zt.EventEmitter,this.registering=!1,!Gp(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Yn(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!Gp(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,i)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),i(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return i(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,n)=>{const i=sb.isReactNative()?void 0:{rejectUnauthorized:!KB(e)},s=new XB(e,[],i);YB()?s.onerror=o=>{const a=o;n(this.emitError(a.error))}:s.on("error",o=>{n(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),r(s)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Li(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const n=this.parseError(r),i=n.message||n.toString(),s=Eh(e,i);this.events.emit("payload",s)}parseError(e,r=this.url){return LB(e,Yp(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Xp&&this.events.setMaxListeners(Xp)}emitError(e){const r=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${Yp(this.url)}`));return this.events.emit("register_error",r),r}};var JB={};const ab="wc",cb=2,Vl="core",Tr=`${ab}@2:${Vl}:`,QB={logger:"error"},e6={database:":memory:"},t6="crypto",Zp="client_ed25519_seed",r6=pe.ONE_DAY,n6="keychain",i6="0.3",s6="messages",o6="0.3",a6=pe.SIX_HOURS,c6="publisher",ub="irn",u6="error",lb="wss://relay.walletconnect.org",l6="relayer",He={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},f6="_subscription",Kt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},h6=.1,Hl="2.22.4",qe={link_mode:"link_mode",relay:"relay"},Do={inbound:"inbound",outbound:"outbound"},d6="0.3",p6="WALLETCONNECT_CLIENT_ID",Jp="WALLETCONNECT_LINK_MODE_APPS",Mt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},g6="subscription",y6="0.3",w6="pairing",m6="0.3",ss={wc_pairingDelete:{req:{ttl:pe.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:pe.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:pe.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:pe.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:pe.ONE_DAY,prompt:!1,tag:0},res:{ttl:pe.ONE_DAY,prompt:!1,tag:0}}},kn={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},ir={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},b6="history",E6="0.3",v6="expirer",Gt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},_6="0.3",x6="verify-api",S6="https://verify.walletconnect.com",fb="https://verify.walletconnect.org",_s=fb,I6=`${_s}/v3`,A6=[S6,fb],T6="echo",O6="https://echo.walletconnect.com",mr={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},$r={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},sr={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success",session_request_response_started:"session_request_response_started",session_request_response_validation_success:"session_request_response_validation_success",session_request_response_publish_started:"session_request_response_publish_started"},Un={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found",session_request_response_validation_failure:"session_request_response_validation_failure",session_request_response_publish_failure:"session_request_response_publish_failure"},Ln={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},os={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},C6=.1,D6="event-client",B6=86400,R6="https://pulse.walletconnect.org/batch";function N6(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function f(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var w=0,v=0,E=0,I=g.length;E!==I&&g[E]===0;)E++,w++;for(var x=(I-E)*l+1>>>0,A=new Uint8Array(x);E!==I;){for(var T=g[E],O=0,P=x-1;(T!==0||O<v)&&P!==-1;P--,O++)T+=256*A[P]>>>0,A[P]=T%a>>>0,T=T/a>>>0;if(T!==0)throw new Error("Non-zero carry");v=O,E++}for(var M=x-v;M!==x&&A[M]===0;)M++;for(var U=c.repeat(w);M<x;++M)U+=t.charAt(A[M]);return U}function h(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var w=0;if(g[w]!==" "){for(var v=0,E=0;g[w]===c;)v++,w++;for(var I=(g.length-w)*u+1>>>0,x=new Uint8Array(I);g[w];){var A=r[g.charCodeAt(w)];if(A===255)return;for(var T=0,O=I-1;(A!==0||T<E)&&O!==-1;O--,T++)A+=a*x[O]>>>0,x[O]=A%256>>>0,A=A/256>>>0;if(A!==0)throw new Error("Non-zero carry");E=T,w++}if(g[w]!==" "){for(var P=I-E;P!==I&&x[P]===0;)P++;for(var M=new Uint8Array(v+(I-P)),U=v;P!==I;)M[U++]=x[P++];return M}}}function p(g){var w=h(g);if(w)return w;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:h,decode:p}}var P6=N6,U6=P6;const hb=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},L6=t=>new TextEncoder().encode(t),$6=t=>new TextDecoder().decode(t);class M6{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class F6{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return db(this,e)}}class k6{constructor(e){this.decoders=e}or(e){return db(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const db=(t,e)=>new k6({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class j6{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new M6(e,r,n),this.decoder=new F6(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const qa=({name:t,prefix:e,encode:r,decode:n})=>new j6(t,e,r,n),Xs=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=U6(r,e);return qa({prefix:t,name:e,encode:n,decode:s=>hb(i(s))})},q6=(t,e,r,n)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const f=i[t[l]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|f,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},z6=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},dt=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>qa({prefix:e,name:t,encode(i){return z6(i,n,r)},decode(i){return q6(i,n,r,t)}}),V6=qa({prefix:"\0",name:"identity",encode:t=>$6(t),decode:t=>L6(t)});var H6=Object.freeze({__proto__:null,identity:V6});const K6=dt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var W6=Object.freeze({__proto__:null,base2:K6});const G6=dt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Y6=Object.freeze({__proto__:null,base8:G6});const X6=Xs({prefix:"9",name:"base10",alphabet:"0123456789"});var Z6=Object.freeze({__proto__:null,base10:X6});const J6=dt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Q6=dt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var eR=Object.freeze({__proto__:null,base16:J6,base16upper:Q6});const tR=dt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),rR=dt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),nR=dt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),iR=dt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),sR=dt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),oR=dt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),aR=dt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),cR=dt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),uR=dt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var lR=Object.freeze({__proto__:null,base32:tR,base32upper:rR,base32pad:nR,base32padupper:iR,base32hex:sR,base32hexupper:oR,base32hexpad:aR,base32hexpadupper:cR,base32z:uR});const fR=Xs({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),hR=Xs({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var dR=Object.freeze({__proto__:null,base36:fR,base36upper:hR});const pR=Xs({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),gR=Xs({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var yR=Object.freeze({__proto__:null,base58btc:pR,base58flickr:gR});const wR=dt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),mR=dt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),bR=dt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),ER=dt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var vR=Object.freeze({__proto__:null,base64:wR,base64pad:mR,base64url:bR,base64urlpad:ER});const pb=Array.from(""),_R=pb.reduce((t,e,r)=>(t[r]=e,t),[]),xR=pb.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function SR(t){return t.reduce((e,r)=>(e+=_R[r],e),"")}function IR(t){const e=[];for(const r of t){const n=xR[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const AR=qa({prefix:"",name:"base256emoji",encode:SR,decode:IR});var TR=Object.freeze({__proto__:null,base256emoji:AR}),OR=gb,Qp=128,CR=-128,DR=Math.pow(2,31);function gb(t,e,r){e=e||[],r=r||0;for(var n=r;t>=DR;)e[r++]=t&255|Qp,t/=128;for(;t&CR;)e[r++]=t&255|Qp,t>>>=7;return e[r]=t|0,gb.bytes=r-n+1,e}var BR=Kl,RR=128,eg=127;function Kl(t,n){var r=0,n=n||0,i=0,s=n,o,a=t.length;do{if(s>=a)throw Kl.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=i<28?(o&eg)<<i:(o&eg)*Math.pow(2,i),i+=7}while(o>=RR);return Kl.bytes=s-n,r}var NR=Math.pow(2,7),PR=Math.pow(2,14),UR=Math.pow(2,21),LR=Math.pow(2,28),$R=Math.pow(2,35),MR=Math.pow(2,42),FR=Math.pow(2,49),kR=Math.pow(2,56),jR=Math.pow(2,63),qR=function(t){return t<NR?1:t<PR?2:t<UR?3:t<LR?4:t<$R?5:t<MR?6:t<FR?7:t<kR?8:t<jR?9:10},zR={encode:OR,decode:BR,encodingLength:qR},yb=zR;const tg=(t,e,r=0)=>(yb.encode(t,e,r),e),rg=t=>yb.encodingLength(t),Wl=(t,e)=>{const r=e.byteLength,n=rg(t),i=n+rg(r),s=new Uint8Array(i+r);return tg(t,s,0),tg(r,s,n),s.set(e,i),new VR(t,r,e,s)};class VR{constructor(e,r,n,i){this.code=e,this.size=r,this.digest=n,this.bytes=i}}const wb=({name:t,code:e,encode:r})=>new HR(t,e,r);class HR{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Wl(this.code,r):r.then(n=>Wl(this.code,n))}else throw Error("Unknown type, must be binary type")}}const mb=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),KR=wb({name:"sha2-256",code:18,encode:mb("SHA-256")}),WR=wb({name:"sha2-512",code:19,encode:mb("SHA-512")});var GR=Object.freeze({__proto__:null,sha256:KR,sha512:WR});const bb=0,YR="identity",Eb=hb,XR=t=>Wl(bb,Eb(t)),ZR={code:bb,name:YR,encode:Eb,digest:XR};var JR=Object.freeze({__proto__:null,identity:ZR});new TextEncoder,new TextDecoder;const ng={...H6,...W6,...Y6,...Z6,...eR,...lR,...dR,...yR,...vR,...TR};({...GR,...JR});function vb(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function QR(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?vb(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function _b(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const ig=_b("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Uu=_b("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=QR(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),eN={utf8:ig,"utf-8":ig,hex:ng.base16,latin1:Uu,ascii:Uu,binary:Uu,...ng};function tN(t,e="utf8"){const r=eN[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?vb(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}var rN=Object.defineProperty,nN=(t,e,r)=>e in t?rN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,wr=(t,e,r)=>nN(t,typeof e!="symbol"?e+"":e,r);class iN{constructor(e,r){this.core=e,this.logger=r,wr(this,"keychain",new Map),wr(this,"name",n6),wr(this,"version",i6),wr(this,"initialized",!1),wr(this,"storagePrefix",Tr),wr(this,"init",async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}}),wr(this,"has",n=>(this.isInitialized(),this.keychain.has(n))),wr(this,"set",async(n,i)=>{this.isInitialized(),this.keychain.set(n,i),await this.persist()}),wr(this,"get",n=>{this.isInitialized();const i=this.keychain.get(n);if(typeof i>"u"){const{message:s}=de("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(s)}return i}),wr(this,"del",async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()}),this.core=e,this.logger=Vt(r,this.name)}get context(){return Lt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Xo(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Zo(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=de("NOT_INITIALIZED",this.name);throw new Error(e)}}}var sN=Object.defineProperty,oN=(t,e,r)=>e in t?sN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,tt=(t,e,r)=>oN(t,typeof e!="symbol"?e+"":e,r);class aN{constructor(e,r,n){this.core=e,this.logger=r,tt(this,"name",t6),tt(this,"keychain"),tt(this,"randomSessionIdentifier",na()),tt(this,"initialized",!1),tt(this,"clientId"),tt(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),tt(this,"hasKeys",i=>(this.isInitialized(),this.keychain.has(i))),tt(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;const i=await this.getClientSeed(),s=Md(i),o=hy(s.publicKey);return this.clientId=o,o}),tt(this,"generateKeyPair",()=>{this.isInitialized();const i=r1();return this.setPrivateKey(i.publicKey,i.privateKey)}),tt(this,"signJWT",async i=>{this.isInitialized();const s=await this.getClientSeed(),o=Md(s),a=this.randomSessionIdentifier;return await t8(a,i,r6,o)}),tt(this,"generateSharedKey",(i,s,o)=>{this.isInitialized();const a=this.getPrivateKey(i),c=n1(a,s);return this.setSymKey(c,o)}),tt(this,"setSymKey",async(i,s)=>{this.isInitialized();const o=s||bs(i);return await this.keychain.set(o,i),o}),tt(this,"deleteKeyPair",async i=>{this.isInitialized(),await this.keychain.del(i)}),tt(this,"deleteSymKey",async i=>{this.isInitialized(),await this.keychain.del(i)}),tt(this,"encode",async(i,s,o)=>{this.isInitialized();const a=ph(o),c=Yn(s);if(Ll(a))return c1(c,o==null?void 0:o.encoding);if(Ul(a)){const h=a.senderPublicKey,p=a.receiverPublicKey;i=await this.generateSharedKey(h,p)}const u=this.getSymKey(i),{type:l,senderPublicKey:f}=a;return o1({type:l,symKey:u,message:c,senderPublicKey:f,encoding:o==null?void 0:o.encoding})}),tt(this,"decode",async(i,s,o)=>{this.isInitialized();const a=l1(s,o);if(Ll(a)){const c=u1(s,o==null?void 0:o.encoding);return Li(c)}if(Ul(a)){const c=a.receiverPublicKey,u=a.senderPublicKey;i=await this.generateSharedKey(c,u)}try{const c=this.getSymKey(i),u=a1({symKey:c,encoded:s,encoding:o==null?void 0:o.encoding});return Li(u)}catch(c){this.logger.error(`Failed to decode message from topic: '${i}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),tt(this,"getPayloadType",(i,s=St)=>{const o=ji({encoded:i,encoding:s});return On(o.type)}),tt(this,"getPayloadSenderPublicKey",(i,s=St)=>{const o=ji({encoded:i,encoding:s});return o.senderPublicKey?Ut(o.senderPublicKey,_t):void 0}),this.core=e,this.logger=Vt(r,this.name),this.keychain=n||new iN(this.core,this.logger)}get context(){return Lt(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Zp)}catch{e=na(),await this.keychain.set(Zp,e)}return tN(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=de("NOT_INITIALIZED",this.name);throw new Error(e)}}}var cN=Object.defineProperty,uN=Object.defineProperties,lN=Object.getOwnPropertyDescriptors,sg=Object.getOwnPropertySymbols,fN=Object.prototype.hasOwnProperty,hN=Object.prototype.propertyIsEnumerable,Gl=(t,e,r)=>e in t?cN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,dN=(t,e)=>{for(var r in e||(e={}))fN.call(e,r)&&Gl(t,r,e[r]);if(sg)for(var r of sg(e))hN.call(e,r)&&Gl(t,r,e[r]);return t},pN=(t,e)=>uN(t,lN(e)),$t=(t,e,r)=>Gl(t,typeof e!="symbol"?e+"":e,r);class gN extends Qx{constructor(e,r){super(e,r),this.logger=e,this.core=r,$t(this,"messages",new Map),$t(this,"messagesWithoutClientAck",new Map),$t(this,"name",s6),$t(this,"version",o6),$t(this,"initialized",!1),$t(this,"storagePrefix",Tr),$t(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n);const i=await this.getRelayerMessagesWithoutClientAck();typeof i<"u"&&(this.messagesWithoutClientAck=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}}),$t(this,"set",async(n,i,s)=>{this.isInitialized();const o=jt(i);let a=this.messages.get(n);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=i,this.messages.set(n,a),s===Do.inbound){const c=this.messagesWithoutClientAck.get(n)||{};this.messagesWithoutClientAck.set(n,pN(dN({},c),{[o]:i}))}return await this.persist(),o}),$t(this,"get",n=>{this.isInitialized();let i=this.messages.get(n);return typeof i>"u"&&(i={}),i}),$t(this,"getWithoutAck",n=>{this.isInitialized();const i={};for(const s of n){const o=this.messagesWithoutClientAck.get(s)||{};i[s]=Object.values(o)}return i}),$t(this,"has",(n,i)=>{this.isInitialized();const s=this.get(n),o=jt(i);return typeof s[o]<"u"}),$t(this,"ack",async(n,i)=>{this.isInitialized();const s=this.messagesWithoutClientAck.get(n);if(typeof s>"u")return;const o=jt(i);delete s[o],Object.keys(s).length===0?this.messagesWithoutClientAck.delete(n):this.messagesWithoutClientAck.set(n,s),await this.persist()}),$t(this,"del",async n=>{this.isInitialized(),this.messages.delete(n),this.messagesWithoutClientAck.delete(n),await this.persist()}),this.logger=Vt(e,this.name),this.core=r}get context(){return Lt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Xo(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,Xo(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Zo(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?Zo(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=de("NOT_INITIALIZED",this.name);throw new Error(e)}}}var yN=Object.defineProperty,wN=Object.defineProperties,mN=Object.getOwnPropertyDescriptors,og=Object.getOwnPropertySymbols,bN=Object.prototype.hasOwnProperty,EN=Object.prototype.propertyIsEnumerable,Yl=(t,e,r)=>e in t?yN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,gi=(t,e)=>{for(var r in e||(e={}))bN.call(e,r)&&Yl(t,r,e[r]);if(og)for(var r of og(e))EN.call(e,r)&&Yl(t,r,e[r]);return t},ag=(t,e)=>wN(t,mN(e)),Wt=(t,e,r)=>Yl(t,typeof e!="symbol"?e+"":e,r);class vN extends eS{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,Wt(this,"events",new zt.EventEmitter),Wt(this,"name",c6),Wt(this,"queue",new Map),Wt(this,"publishTimeout",pe.toMiliseconds(pe.ONE_MINUTE)),Wt(this,"initialPublishTimeout",pe.toMiliseconds(pe.ONE_SECOND*15)),Wt(this,"needsTransportRestart",!1),Wt(this,"publish",async(n,i,s)=>{var o,a,c,u,l;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:i,opts:s}});const f=(s==null?void 0:s.ttl)||a6,h=(s==null?void 0:s.prompt)||!1,p=(s==null?void 0:s.tag)||0,g=(s==null?void 0:s.id)||_n().toString(),w=Kn(Us().protocol),v={id:g,method:(s==null?void 0:s.publishMethod)||w.publish,params:gi({topic:n,message:i,ttl:f,prompt:h,tag:p,attestation:s==null?void 0:s.attestation},s==null?void 0:s.tvf)},E=`Failed to publish payload, please try again. id:${g} tag:${p}`;try{Ze((o=v.params)==null?void 0:o.prompt)&&((a=v.params)==null||delete a.prompt),Ze((c=v.params)==null?void 0:c.tag)&&((u=v.params)==null||delete u.tag);const I=new Promise(async x=>{const A=({id:O})=>{var P;((P=v.id)==null?void 0:P.toString())===O.toString()&&(this.removeRequestFromQueue(O),this.relayer.events.removeListener(He.publish,A),x())};this.relayer.events.on(He.publish,A);const T=ur(new Promise((O,P)=>{this.rpcPublish(v,s).then(O).catch(M=>{this.logger.warn(M,M==null?void 0:M.message),P(M)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${g} tag:${p}`);try{await T,this.events.removeListener(He.publish,A)}catch(O){this.queue.set(g,{request:v,opts:s,attempt:1}),this.logger.warn(O,O==null?void 0:O.message)}});this.logger.trace({type:"method",method:"publish",params:{id:g,topic:n,message:i,opts:s}}),await ur(I,this.publishTimeout,E)}catch(I){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(I),(l=s==null?void 0:s.internal)!=null&&l.throwOnFailedPublish)throw I}finally{this.queue.delete(g)}}),Wt(this,"publishCustom",async n=>{var i,s,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:n});const{payload:u,opts:l={}}=n,{attestation:f,tvf:h,publishMethod:p,prompt:g,tag:w,ttl:v=pe.FIVE_MINUTES}=l,E=l.id||_n().toString(),I=Kn(Us().protocol),x=p||I.publish,A={id:E,method:x,params:gi(ag(gi({},u),{ttl:v,prompt:g,tag:w,attestation:f}),h)},T=`Failed to publish custom payload, please try again. id:${E} tag:${w}`;try{Ze((i=A.params)==null?void 0:i.prompt)&&((s=A.params)==null||delete s.prompt),Ze((o=A.params)==null?void 0:o.tag)&&((a=A.params)==null||delete a.tag);const O=new Promise(async P=>{const M=({id:G})=>{var se;((se=A.id)==null?void 0:se.toString())===G.toString()&&(this.removeRequestFromQueue(G),this.relayer.events.removeListener(He.publish,M),P())};this.relayer.events.on(He.publish,M);const U=ur(new Promise((G,se)=>{this.rpcPublish(A,l).then(G).catch(Z=>{this.logger.warn(Z,Z==null?void 0:Z.message),se(Z)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${x} id:${E} tag:${w}`);try{await U,this.events.removeListener(He.publish,M)}catch(G){this.queue.set(E,{request:A,opts:l,attempt:1}),this.logger.warn(G,G==null?void 0:G.message)}});this.logger.trace({type:"method",method:"publish",params:{id:E,payload:u,opts:l}}),await ur(O,this.publishTimeout,T)}catch(O){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(O),(c=l==null?void 0:l.internal)!=null&&c.throwOnFailedPublish)throw O}finally{this.queue.delete(E)}}),Wt(this,"on",(n,i)=>{this.events.on(n,i)}),Wt(this,"once",(n,i)=>{this.events.once(n,i)}),Wt(this,"off",(n,i)=>{this.events.off(n,i)}),Wt(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.relayer=e,this.logger=Vt(r,this.name),this.registerEventListeners()}get context(){return Lt(this.logger)}async rpcPublish(e,r){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const n=await this.relayer.request(e);return this.relayer.events.emit(He.publish,gi(gi({},e),r)),this.logger.debug("Successfully Published Payload"),n}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{var n;const i=e.attempt+1;this.queue.set(r,ag(gi({},e),{attempt:i})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(n=e.request.params)==null?void 0:n.tag}, attempt: ${i}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(ti.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(He.connection_stalled);return}this.checkQueue()}),this.relayer.on(He.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var _N=Object.defineProperty,xN=(t,e,r)=>e in t?_N(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,yi=(t,e,r)=>xN(t,typeof e!="symbol"?e+"":e,r);class SN{constructor(){yi(this,"map",new Map),yi(this,"set",(e,r)=>{const n=this.get(e);this.exists(e,r)||this.map.set(e,[...n,r])}),yi(this,"get",e=>this.map.get(e)||[]),yi(this,"exists",(e,r)=>this.get(e).includes(r)),yi(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const n=this.get(e);if(!this.exists(e,r))return;const i=n.filter(s=>s!==r);if(!i.length){this.map.delete(e);return}this.map.set(e,i)}),yi(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var IN=Object.defineProperty,AN=Object.defineProperties,TN=Object.getOwnPropertyDescriptors,cg=Object.getOwnPropertySymbols,ON=Object.prototype.hasOwnProperty,CN=Object.prototype.propertyIsEnumerable,Xl=(t,e,r)=>e in t?IN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,as=(t,e)=>{for(var r in e||(e={}))ON.call(e,r)&&Xl(t,r,e[r]);if(cg)for(var r of cg(e))CN.call(e,r)&&Xl(t,r,e[r]);return t},Lu=(t,e)=>AN(t,TN(e)),Fe=(t,e,r)=>Xl(t,typeof e!="symbol"?e+"":e,r);class DN extends nS{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,Fe(this,"subscriptions",new Map),Fe(this,"topicMap",new SN),Fe(this,"events",new zt.EventEmitter),Fe(this,"name",g6),Fe(this,"version",y6),Fe(this,"pending",new Map),Fe(this,"cached",[]),Fe(this,"initialized",!1),Fe(this,"storagePrefix",Tr),Fe(this,"subscribeTimeout",pe.toMiliseconds(pe.ONE_MINUTE)),Fe(this,"initialSubscribeTimeout",pe.toMiliseconds(pe.ONE_SECOND*15)),Fe(this,"clientId"),Fe(this,"batchSubscribeTopicsLimit",500),Fe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),Fe(this,"subscribe",async(n,i)=>{var s;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:i}});try{const o=Us(i),a={topic:n,relay:o,transportType:i==null?void 0:i.transportType};(s=i==null?void 0:i.internal)!=null&&s.skipSubscribe||this.pending.set(n,a);const c=await this.rpcSubscribe(n,o,i);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:i}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),Fe(this,"unsubscribe",async(n,i)=>{this.isInitialized(),typeof(i==null?void 0:i.id)<"u"?await this.unsubscribeById(n,i.id,i):await this.unsubscribeByTopic(n,i)}),Fe(this,"isSubscribed",n=>new Promise(i=>{i(this.topicMap.topics.includes(n))})),Fe(this,"isKnownTopic",n=>new Promise(i=>{i(this.topicMap.topics.includes(n)||this.pending.has(n)||this.cached.some(s=>s.topic===n))})),Fe(this,"on",(n,i)=>{this.events.on(n,i)}),Fe(this,"once",(n,i)=>{this.events.once(n,i)}),Fe(this,"off",(n,i)=>{this.events.off(n,i)}),Fe(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),Fe(this,"start",async()=>{await this.onConnect()}),Fe(this,"stop",async()=>{await this.onDisconnect()}),Fe(this,"restart",async()=>{await this.restore(),await this.onRestart()}),Fe(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const n=[];this.pending.forEach(i=>{n.push(i)}),await this.batchSubscribe(n)}),Fe(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(ti.pulse,async()=>{await this.checkPending()}),this.events.on(Mt.created,async n=>{const i=Mt.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:n}),await this.persist()}),this.events.on(Mt.deleted,async n=>{const i=Mt.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:n}),await this.persist()})}),this.relayer=e,this.logger=Vt(r,this.name),this.clientId=""}get context(){return Lt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let n=!1;try{n=this.getSubscription(e).topic===r}catch{}return n}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const n=this.topicMap.get(e);await Promise.all(n.map(async i=>await this.unsubscribeById(e,i,r)))}async unsubscribeById(e,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}});try{const i=Us(n);await this.restartToComplete({topic:e,id:r,relay:i}),await this.rpcUnsubscribe(e,r,i);const s=Ve("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(e,r,n){var i,s;const o=await this.getSubscriptionId(e);if((i=n==null?void 0:n.internal)!=null&&i.skipSubscribe)return o;(!n||(n==null?void 0:n.transportType)===qe.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});const a={method:Kn(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(s=n==null?void 0:n.internal)==null?void 0:s.throwOnFailedPublish;try{if((n==null?void 0:n.transportType)===qe.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(f=>this.logger.warn(f))},pe.toMiliseconds(pe.ONE_SECOND)),o;const u=new Promise(async f=>{const h=p=>{p.topic===e&&(this.events.removeListener(Mt.created,h),f(p.id))};this.events.on(Mt.created,h);try{const p=await ur(new Promise((g,w)=>{this.relayer.request(a).catch(v=>{this.logger.warn(v,v==null?void 0:v.message),w(v)}).then(g)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Mt.created,h),f(p)}catch{}}),l=await ur(u,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!l&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return l?o:null}catch(u){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(He.connection_stalled),c)throw u}return null}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,n={method:Kn(r.protocol).batchSubscribe,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await ur(new Promise(i=>{this.relayer.request(n).catch(s=>this.logger.warn(s)).then(i)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(He.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const r=e[0].relay,n={method:Kn(r.protocol).batchFetchMessages,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});let i;try{i=await await ur(new Promise((s,o)=>{this.relayer.request(n).catch(a=>{this.logger.warn(a),o(a)}).then(s)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(He.connection_stalled)}return i}rpcUnsubscribe(e,r,n){const i={method:Kn(n.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,r){this.setSubscription(e,Lu(as({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,as({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,n),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,as({},r)),this.topicMap.set(r.topic,e),this.events.emit(Mt.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:n}=de("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const n=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(n.topic,e),this.events.emit(Mt.deleted,Lu(as({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Mt.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let n=0;n<r;n++){const i=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(Mt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(r=>{var n;return r.topic===((n=this.subscriptions.get(r.id))==null?void 0:n.topic)})){const{message:r}=de("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async r=>Lu(as({},r),{id:await this.getSubscriptionId(r.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await Ww(pe.toMiliseconds(pe.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=de("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return jt(e+await this.getClientId())}}var BN=Object.defineProperty,ug=Object.getOwnPropertySymbols,RN=Object.prototype.hasOwnProperty,NN=Object.prototype.propertyIsEnumerable,Zl=(t,e,r)=>e in t?BN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lg=(t,e)=>{for(var r in e||(e={}))RN.call(e,r)&&Zl(t,r,e[r]);if(ug)for(var r of ug(e))NN.call(e,r)&&Zl(t,r,e[r]);return t},Ne=(t,e,r)=>Zl(t,typeof e!="symbol"?e+"":e,r);class PN extends tS{constructor(e){var r;super(e),Ne(this,"protocol","wc"),Ne(this,"version",2),Ne(this,"core"),Ne(this,"logger"),Ne(this,"events",new zt.EventEmitter),Ne(this,"provider"),Ne(this,"messages"),Ne(this,"subscriber"),Ne(this,"publisher"),Ne(this,"name",l6),Ne(this,"transportExplicitlyClosed",!1),Ne(this,"initialized",!1),Ne(this,"connectionAttemptInProgress",!1),Ne(this,"relayUrl"),Ne(this,"projectId"),Ne(this,"packageName"),Ne(this,"bundleId"),Ne(this,"hasExperiencedNetworkDisruption",!1),Ne(this,"pingTimeout"),Ne(this,"heartBeatTimeout",pe.toMiliseconds(pe.THIRTY_SECONDS+pe.FIVE_SECONDS)),Ne(this,"reconnectTimeout"),Ne(this,"connectPromise"),Ne(this,"reconnectInProgress",!1),Ne(this,"requestsInFlight",[]),Ne(this,"connectTimeout",pe.toMiliseconds(pe.ONE_SECOND*15)),Ne(this,"request",async n=>{var i,s;this.logger.debug("Publishing Request Payload");const o=n.id||_n().toString();await this.toEstablishConnection();try{this.logger.trace({id:o,method:n.method,topic:(i=n.params)==null?void 0:i.topic},"relayer.request - publishing...");const a=`${o}:${((s=n.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(a);const c=await this.provider.request(n);return this.requestsInFlight=this.requestsInFlight.filter(u=>u!==a),c}catch(a){throw this.logger.debug(`Failed to Publish Request: ${o}`),a}}),Ne(this,"resetPingTimeout",()=>{Rs()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var n,i,s,o;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(o=(s=(i=(n=this.provider)==null?void 0:n.connection)==null?void 0:i.socket)==null?void 0:s.terminate)==null||o.call(s)}catch(a){this.logger.warn(a,a==null?void 0:a.message)}},this.heartBeatTimeout))}),Ne(this,"onPayloadHandler",n=>{this.onProviderPayload(n),this.resetPingTimeout()}),Ne(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(He.connect)}),Ne(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),Ne(this,"onProviderErrorHandler",n=>{this.logger.fatal(`Fatal socket error: ${n.message}`),this.events.emit(He.error,n),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),Ne(this,"registerProviderListeners",()=>{this.provider.on(Kt.payload,this.onPayloadHandler),this.provider.on(Kt.connect,this.onConnectHandler),this.provider.on(Kt.disconnect,this.onDisconnectHandler),this.provider.on(Kt.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=mh({logger:(r=e.logger)!=null?r:u6,name:this.name}),this.messages=new gN(this.logger,e.core),this.subscriber=new DN(this,this.logger),this.publisher=new vN(this,this.logger),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||lb,Ow()?this.packageName=wl():Cw()&&(this.bundleId=wl()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e==null?void 0:e.message))}get context(){return Lt(this.logger)}get connected(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===1||!1}get connecting(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,n){this.isInitialized(),await this.publisher.publish(e,r,n),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:qe.relay},Do.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,r){var n,i,s;this.isInitialized(),(!(r!=null&&r.transportType)||(r==null?void 0:r.transportType)==="relay")&&await this.toEstablishConnection();const o=typeof((n=r==null?void 0:r.internal)==null?void 0:n.throwOnFailedPublish)>"u"?!0:(i=r==null?void 0:r.internal)==null?void 0:i.throwOnFailedPublish;let a=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"",c;const u=l=>{l.topic===e&&(this.subscriber.off(Mt.created,u),c())};return await Promise.all([new Promise(l=>{c=l,this.subscriber.on(Mt.created,u)}),new Promise(async(l,f)=>{a=await this.subscriber.subscribe(e,lg({internal:{throwOnFailedPublish:o}},r)).catch(h=>{o&&f(h)})||a,l()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await ur(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,n)=>{await this.connect(e).then(r).catch(n).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await ql())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=e.sort((n,i)=>n.publishedAt-i.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(const n of r)try{await this.onMessageEvent(n)}catch(i){this.logger.warn(i,"Error while processing batch message event: "+(i==null?void 0:i.message))}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){const{topic:n}=e;if(!r.sessionExists){const i=Xe(pe.FIVE_MINUTES),s={topic:n,expiry:i,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(n,s)}this.events.emit(He.message,e),await this.recordMessageEvent(e,Do.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(n,i)=>{const s=()=>{i(new Error("Connection interrupted while trying to connect"))};this.provider.once(Kt.disconnect,s),await ur(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{i(o)}).finally(()=>{this.provider.off(Kt.disconnect,s),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{i(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Kt.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(Kt.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,n()})}catch(n){await this.subscriber.stop();const i=n;this.logger.warn({},i.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(n=>setTimeout(n,pe.toMiliseconds(r*1))),r++}}startPingTimeout(){var e,r,n,i,s;if(Rs())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((s=(i=(n=this.provider)==null?void 0:n.connection)==null?void 0:i.socket)==null||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o==null?void 0:o.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new WB(new ZB(Pw({sdkVersion:Hl,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){const{topic:n,message:i}=e;await this.messages.set(n,i,r)}async shouldIgnoreMessageEvent(e){const{topic:r,message:n}=e;if(!n||n.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;const i=this.messages.has(r,n);return i&&this.logger.warn(`Ignoring duplicate message: ${n}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),vh(e)){if(!e.method.endsWith(f6))return;const r=e.params,{topic:n,message:i,publishedAt:s,attestation:o}=r.data,a={topic:n,message:i,publishedAt:s,transportType:qe.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(lg({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else ja(e)&&this.events.emit(He.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,Do.inbound),this.events.emit(He.message,e))}async acknowledgePayload(e){const r=sa(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(Kt.payload,this.onPayloadHandler),this.provider.off(Kt.connect,this.onConnectHandler),this.provider.off(Kt.disconnect,this.onDisconnectHandler),this.provider.off(Kt.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await ql();Y1(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(n=>this.logger.error(n,n==null?void 0:n.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(ti.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&J1())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(r){this.logger.warn(r,r==null?void 0:r.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(He.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},pe.toMiliseconds(h6)))))}isInitialized(){if(!this.initialized){const{message:e}=de("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function UN(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function fg(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function hg(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const LN="[object RegExp]",$N="[object String]",MN="[object Number]",FN="[object Boolean]",dg="[object Arguments]",kN="[object Symbol]",jN="[object Date]",qN="[object Map]",zN="[object Set]",VN="[object Array]",HN="[object Function]",KN="[object ArrayBuffer]",$u="[object Object]",WN="[object Error]",GN="[object DataView]",YN="[object Uint8Array]",XN="[object Uint8ClampedArray]",ZN="[object Uint16Array]",JN="[object Uint32Array]",QN="[object BigUint64Array]",eP="[object Int8Array]",tP="[object Int16Array]",rP="[object Int32Array]",nP="[object BigInt64Array]",iP="[object Float32Array]",sP="[object Float64Array]";function oP(){}function pg(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function aP(t,e,r){return ds(t,e,void 0,void 0,void 0,void 0,r)}function ds(t,e,r,n,i,s,o){const a=o(t,e,r,n,i,s);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return xs(t,e,s,o)}return xs(t,e,s,o)}function xs(t,e,r,n){if(Object.is(t,e))return!0;let i=hg(t),s=hg(e);if(i===dg&&(i=$u),s===dg&&(s=$u),i!==s)return!1;switch(i){case $N:return t.toString()===e.toString();case MN:{const c=t.valueOf(),u=e.valueOf();return UN(c,u)}case FN:case jN:case kN:return Object.is(t.valueOf(),e.valueOf());case LN:return t.source===e.source&&t.flags===e.flags;case HN:return t===e}r=r??new Map;const o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(i){case qN:{if(t.size!==e.size)return!1;for(const[c,u]of t.entries())if(!e.has(c)||!ds(u,e.get(c),c,t,e,r,n))return!1;return!0}case zN:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),u=Array.from(e.values());for(let l=0;l<c.length;l++){const f=c[l],h=u.findIndex(p=>ds(f,p,void 0,t,e,r,n));if(h===-1)return!1;u.splice(h,1)}return!0}case VN:case YN:case XN:case ZN:case JN:case QN:case eP:case tP:case rP:case nP:case iP:case sP:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!ds(t[c],e[c],c,t,e,r,n))return!1;return!0}case KN:return t.byteLength!==e.byteLength?!1:xs(new Uint8Array(t),new Uint8Array(e),r,n);case GN:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:xs(new Uint8Array(t),new Uint8Array(e),r,n);case WN:return t.name===e.name&&t.message===e.message;case $u:{if(!(xs(t.constructor,e.constructor,r,n)||pg(t)&&pg(e)))return!1;const c=[...Object.keys(t),...fg(t)],u=[...Object.keys(e),...fg(e)];if(c.length!==u.length)return!1;for(let l=0;l<c.length;l++){const f=c[l],h=t[f];if(!Object.hasOwn(e,f))return!1;const p=e[f];if(!ds(h,p,f,t,e,r,n))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function cP(t,e){return aP(t,e,oP)}var uP=Object.defineProperty,gg=Object.getOwnPropertySymbols,lP=Object.prototype.hasOwnProperty,fP=Object.prototype.propertyIsEnumerable,Jl=(t,e,r)=>e in t?uP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,yg=(t,e)=>{for(var r in e||(e={}))lP.call(e,r)&&Jl(t,r,e[r]);if(gg)for(var r of gg(e))fP.call(e,r)&&Jl(t,r,e[r]);return t},Ct=(t,e,r)=>Jl(t,typeof e!="symbol"?e+"":e,r);class ci extends rS{constructor(e,r,n,i=Tr,s=void 0){super(e,r,n,i),this.core=e,this.logger=r,this.name=n,Ct(this,"map",new Map),Ct(this,"version",d6),Ct(this,"cached",[]),Ct(this,"initialized",!1),Ct(this,"getKey"),Ct(this,"storagePrefix",Tr),Ct(this,"recentlyDeleted",[]),Ct(this,"recentlyDeletedLimit",200),Ct(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Ze(o)?this.map.set(this.getKey(o),o):O1(o)?this.map.set(o.id,o):C1(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Ct(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Ct(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Ct(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>cP(a[c],o[c]))):this.values)),Ct(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=yg(yg({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Ct(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Vt(r,this.name),this.storagePrefix=i,this.getKey=s}get context(){return Lt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:i}=de("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}const{message:n}=de("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=de("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=de("NOT_INITIALIZED",this.name);throw new Error(e)}}}var hP=Object.defineProperty,dP=(t,e,r)=>e in t?hP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ce=(t,e,r)=>dP(t,typeof e!="symbol"?e+"":e,r);class pP{constructor(e,r){this.core=e,this.logger=r,Ce(this,"name",w6),Ce(this,"version",m6),Ce(this,"events",new l0),Ce(this,"pairings"),Ce(this,"initialized",!1),Ce(this,"storagePrefix",Tr),Ce(this,"ignoredPayloadTypes",[Ir]),Ce(this,"registeredMethods",[]),Ce(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),Ce(this,"register",({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]}),Ce(this,"create",async n=>{this.isInitialized();const i=na(),s=await this.core.crypto.setSymKey(i),o=Xe(pe.FIVE_MINUTES),a={protocol:ub},c={topic:s,expiry:o,relay:a,active:!1,methods:n==null?void 0:n.methods},u=Ml({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:a,expiryTimestamp:o,methods:n==null?void 0:n.methods});return this.events.emit(kn.create,c),this.core.expirer.set(s,o),await this.pairings.set(s,c),await this.core.relayer.subscribe(s,{transportType:n==null?void 0:n.transportType,internal:n==null?void 0:n.internal}),{topic:s,uri:u}}),Ce(this,"pair",async n=>{this.isInitialized();const i=this.core.eventClient.createEvent({properties:{topic:n==null?void 0:n.uri,trace:[mr.pairing_started]}});this.isValidPair(n,i);const{topic:s,symKey:o,relay:a,expiryTimestamp:c,methods:u}=$l(n.uri);i.props.properties.topic=s,i.addTrace(mr.pairing_uri_validation_success),i.addTrace(mr.pairing_uri_not_expired);let l;if(this.pairings.keys.includes(s)){if(l=this.pairings.get(s),i.addTrace(mr.existing_pairing),l.active)throw i.setError($r.active_pairing_already_exists),new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);i.addTrace(mr.pairing_not_expired)}const f=c||Xe(pe.FIVE_MINUTES),h={topic:s,relay:a,expiry:f,active:!1,methods:u};this.core.expirer.set(s,f),await this.pairings.set(s,h),i.addTrace(mr.store_new_pairing),n.activatePairing&&await this.activate({topic:s}),this.events.emit(kn.create,h),i.addTrace(mr.emit_inactive_pairing),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),i.addTrace(mr.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{i.setError($r.no_internet_connection)}try{await this.core.relayer.subscribe(s,{relay:a})}catch(p){throw i.setError($r.subscribe_pairing_topic_failure),p}return i.addTrace(mr.subscribe_pairing_topic_success),h}),Ce(this,"activate",async({topic:n})=>{this.isInitialized();const i=Xe(pe.FIVE_MINUTES);this.core.expirer.set(n,i),await this.pairings.update(n,{active:!0,expiry:i})}),Ce(this,"ping",async n=>{this.isInitialized(),await this.isValidPing(n),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:i}=n;if(this.pairings.keys.includes(i)){const s=await this.sendRequest(i,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=dn();this.events.once(Le("pairing_ping",s),({error:u})=>{u?c(u):a()}),await o()}}),Ce(this,"updateExpiry",async({topic:n,expiry:i})=>{this.isInitialized(),await this.pairings.update(n,{expiry:i})}),Ce(this,"updateMetadata",async({topic:n,metadata:i})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:i})}),Ce(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),Ce(this,"disconnect",async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:i}=n;this.pairings.keys.includes(i)&&(await this.sendRequest(i,"wc_pairingDelete",Ve("USER_DISCONNECTED")),await this.deletePairing(i))}),Ce(this,"formatUriFromPairing",n=>{this.isInitialized();const{topic:i,relay:s,expiry:o,methods:a}=n,c=this.core.crypto.keychain.get(i);return Ml({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:c,relay:s,expiryTimestamp:o,methods:a})}),Ce(this,"sendRequest",async(n,i,s)=>{const o=qr(i,s),a=await this.core.crypto.encode(n,o),c=ss[i].req;return this.core.history.set(n,o),this.core.relayer.publish(n,a,c),o.id}),Ce(this,"sendResult",async(n,i,s)=>{const o=sa(n,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,n)).request.method,u=ss[c].res;await this.core.relayer.publish(i,a,u),await this.core.history.resolve(o)}),Ce(this,"sendError",async(n,i,s)=>{const o=Eh(n,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,n)).request.method,u=ss[c]?ss[c].res:ss.unregistered_method.res;await this.core.relayer.publish(i,a,u),await this.core.history.resolve(o)}),Ce(this,"deletePairing",async(n,i)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,Ve("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),i?Promise.resolve():this.core.expirer.del(n)])}),Ce(this,"cleanup",async()=>{const n=this.pairings.getAll().filter(i=>kr(i.expiry));await Promise.all(n.map(i=>this.deletePairing(i.topic)))}),Ce(this,"onRelayEventRequest",async n=>{const{topic:i,payload:s}=n;switch(s.method){case"wc_pairingPing":return await this.onPairingPingRequest(i,s);case"wc_pairingDelete":return await this.onPairingDeleteRequest(i,s);default:return await this.onUnknownRpcMethodRequest(i,s)}}),Ce(this,"onRelayEventResponse",async n=>{const{topic:i,payload:s}=n,o=(await this.core.history.get(i,s.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(i,s);default:return this.onUnknownRpcMethodResponse(o)}}),Ce(this,"onPairingPingRequest",async(n,i)=>{const{id:s}=i;try{this.isValidPing({topic:n}),await this.sendResult(s,n,!0),this.events.emit(kn.ping,{id:s,topic:n})}catch(o){await this.sendError(s,n,o),this.logger.error(o)}}),Ce(this,"onPairingPingResponse",(n,i)=>{const{id:s}=i;setTimeout(()=>{Er(i)?this.events.emit(Le("pairing_ping",s),{}):Zt(i)&&this.events.emit(Le("pairing_ping",s),{error:i.error})},500)}),Ce(this,"onPairingDeleteRequest",async(n,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(kn.delete,{id:s,topic:n})}catch(o){await this.sendError(s,n,o),this.logger.error(o)}}),Ce(this,"onUnknownRpcMethodRequest",async(n,i)=>{const{id:s,method:o}=i;try{if(this.registeredMethods.includes(o))return;const a=Ve("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,n,a),this.logger.error(a)}catch(a){await this.sendError(s,n,a),this.logger.error(a)}}),Ce(this,"onUnknownRpcMethodResponse",n=>{this.registeredMethods.includes(n)||this.logger.error(Ve("WC_METHOD_UNSUPPORTED",n))}),Ce(this,"isValidPair",(n,i)=>{var s;if(!xt(n)){const{message:a}=de("MISSING_OR_INVALID",`pair() params: ${n}`);throw i.setError($r.malformed_pairing_uri),new Error(a)}if(!T1(n.uri)){const{message:a}=de("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw i.setError($r.malformed_pairing_uri),new Error(a)}const o=$l(n==null?void 0:n.uri);if(!((s=o==null?void 0:o.relay)!=null&&s.protocol)){const{message:a}=de("MISSING_OR_INVALID","pair() uri#relay-protocol");throw i.setError($r.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=de("MISSING_OR_INVALID","pair() uri#symKey");throw i.setError($r.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&pe.toMiliseconds(o==null?void 0:o.expiryTimestamp)<Date.now()){i.setError($r.pairing_expired);const{message:a}=de("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),Ce(this,"isValidPing",async n=>{if(!xt(n)){const{message:s}=de("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(s)}const{topic:i}=n;await this.isValidPairingTopic(i)}),Ce(this,"isValidDisconnect",async n=>{if(!xt(n)){const{message:s}=de("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(s)}const{topic:i}=n;await this.isValidPairingTopic(i)}),Ce(this,"isValidPairingTopic",async n=>{if(!Ke(n,!1)){const{message:i}=de("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(i)}if(!this.pairings.keys.includes(n)){const{message:i}=de("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(i)}if(kr(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:i}=de("EXPIRED",`pairing topic: ${n}`);throw new Error(i)}}),this.core=e,this.logger=Vt(r,this.name),this.pairings=new ci(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Lt(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=de("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(He.message,async e=>{const{topic:r,message:n,transportType:i}=e;if(this.pairings.keys.includes(r)&&i!==qe.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))try{const s=await this.core.crypto.decode(r,n);vh(s)?(this.core.history.set(r,s),await this.onRelayEventRequest({topic:r,payload:s})):ja(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:r,payload:s}),this.core.history.delete(r,s.id)),await this.core.relayer.messages.ack(r,n)}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(Gt.expired,async e=>{const{topic:r}=Wf(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(kn.expire,{topic:r}))})}}var gP=Object.defineProperty,yP=(t,e,r)=>e in t?gP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lt=(t,e,r)=>yP(t,typeof e!="symbol"?e+"":e,r);class wP extends Jx{constructor(e,r){super(e,r),this.core=e,this.logger=r,lt(this,"records",new Map),lt(this,"events",new zt.EventEmitter),lt(this,"name",b6),lt(this,"version",E6),lt(this,"cached",[]),lt(this,"initialized",!1),lt(this,"storagePrefix",Tr),lt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),lt(this,"set",(n,i,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:i,chainId:s}),this.records.has(i.id))return;const o={id:i.id,topic:n,request:{method:i.method,params:i.params||null},chainId:s,expiry:Xe(pe.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(ir.created,o)}),lt(this,"resolve",async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const i=await this.getRecord(n.id);typeof i.response>"u"&&(i.response=Zt(n)?{error:n.error}:{result:n.result},this.records.set(i.id,i),this.persist(),this.events.emit(ir.updated,i))}),lt(this,"get",async(n,i)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:i}),await this.getRecord(i))),lt(this,"delete",(n,i)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:i}),this.values.forEach(s=>{if(s.topic===n){if(typeof i<"u"&&s.id!==i)return;this.records.delete(s.id),this.events.emit(ir.deleted,s)}}),this.persist()}),lt(this,"exists",async(n,i)=>(this.isInitialized(),this.records.has(i)?(await this.getRecord(i)).topic===n:!1)),lt(this,"on",(n,i)=>{this.events.on(n,i)}),lt(this,"once",(n,i)=>{this.events.once(n,i)}),lt(this,"off",(n,i)=>{this.events.off(n,i)}),lt(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.logger=Vt(r,this.name)}get context(){return Lt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:qr(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(n)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:n}=de("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(ir.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=de("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(ir.created,e=>{const r=ir.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(ir.updated,e=>{const r=ir.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(ir.deleted,e=>{const r=ir.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(ti.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{pe.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(ir.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=de("NOT_INITIALIZED",this.name);throw new Error(e)}}}var mP=Object.defineProperty,bP=(t,e,r)=>e in t?mP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,bt=(t,e,r)=>bP(t,typeof e!="symbol"?e+"":e,r);class EP extends iS{constructor(e,r){super(e,r),this.core=e,this.logger=r,bt(this,"expirations",new Map),bt(this,"events",new zt.EventEmitter),bt(this,"name",v6),bt(this,"version",_6),bt(this,"cached",[]),bt(this,"initialized",!1),bt(this,"storagePrefix",Tr),bt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),bt(this,"has",n=>{try{const i=this.formatTarget(n);return typeof this.getExpiration(i)<"u"}catch{return!1}}),bt(this,"set",(n,i)=>{this.isInitialized();const s=this.formatTarget(n),o={target:s,expiry:i};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(Gt.created,{target:s,expiration:o})}),bt(this,"get",n=>{this.isInitialized();const i=this.formatTarget(n);return this.getExpiration(i)}),bt(this,"del",n=>{if(this.isInitialized(),this.has(n)){const i=this.formatTarget(n),s=this.getExpiration(i);this.expirations.delete(i),this.events.emit(Gt.deleted,{target:i,expiration:s})}}),bt(this,"on",(n,i)=>{this.events.on(n,i)}),bt(this,"once",(n,i)=>{this.events.once(n,i)}),bt(this,"off",(n,i)=>{this.events.off(n,i)}),bt(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.logger=Vt(r,this.name)}get context(){return Lt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Mw(e);if(typeof e=="number")return Fw(e);const{message:r}=de("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Gt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=de("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:n}=de("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(n),new Error(n)}return r}checkExpiry(e,r){const{expiry:n}=r;pe.toMiliseconds(n)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(Gt.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(ti.pulse,()=>this.checkExpirations()),this.events.on(Gt.created,e=>{const r=Gt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(Gt.expired,e=>{const r=Gt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(Gt.deleted,e=>{const r=Gt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=de("NOT_INITIALIZED",this.name);throw new Error(e)}}}var vP=Object.defineProperty,_P=(t,e,r)=>e in t?vP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ye=(t,e,r)=>_P(t,typeof e!="symbol"?e+"":e,r);class xP extends sS{constructor(e,r,n){super(e,r,n),this.core=e,this.logger=r,this.store=n,Ye(this,"name",x6),Ye(this,"abortController"),Ye(this,"isDevEnv"),Ye(this,"verifyUrlV3",I6),Ye(this,"storagePrefix",Tr),Ye(this,"version",cb),Ye(this,"publicKey"),Ye(this,"fetchPromise"),Ye(this,"init",async()=>{var i;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&pe.toMiliseconds((i=this.publicKey)==null?void 0:i.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),Ye(this,"register",async i=>{if(!ii()||this.isDevEnv)return;const s=window.location.origin,{id:o,decryptedId:a}=i,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${s}&id=${o}&decryptedId=${a}`;try{const u=Xn(),l=this.startAbortTimer(pe.ONE_SECOND*5),f=await new Promise((h,p)=>{const g=()=>{window.removeEventListener("message",v),u.body.removeChild(w),p("attestation aborted")};this.abortController.signal.addEventListener("abort",g);const w=u.createElement("iframe");w.src=c,w.style.display="none",w.addEventListener("error",g,{signal:this.abortController.signal});const v=E=>{if(E.data&&typeof E.data=="string")try{const I=JSON.parse(E.data);if(I.type==="verify_attestation"){if(al(I.attestation).payload.id!==o)return;clearInterval(l),u.body.removeChild(w),this.abortController.signal.removeEventListener("abort",g),window.removeEventListener("message",v),h(I.attestation===null?"":I.attestation)}}catch(I){this.logger.warn(I)}};u.body.appendChild(w),window.addEventListener("message",v,{signal:this.abortController.signal})});return this.logger.debug(f,"jwt attestation"),f}catch(u){this.logger.warn(u)}return""}),Ye(this,"resolve",async i=>{if(this.isDevEnv)return"";const{attestationId:s,hash:o,encryptedId:a}=i;if(s===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(s){if(al(s).payload.id!==a)return;const u=await this.isValidJwtAttestation(s);if(u){if(!u.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return u}}if(!o)return;const c=this.getVerifyUrl(i==null?void 0:i.verifyUrl);return this.fetchAttestation(o,c)}),Ye(this,"fetchAttestation",async(i,s)=>{this.logger.debug(`resolving attestation: ${i} from url: ${s}`);const o=this.startAbortTimer(pe.ONE_SECOND*5),a=await fetch(`${s}/attestation/${i}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),Ye(this,"getVerifyUrl",i=>{let s=i||_s;return A6.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${_s}`),s=_s),s}),Ye(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const i=this.startAbortTimer(pe.FIVE_SECONDS),s=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(i),await s.json()}catch(i){this.logger.warn(i)}}),Ye(this,"persistPublicKey",async i=>{this.logger.debug(i,"persisting public key to local storage"),await this.store.setItem(this.storeKey,i),this.publicKey=i}),Ye(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),Ye(this,"isValidJwtAttestation",async i=>{const s=await this.getPublicKey();try{if(s)return this.validateAttestation(i,s)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(i,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),Ye(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),Ye(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async s=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),s(o))});const i=await this.fetchPromise;return this.fetchPromise=void 0,i}),Ye(this,"validateAttestation",(i,s)=>{const o=h1(i,s.publicKey),a={hasExpired:pe.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Vt(r,this.name),this.abortController=new AbortController,this.isDevEnv=Ca(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return Lt(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),pe.toMiliseconds(e))}}var SP=Object.defineProperty,IP=(t,e,r)=>e in t?SP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,wg=(t,e,r)=>IP(t,typeof e!="symbol"?e+"":e,r);class AP extends oS{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,wg(this,"context",T6),wg(this,"registerDeviceToken",async n=>{const{clientId:i,token:s,notificationType:o,enableEncrypted:a=!1}=n,c=`${O6}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:i,type:o,token:s,always_raw:a})})}),this.logger=Vt(r,this.context)}}var TP=Object.defineProperty,mg=Object.getOwnPropertySymbols,OP=Object.prototype.hasOwnProperty,CP=Object.prototype.propertyIsEnumerable,Ql=(t,e,r)=>e in t?TP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,cs=(t,e)=>{for(var r in e||(e={}))OP.call(e,r)&&Ql(t,r,e[r]);if(mg)for(var r of mg(e))CP.call(e,r)&&Ql(t,r,e[r]);return t},rt=(t,e,r)=>Ql(t,typeof e!="symbol"?e+"":e,r);class DP extends aS{constructor(e,r,n=!0){super(e,r,n),this.core=e,this.logger=r,rt(this,"context",D6),rt(this,"storagePrefix",Tr),rt(this,"storageVersion",C6),rt(this,"events",new Map),rt(this,"shouldPersist",!1),rt(this,"init",async()=>{if(!Ca())try{const i={eventId:El(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Hf(this.core.relayer.protocol,this.core.relayer.version,Hl)}}};await this.sendEvent([i])}catch(i){this.logger.warn(i)}}),rt(this,"createEvent",i=>{const{event:s="ERROR",type:o="",properties:{topic:a,trace:c}}=i,u=El(),l=this.core.projectId||"",f=Date.now(),h=cs({eventId:u,timestamp:f,props:{event:s,type:o,properties:{topic:a,trace:c}},bundleId:l,domain:this.getAppDomain()},this.setMethods(u));return this.telemetryEnabled&&(this.events.set(u,h),this.shouldPersist=!0),h}),rt(this,"getEvent",i=>{const{eventId:s,topic:o}=i;if(s)return this.events.get(s);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return cs(cs({},a),this.setMethods(a.eventId))}),rt(this,"deleteEvent",i=>{const{eventId:s}=i;this.events.delete(s),this.shouldPersist=!0}),rt(this,"setEventListeners",()=>{this.core.heartbeat.on(ti.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(i=>{pe.fromMiliseconds(Date.now())-pe.fromMiliseconds(i.timestamp)>B6&&(this.events.delete(i.eventId),this.shouldPersist=!0)})})}),rt(this,"setMethods",i=>({addTrace:s=>this.addTrace(i,s),setError:s=>this.setError(i,s)})),rt(this,"addTrace",(i,s)=>{const o=this.events.get(i);o&&(o.props.properties.trace.push(s),this.events.set(i,o),this.shouldPersist=!0)}),rt(this,"setError",(i,s)=>{const o=this.events.get(i);o&&(o.props.type=s,o.timestamp=Date.now(),this.events.set(i,o),this.shouldPersist=!0)}),rt(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),rt(this,"restore",async()=>{try{const i=await this.core.storage.getItem(this.storageKey)||[];if(!i.length)return;i.forEach(s=>{this.events.set(s.eventId,cs(cs({},s),this.setMethods(s.eventId)))})}catch(i){this.logger.warn(i)}}),rt(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const i=[];for(const[s,o]of this.events)o.props.type&&i.push(o);if(i.length!==0)try{if((await this.sendEvent(i)).ok)for(const s of i)this.events.delete(s.eventId),this.shouldPersist=!0}catch(s){this.logger.warn(s)}}),rt(this,"sendEvent",async i=>{const s=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${R6}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Hl}${s}`,{method:"POST",body:JSON.stringify(i)})}),rt(this,"getAppDomain",()=>Vf().url),this.logger=Vt(r,this.context),this.telemetryEnabled=n,n?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var BP=Object.defineProperty,bg=Object.getOwnPropertySymbols,RP=Object.prototype.hasOwnProperty,NP=Object.prototype.propertyIsEnumerable,ef=(t,e,r)=>e in t?BP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Eg=(t,e)=>{for(var r in e||(e={}))RP.call(e,r)&&ef(t,r,e[r]);if(bg)for(var r of bg(e))NP.call(e,r)&&ef(t,r,e[r]);return t},ke=(t,e,r)=>ef(t,typeof e!="symbol"?e+"":e,r);class _h extends Gx{constructor(e){var r;super(e),ke(this,"protocol",ab),ke(this,"version",cb),ke(this,"name",Vl),ke(this,"relayUrl"),ke(this,"projectId"),ke(this,"customStoragePrefix"),ke(this,"events",new zt.EventEmitter),ke(this,"logger"),ke(this,"heartbeat"),ke(this,"relayer"),ke(this,"crypto"),ke(this,"storage"),ke(this,"history"),ke(this,"expirer"),ke(this,"pairing"),ke(this,"verify"),ke(this,"echoClient"),ke(this,"linkModeSupportedApps"),ke(this,"eventClient"),ke(this,"initialized",!1),ke(this,"logChunkController"),ke(this,"on",(a,c)=>this.events.on(a,c)),ke(this,"once",(a,c)=>this.events.once(a,c)),ke(this,"off",(a,c)=>this.events.off(a,c)),ke(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),ke(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:u})=>{if(!a||!c)return;const l={topic:a,message:c,publishedAt:Date.now(),transportType:qe.link_mode};this.relayer.onLinkMessageEvent(l,{sessionExists:u})});const n=this.getGlobalCore(e==null?void 0:e.customStoragePrefix);if(n)try{return this.customStoragePrefix=n.customStoragePrefix,this.logger=n.logger,this.heartbeat=n.heartbeat,this.crypto=n.crypto,this.history=n.history,this.expirer=n.expirer,this.storage=n.storage,this.relayer=n.relayer,this.pairing=n.pairing,this.verify=n.verify,this.echoClient=n.echoClient,this.linkModeSupportedApps=n.linkModeSupportedApps,this.eventClient=n.eventClient,this.initialized=n.initialized,this.logChunkController=n.logChunkController,n}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||lb,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const i=jx({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:QB.logger,name:Vl}),{logger:s,chunkLoggerController:o}=$0({opts:i,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=o,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Vt(s,this.name),this.heartbeat=new v_,this.crypto=new aN(this,this.logger,e==null?void 0:e.keychain),this.history=new wP(this,this.logger),this.expirer=new EP(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new nx(Eg(Eg({},e6),e==null?void 0:e.storageOptions)),this.relayer=new PN({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new pP(this,this.logger),this.verify=new xP(this,this.logger,this.storage),this.echoClient=new AP(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new DP(this,this.logger,e==null?void 0:e.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const r=new _h(e);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(p6,n),r}get context(){return Lt(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(Jp,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(Jp)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(e,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${e}`,n=`${r}_count`;return globalThis[n]=(globalThis[n]||0)+1,globalThis[n]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[n]} times.`),globalThis[r]}catch(r){console.warn("Failed to get global WalletConnect core",r);return}}setGlobalCore(e){var r;try{if(this.isGlobalCoreDisabled())return;const n=`_walletConnectCore_${((r=e.opts)==null?void 0:r.customStoragePrefix)||""}`;globalThis[n]=e}catch(n){console.warn("Failed to set global WalletConnect core",n)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&JB.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}}const PP=_h,xh="wc",Sh=2,Ih="client",za=`${xh}@${Sh}:${Ih}:`,Bo={name:Ih,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.org"},UP={session_proposal:"session_proposal",session_update:"session_update",session_extend:"session_extend",session_ping:"session_ping",session_delete:"session_delete",session_expire:"session_expire",session_request:"session_request",session_request_sent:"session_request_sent",session_event:"session_event",proposal_expire:"proposal_expire",session_authenticate:"session_authenticate",session_request_expire:"session_request_expire",session_connect:"session_connect"},LP={database:":memory:"},tf="WALLETCONNECT_DEEPLINK_CHOICE",$P={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},MP="history",FP="0.3",xb="proposal",kP=pe.THIRTY_DAYS,rf="Proposal expired",Sb="session",$n=pe.SEVEN_DAYS,Ib="engine",it={wc_sessionPropose:{req:{ttl:pe.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:pe.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:pe.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:pe.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:pe.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:pe.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:pe.ONE_DAY,prompt:!1,tag:1104},res:{ttl:pe.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:pe.ONE_DAY,prompt:!1,tag:1106},res:{ttl:pe.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:pe.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:pe.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:pe.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:pe.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:pe.ONE_DAY,prompt:!1,tag:1112},res:{ttl:pe.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:pe.ONE_DAY,prompt:!1,tag:1114},res:{ttl:pe.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:pe.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:pe.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:pe.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:pe.FIVE_MINUTES,prompt:!1,tag:1119}}},Ro={min:pe.FIVE_MINUTES,max:pe.SEVEN_DAYS},ar={idle:"IDLE",active:"ACTIVE"},Ab={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},Tb="request",Ob=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],Cb="wc",jP=1.5,Db="auth",Bb="authKeys",Rb="pairingTopics",Nb="requests",Zs=`${Cb}@${1.5}:${Db}:`,Ss=`${Zs}:PUB_KEY`;var qP=Object.defineProperty,zP=Object.defineProperties,VP=Object.getOwnPropertyDescriptors,vg=Object.getOwnPropertySymbols,HP=Object.prototype.hasOwnProperty,KP=Object.prototype.propertyIsEnumerable,nf=(t,e,r)=>e in t?qP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$e=(t,e)=>{for(var r in e||(e={}))HP.call(e,r)&&nf(t,r,e[r]);if(vg)for(var r of vg(e))KP.call(e,r)&&nf(t,r,e[r]);return t},Et=(t,e)=>zP(t,VP(e)),ue=(t,e,r)=>nf(t,typeof e!="symbol"?e+"":e,r);class WP extends fS{constructor(e){super(e),ue(this,"name",Ib),ue(this,"events",new l0),ue(this,"initialized",!1),ue(this,"requestQueue",{state:ar.idle,queue:[]}),ue(this,"sessionRequestQueue",{state:ar.idle,queue:[]}),ue(this,"emittedSessionRequests",new Gw({limit:500})),ue(this,"requestQueueDelay",pe.ONE_SECOND),ue(this,"expectedPairingMethodMap",new Map),ue(this,"recentlyDeletedMap",new Map),ue(this,"recentlyDeletedLimit",200),ue(this,"relayMessageCache",[]),ue(this,"pendingSessions",new Map),ue(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(it)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},pe.toMiliseconds(this.requestQueueDelay)))}),ue(this,"connect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const n=Et($e({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(n),n.optionalNamespaces=_1(n.requiredNamespaces,n.optionalNamespaces),n.requiredNamespaces={};const{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:u}=n;let l=i,f,h=!1;try{if(l){const O=this.client.core.pairing.pairings.get(l);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),h=O.active}}catch(O){throw this.client.logger.error(`connect() -> pairing.get(${l}) failed`),O}if(!l||!h){const{topic:O,uri:P}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});l=O,f=P}if(!l){const{message:O}=de("NO_MATCHING_KEY",`connect() pairing topic: ${l}`);throw new Error(O)}const p=await this.client.core.crypto.generateKeyPair(),g=it.wc_sessionPropose.req.ttl||pe.FIVE_MINUTES,w=Xe(g),v=Et($e($e({requiredNamespaces:s,optionalNamespaces:o,relays:u??[{protocol:ub}],proposer:{publicKey:p,metadata:this.client.metadata},expiryTimestamp:w,pairingTopic:l},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:br()}),E=Le("session_connect",v.id),{reject:I,resolve:x,done:A}=dn(g,rf),T=({id:O})=>{O===v.id&&(this.client.events.off("proposal_expire",T),this.pendingSessions.delete(v.id),this.events.emit(E,{error:{message:rf,code:0}}))};return this.client.events.on("proposal_expire",T),this.events.once(E,({error:O,session:P})=>{this.client.events.off("proposal_expire",T),O?I(O):P&&x(P)}),await this.sendProposeSession({proposal:v,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:v.id}}}),await this.setProposal(v.id,v),{uri:f,approval:A}}),ue(this,"pair",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(r)}catch(n){throw this.client.logger.error("pair() failed"),n}}),ue(this,"approve",async r=>{var n,i,s;const o=this.client.core.eventClient.createEvent({properties:{topic:(n=r==null?void 0:r.id)==null?void 0:n.toString(),trace:[sr.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(U){throw o.setError(Un.no_internet_connection),U}try{await this.isValidProposalId(r==null?void 0:r.id)}catch(U){throw this.client.logger.error(`approve() -> proposal.get(${r==null?void 0:r.id}) failed`),o.setError(Un.proposal_not_found),U}try{await this.isValidApprove(r)}catch(U){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Un.session_approve_namespace_validation_failure),U}const{id:a,relayProtocol:c,namespaces:u,sessionProperties:l,scopedProperties:f,sessionConfig:h}=r,p=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:g,proposer:w,requiredNamespaces:v,optionalNamespaces:E}=p;let I=(i=this.client.core.eventClient)==null?void 0:i.getEvent({topic:g});I||(I=(s=this.client.core.eventClient)==null?void 0:s.createEvent({type:sr.session_approve_started,properties:{topic:g,trace:[sr.session_approve_started,sr.session_namespaces_validation_success]}}));const x=await this.client.core.crypto.generateKeyPair(),A=w.publicKey,T=await this.client.core.crypto.generateSharedKey(x,A),O=$e($e($e({relay:{protocol:c??"irn"},namespaces:u,controller:{publicKey:x,metadata:this.client.metadata},expiry:Xe($n)},l&&{sessionProperties:l}),f&&{scopedProperties:f}),h&&{sessionConfig:h}),P=qe.relay;I.addTrace(sr.subscribing_session_topic);try{await this.client.core.relayer.subscribe(T,{transportType:P,internal:{skipSubscribe:!0}})}catch(U){throw I.setError(Un.subscribe_session_topic_failure),U}I.addTrace(sr.subscribe_session_topic_success);const M=Et($e({},O),{topic:T,requiredNamespaces:v,optionalNamespaces:E,pairingTopic:g,acknowledged:!1,self:O.controller,peer:{publicKey:w.publicKey,metadata:w.metadata},controller:x,transportType:qe.relay});await this.client.session.set(T,M),I.addTrace(sr.store_session);try{await this.sendApproveSession({sessionTopic:T,proposal:p,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:x},sessionSettleRequest:O,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:a}}}),I.addTrace(sr.session_approve_publish_success)}catch(U){throw this.client.logger.error(U),this.client.session.delete(T,Ve("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(T),U}return this.client.core.eventClient.deleteEvent({eventId:I.eventId}),await this.client.core.pairing.updateMetadata({topic:g,metadata:w.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:g}),await this.setExpiry(T,Xe($n)),{topic:T,acknowledged:()=>Promise.resolve(this.client.session.get(T))}}),ue(this,"reject",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(r)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:n,reason:i}=r;let s;try{s=this.client.proposal.get(n).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${n}) failed`),o}s&&await this.sendError({id:n,topic:s,error:i,rpcOpts:it.wc_sessionPropose.reject}),await this.deleteProposal(n)}),ue(this,"update",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(r)}catch(f){throw this.client.logger.error("update() -> isValidUpdate() failed"),f}const{topic:n,namespaces:i}=r,{done:s,resolve:o,reject:a}=dn(),c=br(),u=_n().toString(),l=this.client.session.get(n).namespaces;return this.events.once(Le("session_update",c),({error:f})=>{f?a(f):o()}),await this.client.session.update(n,{namespaces:i}),await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:i},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:u}).catch(f=>{this.client.logger.error(f),this.client.session.update(n,{namespaces:l}),a(f)}),{acknowledged:s}}),ue(this,"extend",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(r)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:n}=r,i=br(),{done:s,resolve:o,reject:a}=dn();return this.events.once(Le("session_extend",i),({error:c})=>{c?a(c):o()}),await this.setExpiry(n,Xe($n)),this.sendRequest({topic:n,method:"wc_sessionExtend",params:{},clientRpcId:i,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:s}}),ue(this,"request",async r=>{this.isInitialized();try{await this.isValidRequest(r)}catch(v){throw this.client.logger.error("request() -> isValidRequest() failed"),v}const{chainId:n,request:i,topic:s,expiry:o=it.wc_sessionRequest.req.ttl}=r,a=this.client.session.get(s);(a==null?void 0:a.transportType)===qe.relay&&await this.confirmOnlineStateOrThrow();const c=br(),u=_n().toString(),{done:l,resolve:f,reject:h}=dn(o,"Request expired. Please try again.");this.events.once(Le("session_request",c),({error:v,result:E})=>{v?h(v):f(E)});const p="wc_sessionRequest",g=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(g)return await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:s,method:p,params:{request:Et($e({},i),{expiryTimestamp:Xe(o)}),chainId:n},expiry:o,throwOnFailedPublish:!0,appLink:g}).catch(v=>h(v)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:n,id:c}),await l();const w={request:Et($e({},i),{expiryTimestamp:Xe(o)}),chainId:n};return await Promise.all([new Promise(async v=>{await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:s,method:p,params:w,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,w)}).catch(E=>h(E)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:n,id:c}),v()}),new Promise(async v=>{var E;if(!((E=a.sessionConfig)!=null&&E.disableDeepLink)){const I=await zw(this.client.core.storage,tf);await kw({id:c,topic:s,wcDeepLink:I})}v()}),l()]).then(v=>v[2])}),ue(this,"respond",async r=>{var n,i;this.isInitialized();const s=this.client.core.eventClient.createEvent({properties:{topic:(r==null?void 0:r.topic)||((i=(n=r==null?void 0:r.response)==null?void 0:n.id)==null?void 0:i.toString()),trace:[sr.session_request_response_started]}});try{await this.isValidRespond(r)}catch(f){throw s.addTrace(f==null?void 0:f.message),s.setError(Un.session_request_response_validation_failure),f}s.addTrace(sr.session_request_response_validation_success);const{topic:o,response:a}=r,{id:c}=a,u=this.client.session.get(o);u.transportType===qe.relay&&await this.confirmOnlineStateOrThrow();const l=this.getAppLinkIfEnabled(u.peer.metadata,u.transportType);try{s.addTrace(sr.session_request_response_publish_started),Er(a)?await this.sendResult({id:c,topic:o,result:a.result,throwOnFailedPublish:!0,appLink:l}):Zt(a)&&await this.sendError({id:c,topic:o,error:a.error,appLink:l}),this.cleanupAfterResponse(r)}catch(f){throw s.addTrace(f==null?void 0:f.message),s.setError(Un.session_request_response_publish_failure),f}}),ue(this,"ping",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(r)}catch(i){throw this.client.logger.error("ping() -> isValidPing() failed"),i}const{topic:n}=r;if(this.client.session.keys.includes(n)){const i=br(),s=_n().toString(),{done:o,resolve:a,reject:c}=dn();this.events.once(Le("session_ping",i),({error:u})=>{u?c(u):a()}),await Promise.all([this.sendRequest({topic:n,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:i,relayRpcId:s}),o()])}else this.client.core.pairing.pairings.keys.includes(n)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:n}))}),ue(this,"emit",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(r);const{topic:n,event:i,chainId:s}=r,o=_n().toString(),a=br();await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:i,chainId:s},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),ue(this,"disconnect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(r);const{topic:n}=r;if(this.client.session.keys.includes(n))await this.sendRequest({topic:n,method:"wc_sessionDelete",params:Ve("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:n,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(n))await this.client.core.pairing.disconnect({topic:n});else{const{message:i}=de("MISMATCHED_TOPIC",`Session or pairing topic not found: ${n}`);throw new Error(i)}}),ue(this,"find",r=>(this.isInitialized(),this.client.session.getAll().filter(n=>I1(n,r)))),ue(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),ue(this,"authenticate",async(r,n)=>{var i;this.isInitialized(),this.isValidAuthenticate(r);const s=n&&this.client.core.linkModeSupportedApps.includes(n)&&((i=this.client.metadata.redirect)==null?void 0:i.linkMode),o=s?qe.link_mode:qe.relay;o===qe.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:u,domain:l,nonce:f,type:h,exp:p,nbf:g,methods:w=[],expiry:v}=r,E=[...r.resources||[]],{topic:I,uri:x}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:I,uri:x}});const A=await this.client.core.crypto.generateKeyPair(),T=bs(A);if(await Promise.all([this.client.auth.authKeys.set(Ss,{responseTopic:T,publicKey:A}),this.client.auth.pairingTopics.set(T,{topic:T,pairingTopic:I})]),await this.client.core.relayer.subscribe(T,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${I}`),w.length>0){const{namespace:k}=Ti(a[0]);let W=Im(k,"request",w);Gn(E)&&(W=Am(W,E.pop())),E.push(W)}const O=v&&v>it.wc_sessionAuthenticate.req.ttl?v:it.wc_sessionAuthenticate.req.ttl,P={authPayload:{type:h??"caip122",chains:a,statement:c,aud:u,domain:l,version:"1",nonce:f,iat:new Date().toISOString(),exp:p,nbf:g,resources:E},requester:{publicKey:A,metadata:this.client.metadata},expiryTimestamp:Xe(O)},M={eip155:{chains:a,methods:[...new Set(["personal_sign",...w])],events:["chainChanged","accountsChanged"]}},U={requiredNamespaces:{},optionalNamespaces:M,relays:[{protocol:"irn"}],pairingTopic:I,proposer:{publicKey:A,metadata:this.client.metadata},expiryTimestamp:Xe(it.wc_sessionPropose.req.ttl),id:br()},{done:G,resolve:se,reject:Z}=dn(O,"Request expired"),L=br(),K=Le("session_connect",U.id),D=Le("session_request",L),C=async({error:k,session:W})=>{this.events.off(D,F),k?Z(k):W&&se({session:W})},F=async k=>{var W,te,ie;if(await this.deletePendingAuthRequest(L,{message:"fulfilled",code:0}),k.error){const ae=Ve("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return k.error.code===ae.code?void 0:(this.events.off(K,C),Z(k.error.message))}await this.deleteProposal(U.id),this.events.off(K,C);const{cacaos:he,responder:J}=k.result,fe=[],q=[];for(const ae of he){await xl({cacao:ae,projectId:this.client.core.projectId})||(this.client.logger.error(ae,"Signature verification failed"),Z(Ve("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:S}=ae,m=Gn(S.resources),b=[Qo(S.iss)],R=Ps(S.iss);if(m){const N=Sl(m),z=Il(m);fe.push(...N),b.push(...z)}for(const N of b)q.push(`${N}:${R}`)}const j=await this.client.core.crypto.generateSharedKey(A,J.publicKey);let ne;fe.length>0&&(ne={topic:j,acknowledged:!0,self:{publicKey:A,metadata:this.client.metadata},peer:J,controller:J.publicKey,expiry:Xe($n),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:I,namespaces:Fl([...new Set(fe)],[...new Set(q)]),transportType:o},await this.client.core.relayer.subscribe(j,{transportType:o}),await this.client.session.set(j,ne),I&&await this.client.core.pairing.updateMetadata({topic:I,metadata:J.metadata}),ne=this.client.session.get(j)),(W=this.client.metadata.redirect)!=null&&W.linkMode&&(te=J.metadata.redirect)!=null&&te.linkMode&&(ie=J.metadata.redirect)!=null&&ie.universal&&n&&(this.client.core.addLinkModeSupportedApp(J.metadata.redirect.universal),this.client.session.update(j,{transportType:qe.link_mode})),se({auths:he,session:ne})};this.events.once(K,C),this.events.once(D,F);let Y;try{if(s){const k=qr("wc_sessionAuthenticate",P,L);this.client.core.history.set(I,k);const W=await this.client.core.crypto.encode("",k,{type:Gi,encoding:Vr});Y=hs(n,I,W)}else await Promise.all([this.sendRequest({topic:I,method:"wc_sessionAuthenticate",params:P,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:L}),this.sendRequest({topic:I,method:"wc_sessionPropose",params:U,expiry:it.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:U.id})])}catch(k){throw this.events.off(K,C),this.events.off(D,F),k}return await this.setProposal(U.id,U),await this.setAuthRequest(L,{request:Et($e({},P),{verifyContext:{}}),pairingTopic:I,transportType:o}),{uri:Y??x,response:G}}),ue(this,"approveSessionAuthenticate",async r=>{const{id:n,auths:i}=r,s=this.client.core.eventClient.createEvent({properties:{topic:n.toString(),trace:[Ln.authenticated_session_approve_started]}});try{this.isInitialized()}catch(v){throw s.setError(os.no_internet_connection),v}const o=this.getPendingAuthRequest(n);if(!o)throw s.setError(os.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${n}`);const a=o.transportType||qe.relay;a===qe.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,u=await this.client.core.crypto.generateKeyPair(),l=bs(c),f={type:Ir,receiverPublicKey:c,senderPublicKey:u},h=[],p=[];for(const v of i){if(!await xl({cacao:v,projectId:this.client.core.projectId})){s.setError(os.invalid_cacao);const T=Ve("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:n,topic:l,error:T,encodeOpts:f}),new Error(T.message)}s.addTrace(Ln.cacaos_verified);const{p:E}=v,I=Gn(E.resources),x=[Qo(E.iss)],A=Ps(E.iss);if(I){const T=Sl(I),O=Il(I);h.push(...T),x.push(...O)}for(const T of x)p.push(`${T}:${A}`)}const g=await this.client.core.crypto.generateSharedKey(u,c);s.addTrace(Ln.create_authenticated_session_topic);let w;if((h==null?void 0:h.length)>0){w={topic:g,acknowledged:!0,self:{publicKey:u,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:Xe($n),authentication:i,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:Fl([...new Set(h)],[...new Set(p)]),transportType:a},s.addTrace(Ln.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(g,{transportType:a})}catch(v){throw s.setError(os.subscribe_authenticated_session_topic_failure),v}s.addTrace(Ln.subscribe_authenticated_session_topic_success),await this.client.session.set(g,w),s.addTrace(Ln.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}s.addTrace(Ln.publishing_authenticated_session_approve);try{await this.sendResult({topic:l,id:n,result:{cacaos:i,responder:{publicKey:u,metadata:this.client.metadata}},encodeOpts:f,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(v){throw s.setError(os.authenticated_session_approve_publish_failure),v}return await this.client.auth.requests.delete(n,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:s.eventId}),{session:w}}),ue(this,"rejectSessionAuthenticate",async r=>{this.isInitialized();const{id:n,reason:i}=r,s=this.getPendingAuthRequest(n);if(!s)throw new Error(`Could not find pending auth request with id ${n}`);s.transportType===qe.relay&&await this.confirmOnlineStateOrThrow();const o=s.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=bs(o),u={type:Ir,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:n,topic:c,error:i,encodeOpts:u,rpcOpts:it.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(s.requester.metadata,s.transportType)}),await this.client.auth.requests.delete(n,{message:"rejected",code:0}),await this.deleteProposal(n)}),ue(this,"formatAuthMessage",r=>{this.isInitialized();const{request:n,iss:i}=r;return th(n,i)}),ue(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const r=this.relayMessageCache.shift();r&&await this.onRelayMessage(r)}catch(r){this.client.logger.error(r)}},50)}),ue(this,"cleanupDuplicatePairings",async r=>{if(r.pairingTopic)try{const n=this.client.core.pairing.pairings.get(r.pairingTopic),i=this.client.core.pairing.pairings.getAll().filter(s=>{var o,a;return((o=s.peerMetadata)==null?void 0:o.url)&&((a=s.peerMetadata)==null?void 0:a.url)===r.peer.metadata.url&&s.topic&&s.topic!==n.topic});if(i.length===0)return;this.client.logger.info(`Cleaning up ${i.length} duplicate pairing(s)`),await Promise.all(i.map(s=>this.client.core.pairing.disconnect({topic:s.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}}),ue(this,"deleteSession",async r=>{var n;const{topic:i,expirerHasDeleted:s=!1,emitEvent:o=!0,id:a=0}=r,{self:c}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),await this.client.session.delete(i,Ve("USER_DISCONNECTED")),this.addToRecentlyDeleted(i,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),s||this.client.core.expirer.del(i),this.client.core.storage.removeItem(tf).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===i&&this.deletePendingSessionRequest(u.id,Ve("USER_DISCONNECTED"))}),i===((n=this.sessionRequestQueue.queue[0])==null?void 0:n.topic)&&(this.sessionRequestQueue.state=ar.idle),o&&this.client.events.emit("session_delete",{id:a,topic:i})}),ue(this,"deleteProposal",async(r,n)=>{if(n)try{const i=this.client.proposal.get(r),s=this.client.core.eventClient.getEvent({topic:i.pairingTopic});s==null||s.setError(Un.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(r,Ve("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")}),ue(this,"deletePendingSessionRequest",async(r,n,i=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,n),i?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(s=>s.id!==r),i&&(this.sessionRequestQueue.state=ar.idle,this.client.events.emit("session_request_expire",{id:r}))}),ue(this,"deletePendingAuthRequest",async(r,n,i=!1)=>{await Promise.all([this.client.auth.requests.delete(r,n),i?Promise.resolve():this.client.core.expirer.del(r)])}),ue(this,"setExpiry",async(r,n)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,n),await this.client.session.update(r,{expiry:n}))}),ue(this,"setProposal",async(r,n)=>{this.client.core.expirer.set(r,Xe(it.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,n)}),ue(this,"setAuthRequest",async(r,n)=>{const{request:i,pairingTopic:s,transportType:o=qe.relay}=n;this.client.core.expirer.set(r,i.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:i.authPayload,requester:i.requester,expiryTimestamp:i.expiryTimestamp,id:r,pairingTopic:s,verifyContext:i.verifyContext,transportType:o})}),ue(this,"setPendingSessionRequest",async r=>{const{id:n,topic:i,params:s,verifyContext:o}=r,a=s.request.expiryTimestamp||Xe(it.wc_sessionRequest.req.ttl);this.client.core.expirer.set(n,a),await this.client.pendingRequest.set(n,{id:n,topic:i,params:s,verifyContext:o})}),ue(this,"sendRequest",async r=>{const{topic:n,method:i,params:s,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:u,appLink:l,tvf:f,publishOpts:h={}}=r,p=qr(i,s,c);let g;const w=!!l;try{const I=w?Vr:St;g=await this.client.core.crypto.encode(n,p,{encoding:I})}catch(I){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${n} failed`),I}let v;if(Ob.includes(i)){const I=jt(JSON.stringify(p)),x=jt(g);v=await this.client.core.verify.register({id:x,decryptedId:I})}const E=$e($e({},it[i].req),h);if(E.attestation=v,o&&(E.ttl=o),a&&(E.id=a),this.client.core.history.set(n,p),w){const I=hs(l,n,g);await global.Linking.openURL(I,this.client.name)}else E.tvf=Et($e({},f),{correlationId:p.id}),u?(E.internal=Et($e({},E.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,g,E)):this.client.core.relayer.publish(n,g,E).catch(I=>this.client.logger.error(I));return p.id}),ue(this,"sendProposeSession",async r=>{const{proposal:n,publishOpts:i}=r,s=qr("wc_sessionPropose",n,n.id);this.client.core.history.set(n.pairingTopic,s);const o=await this.client.core.crypto.encode(n.pairingTopic,s,{encoding:St}),a=jt(JSON.stringify(s)),c=jt(o),u=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:n.pairingTopic,sessionProposal:o},opts:Et($e({},i),{publishMethod:"wc_proposeSession",attestation:u})})}),ue(this,"sendApproveSession",async r=>{const{sessionTopic:n,pairingProposalResponse:i,proposal:s,sessionSettleRequest:o,publishOpts:a}=r,c=sa(s.id,i),u=await this.client.core.crypto.encode(s.pairingTopic,c,{encoding:St}),l=qr("wc_sessionSettle",o,a==null?void 0:a.id),f=await this.client.core.crypto.encode(n,l,{encoding:St});this.client.core.history.set(n,l),await this.client.core.relayer.publishCustom({payload:{sessionTopic:n,pairingTopic:s.pairingTopic,sessionProposalResponse:u,sessionSettlementRequest:f},opts:Et($e({},a),{publishMethod:"wc_approveSession"})})}),ue(this,"sendResult",async r=>{const{id:n,topic:i,result:s,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=r,u=sa(n,s);let l;const f=c&&typeof(global==null?void 0:global.Linking)<"u";try{const g=f?Vr:St;l=await this.client.core.crypto.encode(i,u,Et($e({},a||{}),{encoding:g}))}catch(g){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${i} failed`),g}let h,p;try{h=await this.client.core.history.get(i,n);const g=h.request;try{p=this.getTVFParams(n,g.params,s)}catch(w){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${w==null?void 0:w.message}`)}}catch(g){throw this.client.logger.error(`sendResult() -> history.get(${i}, ${n}) failed`),g}if(f){const g=hs(c,i,l);await global.Linking.openURL(g,this.client.name)}else{const g=h.request.method,w=it[g].res;w.tvf=Et($e({},p),{correlationId:n}),o?(w.internal=Et($e({},w.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,l,w)):this.client.core.relayer.publish(i,l,w).catch(v=>this.client.logger.error(v))}await this.client.core.history.resolve(u)}),ue(this,"sendError",async r=>{const{id:n,topic:i,error:s,encodeOpts:o,rpcOpts:a,appLink:c}=r,u=Eh(n,s);let l;const f=c&&typeof(global==null?void 0:global.Linking)<"u";try{const p=f?Vr:St;l=await this.client.core.crypto.encode(i,u,Et($e({},o||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${i} failed`),p}let h;try{h=await this.client.core.history.get(i,n)}catch(p){throw this.client.logger.error(`sendError() -> history.get(${i}, ${n}) failed`),p}if(f){const p=hs(c,i,l);await global.Linking.openURL(p,this.client.name)}else{const p=h.request.method,g=a||it[p].res;this.client.core.relayer.publish(i,l,g)}await this.client.core.history.resolve(u)}),ue(this,"cleanup",async()=>{const r=[],n=[];this.client.session.getAll().forEach(i=>{let s=!1;kr(i.expiry)&&(s=!0),this.client.core.crypto.keychain.has(i.topic)||(s=!0),s&&r.push(i.topic)}),this.client.proposal.getAll().forEach(i=>{kr(i.expiryTimestamp)&&n.push(i.id)}),await Promise.all([...r.map(i=>this.deleteSession({topic:i})),...n.map(i=>this.deleteProposal(i))])}),ue(this,"onProviderMessageEvent",async r=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(r):await this.onRelayMessage(r)}),ue(this,"onRelayEventRequest",async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()}),ue(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===ar.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ar.active;const r=this.requestQueue.queue.shift();if(r)try{await this.processRequest(r)}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=ar.idle}),ue(this,"processRequest",async r=>{const{topic:n,payload:i,attestation:s,transportType:o,encryptedId:a}=r,c=i.method;if(!this.shouldIgnorePairingRequest({topic:n,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:n,payload:i,attestation:s,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(n,i);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(n,i);case"wc_sessionExtend":return await this.onSessionExtendRequest(n,i);case"wc_sessionPing":return await this.onSessionPingRequest(n,i);case"wc_sessionDelete":return await this.onSessionDeleteRequest(n,i);case"wc_sessionRequest":return await this.onSessionRequest({topic:n,payload:i,attestation:s,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(n,i);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:n,payload:i,attestation:s,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),ue(this,"onRelayEventResponse",async r=>{const{topic:n,payload:i,transportType:s}=r,o=(await this.client.core.history.get(n,i.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(n,i,s);case"wc_sessionSettle":return this.onSessionSettleResponse(n,i);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,i);case"wc_sessionExtend":return this.onSessionExtendResponse(n,i);case"wc_sessionPing":return this.onSessionPingResponse(n,i);case"wc_sessionRequest":return this.onSessionRequestResponse(n,i);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(n,i);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),ue(this,"onRelayEventUnknownPayload",r=>{const{topic:n}=r,{message:i}=de("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(i)}),ue(this,"shouldIgnorePairingRequest",r=>{const{topic:n,requestMethod:i}=r,s=this.expectedPairingMethodMap.get(n);return!s||s.includes(i)?!1:!!(s.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),ue(this,"onSessionProposeRequest",async r=>{const{topic:n,payload:i,attestation:s,encryptedId:o}=r,{params:a,id:c}=i;try{const u=this.client.core.eventClient.getEvent({topic:n});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),u==null||u.setError($r.proposal_listener_not_found)),this.isValidConnect($e({},i.params));const l=a.expiryTimestamp||Xe(it.wc_sessionPropose.req.ttl),f=$e({id:c,pairingTopic:n,expiryTimestamp:l,attestation:s,encryptedId:o},a);await this.setProposal(c,f);const h=await this.getVerifyContext({attestationId:s,hash:jt(JSON.stringify(i)),encryptedId:o,metadata:f.proposer.metadata});u==null||u.addTrace(mr.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:f,verifyContext:h})}catch(u){await this.sendError({id:c,topic:n,error:u,rpcOpts:it.wc_sessionPropose.autoReject}),this.client.logger.error(u)}}),ue(this,"onSessionProposeResponse",async(r,n,i)=>{const{id:s}=n;if(Er(n)){const{result:o}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const u=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:u});const l=await this.client.core.crypto.generateSharedKey(c,u);this.pendingSessions.set(s,{sessionTopic:l,pairingTopic:r,proposalId:s,publicKey:c});const f=await this.client.core.relayer.subscribe(l,{transportType:i});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:f}),await this.client.core.pairing.activate({topic:r})}else if(Zt(n)){await this.deleteProposal(s);const o=Le("session_connect",s);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:n.error})}}),ue(this,"onSessionSettleRequest",async(r,n)=>{const{id:i,params:s}=n;try{this.isValidSessionSettleRequest(s);const{relay:o,controller:a,expiry:c,namespaces:u,sessionProperties:l,scopedProperties:f,sessionConfig:h}=n.params,p=[...this.pendingSessions.values()].find(v=>v.sessionTopic===r);if(!p)return this.client.logger.error(`Pending session not found for topic ${r}`);const g=this.client.proposal.get(p.proposalId),w=Et($e($e($e({topic:r,relay:o,expiry:c,namespaces:u,acknowledged:!0,pairingTopic:p.pairingTopic,requiredNamespaces:g.requiredNamespaces,optionalNamespaces:g.optionalNamespaces,controller:a.publicKey,self:{publicKey:p.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},l&&{sessionProperties:l}),f&&{scopedProperties:f}),h&&{sessionConfig:h}),{transportType:qe.relay});await this.client.session.set(w.topic,w),await this.setExpiry(w.topic,w.expiry),await this.client.core.pairing.updateMetadata({topic:p.pairingTopic,metadata:w.peer.metadata}),this.client.events.emit("session_connect",{session:w}),this.events.emit(Le("session_connect",p.proposalId),{session:w}),this.pendingSessions.delete(p.proposalId),this.deleteProposal(p.proposalId,!1),this.cleanupDuplicatePairings(w),await this.sendResult({id:n.id,topic:r,result:!0})}catch(o){await this.sendError({id:i,topic:r,error:o}),this.client.logger.error(o)}}),ue(this,"onSessionSettleResponse",async(r,n)=>{const{id:i}=n;Er(n)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Le("session_approve",i),{})):Zt(n)&&(await this.client.session.delete(r,Ve("USER_DISCONNECTED")),this.events.emit(Le("session_approve",i),{error:n.error}))}),ue(this,"onSessionUpdateRequest",async(r,n)=>{const{params:i,id:s}=n;try{const o=`${r}_session_update`,a=mi.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.warn(`Discarding out of sync request - ${s}`),this.sendError({id:s,topic:r,error:Ve("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate($e({topic:r},i));try{mi.set(o,s),await this.client.session.update(r,{namespaces:i.namespaces}),await this.sendResult({id:s,topic:r,result:!0})}catch(c){throw mi.delete(o),c}this.client.events.emit("session_update",{id:s,topic:r,params:i})}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),ue(this,"isRequestOutOfSync",(r,n)=>n.toString().slice(0,-3)<r.toString().slice(0,-3)),ue(this,"onSessionUpdateResponse",(r,n)=>{const{id:i}=n,s=Le("session_update",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Er(n)?this.events.emit(Le("session_update",i),{}):Zt(n)&&this.events.emit(Le("session_update",i),{error:n.error})}),ue(this,"onSessionExtendRequest",async(r,n)=>{const{id:i}=n;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Xe($n)),await this.sendResult({id:i,topic:r,result:!0}),this.client.events.emit("session_extend",{id:i,topic:r})}catch(s){await this.sendError({id:i,topic:r,error:s}),this.client.logger.error(s)}}),ue(this,"onSessionExtendResponse",(r,n)=>{const{id:i}=n,s=Le("session_extend",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Er(n)?this.events.emit(Le("session_extend",i),{}):Zt(n)&&this.events.emit(Le("session_extend",i),{error:n.error})}),ue(this,"onSessionPingRequest",async(r,n)=>{const{id:i}=n;try{this.isValidPing({topic:r}),await this.sendResult({id:i,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:i,topic:r})}catch(s){await this.sendError({id:i,topic:r,error:s}),this.client.logger.error(s)}}),ue(this,"onSessionPingResponse",(r,n)=>{const{id:i}=n,s=Le("session_ping",i);setTimeout(()=>{if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners 2176`);Er(n)?this.events.emit(Le("session_ping",i),{}):Zt(n)&&this.events.emit(Le("session_ping",i),{error:n.error})},500)}),ue(this,"onSessionDeleteRequest",async(r,n)=>{const{id:i}=n;try{this.isValidDisconnect({topic:r,reason:n.params}),await Promise.all([new Promise(s=>{this.client.core.relayer.once(He.publish,async()=>{s(await this.deleteSession({topic:r,id:i}))})}),this.sendResult({id:i,topic:r,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:r,error:Ve("USER_DISCONNECTED")})]).catch(s=>this.client.logger.error(s))}catch(s){this.client.logger.error(s)}}),ue(this,"onSessionRequest",async r=>{var n,i,s;const{topic:o,payload:a,attestation:c,encryptedId:u,transportType:l}=r,{id:f,params:h}=a;try{await this.isValidRequest($e({topic:o},h));const p=this.client.session.get(o),g=await this.getVerifyContext({attestationId:c,hash:jt(JSON.stringify(qr("wc_sessionRequest",h,f))),encryptedId:u,metadata:p.peer.metadata,transportType:l}),w={id:f,topic:o,params:h,verifyContext:g};await this.setPendingSessionRequest(w),l===qe.link_mode&&(n=p.peer.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp((i=p.peer.metadata.redirect)==null?void 0:i.universal),(s=this.client.signConfig)!=null&&s.disableRequestQueue?this.emitSessionRequest(w):(this.addSessionRequestToSessionRequestQueue(w),this.processSessionRequestQueue())}catch(p){await this.sendError({id:f,topic:o,error:p}),this.client.logger.error(p)}}),ue(this,"onSessionRequestResponse",(r,n)=>{const{id:i}=n,s=Le("session_request",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Er(n)?this.events.emit(Le("session_request",i),{result:n.result}):Zt(n)&&this.events.emit(Le("session_request",i),{error:n.error})}),ue(this,"onSessionEventRequest",async(r,n)=>{const{id:i,params:s}=n;try{const o=`${r}_session_event_${s.event.name}`,a=mi.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.info(`Discarding out of sync request - ${i}`);return}this.isValidEmit($e({topic:r},s)),this.client.events.emit("session_event",{id:i,topic:r,params:s}),mi.set(o,i)}catch(o){await this.sendError({id:i,topic:r,error:o}),this.client.logger.error(o)}}),ue(this,"onSessionAuthenticateResponse",(r,n)=>{const{id:i}=n;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:n}),Er(n)?this.events.emit(Le("session_request",i),{result:n.result}):Zt(n)&&this.events.emit(Le("session_request",i),{error:n.error})}),ue(this,"onSessionAuthenticateRequest",async r=>{var n;const{topic:i,payload:s,attestation:o,encryptedId:a,transportType:c}=r;try{const{requester:u,authPayload:l,expiryTimestamp:f}=s.params,h=await this.getVerifyContext({attestationId:o,hash:jt(JSON.stringify(s)),encryptedId:a,metadata:u.metadata,transportType:c}),p={requester:u,pairingTopic:i,id:s.id,authPayload:l,verifyContext:h,expiryTimestamp:f};await this.setAuthRequest(s.id,{request:p,pairingTopic:i,transportType:c}),c===qe.link_mode&&(n=u.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp(u.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:i,params:s.params,id:s.id,verifyContext:h})}catch(u){this.client.logger.error(u);const l=s.params.requester.publicKey,f=await this.client.core.crypto.generateKeyPair(),h=this.getAppLinkIfEnabled(s.params.requester.metadata,c),p={type:Ir,receiverPublicKey:l,senderPublicKey:f};await this.sendError({id:s.id,topic:i,error:u,encodeOpts:p,rpcOpts:it.wc_sessionAuthenticate.autoReject,appLink:h})}}),ue(this,"addSessionRequestToSessionRequestQueue",r=>{this.sessionRequestQueue.queue.push(r)}),ue(this,"cleanupAfterResponse",r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ar.idle,this.processSessionRequestQueue()},pe.toMiliseconds(this.requestQueueDelay))}),ue(this,"cleanupPendingSentRequestsForTopic",({topic:r,error:n})=>{const i=this.client.core.history.pending;i.length>0&&i.filter(s=>s.topic===r&&s.request.method==="wc_sessionRequest").forEach(s=>{const o=s.request.id,a=Le("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(Le("session_request",s.request.id),{error:n})})}),ue(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===ar.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(r)}catch(n){this.client.logger.error(n)}}),ue(this,"emitSessionRequest",r=>{if(this.emittedSessionRequests.has(r.id)){this.client.logger.warn({id:r.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${r.id}`);return}this.sessionRequestQueue.state=ar.active,this.emittedSessionRequests.add(r.id),this.client.events.emit("session_request",r)}),ue(this,"onPairingCreated",r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;const n=this.client.proposal.getAll().find(i=>i.pairingTopic===r.topic);n&&this.onSessionProposeRequest({topic:r.topic,payload:qr("wc_sessionPropose",Et($e({},n),{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties,scopedProperties:n.scopedProperties}),n.id),attestation:n.attestation,encryptedId:n.encryptedId})}),ue(this,"isValidConnect",async r=>{if(!xt(r)){const{message:u}=de("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(u)}const{pairingTopic:n,requiredNamespaces:i,optionalNamespaces:s,sessionProperties:o,scopedProperties:a,relays:c}=r;if(Ze(n)||await this.isValidPairingTopic(n),!$1(c,!0)){const{message:u}=de("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(u)}if(i&&!Ze(i)&&qi(i)!==0){const u="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(u):this.client.logger.warn(u),this.validateNamespaces(i,"requiredNamespaces")}if(s&&!Ze(s)&&qi(s)!==0&&this.validateNamespaces(s,"optionalNamespaces"),o&&!Ze(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!Ze(a)){this.validateSessionProps(a,"scopedProperties");const u=Object.keys(i||{}).concat(Object.keys(s||{}));if(!Object.keys(a).every(l=>u.includes(l.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(u)}`)}}),ue(this,"validateNamespaces",(r,n)=>{const i=L1(r,"connect()",n);if(i)throw new Error(i.message)}),ue(this,"isValidApprove",async r=>{if(!xt(r))throw new Error(de("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:n,namespaces:i,relayProtocol:s,sessionProperties:o,scopedProperties:a}=r;this.checkRecentlyDeleted(n),await this.isValidProposalId(n);const c=this.client.proposal.get(n),u=Es(i,"approve()");if(u)throw new Error(u.message);const l=ia(c.requiredNamespaces,i,"approve()");if(l)throw new Error(l.message);if(!Ke(s,!0)){const{message:f}=de("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(f)}if(o&&!Ze(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!Ze(a)){this.validateSessionProps(a,"scopedProperties");const f=new Set(Object.keys(i));if(!Object.keys(a).every(h=>f.has(h.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(f).join(", ")}`)}}),ue(this,"isValidReject",async r=>{if(!xt(r)){const{message:s}=de("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(s)}const{id:n,reason:i}=r;if(this.checkRecentlyDeleted(n),await this.isValidProposalId(n),!F1(i)){const{message:s}=de("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(i)}`);throw new Error(s)}}),ue(this,"isValidSessionSettleRequest",r=>{if(!xt(r)){const{message:u}=de("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(u)}const{relay:n,controller:i,namespaces:s,expiry:o}=r;if(!wh(n)){const{message:u}=de("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(u)}const a=D1(i,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=Es(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(kr(o)){const{message:u}=de("EXPIRED","onSessionSettleRequest()");throw new Error(u)}}),ue(this,"isValidUpdate",async r=>{if(!xt(r)){const{message:c}=de("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(c)}const{topic:n,namespaces:i}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const s=this.client.session.get(n),o=Es(i,"update()");if(o)throw new Error(o.message);const a=ia(s.requiredNamespaces,i,"update()");if(a)throw new Error(a.message)}),ue(this,"isValidExtend",async r=>{if(!xt(r)){const{message:i}=de("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(i)}const{topic:n}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n)}),ue(this,"isValidRequest",async r=>{if(!xt(r)){const{message:c}=de("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(c)}const{topic:n,request:i,chainId:s,expiry:o}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const{namespaces:a}=this.client.session.get(n);if(!jl(a,s)){const{message:c}=de("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(c)}if(!k1(i)){const{message:c}=de("MISSING_OR_INVALID",`request() ${JSON.stringify(i)}`);throw new Error(c)}if(!z1(a,s,i.method)){const{message:c}=de("MISSING_OR_INVALID",`request() method: ${i.method}`);throw new Error(c)}if(o&&!H1(o,Ro)){const{message:c}=de("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${Ro.min} and ${Ro.max}`);throw new Error(c)}}),ue(this,"isValidRespond",async r=>{var n;if(!xt(r)){const{message:a}=de("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(a)}const{topic:i,response:s}=r;try{await this.isValidSessionTopic(i)}catch(a){throw(n=r==null?void 0:r.response)!=null&&n.id&&this.cleanupAfterResponse(r),a}if(!j1(s)){const{message:a}=de("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(a)}const o=this.client.pendingRequest.get(s.id);if(o.topic!==i){const{message:a}=de("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${s.id}, expected topic: ${o.topic}, received topic: ${i}`);throw new Error(a)}}),ue(this,"isValidPing",async r=>{if(!xt(r)){const{message:i}=de("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(i)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)}),ue(this,"isValidEmit",async r=>{if(!xt(r)){const{message:a}=de("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(a)}const{topic:n,event:i,chainId:s}=r;await this.isValidSessionTopic(n);const{namespaces:o}=this.client.session.get(n);if(!jl(o,s)){const{message:a}=de("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(a)}if(!q1(i)){const{message:a}=de("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}if(!V1(o,s,i.name)){const{message:a}=de("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}}),ue(this,"isValidDisconnect",async r=>{if(!xt(r)){const{message:i}=de("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(i)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)}),ue(this,"isValidAuthenticate",r=>{const{chains:n,uri:i,domain:s,nonce:o}=r;if(!Array.isArray(n)||n.length===0)throw new Error("chains is required and must be a non-empty array");if(!Ke(i,!1))throw new Error("uri is required parameter");if(!Ke(s,!1))throw new Error("domain is required parameter");if(!Ke(o,!1))throw new Error("nonce is required parameter");if([...new Set(n.map(c=>Ti(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=Ti(n[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),ue(this,"getVerifyContext",async r=>{const{attestationId:n,hash:i,encryptedId:s,metadata:o,transportType:a}=r,c={verified:{verifyUrl:o.verifyUrl||_s,validation:"UNKNOWN",origin:o.url||""}};try{if(a===qe.link_mode){const l=this.getAppLinkIfEnabled(o,a);return c.verified.validation=l&&new URL(l).origin===new URL(o.url).origin?"VALID":"INVALID",c}const u=await this.client.core.verify.resolve({attestationId:n,hash:i,encryptedId:s,verifyUrl:o.verifyUrl});u&&(c.verified.origin=u.origin,c.verified.isScam=u.isScam,c.verified.validation=u.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.warn(u)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),ue(this,"validateSessionProps",(r,n)=>{Object.values(r).forEach((i,s)=>{if(i==null){const{message:o}=de("MISSING_OR_INVALID",`${n} must contain an existing value for each key. Received: ${i} for key ${Object.keys(r)[s]}`);throw new Error(o)}})}),ue(this,"getPendingAuthRequest",r=>{const n=this.client.auth.requests.get(r);return typeof n=="object"?n:void 0}),ue(this,"addToRecentlyDeleted",(r,n)=>{if(this.recentlyDeletedMap.set(r,n),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let i=0;const s=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(i++>=s)break;this.recentlyDeletedMap.delete(o)}}}),ue(this,"checkRecentlyDeleted",r=>{const n=this.recentlyDeletedMap.get(r);if(n){const{message:i}=de("MISSING_OR_INVALID",`Record was recently deleted - ${n}: ${r}`);throw new Error(i)}}),ue(this,"isLinkModeEnabled",(r,n)=>{var i,s,o,a,c,u,l,f,h;return!r||n!==qe.link_mode?!1:((s=(i=this.client.metadata)==null?void 0:i.redirect)==null?void 0:s.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((u=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:u.universal)!==""&&((l=r==null?void 0:r.redirect)==null?void 0:l.universal)!==void 0&&((f=r==null?void 0:r.redirect)==null?void 0:f.universal)!==""&&((h=r==null?void 0:r.redirect)==null?void 0:h.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(r.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),ue(this,"getAppLinkIfEnabled",(r,n)=>{var i;return this.isLinkModeEnabled(r,n)?(i=r==null?void 0:r.redirect)==null?void 0:i.universal:void 0}),ue(this,"handleLinkModeMessage",({url:r})=>{if(!r||!r.includes("wc_ev")||!r.includes("topic"))return;const n=bl(r,"topic")||"",i=decodeURIComponent(bl(r,"wc_ev")||""),s=this.client.session.keys.includes(n);s&&this.client.session.update(n,{transportType:qe.link_mode}),this.client.core.dispatchEnvelope({topic:n,message:i,sessionExists:s})}),ue(this,"registerLinkModeListeners",async()=>{var r;if(Ca()||Jr()&&(r=this.client.metadata.redirect)!=null&&r.linkMode){const n=global==null?void 0:global.Linking;if(typeof n<"u"){n.addEventListener("url",this.handleLinkModeMessage,this.client.name);const i=await n.getInitialURL();i&&setTimeout(()=>{this.handleLinkModeMessage({url:i})},50)}}}),ue(this,"getTVFParams",(r,n,i)=>{var s,o,a;if(!((s=n.request)!=null&&s.method))return{};const c={correlationId:r,rpcMethods:[n.request.method],chainId:n.chainId};try{const u=this.extractTxHashesFromResult(n.request,i);c.txHashes=u,c.contractAddresses=this.isValidContractData(n.request.params)?[(a=(o=n.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(u){this.client.logger.warn(u,"Error getting TVF params")}return c}),ue(this,"isValidContractData",r=>{var n;if(!r)return!1;try{const i=(r==null?void 0:r.data)||((n=r==null?void 0:r[0])==null?void 0:n.data);if(!i.startsWith("0x"))return!1;const s=i.slice(2);return/^[0-9a-fA-F]*$/.test(s)?s.length%2===0:!1}catch{}return!1}),ue(this,"extractTxHashesFromResult",(r,n)=>{var i;try{if(!n)return[];const s=r.method,o=Ab[s];if(s==="sui_signTransaction")return[hm(n.transactionBytes)];if(s==="near_signTransaction")return[vl(n)];if(s==="near_signTransactions")return n.map(c=>vl(c));if(s==="xrpl_signTransactionFor"||s==="xrpl_signTransaction")return[(i=n.tx_json)==null?void 0:i.hash];if(s==="polkadot_signTransaction")return[rb({transaction:r.params.transactionPayload,signature:n.signature})];if(s==="algo_signTxn")return Jn(n)?n.map(c=>_l(c)):[_l(n)];if(s==="cosmos_signDirect")return[pm(n)];if(s==="wallet_sendCalls")return gm(n);if(typeof n=="string")return[n];const a=n[o.key];if(Jn(a))return s==="solana_signAllTransactions"?a.map(c=>fm(c)):a;if(typeof a=="string")return[a]}catch(s){this.client.logger.warn(s,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,r=this.client.core.relayer.messages.getWithoutAck(e);for(const[n,i]of Object.entries(r))for(const s of i)try{await this.onProviderMessageEvent({topic:n,message:s,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${n}, message: ${s}`)}}catch(e){this.client.logger.warn(e,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){const{message:e}=de("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(He.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:r,message:n,attestation:i,transportType:s}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(Ss)?this.client.auth.authKeys.get(Ss):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(r,n,{receiverPublicKey:o,encoding:s===qe.link_mode?Vr:St});vh(a)?(this.client.core.history.set(r,a),await this.onRelayEventRequest({topic:r,payload:a,attestation:i,transportType:s,encryptedId:jt(n)})):ja(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a,transportType:s}),this.client.core.history.delete(r,a.id)):await this.onRelayEventUnknownPayload({topic:r,payload:a,transportType:s}),await this.client.core.relayer.messages.ack(r,n)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(Gt.expired,async e=>{const{topic:r,id:n}=Wf(e.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,de("EXPIRED"),!0);if(n&&this.client.auth.requests.keys.includes(n))return await this.deletePendingAuthRequest(n,de("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(kn.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(kn.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!Ke(e,!1)){const{message:r}=de("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=de("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(kr(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=de("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!Ke(e,!1)){const{message:r}=de("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:r}=de("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(kr(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:r}=de("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(e)){const{message:r}=de("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Ke(e,!1)){const{message:r}=de("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=de("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!M1(e)){const{message:r}=de("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=de("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(kr(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:r}=de("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class GP extends ci{constructor(e,r){super(e,r,xb,za),this.core=e,this.logger=r}}class Pb extends ci{constructor(e,r){super(e,r,Sb,za),this.core=e,this.logger=r}}class YP extends ci{constructor(e,r){super(e,r,Tb,za,n=>n.id),this.core=e,this.logger=r}}class XP extends ci{constructor(e,r){super(e,r,Bb,Zs,()=>Ss),this.core=e,this.logger=r}}class ZP extends ci{constructor(e,r){super(e,r,Rb,Zs),this.core=e,this.logger=r}}class JP extends ci{constructor(e,r){super(e,r,Nb,Zs,n=>n.id),this.core=e,this.logger=r}}var QP=Object.defineProperty,e5=(t,e,r)=>e in t?QP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Mu=(t,e,r)=>e5(t,typeof e!="symbol"?e+"":e,r);class t5{constructor(e,r){this.core=e,this.logger=r,Mu(this,"authKeys"),Mu(this,"pairingTopics"),Mu(this,"requests"),this.authKeys=new XP(this.core,this.logger),this.pairingTopics=new ZP(this.core,this.logger),this.requests=new JP(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var r5=Object.defineProperty,n5=(t,e,r)=>e in t?r5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,De=(t,e,r)=>n5(t,typeof e!="symbol"?e+"":e,r);class Va extends lS{constructor(e){super(e),De(this,"protocol",xh),De(this,"version",Sh),De(this,"name",Bo.name),De(this,"metadata"),De(this,"core"),De(this,"logger"),De(this,"events",new zt.EventEmitter),De(this,"engine"),De(this,"session"),De(this,"proposal"),De(this,"pendingRequest"),De(this,"auth"),De(this,"signConfig"),De(this,"on",(n,i)=>this.events.on(n,i)),De(this,"once",(n,i)=>this.events.once(n,i)),De(this,"off",(n,i)=>this.events.off(n,i)),De(this,"removeListener",(n,i)=>this.events.removeListener(n,i)),De(this,"removeAllListeners",n=>this.events.removeAllListeners(n)),De(this,"connect",async n=>{try{return await this.engine.connect(n)}catch(i){throw this.logger.error(i.message),i}}),De(this,"pair",async n=>{try{return await this.engine.pair(n)}catch(i){throw this.logger.error(i.message),i}}),De(this,"approve",async n=>{try{return await this.engine.approve(n)}catch(i){throw this.logger.error(i.message),i}}),De(this,"reject",async n=>{try{return await this.engine.reject(n)}catch(i){throw this.logger.error(i.message),i}}),De(this,"update",async n=>{try{return await this.engine.update(n)}catch(i){throw this.logger.error(i.message),i}}),De(this,"extend",async n=>{try{return await this.engine.extend(n)}catch(i){throw this.logger.error(i.message),i}}),De(this,"request",async n=>{try{return await this.engine.request(n)}catch(i){throw this.logger.error(i.message),i}}),De(this,"respond",async n=>{try{return await this.engine.respond(n)}catch(i){throw this.logger.error(i.message),i}}),De(this,"ping",async n=>{try{return await this.engine.ping(n)}catch(i){throw this.logger.error(i.message),i}}),De(this,"emit",async n=>{try{return await this.engine.emit(n)}catch(i){throw this.logger.error(i.message),i}}),De(this,"disconnect",async n=>{try{return await this.engine.disconnect(n)}catch(i){throw this.logger.error(i.message),i}}),De(this,"find",n=>{try{return this.engine.find(n)}catch(i){throw this.logger.error(i.message),i}}),De(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}}),De(this,"authenticate",async(n,i)=>{try{return await this.engine.authenticate(n,i)}catch(s){throw this.logger.error(s.message),s}}),De(this,"formatAuthMessage",n=>{try{return this.engine.formatAuthMessage(n)}catch(i){throw this.logger.error(i.message),i}}),De(this,"approveSessionAuthenticate",async n=>{try{return await this.engine.approveSessionAuthenticate(n)}catch(i){throw this.logger.error(i.message),i}}),De(this,"rejectSessionAuthenticate",async n=>{try{return await this.engine.rejectSessionAuthenticate(n)}catch(i){throw this.logger.error(i.message),i}}),this.name=(e==null?void 0:e.name)||Bo.name,this.metadata=Bw(e==null?void 0:e.metadata),this.signConfig=e==null?void 0:e.signConfig;const r=mh({logger:(e==null?void 0:e.logger)||Bo.logger,name:this.name});this.logger=r,this.core=(e==null?void 0:e.core)||new PP(e),this.session=new Pb(this.core,this.logger),this.proposal=new GP(this.core,this.logger),this.pendingRequest=new YP(this.core,this.logger),this.engine=new WP(this),this.auth=new t5(this.core,this.logger)}static async init(e){const r=new Va(e);return await r.initialize(),r}get context(){return Lt(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const i5=Pb,s5=Va,o5=Object.freeze(Object.defineProperty({__proto__:null,AUTH_CONTEXT:Db,AUTH_KEYS_CONTEXT:Bb,AUTH_PAIRING_TOPIC_CONTEXT:Rb,AUTH_PROTOCOL:Cb,AUTH_PUBLIC_KEY_NAME:Ss,AUTH_REQUEST_CONTEXT:Nb,AUTH_STORAGE_PREFIX:Zs,AUTH_VERSION:jP,ENGINE_CONTEXT:Ib,ENGINE_QUEUE_STATES:ar,ENGINE_RPC_OPTS:it,HISTORY_CONTEXT:MP,HISTORY_EVENTS:$P,HISTORY_STORAGE_VERSION:FP,METHODS_TO_VERIFY:Ob,PROPOSAL_CONTEXT:xb,PROPOSAL_EXPIRY:kP,PROPOSAL_EXPIRY_MESSAGE:rf,REQUEST_CONTEXT:Tb,SESSION_CONTEXT:Sb,SESSION_EXPIRY:$n,SESSION_REQUEST_EXPIRY_BOUNDARIES:Ro,SIGN_CLIENT_CONTEXT:Ih,SIGN_CLIENT_DEFAULT:Bo,SIGN_CLIENT_EVENTS:UP,SIGN_CLIENT_PROTOCOL:xh,SIGN_CLIENT_STORAGE_OPTIONS:LP,SIGN_CLIENT_STORAGE_PREFIX:za,SIGN_CLIENT_VERSION:Sh,SessionStore:i5,SignClient:s5,TVF_METHODS:Ab,WALLETCONNECT_DEEPLINK_CHOICE:tf,default:Va},Symbol.toStringTag,{value:"Module"})),a5=oa(o5),Ub=oa(OB);var lr={},Cn={};Object.defineProperty(Cn,"__esModule",{value:!0});Cn.OptionalOperation=Cn.Operation=void 0;var _g;(function(t){t.SIGN_TRANSACTION="mvx_signTransaction",t.SIGN_TRANSACTIONS="mvx_signTransactions",t.SIGN_MESSAGE="mvx_signMessage"})(_g||(Cn.Operation=_g={}));var xg;(function(t){t.SIGN_LOGIN_TOKEN="mvx_signLoginToken",t.SIGN_NATIVE_AUTH_TOKEN="mvx_signNativeAuthToken",t.CANCEL_ACTION="mvx_cancelAction"})(xg||(Cn.OptionalOperation=xg={}));Object.defineProperty(lr,"__esModule",{value:!0});lr.WALLETCONNECT_SIGN_LOGIN_DELAY=lr.WALLETCONNECT_MULTIVERSX_OPTIONAL_METHODS=lr.WALLETCONNECT_MULTIVERSX_METHODS=lr.WALLETCONNECT_MULTIVERSX_NAMESPACE=void 0;const Lb=Cn;lr.WALLETCONNECT_MULTIVERSX_NAMESPACE="mvx";lr.WALLETCONNECT_MULTIVERSX_METHODS=Object.values(Lb.Operation);lr.WALLETCONNECT_MULTIVERSX_OPTIONAL_METHODS=Object.values(Lb.OptionalOperation);lr.WALLETCONNECT_SIGN_LOGIN_DELAY=500;var fr={};Object.defineProperty(fr,"__esModule",{value:!0});fr.WalletConnectV2ProviderErrorMessagesEnum=fr.ErrBadAddress=fr.ErrNotImplemented=fr.Err=void 0;class Ah extends Error{constructor(e,r){super(e),this.inner=void 0,this.inner=r}}fr.Err=Ah;class c5 extends Ah{constructor(){super("Method not yet implemented")}}fr.ErrNotImplemented=c5;class u5 extends Ah{constructor(e,r){super(`Bad address: ${e}`,r)}}fr.ErrBadAddress=u5;var Sg;(function(t){t.unableToInit="WalletConnect is unable to init",t.notInitialized="WalletConnect is not initialized",t.unableToConnect="WalletConnect is unable to connect",t.unableToConnectExisting="WalletConnect is unable to connect to existing pairing",t.unableToSignLoginToken="WalletConnect could not sign login token",t.unableToSign="WalletConnect could not sign the message",t.unableToLogin="WalletConnect is unable to login",t.unableToHandleTopic="WalletConnect: Unable to handle topic update",t.unableToHandleEvent="WalletConnect: Unable to handle events",t.unableToHandleCleanup="WalletConnect: Unable to handle cleanup",t.sessionNotConnected="WalletConnect Session is not connected",t.sessionDeleted="WalletConnect Session Deleted",t.sessionExpired="WalletConnect Session Expired",t.alreadyLoggedOut="WalletConnect: Already logged out",t.pingFailed="WalletConnect Ping Failed",t.invalidAddress="WalletConnect: Invalid address",t.requestDifferentChain="WalletConnect: Request Chain Id different than Connection Chain Id",t.invalidMessageResponse="WalletConnect could not sign the message",t.invalidMessageSignature="WalletConnect: Invalid message signature",t.invalidTransactionResponse="WalletConnect could not sign the transactions. Invalid signatures",t.invalidCustomRequestResponse="WalletConnect could not send the custom request",t.transactionError="Transaction canceled",t.connectionError="WalletConnect could not establish a connection",t.invalidGuardian="WalletConnect: Invalid Guardian"})(Sg||(fr.WalletConnectV2ProviderErrorMessagesEnum=Sg={}));var Js={};Object.defineProperty(Js,"__esModule",{value:!0});Js.Logger=void 0;class l5{static error(e){console.error(e)}static trace(e){console.trace(e)}}Js.Logger=l5;var rr={},f5=Ee&&Ee.__awaiter||function(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(f){o(f)}}function c(l){try{u(n.throw(l))}catch(f){o(f)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(t,e||[])).next())})};Object.defineProperty(rr,"__esModule",{value:!0});rr.getCurrentSession=Mb;rr.getCurrentTopic=d5;rr.getConnectionParams=p5;rr.getExistingConnectionParams=Fb;rr.getMvxNamespace=Th;rr.addressIsValid=g5;rr.getAddressFromSession=y5;rr.applyTransactionSignature=w5;rr.getMetadata=m5;rr.sleep=b5;const $b=Sn,h5=Ub,No=lr,Wr=fr,sf=Js,Ig=Cn;function Mb(t,e){if(!e)throw new Error(Wr.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);const r=e.find(Fb(t)).filter(n=>n.acknowledged);if(r.length>0){const n=r.length-1;return r[n]}if(e.session.length>0){const n=e.session.keys.length-1;return e.session.get(e.session.keys[n])}throw sf.Logger.error(Wr.WalletConnectV2ProviderErrorMessagesEnum.sessionNotConnected),new Error(Wr.WalletConnectV2ProviderErrorMessagesEnum.sessionNotConnected)}function d5(t,e){if(!e)throw new Error(Wr.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);const r=Mb(t,e);if(!(r!=null&&r.topic))throw new Error(Wr.WalletConnectV2ProviderErrorMessagesEnum.sessionNotConnected);return r.topic}function p5(t,e){return{optionalNamespaces:Th(t,e)}}function Fb(t,e){return{requiredNamespaces:Th(t,e)}}function Th(t,e){var r,n,i;const s=[...No.WALLETCONNECT_MULTIVERSX_METHODS,...(r=e==null?void 0:e.methods)!==null&&r!==void 0?r:[]];!((n=e==null?void 0:e.methods)===null||n===void 0)&&n.includes(Ig.OptionalOperation.SIGN_LOGIN_TOKEN)||s.push(Ig.OptionalOperation.SIGN_LOGIN_TOKEN);const o=[`${No.WALLETCONNECT_MULTIVERSX_NAMESPACE}:${t}`],a=(i=e==null?void 0:e.events)!==null&&i!==void 0?i:[];return{[No.WALLETCONNECT_MULTIVERSX_NAMESPACE]:{methods:s,chains:o,events:a}}}function g5(t){try{return!$b.Address.newFromBech32(t).isEmpty()}catch{return!1}}function y5(t){const e=t.namespaces[No.WALLETCONNECT_MULTIVERSX_NAMESPACE];if(e&&e.accounts){const r=e.accounts[0],[n,i,s]=r.split(":");return s}return""}function w5({transaction:t,response:e}){if(!e)throw sf.Logger.error(Wr.WalletConnectV2ProviderErrorMessagesEnum.invalidTransactionResponse),new Error(Wr.WalletConnectV2ProviderErrorMessagesEnum.invalidTransactionResponse);const{signature:r,guardianSignature:n,version:i,options:s,guardian:o}=e,a=t.guardian.toBech32();if(a&&a!==o)throw sf.Logger.error(Wr.WalletConnectV2ProviderErrorMessagesEnum.invalidGuardian),new Error(Wr.WalletConnectV2ProviderErrorMessagesEnum.invalidGuardian);return o&&(t.guardian=$b.Address.newFromBech32(o)),i&&(t.version=i),s!=null&&(t.options=s),t.signature=Buffer.from(r,"hex"),n&&(t.guardianSignature=Buffer.from(n,"hex")),t}function m5(t){if(t)return Object.assign(Object.assign({},t),{url:(0,h5.getAppMetadata)().url})}function b5(t){return f5(this,void 0,void 0,function*(){return yield new Promise(e=>setTimeout(()=>{e()},t))})}(function(t){var e=Ee&&Ee.__awaiter||function(p,g,w,v){function E(I){return I instanceof w?I:new w(function(x){x(I)})}return new(w||(w=Promise))(function(I,x){function A(P){try{O(v.next(P))}catch(M){x(M)}}function T(P){try{O(v.throw(P))}catch(M){x(M)}}function O(P){P.done?I(P.value):E(P.value).then(A,T)}O((v=v.apply(p,g||[])).next())})},r=Ee&&Ee.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};Object.defineProperty(t,"__esModule",{value:!0}),t.WalletConnectV2Provider=t.OptionalOperation=t.Operation=t.WalletConnectV2ProviderErrorMessagesEnum=void 0;const n=Pi,i=Sn,s=r(a5),o=Ub,a=lr,c=fr;Object.defineProperty(t,"WalletConnectV2ProviderErrorMessagesEnum",{enumerable:!0,get:function(){return c.WalletConnectV2ProviderErrorMessagesEnum}});const u=Js,l=Cn;Object.defineProperty(t,"Operation",{enumerable:!0,get:function(){return l.Operation}}),Object.defineProperty(t,"OptionalOperation",{enumerable:!0,get:function(){return l.OptionalOperation}});const f=rr;class h{constructor(g,w,v,E,I){this.chainId="",this.isInitializing=!1,this.processingTopic="",this.options={},this.account={address:""},this.onClientConnect=g,this.chainId=w,this.walletConnectV2Relay=v,this.walletConnectV2ProjectId=E,this.options=I}disconnect(){this.account={address:"",signature:""},this.walletConnector=void 0,this.session=void 0,this.pairings=void 0}init(){return e(this,void 0,void 0,function*(){var g,w;if(this.isInitialized())return this.isInitialized();try{if(!this.isInitializing){this.isInitializing=!0,this.disconnect();const v=!((g=this.options)===null||g===void 0)&&g.metadata?{metadata:(0,f.getMetadata)((w=this.options)===null||w===void 0?void 0:w.metadata)}:{},E=yield s.default.init(Object.assign(Object.assign(Object.assign({},this.options),{relayUrl:this.walletConnectV2Relay,projectId:this.walletConnectV2ProjectId}),v));this.walletConnector=E,this.isInitializing=!1,yield this.subscribeToEvents(E),yield this.checkPersistedState(E)}}catch{throw new Error(c.WalletConnectV2ProviderErrorMessagesEnum.unableToInit)}finally{return this.isInitializing=!1,this.isInitialized()}})}isInitialized(){return!!this.walletConnector&&!this.isInitializing}isConnected(){return!!(this.isInitialized()&&typeof this.session<"u")}getAccount(){return this.account}setAccount(g){this.account=g}connect(g){return e(this,void 0,void 0,function*(){var w,v;if(typeof this.walletConnector>"u")throw new Error(c.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);const E=(0,f.getConnectionParams)(this.chainId,g);try{return yield this.walletConnector.connect(Object.assign({pairingTopic:g==null?void 0:g.topic},E))}catch{if(g!=null&&g.topic)try{(v=(w=this.walletConnector.core)===null||w===void 0?void 0:w.expirer)===null||v===void 0||v.set(g.topic,0)}catch{u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.unableToHandleCleanup)}throw this.disconnect(),u.Logger.error(g!=null&&g.topic?c.WalletConnectV2ProviderErrorMessagesEnum.unableToConnectExisting:c.WalletConnectV2ProviderErrorMessagesEnum.unableToConnect),new Error(g!=null&&g.topic?c.WalletConnectV2ProviderErrorMessagesEnum.unableToConnectExisting:c.WalletConnectV2ProviderErrorMessagesEnum.unableToConnect)}})}login(g){return e(this,void 0,void 0,function*(){var w;if(this.isInitializing=!0,typeof this.walletConnector>"u"&&(yield this.connect()),typeof this.walletConnector>"u")throw new Error(c.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);typeof this.session<"u"&&(yield this.logout({topic:(w=this.session)===null||w===void 0?void 0:w.topic}));try{if(g&&g.approval){const v=yield g.approval();if(g.token){yield(0,f.sleep)(a.WALLETCONNECT_SIGN_LOGIN_DELAY);const E=(0,f.getAddressFromSession)(v),x=v.namespaces[a.WALLETCONNECT_MULTIVERSX_NAMESPACE].methods.includes(l.OptionalOperation.SIGN_NATIVE_AUTH_TOKEN)?l.OptionalOperation.SIGN_NATIVE_AUTH_TOKEN:l.OptionalOperation.SIGN_LOGIN_TOKEN,{signature:A}=yield this.walletConnector.request({chainId:`${a.WALLETCONNECT_MULTIVERSX_NAMESPACE}:${this.chainId}`,topic:v.topic,request:{method:x,params:{token:g.token,address:E}}});if(!A)throw u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.unableToSignLoginToken),new Error(c.WalletConnectV2ProviderErrorMessagesEnum.unableToSignLoginToken);return yield this.onSessionConnected({session:v,signature:A})}return yield this.onSessionConnected({session:v,signature:""})}}catch{throw this.disconnect(),u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.unableToLogin),new Error(c.WalletConnectV2ProviderErrorMessagesEnum.unableToLogin)}finally{this.isInitializing=!1}return null})}logout(g){return e(this,void 0,void 0,function*(){if(typeof this.walletConnector>"u")throw u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.notInitialized),new Error(c.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);try{if(this.processingTopic===((g==null?void 0:g.topic)||(0,f.getCurrentTopic)(this.chainId,this.walletConnector)))return!0;if(g!=null&&g.topic)this.processingTopic=g.topic,yield this.walletConnector.disconnect({topic:g.topic,reason:(0,o.getSdkError)("USER_DISCONNECTED")});else{const w=(0,f.getCurrentTopic)(this.chainId,this.walletConnector);this.processingTopic=w,yield this.walletConnector.disconnect({topic:w,reason:(0,o.getSdkError)("USER_DISCONNECTED")}),this.disconnect(),yield this.cleanupPendingPairings({deletePairings:!0})}}catch{u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.alreadyLoggedOut)}finally{this.processingTopic=""}return!0})}getAddress(){if(typeof this.walletConnector>"u")throw u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.notInitialized),new Error(c.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);return this.account.address}getSignature(){if(typeof this.walletConnector>"u")throw u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.notInitialized),new Error(c.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);return this.account.signature}getPairings(){return e(this,void 0,void 0,function*(){var g,w,v,E,I;if(typeof this.walletConnector>"u")throw u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.notInitialized),new Error(c.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);return(I=(E=(v=(w=(g=this.walletConnector)===null||g===void 0?void 0:g.core)===null||w===void 0?void 0:w.pairing)===null||v===void 0?void 0:v.pairings)===null||E===void 0?void 0:E.getAll({active:!0}))!==null&&I!==void 0?I:[]})}signMessage(g){return e(this,void 0,void 0,function*(){var w;const v=new n.Message({data:Buffer.from(g.data),address:(w=g.address)!==null&&w!==void 0?w:i.Address.newFromBech32(this.account.address),signer:"wallet-connect-v2",version:g.version});if(typeof this.walletConnector>"u")throw u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.notInitialized),new Error(c.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);if(typeof this.session>"u")throw u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.sessionNotConnected),this.onClientConnect.onClientLogout(),new Error(c.WalletConnectV2ProviderErrorMessagesEnum.sessionNotConnected);try{const E=this.getAddress(),{signature:I}=yield this.walletConnector.request({chainId:`${a.WALLETCONNECT_MULTIVERSX_NAMESPACE}:${this.chainId}`,topic:(0,f.getCurrentTopic)(this.chainId,this.walletConnector),request:{method:l.Operation.SIGN_MESSAGE,params:{address:E,message:v.data.toString()}}});if(!I)throw u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.invalidMessageResponse),new Error(c.WalletConnectV2ProviderErrorMessagesEnum.invalidMessageResponse);try{v.signature=Buffer.from(I,"hex")}catch{throw u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.invalidMessageSignature),new Error(c.WalletConnectV2ProviderErrorMessagesEnum.invalidMessageSignature)}}catch{throw new Error(c.WalletConnectV2ProviderErrorMessagesEnum.unableToSign)}return v})}signTransaction(g){return e(this,void 0,void 0,function*(){if(typeof this.walletConnector>"u")throw u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.notInitialized),new Error(c.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);if(typeof this.session>"u")throw u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.sessionNotConnected),this.onClientConnect.onClientLogout(),new Error(c.WalletConnectV2ProviderErrorMessagesEnum.sessionNotConnected);const w=g.toPlainObject();if(this.chainId!==g.chainID.valueOf())throw u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.requestDifferentChain),new Error(c.WalletConnectV2ProviderErrorMessagesEnum.requestDifferentChain);try{const v=yield this.walletConnector.request({chainId:`${a.WALLETCONNECT_MULTIVERSX_NAMESPACE}:${this.chainId}`,topic:(0,f.getCurrentTopic)(this.chainId,this.walletConnector),request:{method:l.Operation.SIGN_TRANSACTION,params:{transaction:w}}});return(0,f.applyTransactionSignature)({transaction:g,response:v})}catch{throw new Error(c.WalletConnectV2ProviderErrorMessagesEnum.transactionError)}})}signTransactions(g){return e(this,void 0,void 0,function*(){if(typeof this.walletConnector>"u")throw u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.notInitialized),new Error(c.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);if(typeof this.session>"u")throw u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.sessionNotConnected),this.onClientConnect.onClientLogout(),new Error(c.WalletConnectV2ProviderErrorMessagesEnum.sessionNotConnected);const w=g.map(v=>{if(this.chainId!==v.chainID.valueOf())throw u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.requestDifferentChain),new Error(c.WalletConnectV2ProviderErrorMessagesEnum.requestDifferentChain);return v.toPlainObject()});try{const{signatures:v}=yield this.walletConnector.request({chainId:`${a.WALLETCONNECT_MULTIVERSX_NAMESPACE}:${this.chainId}`,topic:(0,f.getCurrentTopic)(this.chainId,this.walletConnector),request:{method:l.Operation.SIGN_TRANSACTIONS,params:{transactions:w}}});if(!v)throw u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.invalidTransactionResponse),new Error(c.WalletConnectV2ProviderErrorMessagesEnum.invalidTransactionResponse);if(!Array.isArray(v)||g.length!==v.length)throw new Error(c.WalletConnectV2ProviderErrorMessagesEnum.invalidTransactionResponse);for(const[E,I]of g.entries()){const x=v[E];(0,f.applyTransactionSignature)({transaction:I,response:x})}return g}catch{throw new Error(c.WalletConnectV2ProviderErrorMessagesEnum.transactionError)}})}sendCustomRequest(g){return e(this,void 0,void 0,function*(){var w;if(typeof this.walletConnector>"u")throw u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.notInitialized),new Error(c.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);if(typeof this.session>"u")throw u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.sessionNotConnected),this.onClientConnect.onClientLogout(),new Error(c.WalletConnectV2ProviderErrorMessagesEnum.sessionNotConnected);if(!((w=g==null?void 0:g.request)===null||w===void 0)&&w.method){try{const v=Object.assign({},g.request);let{method:E}=v;const{response:I}=yield this.walletConnector.request({chainId:`${a.WALLETCONNECT_MULTIVERSX_NAMESPACE}:${this.chainId}`,topic:(0,f.getCurrentTopic)(this.chainId,this.walletConnector),request:Object.assign(Object.assign({},v),{method:E})});I||u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.invalidCustomRequestResponse)}catch{u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.invalidCustomRequestResponse)}return}})}ping(){return e(this,void 0,void 0,function*(){if(typeof this.walletConnector>"u")throw u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.notInitialized),new Error(c.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);typeof this.session>"u"&&u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.sessionNotConnected);try{const g=(0,f.getCurrentTopic)(this.chainId,this.walletConnector);return yield this.walletConnector.ping({topic:g}),!0}catch{return u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.pingFailed),!1}})}loginAccount(g){return e(this,void 0,void 0,function*(){return g?(0,f.addressIsValid)(g.address)?(this.account.address=g.address,g.signature&&(this.account.signature=g.signature),this.onClientConnect.onClientLogin(),this.account.address):(u.Logger.error(`${c.WalletConnectV2ProviderErrorMessagesEnum.invalidAddress} ${g.address}`),this.walletConnector&&(yield this.logout()),""):""})}onSessionConnected(g){return e(this,void 0,void 0,function*(){if(!g)return null;this.session=g.session,this.account.signature=g.signature||"";const w=(0,f.getAddressFromSession)(g.session);return w?(yield this.loginAccount({address:w,signature:g.signature}),this.account.address=w,this.account):null})}handleSessionEvents(g){return e(this,arguments,void 0,function*({topic:w,params:v}){var E;if(typeof this.walletConnector>"u")throw new Error(c.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);if(this.session&&((E=this.session)===null||E===void 0?void 0:E.topic)!==w)return;const{event:I}=v;if(I!=null&&I.name&&(0,f.getCurrentTopic)(this.chainId,this.walletConnector)===w){const x=I.data;this.onClientConnect.onClientEvent(x)}})}subscribeToEvents(g){return e(this,void 0,void 0,function*(){if(typeof g>"u")throw new Error(c.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);try{g.on("session_update",({topic:w,params:v})=>{var E;if(!this.session||((E=this.session)===null||E===void 0?void 0:E.topic)!==w)return;const{namespaces:I}=v,x=g.session.get(w),A=Object.assign(Object.assign({},x),{namespaces:I});this.onSessionConnected({session:A})}),g.on("session_event",this.handleSessionEvents.bind(this)),g.on("session_delete",w=>e(this,[w],void 0,function*({topic:v}){var E;this.isInitializing&&(this.onClientConnect.onClientLogout(),this.disconnect()),!(!this.session||((E=this.session)===null||E===void 0?void 0:E.topic)!==v)&&(u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.sessionDeleted),this.onClientConnect.onClientLogout(),this.disconnect(),yield this.cleanupPendingPairings({deletePairings:!0}))})),g.on("session_expire",w=>e(this,[w],void 0,function*({topic:v}){var E;!this.session||((E=this.session)===null||E===void 0?void 0:E.topic)!==v||(u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.sessionExpired),this.onClientConnect.onClientLogout(),this.disconnect(),yield this.cleanupPendingPairings({deletePairings:!0}))}))}catch{u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.unableToHandleEvent)}})}checkPersistedState(g){return e(this,void 0,void 0,function*(){if(typeof g>"u")throw new Error(c.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);if(this.pairings=yield this.getPairings(),!(typeof this.session<"u")&&g.session.length&&!this.account.address&&!this.isInitializing){const w=(0,f.getCurrentSession)(this.chainId,g);if(w)return yield this.onSessionConnected({session:w}),w}})}cleanupPendingPairings(){return e(this,arguments,void 0,function*(g={}){var w,v,E,I,x,A,T,O;if(!(typeof this.walletConnector>"u"))try{const P=(E=(v=(w=this.walletConnector.core)===null||w===void 0?void 0:w.pairing)===null||v===void 0?void 0:v.pairings)===null||E===void 0?void 0:E.getAll({active:!1});if(!(0,o.isValidArray)(P))return;for(const M of P)if(g.deletePairings)(x=(I=this.walletConnector.core)===null||I===void 0?void 0:I.expirer)===null||x===void 0||x.set(M.topic,0);else try{yield(O=(T=(A=this.walletConnector.core)===null||A===void 0?void 0:A.relayer)===null||T===void 0?void 0:T.subscriber)===null||O===void 0?void 0:O.unsubscribe(M.topic)}catch{u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.unableToHandleCleanup)}}catch{u.Logger.error(c.WalletConnectV2ProviderErrorMessagesEnum.unableToHandleCleanup)}})}}t.WalletConnectV2Provider=h})(Gg);(function(t){var e=Ee&&Ee.__createBinding||(Object.create?function(n,i,s,o){o===void 0&&(o=s);var a=Object.getOwnPropertyDescriptor(i,s);(!a||("get"in a?!i.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return i[s]}}),Object.defineProperty(n,o,a)}:function(n,i,s,o){o===void 0&&(o=s),n[o]=i[s]}),r=Ee&&Ee.__exportStar||function(n,i){for(var s in n)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,n,s)};Object.defineProperty(t,"__esModule",{value:!0}),r(Gg,t)})(Wg);window.process=zb;window.Buffer=zi.Buffer;document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("status"),e=document.getElementById("address"),r=document.getElementById("connectBtn"),n=document.getElementById("disconnectBtn"),i=document.getElementById("MyWalletConnectQRContainer");if(!t||!e||!r||!n||!i){console.error(" lment DOM manquant",{statusEl:t,addressEl:e,connectBtn:r,disconnectBtn:n,qrEl:i});return}const s="f4f84c031236a02d1fda5167859868f4",o="wss://relay.walletconnect.com",a="1";let c,u,l,f;const h={onClientLogin:async()=>{const E=await c.getAddress();t.textContent="Status: Connected",e.textContent=E,r.style.display="none",n.style.display="inline-block",i.innerHTML="",u||(u=document.createElement("div"),u.className="balance",u.style.textAlign="center",u.style.fontWeight="bold",u.style.marginTop="10px",i.parentNode.insertBefore(u,i.nextSibling));const I=await g(E);u.textContent=`Solde EGLD: ${I}`,l||(l=document.createElement("div"),l.className="balance-tsk",l.style.textAlign="center",l.style.fontWeight="bold",l.style.marginTop="5px",i.parentNode.insertBefore(l,u.nextSibling));const x=await w(E,"TSK");l.textContent=`Solde TSK: ${x}`,f||(f=document.createElement("div"),f.className="nft-list",f.style.display="flex",f.style.flexWrap="wrap",f.style.gap="15px",f.style.marginTop="15px",i.parentNode.insertBefore(f,l.nextSibling));const A=await v(E);f.innerHTML="",A.length===0?f.innerHTML="<p>Aucun NFT trouv pour cette adresse</p>":A.forEach(T=>{const O=document.createElement("div");O.style.border="2px solid #8B4513",O.style.borderRadius="12px",O.style.padding="10px",O.style.width="140px",O.style.textAlign="center",O.style.backgroundColor="#f9f5f0",O.style.boxShadow="2px 2px 10px rgba(0,0,0,0.2)";const P=document.createElement("img");P.src=T.image||"https://via.placeholder.com/120x120?text=No+Image",P.alt=T.name,P.style.width="120px",P.style.height="120px",P.style.borderRadius="8px",P.style.marginBottom="5px";const M=document.createElement("div");M.textContent=T.name,M.style.fontWeight="bold",M.style.fontSize="14px",M.style.marginBottom="3px";const U=document.createElement("div");U.textContent=`#${T.nonce}`,U.style.fontSize="12px",U.style.color="#555",O.appendChild(P),O.appendChild(M),O.appendChild(U),f.appendChild(O)})},onClientLogout:async()=>{t.textContent="Status: Not connected",e.textContent="",u&&u.remove(),l&&l.remove(),f&&f.remove(),r.style.display="inline-block",n.style.display="none",i.innerHTML=""}};c=new Wg.WalletConnectV2Provider(h,a,o,s);async function p(E){i.innerHTML=await Ms.toString(E,{type:"svg"})}r.addEventListener("click",async()=>{try{await c.init();const{uri:E,approval:I}=await c.connect();await p(E),await c.login({approval:I})}catch(E){console.error("Erreur WalletConnect:",E),alert("Erreur WalletConnect : "+(E.message||E))}}),n.addEventListener("click",async()=>{await c.logout()});async function g(E){var I;try{const T=await(await fetch(`${a==="T"?"https://devnet-api.multiversx.com":"https://api.multiversx.com"}/accounts/${E}`)).json();let O=((I=T.account)==null?void 0:I.balance)??T.balance??0;return(Number(O)/1e18).toFixed(4)}catch(x){return console.error("Erreur fetch EGLD balance:",x),"0.0000"}}async function w(E,I){var x;try{const M=(((x=(await(await fetch(`${a==="T"?"https://devnet-api.multiversx.com":"https://api.multiversx.com"}/accounts/${E}`)).json()).account)==null?void 0:x.esdts)||[]).find(U=>U.identifier===I);return M?(Number(M.balance)/10**(M.decimals||18)).toFixed(4):"0.0000"}catch(A){return console.error(`Erreur fetch ${I} balance:`,A),"0.0000"}}async function v(E){try{const A=await(await fetch(`${a==="T"?"https://devnet-api.multiversx.com":"https://api.elrond.com"}/accounts/${E}/nfts`)).json();return!A||A.length===0?[]:A.map(T=>({name:T.name||T.identifier||"NFT",identifier:T.identifier||"?",nonce:T.nonce||"?",image:T.media&&T.media.length>0?T.media[0].url:null}))}catch(I){return console.error("Erreur fetch NFTs:",I),[]}}});
